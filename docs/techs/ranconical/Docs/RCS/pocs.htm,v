head	1.8;
access;
symbols;
locks;
comment	@# @;


1.8
date	2025.03.25.20.59.47;	author dean;	state Exp;
branches;
next	1.7;

1.7
date	2019.02.05.16.23.26;	author leith;	state Exp;
branches;
next	1.6;

1.6
date	2019.01.15.19.36.35;	author leith;	state Exp;
branches;
next	1.5;

1.5
date	2015.08.31.14.32.38;	author leith;	state Exp;
branches;
next	1.4;

1.4
date	2013.12.12.17.05.43;	author leith;	state Exp;
branches;
next	1.3;

1.3
date	2013.12.12.15.59.17;	author leith;	state Exp;
branches;
next	1.2;

1.2
date	2013.12.12.15.58.12;	author leith;	state Exp;
branches;
next	1.1;

1.1
date	2012.12.21.14.40.58;	author leith;	state Exp;
branches;
next	;


desc
@@


1.8
log
@links
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>Random-conical tilt reconstruction</title>
</head>
<body lang="en-us" dir="ltr">

<i><p align="right">(Updated 2012 Nov 21)</p></i>

<center><p>
<font size="5"><b>Random conical tilt reconstruction</b></font>
</p></center>

<hr />

<b><p>Outline</p></b>
<ul>
	<li>General notes             </li>
	<li>Quick-start guide         </li>
	<li>Getting started           </li>
	<li>Procedure                 </li>
	<li>Miscellaneous procedure files </li>
	<li>References                </li>
</ul>

<hr />

<b><p>General notes</p></b>

<ul>
	<li>Sequential operations are numbered. Options are lettered.    </li>
	<li>Data extension assumed to be <b>.dat</b>. Adjust accordingly.</li>
	<li>List of inputs and outputs in description is not exhaustive. </li>
</ul>

<hr />

<b><p>Quick-start guide</p></b>
<ol>
	<li>tar -xvf $PROCEDURE.tar                                        </li>
	<li>spider rct/dat @@makeparams (or copy <b>params.dat</b>)     </li>
	<li>(optional) tar -xvf $DATA.tar                              </li>
	<li>mkfilenums.py filenums.dat $MICROGRAPHS*                   </li>
	<li>(for non-SPIDER format micrographs) spider rct/dat @@convert</li>
	<li>spider rct/dat @@shrinkmics                                 </li>
	<li>cd Micrographs/ ; montagefromdoc  ../filenums.dat          </li>
	<li>spider rct/dat @@micpair                                    </li>
	<li>(required for JWEB) spider rct/dat @@padmics                </li>
	<li>pick tilt pairs in JWEB or WEB                             </li>
	<li>spider rct/dat @@makesomenoise (or copy <b>noise.dat</b>)   </li>
	<li>spider rct/dat @@windowparticles                            </li>
	<li>(for negative stain) Do both of:                           </li>
	   <ol type=a>
              <li>spider rct/dat @@highpass-untilted                    </li>
              <li>spider rct/dat @@highpass-tilted                      </li>
           </ol>
	<li>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*   </li>
	<li>(if necessary) spider rct/dat @@removebad                   </li>
	<li>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*    </li>
	<li>(if necessary) spider rct/dat @@removebad                   </li>
	<li>(slow) spider rct/dat @@pairwise                            </li>
	<li>(optional) To reorient average, do both of:                </li>
           <ol type=a>
              <li>spider rct/dat @@reorientavg                          </li>
              <li>spider rct/dat @@sumalign                             </li>
           </ol>
<!--</ol>
<OL START=13>-->
	<li>spider rct/dat @@filtershrink                                          </li>
	<li>spider rct/dat @@ca-pca                                                </li>
	<li>Classify.  (Ward's method shown here.  For other options, see below.) </li>
	   <ol type=a>
              <li>spider  rct/dat @@hierarchical                                   </li>
              <li>spider  rct/dat @@binarytree                                     </li>
              <li>cd Zerodegr/Tree ; binarytree labeled0001.dat 4 selclasses.dat  </li>
	   </ol>
	<li>Iterate:                                                              </li> 
           <ol type=a>
              <li>spider rct/dat @@multirefalign (subsequently @@multirefalign-descend)</li> 
              <li>spider rct/dat @@filtershrink     </li> 
              <li>spider rct/dat @@classifybyview   </li>
              <li>verifybyview                     </li> 
            </ol>
	<li>spider rct/dat @@combinegoodclasses     </li> 
	<li>spider rct/dat @@viewaverages           </li> 
	<li>spider rct/dat @@centertilt             </li>
	<li>spider rct/dat @@storeangles            </li>
	<li>(optional) spider rct/dat @@d6symmetry  </li>
	<li>spider rct/dat @@bpclass                </li>
	<li>spider rct/dat @@volfilt                </li>
	<li>(if multiple orientations) Do both of: </li>
           <ol type=a>
              <li>spider rct/dat @@volalignprj      </li>
              <li>spider rct/dat @@mergevols        </li>
           </ol>
	<li>spider rct/dat @@prepare-prjmatch       </li>
</ol>

<hr />

<b><p>Getting started</p></b>

<ul>
    <li>Create a new directory, and change to that directory before unpackaging the 
        procedure-file tarball.                                               </li>
    <li>Micrographs should be placed in the <b>Micrographs/</b> directory.  
        If they are not in SPIDER format, you'll then need to run
        <a href="../convert.rct">convert.rct</a> for the conversion.              </li>

    <li>SPIRE libraries are required for various Python scripts, such as
	<a href="https:spider-em.github.io/spire/bin/mkfilenums.py"> mkfilenums.py</a> 
        and <a href="tree.py">tree.py</a>. 
        Installation instructions for SPIRE can be found 
        <a href="https:spider-em.github.io/spire/install.html">here</a>.
        These steps can usually be substituted with SPIRE-independent analogs. </li> 
</ul>

<hr />

<b><p>Procedure</p></b>

<ul>

<li><p>Prepare directory</p>                                                </li>
    <ul>
        <li>Download 
            <a href="../../../techs/ranconical/tar_archive/rct_procs.tar.gz">
            rct procedures tar archive</a>  and unpackage it by typing:
	    <pre>tar -xvf rct_procs.tar.gz</pre>
	    This will unpackage the files in the currect directory, 
	    so create a new directory if so desired.                        </li>
    </ul>

<li><p>Prepare parameter doc file</p>                                       </li>
    <ul>
        <li>PROCEDURE FILE: <a href="../makeparams.rct">makeparams.rct</a>  </li>
        <li>OUTPUTS:    <b>params</b>                                       </li>
        <li>Otherwise, you can copy a <b>params</b> file from elsewhere.    </li>
        <li>The following parameters (described <a href="params.html"> here</a>) 
            are used from the <b>params</b> file:                           </li>
            <ul>
                <li><b>1</b> -- zip flag -- if set to 1, then particle images 
                                  will be uncompressed using gunzip         </li>
				<ul><li>used by convert.rct                 </li></ul>
                <li><b>2</b> -- format flag -- 0 corresponds to SPIDER, 
                                              3 to Z/I TIFF, etc.           </li>
			        <ul><li>used by convert.rct                 </li></ul>
                <li><b>5</b> -- pixel size -- in Angstroms                  </li>
				<ul><li>used by shrinkmics.rct              </li></ul>
                <li><b>17</b> -- window size -- in pixels                   </li>
				<ul><li>used by many procedure files        </li></ul>
                <li><b>18</b> -- particle diameter -- in pixels             </li>
				<ul><li>used by pairwise.rct                </li></ul>
		<!--	<li><b>NUMBER</b> -- FLAG -- DESCRIPTION</li>
					<ul><li>used by PROCEDURE</li></ul>-->
           </ul>
     </ul>

<li><p><i>(optional)</i> Copy sample data.</p>                               </li>
    <ul>
        <li>Download the 
            <a href="../../../techs/ranconical/tar_archive/data20060817.tar.gz">
            data archive</a> and unpackage it by typing:                     </li>
            <pre>tar -xvf data20060817.tar.gz</pre>
        <li>This command will create a directory called <b>Micrographs/</b>, 
            containing phantom micrographs, and a directory called <b>TP1/</b>,
            containing the files used to generate the micrographs.           </li>
   </ul>

<li><p>Generate a list of micrographs.</p></li>
   <ul>
       <li>PYTHON SCRIPT: href="https:spider-em.github.io/spire/bin/makefilenums.py">mkfilenums.py</a> </li>
       <li>To make a list of TIFF files, for example, the syntax would be:                  </li>
          <pre>mkfilenums  filenums.dat Micrographs/zeiss*.tif</pre>
       <li>This Python script uses the SPIRE library. 
           If SPIRE is not installed, you can generate <b>filenums</b> using other means, 
           such as by manually entering the filenumbers using 
           <a href="../../../man/doccreate.html"> 'DOC CREATE'</a> 
           in SPIDER.                                                                       </li>
   </ul>

<li><p><i>(optional)</i> If the micrographs are not already in SPIDER format, convert them.</p></li>
    <ul>
        <li>PROCEDURE FILE: <a href="../convert.rct">convert.rct</a>                               </li>
        <li>SUBROUTINE: <a href="../convert_p.rct">convert_p.rct</a>                           </li>
        <li>INPUTS:     <b>filenums</b>, <b>Micrographs/mic****</b>                         </li>
        <li>Downstream procedure files will expect files called <b>Micrographs/mic****</b>. 
            Keeping that convention will minimize the number of changes you'll need to make.</li>
        <li>TO DO: add conversion flag for MRC files.                                       </li>
     </ul>

<li><p>Shrink the micrographs for particle-picking.</p>                   </li>
     <ul>
        <li>PROCEDURE FILE: <a href="../shrinkmics.rct">shrinkmics.rct</a>       </li>
        <li>INPUTS: <b>filenums</b>, <b>Micrographs/mic****</b>           </li>
        <li>INPUTS: <b>Micrographs/sm-mic****</b>                         </li>
        <li>Choose the reduction factor such that the micrograph fits 
            on the screen, or that the particles are visible.  
            These downsampled micrographs will be used to pick tilt pairs.</li>
        <li>The filtration step is slow, so 
            by setting <i>[filter-radius]=0</i>, you can skip this step.  </li>
    </ul>

<li><p>Screen micrographs.</p></li>
     <ul>
        <li>Micrographs can be screened using various display programs.
            To use montagefromdoc.py, from <b>Micrographs/</b>
            (there is a pre-existing <b>.montagefromdoc</b> file there), type:
            <pre>montagefromdoc   ../filenums.dat sm-mic*</pre>
            The output should also be <b>filenums</b>.</li>
        <li>If you wish to remove micrographs by editing <b>filenums</b>
            (instead of with montagefromdoc),
            renumber it to have consecutive keys, using 
            <a href="../../../man/docren.html">'DOC REN'</a>. 
           (The input and output can have the same name.) </li>
     </ul>

<li><p>Establish pairings between micrographs</p>                              </li>
    <ul>
        <li>PROCEDURE FILE: <a href="../micpair.rct">micpair.rct</a>                  </li>
        <li>INPUTS: <b>filenums</b>                                            </li>
        <li>OUTPUTS: <b>docmicpairs</b>                                        </li>
        <li>This procedure file presumes that the tilted-specimen micrograph precedes the untilted-specimen micrograph.
             Check the output to confirm that the pairings make sense.         </li>
    </ul>

<li><p>Resize micrographs (Required for JWEB, not required for X-Window WEB)</p></li>
    <ul>
        <li>PROCEDURE FILE: <a href="../padmics.rct">padmics.rct</a>                   </li>
        <li>INPUTS:  <b>docmicpairs</b>, <b>Micrographs/sm-mic****</b>          </li>
        <li>OUTPUTS: <b>Micrographs/jweb-mic{***[untilted]}</b>, 
                     <b>Micrographs/jweb-mic{***[untilted]}_tilted</b>          </li>
        <li>JWEB has a "feature" that requires the tilt pair to have the same dimensions. 
            This procedure file pads the micrographs to the same size. 
            Another feature is that JWEB expects the tilted micrograph to be second, 
            even though it is typically collected first at the microscope.      </li>
    </ul>

<li><p>Pick tilt pairs (for JWEB, differences for X-Window WEB noted below)</p>  </li>
	<ul>
	    <li>INPUTS: <b>Micrographs/jweb-mic{***[untilted]}</b>, <b>Micrographs/jweb-mic{***[untilted]}_tilted</b>
	    <p></p></li>
	</ul>
	<OL type='A'>
	    <li>If using JWEB: </li>
		<ol>
			<li>From the <b>Micrographs/</b> directory, open JWEB. </li>
			<li>Go to <i>File -> Open -> Image Series</i> and select a pair of micrographs. 
			    Adjust the contrast as convenient. 
			    Do <u>NOT</u> resize the micrographs using <i>Edit</i> &gt; <i>Resize</i>, 
			    for ease of use with the procedure files below.</li>
			<li>Click on the <i>Markers/Tilt Pair</i> tab.</li>
			<li>In the <i>Marker File Number</i> field, enter the number of the untilted micrograph.</li>
			<li>Click on the <i>Show/Edit Marker</i> button, which will display the images.</li>
			<li>Select a particle from the untilted micrograph, and 
				the corresponding particle from the tilted micrograph.
				Repeat this for at least four particles, 
				separated as far as possible in the micrograph, 
				ideally in the four corners, but the farther apart the better. 
				<br /><i>HINT:</i> The middle mouse button will erase a pair of points 
				if you make a mistake, or if JWEB becomes confused..
				<br /><i>HINT:</i> Since the numbering is to the right of the marker, 
				it may be easier to proceed from right to left.</li>
			<li>Click on buttons <i>Save Marker Files</i> and <i>Determine Theta</i>, 
				which will determine the magnitude of the tilt angle between the micrographs.</li>
			<li>Click on the <i>Fit Angles</i> button.
				This will determine the direction of the tilt axis.</li>
			<li>Click on the <i>Draw Fitted Locations</i> button.
				This will slightly adjust the locations of the fitted coordinates according to the fitting above, 
				but does not affect the coordinates selected with the mouse.</li>
			<li>Click on the <i>Save Angles</i> button.</li>
			<li>Now, when you select a particle in the untilted image, 
				JWEB will send the cursor to the corresponding location in the tilted image.</li>
			<li>Select more particles from the tilt pair. 
				(For the sample micrograph, there are 76 pairs.  Select all of them.)</li>
			<li>To save the new values, re-click the five buttons: <i>Save Marker Files</i>, <i>Determine Theta</i>, 
				<i>Fit Angles</i>, <i>Draw Fitted Locations</i>, and <i>Save Angles</i>.</li>
		</ol>
	    <li>If using X-Window WEB: </li>
		<ol>
		    <li>From the menu, select <i>COMMANDS</i> &gt; <i>Tilted Particles</i>, 
		        and select first the untilted-specimen image (which is normally collected second) 
		        and then the tilted-specimen image.  </li>
		    <li>In the <i>Particle doc</i> popup window, under <i>Doc file number</i>, 
		        enter the number of the untilted micrograph and click <i>ACCEPT</i>.        </li>
		    <li>Select a particle from the untilted micrograph, and 
			the corresponding particle from the tilted micrograph.
			Repeat this for at least four particles, 
			separated as far as possible in the micrograph, 
			ideally in the four corners, but the farther apart the better.              </li>
		    <li>Click the middle button to open the <i>Particle picking menu_popup</i>.     </li>
		    <li>Click on <i>Determine tilt axis angles</i>, <i>Draw fitted locations</i>, 
		        and <i>Save angles in doc file</i>.</li>
		    <li>Now, when you select a particle in the untilted image, 
			WEB will send the cursor to the corresponding location in the tilted image.</li>
		    <li>Select more particles from the tilt pair. 
			(For the sample micrograph, there are 76 pairs.  Select all of them.)       </li>
		    <li>To save the new values, re-click the three buttons: <i>Determine tilt axis angles</i>, 
		        <i>Draw fitted locations</i>, and <i>Save angles in doc file</i>.           </li>
		    <li>Differences between JWEB and X-Window WEB:                                  </li>
			<ul>
			    <li>X-Window WEB does not require the pair of micrographs to be the same size, 
				so the step <a href="../padmics.rct">padmics.rct</a> is unnecessary.   </li>
			    <li><u>WARNING</u>: If you entered a number under <i>Image reduction factor</i>
				(after setting the reduction factor in <i>OPTIONS</i> &gt; <i>Image</i>)
				do <u>NOT</u> set the parameter <i>[decimation-factor]</i> below in 
				<a href="../windowparticles.rct">windowparticles.rct</a>. 
				Using both parameters will be redundant.</li>
			    <li>There is no <i>Save Marker Files</i> button.
				Coordinates are saved continuously.</li>
			    <li><i>Determine Theta</i> and <i>Fit Angles</i> are merged into one button: 
				<i>Determine tilt axis angles</i>.</li>
			</ul>
		</ol>
	</ol>
	<ul>
	    <li><i>HINT:</i> Save the coordinates frequently. 
		JWEB gets confused from time to time, 
		and the main console window will show which particles have it confused. 
		Delete those particles (using the middle mouse button), and re-pick them, as necessary.</li>
	    <li><i>HINT:</i> If, while picking pairs, the fitted locations stray from the correct location 
		(which could be the case if earlier fittings were done using a limited area, or 
		if the support film deviates from flatness), 
		it may help to re-do the fitting (summarized under the previous bullet).</li>
	    <li><i>HINT:</i> If you close a pair or micrographs and re-open them
		(with the appropriate <i>Marker File Number</i>), 
	    you can resume from where you left off.                                      </li>
	</ul>

<li><p>Obtain a noise image for normalization.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="../makesomenoise.rct">makesomenoise.rct</a>        </li>
		<li>INPUTS: a micrograph </li>
		<li>OUTPUTS: <b>noise</b>, <b>tmpnoise/noi***</b>                        </li>
		<li>Subsequent windowed images will be normalized against the output noise file.
			If you have a pre-existing noise file, copy it to <b>noise.dat</b></li>
		<li>One noise file will be chosen at random by the procedure file.
			You can also look at the noise images in the <b>tmpnoise/</b> directory
			and copy one that looks even "noisier" to    <b>noise.dat</b>
			(in the top-level directory).                                   </li>
	</ul>

<li><p>Window particles from tilted and untilted micrographs.</p>                       </li>
	<ul>
		<li>PROCEDURE FILE: <a href="../windowparticles.rct">windowparticles.rct</a>   </li>
		<li>PARAMETER: <i>[decimation-factor]</i> -- If you used the output of 
		    <a href="../shrinkmics.rct">shrinkmics.rct</a> and/or 
		    <a href="../padmics.rct">padmics.rct</a>, use that value here. 
		    If you used the full-sized micrographs, use the value used under 
		    <i>Edit</i> &gt; <i>Resize</i> (for JWEB) or 
		    <i>Image reduction factor</i> (for X-Window WEB). 
		    Ultimately, this parameter needs to be the factor between 
		    the full-sized micrograph and the version used for particle-selection.</li>
		<li>INPUTS:  <b>params</b>, <b>docmicpairs</b>, <b>noise</b>,
			     <b>Micrographs/mic****</b>, <b>Micrographs/dcu****</b>, 
                             <b>Micrographs/dct****</b>                                 </li>
		<li>OUTPUTS: <b>listparticles</b>,
			<b>Zerodegr/Winrot/unt*****</b>, <b>Tilted/Winrot/tilt*****</b> </li>
	</ul>

<li><p>(Recommended for stained images) High-pass filter windowed images</p>
    
    <p>For negatively-stained images, it is often the case that the puddle of stain surrounding the particles 
    dominates the classification (although maybe not the case for deep-stained specimens).  
    In this case, it may be helpful to high-pass filter the images using a filter radius 
    larger than the size of your particle.  If the filter radius is too fine however, 
    the aligning power of the images will be lost.  You may need to tweak the radii.</p> 
    
    <p>If you are unsure whether to do this step, feel free to skip it, 
    but look at the reconstituted images when you run <a href="../ca-pca".rct">ca-pca.rct</a> 
    in order to see if the stain is the predominant source of variation. </p>        </li>
	<ol>
	    <li>PROCEDURE FILE: <a href="../highpass-untilted.rct">highpass-untilted.rct</a></li>
	    <ul>
		<li>INPUTS:  <b>Zerodegr/Winrot/unt*****</b> (directory renamed to <b>Unhighpass</b></li>
		<li>OUTPUTS: <b>Zerodegr/Winrot/unt*****</b>                         </li>
	    </ul>
	    <li>PROCEDURE FILE: <a href="../highpass-tilted.rct">highpass-tilted.rct</a>    </li>
	    <ul>
		<li>INPUTS:  <b>Tilted/Winrot/tilt*****</b> (directory renamed to <b>Unhighpass</b></li>
		<li>OUTPUTS: <b>Tilted/Winrot/tilt*****</b> </li>
	    </ul>
	</ol>

<li><p>Screen the windowed images for defects (micrograph edges, dust, etc.).</p></li>
	<ul>
		<li>Screen the untilted--specimen windowed images by running
		    <a href="https:spider-em.github.io/spire/bin/montagefromdoc.htm"> 
                    montagefromdoc.py</a>,
                    using the following command:
		    <pre>montagefromdoc  listparticles.dat  Zerodegr/Winrot/unt*</pre>
		Use <b>notgood</b> as the output doc filename.                             <br />  </li>
		<li>Only click on the bad images.
			For the untilted-specimen images, the particle-selection need not be stringent. 
			There will be additional rounds of selection downstream.                   </li>
		<li>If particles are rejected, run: <a href="../removebad.rct">removebad.rct</a>      </li>
		<ul>
		    <li>INPUTS: <b>listparticles</b> (will be backed up by 
                                <a href="../backup.rct">backup.rct</a>), <b>notgood</b>               </li>
		</ul>
		<li>Now screen the tilted images for defects:                                      </li>
		    <pre>montagefromdoc listparticles.dat Tilted/Winrot/tilt*</pre>
		<li>Only click on the bad images.
			For the tilted images, this will be the only opportunity to weed out bad particles --
			such as dust, edges, double-particles, etc. -- so be more stringent here.     </li>
		<li>If tilted particles are rejected, re-run <a href="../removebad.rct">removebad.rct</a></li>
	</ul>

<li><p>Align the untilted-specimen particles using reference-free alignment.</p>  </li>
	<ul>
		<li>PROCEDURE FILE: <a href="../pairwise.rct">pairwise.rct</a>           </li>
		<li>INPUTS: <b>listparticles</b>, <b>Zerodegr/Winrot/unt*****</b> </li>
		<li>OUTPUTS: <b>Zerodegr/Pairwise/rfreeavg001</b>, <b>Zerodegr/Aligned/cenu*****</b>, 
			<b>Zerodegr/Pairwise/docpairalign</b>, many others        </li>
		<li>This procedure file first aligns pairs of images, averages them, 
			then aligns the average of pairs, etc.
			The first level ("depth") will be slow, 
			and each subsequent level will be faster.                 </li>
	</ul>

<li><p><i>(optional)</i> Attempt to align average along coordinate axes</p></li>
	<ol>
	    <li>Align average along coordinate axes
		<ul>
		    <li>PROCEDURE FILE: <a href="../reorientavg.rct">reorientavg.rct</a>                    </li>
		    <li>INPUTS: <b>Zerodegr/Pairwise/rfreeavg001</b>                                 </li>
		    <li>OUTPUTS: <b>Zerodegr/Pairwise/dsolalign</b>, <b>Zerodegr/Pairwise/malign</b> </li>
		    <li>This procedure file aligns the average to a mirrored version of itself, 
			    in an attempt to orient the major axis of the particle along the coordinate axes.
			    There will be two solutions, along <i>x</i> or along <i>y</i>. 
			    It is arbitrary which one to choose.  
			    If you wish to reorient the particles to either of these averages, 
			    note which solution to use (1 or 2), and run the next procedure file, 
			    <a href="../sumalign.rct">sumalign.rct</a>.                                </li>
		</ul>

	    <li>Combine alignments of individual particles with reoriented average</li>
		<ul>
			<li>PROCEDURE FILE: <a href="../sumalign.rct">sumalign.rct</a> </li>
			<li>PARAMETER: solution 1 or 2 (see description below) </li>
			<li>INPUTS: <b>Zerodegr/Winrot/unt*****</b>, <b>Zerodegr/Pairwise/dsolalign</b>, 
				<b>Zerodegr/Pairwise/docpairalign</b> </li>
			<li>OUTPUTS: <b>Zerodegr/Pairwise/dalu001</b>, <b>Zerodegr/Aligned/cenu*****</b>, 
				<b>Zerodegr/Pairwise/avgu001</b> </li>
			<li>If you wish to apply the alignments of the average from
				<a href="../reorientavg.rct">reorientavg.rct</a>, then run this procedure file.  
				Note which solution you would like to apply (1 or 2). 
				Typically, in one solution the major axis is along <i>x</i>.
				and in the other it is along <i>y</i>.
				It is arbitrary which solution to use.</li>
		</ul>
	</ol>

<li><p>Filter the aligned, untilted particles.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="../filtershrink.rct">filtershrink.rct</a> </li>
		<li>PARAMETERS: reduction factor, low-pass filter parameters    </li>
		<li>INPUT:  <b>Zerodegr/Aligned/cenu*****</b>                   </li>
		<li>OUTPUT: <b>Zerodegr/Filtered/flt*****</b>                   </li>
		<li>Remember to change the input filename if you ran 
                    <a href="../sumalign.rct">sumalign.rct</a>.                    </li>
		<li>The filtered images produced will be used for multivariate data analysis and classification.
                    To look at the filtered untilted particles, type:       </li>
                    <pre>montagefromdoc listparticles.dat Zerodegr/Filtered/flt*</pre>
	</ul>

<li><p>Run correspondence analysis (CA) or principal component analysis (PCA) on filtered images.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="../ca-pca".rct">ca-pca.rct</a>                     </li>
		<li>PARAMETERS:                                                         </li>
                    <ul>
                    <li><i>flag for CA (1), PCA (2), or iterative PCA (3)</i> --
                        One method or another sometimes crashes due to "numerical inaccuracy."
                        I, subjectively, try CA first, then iterative PCA, then PCA last.</li>
                    <li><i>number of factors to calculate</i> --
                        If after you run this procedure file, 
                        all of the eigenimages look meaningful,
                        increase this parameter and re-run.                             </li>
                    </ul>
		<li>INPUT: <b>Zerodegr/Filtered/flt*****</b>                            </li>
		<li>OUTPUT: <b>Zerodegr/MSA/cas_***</b>, <b>Zerodegr/MSA/reconstituted***</b>, others </li>
		<li>The commands to generate the PostScript eigenvalue histogram require the 
                    SPIRE Python libraries ( 
		    <a href="https:spider-em.github.io/spire/install.html">
                    (nstallation instructions</a>).                                     </li>
		<li>For negatively-stained samples, when looking at the reconstituted images, 
		    if it appears that the stain distribution is the greatest source of variation, 
		    go back to the high-pass filtration step above.                     </li>
	</ul>

<li><p>Classify images. Chose one of:</p></li>
	<ol type=a>
		<li>K-means clasification. </li>
		<ul>
			<li>PROCEDURE FILE: <a href="../kmeans.rct">kmeans.rct</a> </li>
			<li>PARAMETERS:</li>
				<ul>
					<li><i>desired number of classes</i> --
						Too small a number, and dissimilar particles will be grouped together, 
						and too large a number, and the class averages will be noisy. 
						I typically use a number that doesn't produce classes 
						whose montage doesn't fit on the screen, i.e., 
						one class per 50 to 75 particles.</li>
					<li><i>number of factors to use</i> --
						choose this number based on the appearance of the eigenimages 
						and the strength of the factors (based on the histogram). 
						Use of the weaker factors will probably not make a big difference though.</li>
				</ul>
			<li>INPUTS: <b>Zerodegr/MSA/cas_***</b>, <b>Zerodegr/Filtered/flt*****</b> </li>
			<li>OUTPUTS: <b>classavg***</b>, <b>docclass****</b>, others </li>
		</ul>

		<li>Hierarchical classification, using Ward's method. </li>
		<ol>
			<li>Run classification. </li>
			<ul>
				<li>PROCEDURE FILE: <a href="../hierarchical.rct">hierarchical.rct</a> </li>
				<li>PARAMETER: <i>number of factors to use</i> --
					choose this number based on the appearance of the eigenimages 
					and the strength of the factors (based on the histogram). 
					Use of the weaker factors will probably not make a big difference though.</li>
				<li>INPUTS: <b>Zerodegr/MSA/cas_***</b> </li>
				<li>OUTPUTS: <b>docdendro</b> </li>
			</ul>

			<li>Generate class averages. Choose one of:</li>
			<ol type=a>
				<li>Generate binary tree using tree.py</li>
				<ul>
					<li>PROCEDURE FILE: <a href="../binarytree.rct">binarytree.rct</a> </li>
					<li>SUBROUTINES: averagenode.rct, update_lut.rct </li>
					<li>PARAMETER: <i>ending depth</i> --
						For the depth that you specify here, there will be up to 2^<i>depth</i> averages generated. 
						For high values, the averages may be too noisy to be useful. 
						It is better to make too many and display fewer in the next step.</li>
					<li>INPUT: <b>docdendro</b> </li>
					<li>OUTPUTS: <b>avgnode***</b>, <b>labeled***</b> </li>
					<li>NOTE: The format of SPIDER's dendrogram doc file changed in version 17.13. 
						Previous the top two branches had height 1, whereas now, it's 100. 
						If this procedure file crashes, check this parameter.</li>
					<li>To view the binary tree, run <A href="tree.py">binarytree</A>. 
						here</a>. Briefly, an example of the syntax is:
						<pre>cd Zerodegr/Tree ; binarytree labeled0001.dat 4 selclasses.dat</pre>
						Save the selection file with <i>CTRL-s</i>.<p></p></li>
				</ul>

				<li>Generate binary tree as (large) SPIDER image</li>
				<ul>
					<li>Alternatively, you can run <a href="../tree.rct">tree.rct</a>,
						which creates a large image in SPIDER format. 
						Be aware that the image becomes unwieldy for large trees. 
						If you choose this option, you may wish to copy the file to another format
						and view it in a dedicated image-viewer.</li>
				</ul>

				<li>Simple class averages</li>
				<ul>
					<li>This option is equivalent to the bottom row in the binary tree above, 
						or the display in WEB, and similar to simple K-means.</li>
					<li>PROCEDURE FILE: <a href="../classavg.rct">classavg.rct</a> </li>
					<li>PARAMETER:  <i>desired number of classes</i></li>
					<ul>
					</ul>
						<li>Too small a number, and dissimilar particles will be grouped together, 
							and too large a number, and the class averages will be noisy. 
							I typically use a number that produces no classes 
							whose montage doesn't fit on the screen, i.e., 
							one class per 50 to 75 particles.</li>
						<li>If you're going to run <a href="../binarytree.rct">binarytree.rct</a>
							next, the necessary class averages will be generated there.  
							So, it doesn't matter how many classes you request here.</li>
					<li>INPUTS: <b>Zerodegr/Hierarchical/docdendro</b>
					    (other classification options write <b>docdendro</b> in different locations)</li>
					<li>OUTPUTS: <b>classavg***</b>, <b>docclass****</b>, <b>listclasses</b>, others </li>
				</ul>
			</ol>
		</ol>

		<li>Clustering using Diday's method. </li>
		<ol>
			<li>Run classification. </li>
			<ul>
				<li>PROCEDURE FILE: <a href="../cluster.rct">cluster.rct</a> </li>
				<li>PARAMETER: <i>number of factors to use</i> --
					choose this number based on the appearance of the eigenimages 
					and the strength of the factors (based on the histogram). 
					Use of the weaker factors will probably not make a big difference though.</li>
				<li>INPUTS: <b>Zerodegr/MSA/cas_***</b>                </li>
				<li>OUTPUTS: <b>docdendro</b>                          </li>
			</ul>

			<li>Generate class averages. </li>
			<ul>
				<li>PROCEDURE FILE: <a href="../classavg.rct">classavg.rct</a> </li>
				<li>PARAMETER: <i>desired number of classes</i> --
						Too small a number, and dissimilar particles will be grouped together, 
						and too large a number, and the class averages will be noisy. 
						I typically use a number that produces no classes 
						whose montage doesn't fit on the screen, i.e., 
						one class per 50 to 75 particles.       </li>
				<li>INPUTS: <b>docdendro</b>                            </li>
				<li>OUTPUTS: <b>classavg***</b>, <b>docclass****</b>, <b>listclasses</b>, others </li>
				<li>I haven't been able to make this compatible with 
					<a href="../binarytree.rct">binarytree.rct</a>,
					so for now, it's functionally equivalent to K-means.</li>
			</ul>
		</ol>

	</ol>

<li><p>Select unique classes.</p></li>
	<ul>
		<li>The classes selected will be used for multireference alignment. 
			It isn't vital to verify indivudual particles yet.
			This step will depend on which classification method you used, 
			i.e., hierarchical, K-means, or Diday's.
			The <b>.verifybyview</b> file included in the tarball 
			<li>Included in the tarball is a starting <b>.verifybyview</b> file to use. 
			    If not using 
			    <a href="https:spider-em.github.io/spire/tools-docs/verifybyview.html"">
                            verifybyview.py</a>, 
                            call the output class-selection doc file <b>selclasses</b>.   </li>
		<ol type=a>
			<li>To view+select the averages from K-means, type:                </li>
				<pre>verifybyview  Zerodegr/Kmeans/listclasses.dat</pre>
			<li>To view+select the averages from hierarchical classification, use one of the following:
				<pre>verifybyview  Zerodegr/Hierarchical/listclasses.dat</pre>
				
				<u>OR</u> (if you ran 
                                <a href="../binarytree.rct">binarytree.rct</a>):            </li>
				<pre>cd Zerodegr/Tree ; binary labeled0001.dat 5 selclasses.dat</pre>
			<li>To view+select the averages from Diday's method, type:       </li>
				<pre>verifybyview  Zerodegr/Cluster/listclasses.dat    </pre>
		</ol>
		<li>For verifybyview.py, the filenames at the initial dialog are:</li>
			<ul>
				<li><b>listclasses</b> -- can be specified on the command line </li>
				<li><b>classavg***</b> -- class-average template </li>
			</ul>
		Subsequent filenames are:
			<ul>
				<li><b>Zerodegr/Filtered/flt*****</b> -- particle template </li>
				<li><b>selclasses</b> -- list of selected classes </li>
				<li><b>byhand***</b> -- selected particles in a given class</li>
			</ul>
	</ul>

<li><p>Run multireference alignment.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="../multirefalign.rct">multirefalign.rct</a> </li>
		<li>PARAMETERS, notable ones include: </li>
		  <ul>
		    <li><i>[cg-option]</i> -- if this is set to 1 (the default), 
		        center of gravity for each reference is computed using 
		        <a href="../../../man/cgph.html">'CG PH'</a>. 
		        Using negative-stain data, this option may not work well.  
		        You can look at the <b>Zerodegr/Multiref/ref***</b> files while the 
		        (slow) multi-reference alignment is running to check.</li>
		    <li><i>[mirror-option]</i> -- if this is set to 0 (the default), 
		        experimental images are NOT compared to mirrored references.  
		        (I couldn't find an obvious real-life case where particles were flipped by exactly 180 degrees, 
		        but a pseudo-two-fold in the grid plane caused some confusion. 
		        Using phantom data, checking mirrored references seems to work, 
		        for what it's worth.)  In the worst-case scenario --
		        if this parameter is kept at 0, but you do have 180-degree-flipped particles -- 
		        the flipped particles will simply form a distinct class, and
		        separate reconstructions are computed downstream for each class.
		        </li>
		  </ul>
		<li>INPUTS: <b>selclasses</b>, <b>docclass****</b>, 
			<b>Zerodegr/Aligned/cenu*****</b>, <b>Zerodegr/Winrot/unt*****</b> </li>
		<li>OUTPUTS: <b>Zerodegr/Multiref/ref***</b>, <b>Zerodegr/Multiref/docalign</b>, 
			<b>Zerodegr/Multiref/selview***</b>, <b>Zerodegr/Aligned/cenu*****</b>, 
			<b>Zerodegr/Multiref/viewavg***</b></li>
		<li>This procedure file takes the class averages selected in the previous step, 
			re-centers them, and uses these for multireference alignment.</li>
		<li>Be sure that the label <i>[old_class_dir]</i> the procedure file 
			corresponds to the method use to select classes.
			For example, by default this label is set to <b>Zerodegr/Tree</b>,
			the location of the outputs of <a href="../binarytree.rct">binarytree.rct</a>.</li>
	</ul>

<li><p>Re-filter aligned images.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="../filtershrink.rct">../filtershrink.rct</a> </li>
		<li>PARAMETERS: reduction factor, low-pass filter parameters </li>
		<li>INPUT:  <b>Zerodegr/Aligned/cenu*****</b></li>
		<li>OUTPUT: <b>Zerodegr/Filtered/flt*****</b> </li>
	</ul>

<li><p>Classify the particles assigned to each reference.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="../classifybyview.rct">classifybyview.rct</a> </li>
		<li>PARAMETERS:                                                     </li>
			<ul>
				<li>reduction factor                                </li>
				<li>flag for CA (1), PCA (2), or IPCA (3)           </li>
				<li>number of factors to use                        </li>
			</ul>
		<li>INPUTS: <b>Zerodegr/Multiref/listrefs</b>, <b>Zerodegr/Multiref/ref***</b>, 
			    <b>Zerodegr/Multiref/selview***</b>, <b>Zerodegr/Filtered/flt*****</b> </li>
		<li>OUTPUTS: <b>Zerodegr/Multiref/View***/listclasses</b>, 
			     <b>Zerodegr/Multiref/View***/classavg***</b>, 
			     <b>Zerodegr/Multiref/View***/docclass***</b> </li>
		<li>This procedure file performs a separate classification 
			for the particles assigned to each reference.
	</ul>

<li><p>Check the classification results.</p></li>
	<ul>
		<li>Check the classes with the following command:</li>
			<pre>verifybyview  Zerodegr/Multiref/View001/listclasses.dat</pre>
			The initial filenames are:
				<ul>
					<li><b>listclasses</b> -- specified on the command line </li>
					<li><b>classavg***</b> -- class-average template </li>
				</ul>
			Subsequent filenames are:
				<ul>
					<li><b>Zerodegr/Filtered/flt*****</b> -- particle template </li>
					<li><b>selclasses</b> -- list of selected classes </li>
					<li><b>byhand***</b> -- selected particles in a given class </li>
				</ul>
		<li>If all of the class averages under a particular reference look the same, 
			proceed to the next solid bullet 
                        ("Verify individual particles from last iteration of multireference alignment.").</li>
		<li>If there are homogeneous subsets under a particular reference, 
			then select them in verifybyview.py, using right-click. 
			Don't forget to save the good-class list for each view, 
			under <i>File -&gt; Save selection</i>.
		<li>There is no need to select similar-looking class averages, 
			which would then be used as separate references, but 
			if there are important variations, it might be useful to include both.
		<li>Re-run the last three steps, <i>i.e.</i>:</li>
			<ol>
				<li><a href="../multirefalign-descend.rct">multirefalign-descend.rct</a> 
					-- a copy of <a href="../multirefalign.rct">multirefalign.rct</a>
					The following filenames/parameters are changed:</li>
					<ul>
						<li>Input <i>OLD_CLASS_DIR</i> is now the previous 
							multireference alignment directory, e.g., <b>Multiref</b></li>
						<li>Output <i>MULTIREF_DIR</i> is now the new directory, 
							for example <b>Multiref2</b></li>
						<li>The parameter <i>[subdir-flag]</i> set to <i>1</i> will serve as a flag 
							to look in the <b>View***</b> subdirectories for the class averages
							for subsequent runs.</li>
					</ul>
				<li><a href="../filtershrink.rct">filtershrink.rct</a></li>
				<li><a href="../classifybyview.rct">classifybyview.rct</a> -- 
				    Input <i>CLASS_DIR</i> is now the new 
				    multireference alignment directory, <i>e.g.</i>, <b>Multiref2</b></li>
			</ol>
		<li>Repeat these three steps as many times as necessary,
			changing directory names as necessary,
			to obtain relatively homogeneous populations per view. 
			A procedure file <a href="../multirefalign3.rct">multirefalign3.rct</a> is included, which is 
			literally identical to <a href="../multirefalign-descend.rct">multirefalign-descend.rct</a> 
			except for the input and output directory names.  </li>
	</ul>

<li><p>Verify individual particles from last iteration of multireference alignment.</p>       </li>
    <ul>
	<li>Type the following (assuming you performed 2 rounds of multi-reference alignment):</li>
            <pre>verifybyview   Zerodegr/Multiref2/View001/listclasses.dat</pre> 
        <li>INPUTS:  <b>listclasses</b>, <b>classavg***</b>, 
                     <b>docclass***</b>, <b>Zerodegr/Filtered/flt*****</b>                    </li>
        <li>OUTPUTS: <b>selclasses</b>, <b>byhand***</b>                                      </li>
        <li>At this point, we will keep only good particles.
            Exclude particles that do not resemble the class average.
            Individual particles are sorted from best correlation to worst.
            Description of 
            <a href="https:spider-em.github.io/spire/tools-docs/verifybyview.html"> 
                     verifybyview.py usage.</a>                                              </li>
        <li>In the example above, 
            I assume two iterations of classification and multireference alignment.
            If more or fewer iterations were needed,
        <li><i>HINT:</i> Don't forget to save the good-class list in verifybyview.py. 
            It is located in the class-average window under <i>File/SaveSelection</i>. 
            The keyboard shortcut, alternatively, is <i>ALT-s</i>.                          </li>
	</ul>

<li><p>Combine selected particles from classes.</p></li>
	<ul>
           <li>PROCEDURE FILE: <a href="../combinegoodclasses.rct">combinegoodclasses.rct</a> </li>
           <li>INPUTS (assuming again that you performed 2 rounds of multi-reference alignment): </li>
        <ul>
           <li><b>Zerodegr/Multiref2/listrefs</b>                     </li>
           <li><b>Zerodegr/Multiref2/View***/selclasses</b>           </li>
           <li><b>Zerodegr/Multiref2/View***/byhand***</b> (or <b>Zerodegr/Multiref2/View***/docclass****)</b> </li>
        </ul>
        <li>OUTPUTS: <b>Zerodegr/Multiref2/View***/goodsel</b>                     </li>
        <li>This procedure files creates one list of particles for each reference view.</li>
        <li>In the example above, 
            I assume two iterations of classification and multireference alignment.
            If more or fewer iterations were needed,
            change the corresponding multireference-alignment directory name above.</li>
        <li><i>HINT:</i> It may be useful to re-classify only the good particles, 
            if, for example, there's an asymmetry present that is washed out by 
            the bad particles.  
            In that case, re-run classifyview using <b>goodsel***</b> 
            instead of <b>selview***</b>.
            Change the output filenames, so that they don't overwrite previous 
            classification output, 
            e.g., add <i>good</i> to the beginning of the filenames. 
            If you find a new class, using the names of the new doc files, re-run
            <a href="../multirefalign-descend.rct">multirefalign-descend.rct</a>. 
 It may be useful to classify the bad particles too.                                     </li>
	</ul>

<li><p>Average selected images</p></li>
	<ul>
            <li>PROCEDURE FILE: <a href="../viewaverages.rct">viewaverages.rct</a>              </li>
            <li>SUBROUTINE: <a href="../viewaverage1.rct">viewaverage1.rct</a>              </li>
            <li>INPUTS: <b>Zerodegr/Aligned/cenu*****</b>, <b>Zerodegr/Multiref2/goodsel***</b>    
                        (assuming again that you performed 2 rounds of multi-reference alignment)</li>
            <li>OUTPUTS: <b>goodavg***</b>, <b>goodvar***</b>                            </li>
	</ul>

<li><p>Center tilted-specimen particles.</p>                                         </li>
       <ul>
           <li>PROCEDURE FILE: <a href="../centertilt.rct">centertilt.rct</a>               </li>
           <li>PARAMETERS: center-of-gravity option (see NOTE below), 
		           filter parameters (see NOTE below)                         </li>
           <li>INPUT:   <b>Tilted/Winrot/tilt*****</b>                                </li>
           <li>OUTPUTS: <b>Tilted/Aligned/cent*****</b>, <b>Tilted/dalt001</b>, 
			<b>Tilted/avgt001</b>                                         </li>
           <li>This step is straightforward relative to the alignment of the untilted particles. 
		All we are doing here is centering the tilted particles.
		For the three Euler angles needed for backprojection, 
		one is derived from the rotation angle of the untilted images, 
		and the other two are determined by the geometry of the tilt pair.</li>
           <li>To look at the centered tilted particles, type:                       </li>
		<pre>montagefromdoc.py listparticles.dat Tilted/Aligned/cent*</pre>
           <li>If this procedure file runs slowly, you can save time by centering only the selected particles.  
		To do this, change the input <b>listparticles</b> to <b>Zerodegr/Multiref#/combinedgood</b> 
		from the appropriate directory, <i>i.e.</i>, <b>Multiref</b>, <b>Multiref2</b>, etc.</li>
           <li>NOTE: To center the average after reference-free alignment (translation only), 
		    <a href="../../../man/cgph.html"> 'CG PH'</a> 
                    is used as the default.  However, as noted in the documention, 
		    'CG PH' sometimes fails.  As an alternative, a section option is available, 
		    which rotates the average by 180 degrees and aligns this to the unrotated average.  
		    This option is used by setting parameter <i>[cg-option]</i> to 2.  
		    If neither option 1 nor 2 work well, setting <i>[cg-option]</i> will not 
		    attempt to center the average.  
		    Be sure to inspect the average to ensure that is is centered.</li>
           <li>NOTE: Low-pass filtration of the images seems to help the 
		    <a href="../../../man/apsa.html"> 'AP SA'</a> command. 
                    A strong filter is not needed; feel free to experiment.  
		    The filter is applied to temporary, intermediate images; 
		    The final, centered images will be unfiltered.
           </li>
	</ul>

<li><p>Store Euler angles.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="../storeangles.rct">storeangles.rct</a> </li>
		<li>PARAMETER:  <i>[mirror-yn]</i> (see NOTE below)           </li>
		<li>INPUTS:     <b>docalign</b>, <b>Micrographs/dcb****</b>   </li>
		<li>OUTPUTS:    <b>Tilted/dang-store</b>                      </li>
		<li>Use the most recent aligment doc file for the untilted images, 
			e.g., <b>Zerodegr/Multiref2/docalign</b>.             </li>
		<li>NOTE: Changing parameter <i>[mirror-yn]</i> will reverse the handedness of the structure. 
		    Whether this flag should be set to 0 or 1 depends on numerous variables 
                    in the data collection and processing, 
		    such as the direction in which the goniometer is rotated, how the 
                    micrographs are digitized, etc. 
		    Unfortunately, it is difficult to determine from first principles whether 
                    the handedness needs to be flipped, 
		    so the safest way to know how to set this parameter is to generate a 
                    reconstruction of a sample with known handedness.  
		    Once the data-collection/image-processing conventions are set, change them as 
                    seldom as possible, or else 
		    you may need to re-test for flips in handedness.         </li>
		<li><p>This procedure file stores the three Euler angles in a doc file 
                    to use in the backprojection.
		    Assuming the direction of the tilt axes is similar in all of your tilt pairs, 
		    the displayed tilt parameters <u>SHOULD</u> be similar to each other.  
		    However, during the fitting of the angular parameters during tilt-pair picking, 
		    there is a possibility that equivalent (as far as the fitting is concerned) 
                    solutions are chosen inconsistently.    </p>
		    
		    <p>For example, in the sample RCT data in the 
		    <a href="../../../protocol_download.html">
                    Nature Protocols download</a>, 
		    the tilt axes are approximately 0.  
		    It is possible for the fitted tilt-axis angle determined by 
                    WEB or JWEB to be 0 to -180 degrees. </p> </li>
	</ul>

<li><p>Compute 3D reconstructions</p>
    <p>This step will compute 3D reconstructions for each class, 
    as classified in the last iteration of multi-reference alignment. </p>             </li>
	<ul>
	   <li>PROCEDURE FILE: <a href="../bpclass.rct">bpclass.rct</a>                       </li>
	   <li>INPUTS: <b>Zerodegr/Multiref2/listrefs</b>, <b>Zerodegr/Multiref2/goodsel***</b>, 
		       <b>Tilted/dang-store</b>, <b>Tilted/Aligned/cent*****</b>       </li>
	   <li>OUTPUTS: <b>Volumes/vcla***</b>                                         </li>
	</ul>

<li><p>Filter one or all 3D reconstructions</p>                                        </li>
	<ul>
		<li>PROCEDURE FILE: <a href="../volfilt.rct">volfilt.rct</a>                  </li>
		<li>PARAMETERS:</li>
		  <ul>
		    <li><i>[single-class]</i> -- The default value of <i>0</i> will filter all class volumes. 
		        To filter a single volume, perhaps to fine-tune a specific class, 
		        enter the number of that class.                                </li>
		    <li><i>[header-type]</i>, <i>[header-param1]</i>, <i>[header-param2]</i> -- 
		        parameters for the Fourier filter                              </li>
		    <li><i>[override-yn]</i> -- if pre-existing doc file <b>docvolfilt</b> exists 
		        (more on this file below), setting this parameter to <i>1</i> 
		        will override the filter parameters above and 
		        will use the values in the docfile instead                     </li>
		  </ul>
		<li>INPUTS: <b>Zerodegr/Multiref2/listrefs</b>, <b>Volumes/vcla***</b> </li>
		<li>OUTPUTS: <b>Volumes/vflt***</b>, <b>Volumes/docvolfilt</b>         </li>
		<li>The output doc file <b>docvolfilt</b> contains a record of 
		    the most recent filter parameters used.  
		    By setting the parameter <i>[override-yn]</i> to <i>1</i>, 
		    the filter parameters from this editable file will be used.        </li>
	</ul>

<li><p>Align volumes to each other</p>
    
    <p>Skip this step if you have a single class.</p>
    
    <p>This procedure file aligns two volumes to each other.
       Choose one volume as an alignment reference, to which the rest of 
       class volumes will be aligned.  
       After an initial alignment using a coarse search grid using 
       <a href="../../../man/pj3q.html">'PJ 3Q'</a>,
       a finer search will be performed using
       <a href="../../../man/or3q.html">'OR 3Q'</a>
       (which needs an initial estimate for optimal function).
    </p>
    
    <ul>
	<li>PROCEDURE FILE: <a href="../volalignprj.rct">volalignprj.rct</a>                  </li>
	<li>SUBROUTINE: <a href="../montageprj.rct">montageprj.rct</a>                    </li>
	<li>PARAMETERS:                                                                </li>
	  <ul>
	    <li><i>[exp-num]</i> -- the number for the experimental volume to align    </li>
	    <li><i>[ref-num]</i> -- the number for the reference volume                </li>
	    <li><i>[num-solns]</i> -- number of initial alignment solutions to compare 
	        -- multiple initial solutions may converge to the same refined solution</li>
	    <li><i>[dtheta]</i> -- angular increment for initial search, as in
		<a href="../../../techs/recon1a/Procs/refproj.spi">
		refproj.spi</a>.                                                       </li>
	    <li><i>[shift-range]</i>,<i>[shift-step]</i>,<i>[first-ring]</i> -- 2D search parameters for 
	        <a href="../../../man/apsh.html">
                   'AP SH'</a>, as in
		<a href="../../../techs/recon1a/Procs/apsh.spi"> 
                   apsh.spi</a>.</li>
	  </ul>
	<li>INPUTS: <b>Volumes/vcla***</b> (reference and experimental volume to align) </li>
	<li>OUTPUTS:                                                               </li>
	  <ul>
	    <li><b>prj_*** </b> -- re-projection stacks                            </li>
	    <li><b>dalv*** </b> -- alignment parameters for each solution requested</li>
	    <li><b>vali*** </b> -- aligned class volume                            </li>
	    <li><b>mproj***</b> -- comparison of reference projection versus 
	        initial and refined alignments, for each solution requested        </li>
	    <li><b>list2merge</b> -- running list of aligned classes with preferred alignment solution
	        -- more below</li>
	  </ul>
    </ul>

    <p>The first row of each slice in <b>mproj***</b> shows the reference projection. 
       Each additional row corresponds to one alignment solution, from "best" to "worst." 
       The left-hand image is the re-projection following the initial, coarse alignment, and 
       the right-hand image is the re-projection following the refined alignment using 
       <a href="../../../man/or3q.html">'OR 3Q'</a>.</p>
    
    <p>If the better alignment solution is not solution #1, then 
       edit in <b>list2merge</b> column #2, labelled <i>SOLUTIONNUM</i>.  
       If you do wish exclude the aligned class volume in the merging step altogether, 
       set this value to <i>0</i> in <b>list2merge</b>.</p>
       
    <p>The re-projections <b>prj_***</b> will illustrate the missing-cone artifact better than 
       isosurface presentations.</p>
    
<li><p><i>(optional)</i> Merged particles from aligned class volumes into one reconstruction</p></li>
    <ul>
	<li>PROCEDURE FILE: <a href="../mergevols.rct">mergevols.rct</a>                               </li>
	<li>INPUTS:       <b>dang-store</b>, <b>list2merge</b>, <b>dalv***</b>, 
	                  <b>goodsel***</b>, <b>cent*****</b>                                                 </li>
	<li>OUTPUTS:</li> <b>Volumes/vali***</b>, <b>Volumes/docvolangles</b> 
	  <ul>
	    <li><b>dang-merged</b> -- combines particles' Euler angles with class-volume 
                alignment angles                                                                </li>
	    <li><b>mergedsel</b> -- particle-selection file from merged classes                 </li>
	    <li><b>vtot999</b> -- merged volume                                                 </li>
	  </ul>
	</ul>

    <p>If the parameter <i>[classvols-yn]</i> is set to 1, 
       volumes for each class will be reconstructed of the form <b>vtot***</b>,
       using the merged Euler angles. 
       They should look very similar to the <b>vali***</b> reconstructions from the previous step, 
       <a href="../volalignprj.rct">volalignprj.rct</a>, although 
       in this case the volume will have undergone one fewer interpolation.</p>
    
    <p>You will probably want to filter the reconstruction(s) from this step. 
       Edit <a href="../volfilt.rct">volfilt.rct</a> to operate on the 
       <b>vtot***</b> volume(s).</p>
    

<li><p>Prepare files for reference-based alignment</p>                                   </li>
    <ul>

        <li> Before running this step, 
	download the latest
	(<a href="../../../techs/recon1a/spiproject.tar.gz">reference-based alignment tarball</a>) 
	and unpackage it:                                                   <br />
	<code class="snippet">tar -zxvf spiproject.tar.gz</code>.                  <br />
	
        This will create a new directory called <i>myproject</i>                   <br />
        If you rename that directory, remember to change the output in this 
        ensuing procedure file accordingly.                                              </li>
        <li>PROCEDURE FILE: <a href="../prepare-prjmatch.rct">prepare-prjmatch.rct</a>   </li>
	<li>INPUTS:  <b>lots</b> </li>
	<li>OUTPUTS: <b>lots</b> </li>
	<li><p>This procedure file will copy information in a form that can be understood by the 
	    <a href="../../../techs/recon1a/Docs/mr1.html"> 
            reference-based alignment protocol.</a>
	    Begin with the section entitled 
	    <a href="../../../techs/recon1a/Docs/mr1.html#SH"> 
            "Alignment"</a> with the step 
	    <a href="../../../techs/recon1a/Procs/sel_by_group.spi"> 
             sel_by_group.spi</a>. </p>
		    
	    <p>We have not (yet) implemented CTF-correction for the tilted-specimen particle images 
	    (we will be using only the tilted images), so we will be ignoring the CTF.  
	    (Adjust your expectations for the resulting reconstruction accordingly.) 
	    For the steps that present the option of accounting for the CTF or not (such as 
	    <a href="../../../techs/recon1a/Procs/apshgrp.spi"> 
             apshgrp.spi</a> vs.
	    <a href="../../../techs/recon1a/Procs/apsh.spi">
	    apsh.spi</a>), use the version that does not take into account the CTF (in this example, 
	    <a href="../../../techs/recon1a/Procs/apsh.spi"> 
             apsh.spi</a>).</p></li>
      </ul>

<hr />

<!--<li><p>DESCRIPTION</p> </li>

<b><p>Miscellaneous procedure files</p></b>

<li><p>Projection onto convex sets</p>                                </li>

    <ul>
        <li>PROCEDURE FILE: <a href="procedurelink">procedurename</a> </li>
        <li>INPUTS: <b>input</b>   </li>
        <li>OUTPUTS: <b>output</b> </li>
        <li>details</li>
    </ul>  -->

</ul>

<hr />

<b><p>References</p></b>
<ol>
    <li>
        Radermacher M, Wagenknecht T, Verschoor A, Frank J. 
        (1987) Three-dimensional reconstruction from a single-exposure, 
        random conical tilt series applied to 
        the 50S ribosomal subunit of <i>Escherichia coli</i>.
        <i>J Microsc.</i>  <b>146</b>:113-36.        </li>
    <li>Shaikh TR, Gao H, Baxter WT, Asturias F, Boisset N, Leith A, and Frank J. (2008) 
        SPIDER image-processing for single-particle reconstruction of biological 
        macromolecules from electron micrographs.
        <i>Nature Protocols</i> <b>3</b>: 1941-74.   </li>
    <li>Huang T, Shaikh TR, Gupta K, Contreras-Martin LM, Grassucci RA, Van Duyne GD, Frank J, Belfort M .
        (2011) The group II intron ribonucleoprotein precursor is a large, loosely packed structure. 
        <i>Nucleic Acids Res.</i> <b>39</b>: 2845-54.</li>
</ol>

<hr />

</body>
</html>

@


1.7
log
@links, formatting
@
text
@d109 1
a109 1
        <a href="convert.rct">convert.rct</a> for the conversion.              </li>
d112 1
a112 1
	<a href="http://www.wadsworth.org/spider_doc/spider/spire/bin/mkfilenums.py"> mkfilenums.py</a> 
d115 1
a115 1
        <a href="http://www.wadsworth.org/spider_doc/spider/spire/install.html">here</a>.
d127 5
a131 4
        <li>Download <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/ranconical/tar_archive/procedures.tar">
            procedures tar archive</a>  and unpackage it by typing:
	    <pre>tar -xvf procedures.tar</pre>
	    This command will unpackage the files in the currect directory, 
d137 1
a137 1
        <li>PROCEDURE FILE: <a href="makeparams.rct">makeparams.rct</a>         </li>
d140 1
a140 3
        <li>The following parameters (described 
            <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/Docs/params.html">
            here</a>) 
d144 11
a154 10
                                            will be uncompressed using gunzip               </li>
				<ul><li>used by convert.rct       </li></ul>
                <li><b>2</b> -- format flag -- 0 corresponds to SPIDER, 3 to Z/I TIFF, etc. </li>
			        <ul><li>used by convert.rct       </li></ul>
                <li><b>5</b> -- pixel size -- in Angstroms                                  </li>
				<ul><li>used by shrinkmics.rct    </li></ul>
                <li><b>17</b> -- window size -- in pixels                                   </li>
				<ul><li>used by many procedure files  </li></ul>
                <li><b>18</b> -- particle diameter -- in pixels                             </li>
				<ul><li>used by pairwise.rct      </li></ul>
d163 1
a163 1
            <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/ranconical/tar_archive/data20060817.tar">
d165 1
a165 1
            <pre>tar -xvf data20060817.tar</pre>
d173 1
a173 1
       <li>PYTHON SCRIPT: href="http://www.wadsworth.org/spider_doc/spider/spire/bin/makefilenums.py">mkfilenums.py</a> </li>
d179 1
a179 1
           <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/doccreate.html"> 'DOC CREATE'</a> 
d185 2
a186 2
        <li>PROCEDURE FILE: <a href="convert.rct">convert.rct</a>                               </li>
        <li>SUBROUTINE: <a href="convert_p.rct">convert_p.rct</a>                           </li>
d195 1
a195 1
        <li>PROCEDURE FILE: <a href="shrinkmics.rct">shrinkmics.rct</a>       </li>
d215 1
a215 1
            <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/docren.html">'DOC REN'</a>. 
d221 1
a221 1
        <li>PROCEDURE FILE: <a href="micpair.rct">micpair.rct</a>                  </li>
d230 1
a230 1
        <li>PROCEDURE FILE: <a href="padmics.rct">padmics.rct</a>                   </li>
d304 1
a304 1
				so the step <a href="padmics.rct">padmics.rct</a> is unnecessary.   </li>
d308 1
a308 1
				<a href="windowparticles.rct">windowparticles.rct</a>. 
d333 1
a333 1
		<li>PROCEDURE FILE: <a href="makesomenoise.rct">makesomenoise.rct</a>        </li>
d346 1
a346 1
		<li>PROCEDURE FILE: <a href="windowparticles.rct">windowparticles.rct</a>   </li>
d348 2
a349 2
		    <a href="shrinkmics.rct">shrinkmics.rct</a> and/or 
		    <a href="padmics.rct">padmics.rct</a>, use that value here. 
d371 1
a371 1
    but look at the reconstituted images when you run <a href="ca-pca.rct">ca-pca.rct</a> 
d374 1
a374 1
	    <li>PROCEDURE FILE: <a href="highpass-untilted.rct">highpass-untilted.rct</a></li>
d379 1
a379 1
	    <li>PROCEDURE FILE: <a href="highpass-tilted.rct">highpass-tilted.rct</a>    </li>
d389 1
a389 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/spire/bin/montagefromdoc.htm"> 
d397 1
a397 1
		<li>If particles are rejected, run: <a href="removebad.rct">removebad.rct</a>      </li>
d400 1
a400 1
                                <a href="backup.rct">backup.rct</a>), <b>notgood</b>               </li>
d407 1
a407 1
		<li>If tilted particles are rejected, re-run <a href="removebad.rct">removebad.rct</a></li>
d412 1
a412 1
		<li>PROCEDURE FILE: <a href="pairwise.rct">pairwise.rct</a>           </li>
d426 1
a426 1
		    <li>PROCEDURE FILE: <a href="reorientavg.rct">reorientavg.rct</a>                    </li>
d435 1
a435 1
			    <a href="sumalign.rct">sumalign.rct</a>.                                </li>
d440 1
a440 1
			<li>PROCEDURE FILE: <a href="sumalign.rct">sumalign.rct</a> </li>
d447 1
a447 1
				<a href="reorientavg.rct">reorientavg.rct</a>, then run this procedure file.  
d457 1
a457 1
		<li>PROCEDURE FILE: <a href="filtershrink.rct">filtershrink.rct</a> </li>
d462 1
a462 1
                    <a href="sumalign.rct">sumalign.rct</a>.                    </li>
d470 1
a470 1
		<li>PROCEDURE FILE: <a href="ca-pca.rct">ca-pca.rct</a>                     </li>
d485 1
a485 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/spire/install.html">
d496 1
a496 1
			<li>PROCEDURE FILE: <a href="kmeans.rct">kmeans.rct</a> </li>
d518 1
a518 1
				<li>PROCEDURE FILE: <a href="hierarchical.rct">hierarchical.rct</a> </li>
d531 1
a531 1
					<li>PROCEDURE FILE: <a href="binarytree.rct">binarytree.rct</a> </li>
d542 1
a542 1
					<li>To view the binary tree, run <A HREF="tree.py">binarytree</A>. 
d550 1
a550 1
					<li>Alternatively, you can run <a href="tree.rct">tree.rct</a>,
d561 1
a561 1
					<li>PROCEDURE FILE: <a href="classavg.rct">classavg.rct</a> </li>
d570 1
a570 1
						<li>If you're going to run <a href="binarytree.rct">binarytree.rct</a>
d584 1
a584 1
				<li>PROCEDURE FILE: <a href="cluster.rct">cluster.rct</a> </li>
d595 1
a595 1
				<li>PROCEDURE FILE: <a href="classavg.rct">classavg.rct</a> </li>
d605 1
a605 1
					<a href="binarytree.rct">binarytree.rct</a>,
d621 1
a621 1
			    <a href="http://www.wadsworth.org/spider_doc/spider/spire/tools-docs/verifybyview.html"">
d631 1
a631 1
                                <a href="binarytree.rct">binarytree.rct</a>):            </li>
d651 1
a651 1
		<li>PROCEDURE FILE: <a href="multirefalign.rct">multirefalign.rct</a> </li>
d656 1
a656 1
		        <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html">'CG PH'</a>. 
d681 1
a681 1
			the location of the outputs of <a href="binarytree.rct">binarytree.rct</a>.</li>
d686 1
a686 1
		<li>PROCEDURE FILE: <a href="filtershrink.rct">filtershrink.rct</a> </li>
d694 1
a694 1
		<li>PROCEDURE FILE: <a href="classifybyview.rct">classifybyview.rct</a> </li>
d737 2
a738 2
				<li><a href="multirefalign-descend.rct">multirefalign-descend.rct</a> 
					-- a copy of <a href="multirefalign.rct">multirefalign.rct</a>
d749 2
a750 2
				<li><a href="filtershrink.rct">filtershrink.rct</a></li>
				<li><a href="classifybyview.rct">classifybyview.rct</a> -- 
d757 2
a758 2
			A procedure file <a href="multirefalign3.rct">multirefalign3.rct</a> is included, which is 
			literally identical to <a href="multirefalign-descend.rct">multirefalign-descend.rct</a> 
d773 1
a773 1
            <a href="http://www.wadsworth.org/spider_doc/spider/spire/tools-docs/verifybyview.html"> 
d785 1
a785 1
           <li>PROCEDURE FILE: <a href="combinegoodclasses.rct">combinegoodclasses.rct</a> </li>
d807 1
a807 1
            <a href="multirefalign-descend.rct">multirefalign-descend.rct</a>. 
d813 2
a814 2
            <li>PROCEDURE FILE: <a href="viewaverages.rct">viewaverages.rct</a>              </li>
            <li>SUBROUTINE: <a href="viewaverage1.rct">viewaverage1.rct</a>              </li>
d822 1
a822 1
           <li>PROCEDURE FILE: <a href="centertilt.rct">centertilt.rct</a>               </li>
d839 1
a839 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html"> 'CG PH'</a> 
d848 1
a848 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsa.html"> 'AP SA'</a> command. 
d857 1
a857 1
		<li>PROCEDURE FILE: <a href="storeangles.rct">storeangles.rct</a> </li>
d884 1
a884 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
d895 1
a895 1
	   <li>PROCEDURE FILE: <a href="bpclass.rct">bpclass.rct</a>                       </li>
d903 1
a903 1
		<li>PROCEDURE FILE: <a href="volfilt.rct">volfilt.rct</a>                  </li>
d932 1
a932 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/pj3q.html">'PJ 3Q'</a>,
d934 1
a934 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>
d939 2
a940 2
	<li>PROCEDURE FILE: <a href="volalignprj.rct">volalignprj.rct</a>                  </li>
	<li>SUBROUTINE: <a href="montageprj.rct">montageprj.rct</a>                    </li>
d948 1
a948 1
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/refproj.spi">
d951 4
a954 2
	        <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsh.html">'AP SH'</a>, as in
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi"> apsh.spi</a>.</li>
d973 1
a973 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>.</p>
d985 1
a985 1
	<li>PROCEDURE FILE: <a href="mergevols.rct">mergevols.rct</a>                               </li>
d1001 1
a1001 1
       <a href="volalignprj.rct">volalignprj.rct</a>, although 
d1005 1
a1005 1
       Edit <a href="volfilt.rct">volfilt.rct</a> to operate on the 
d1011 11
a1021 7
        <li>Before running this step, download the reference-based alignment tarball and 
            untar it by typing:
            <pre>tar -zxvf spiproject.tar.gz</pre>
	     This will create a new directory called <i>myproject</i>                   <br />
             If you rename that directory, remember to change the output in this 
             ensuing procedure file accordingly.                                             </li>
        <li>PROCEDURE FILE: <a href="prepare-prjmatch.rct">prepare-prjmatch.rct</a>      </li>
d1025 2
a1026 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html"> reference-based alignment protocol.</a>
d1028 4
a1031 2
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html#SH"> "Alignment"</a> with the step 
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/sel_by_group.spi"> sel_by_group.spi</a>. </p>
d1037 3
a1039 2
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apshgrp.spi"> apshgrp.spi</a> vs.
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
d1041 2
a1042 1
	    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi"> apsh.spi</a>).</p></li>
@


1.6
log
@links fixed
@
text
@a12 1
<br />Adapted from the 2007 SPIDER Workshop tutorial
d23 1
a23 1
	<li>Miscellaneous batch files </li>
d41 1
a41 1
	<li>tar -xvf $BATCH.tar</li>
d48 1
a48 1
	<li>spider rct/dat @@micpair</li>
d54 14
a67 14
		<ol type=a>
			<li>spider rct/dat @@highpass-untilted          </li>
			<li>spider rct/dat @@highpass-tilted            </li>
		</ol>
	<li>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*  </li>
	<li>(if necessary) spider rct/dat @@removebad                  </li>
	<li>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*   </li>
	<li>(if necessary) spider rct/dat @@removebad                  </li>
	<li>(slow) spider rct/dat @@pairwise                           </li>
	<li>(optional) To reorient average, do both of:               </li>
		<ol type=a>
			<li>spider rct/dat @@reorientavg               </li>
			<li>spider rct/dat @@sumalign                  </li>
		</ol>
d73 12
a84 12
	<ol type=a>
		<li>spider rct/dat @@hierarchical                                  </li>
		<li>spider rct/dat @@binarytree                                    </li>
		<li>cd Zerodegr/Tree ; binarytree labeled0001.dat 4 selclasses.dat</li>
	</ol>
	<li>Iterate:</li> 
		<ol type=a>
			<li>spider rct/dat @@multirefalign (subsequently @@multirefalign-descend)</li> 
			<li>spider rct/dat @@filtershrink    </li> 
			<li>spider rct/dat @@classifybyview  </li>
			<li>verifybyview                    </li> 
		</ol>
d93 5
a97 5
		<ol type=a>
			<li>spider rct/dat @@volalignprj</li>
			<li>spider rct/dat @@mergevols  </li>
		</ol>
	<li>spider rct/dat @@prepare-prjmatch</li>
d105 12
a116 14
	<li>Create a new directory, and change to that directory before unpackaging the 
		batch-file tarball.</li>

	<li>Micrographs should be placed in the <b>Micrographs/</b> directory.  
		They needn't be in SPIDER format, but you'll then need to run
		<a href="convert.rct">convert.rct</a> for the conversion. </li>

	<li>The SPIRE libraries are required for various Python scripts, such as
		<a href="mkfilenums.py">mkfilenums.py</a> and <a href="tree.py">tree.py</a>. 
		These steps can be substituted with SPIRE-independent analogs. 
		Installation instructions for SPIRE can be found 
		<a href="../../../../spire/install.html">here</a>.</li>

<!-- 	<li></li> -->
d125 8
a132 8
<li><p>Prepare directory</p></li>
	<ul>
	   <li>Download <a href="../tar_archive/">procedures tar archive</a> 
	       and unpackage it by typing:
	       <pre>tar -xvf procedures.tar</pre>
	       This command will unpackage the files in the currect directory, 
	       so create a new directory if so desired.              </li>
	</ul>
d134 25
a158 24
<li><p>Prepare parameter doc file</p></li>
	<ul>
		<li>BATCH FILE: <a href="makeparams.rct">makeparams.rct</a> </li>
		<li>OUTPUTS: <b>params</b> </li>
		<li>Otherwise, you can copy a <b>params</b> file from elsewhere.</li>
		<li>The following parameters (described <a href="../../Docs/params.html">
			here</a>) are used from the <b>params</b> file:</li>
			<ul>
				<li><b>1</b> -- zip flag -- if set to 1, then will be uncompressed using gunzip</li>
					<ul><li>used by convert.rct</li></ul>
				<li><b>2</b> -- format flag -- 0 corresponds to SPIDER, 3 to Z/I TIFF, etc. -- see 
					<a href="../../recon/params.html">
					complete description</a> for additional formats</li>
					<ul><li>used by convert.rct</li></ul>
				<li><b>5</b> -- pixel size -- in Angstroms</li>
					<ul><li>used by shrinkmics.rct</li></ul>
				<li><b>17</b> -- window size -- in pixels </li>
					<ul><li>used by many batch files</li></ul>
				<li><b>18</b> -- particle diameter -- in pixels</li>
					<ul><li>used by pairwise.rct </li></ul>
		<!--		<li><b>NUMBER</b> -- FLAG -- DESCRIPTION</li>
					<ul><li>used by BATCH</li></ul>-->
			</ul>
	</ul>
d160 10
a169 9
<li><p><i>(optional)</i> Copy sample data.</p></li>
	<ul>
		<li>Download the <a href="../tar_archive/data20060817.tar">data archive</a>
			and unpackage it by typing:</li>
			<pre>tar -xvf data20060817.tar</pre>
		<li>This command will create a directory called <b>Micrographs/</b>, 
			containing phantom micrographs, and a directory called <b>TP1/</b>,
			containing the files used to generate the micrographs.</li>
	</ul>
d172 10
a181 10
	<ul>
		<li>PYTHON SCRIPT: <a href="mkfilenums.py">mkfilenums.py</a> </li>
		<li>To make a list of TIFF files, for example, the syntax would be: </li>
			<pre>mkfilenums.py filenums.dat Micrographs/zeiss*.tif</pre>
		<li>This Python script requires the Spiderutils library from SPIRE. 
			If SPIRE is not installed, you can generate <b>filenums</b> using other means, 
			such as by manually entering the filenumbers using 
			<a href="../../../man/doccreate.html">
			'DOC CREATE'</a> in SPIDER. </li>
	</ul>
d184 20
a203 20
	<ul>
		<li>BATCH FILE: <a href="convert.rct">convert.rct</a> </li>
		<li>SUBROUTINE: <a href="convert_p.rct">convert_p.rct</a> </li>
		<li>INPUTS: <b>filenums</b>, <b>Micrographs/mic****</b> </li>
		<li>Downstream batch files will expect files called <b>Micrographs/mic****</b>. 
			Keeping that convention will minimize the number of changes you'll need to make.</li>
		<li>TO DO: add conversion flag for MRC files</li>
	</ul>

<li><p>Shrink the micrographs for particle-picking.</p></li>
	<ul>
		<li>BATCH FILE: <a href="shrinkmics.rct">shrinkmics.rct</a> </li>
		<li>INPUTS: <b>filenums</b>, <b>Micrographs/mic****</b> </li>
		<li>INPUTS: <b>Micrographs/sm-mic****</b> </li>
		<li>Choose the reduction factor such that the micrgraph fits on the screen, 
			or that the particles are visible.  
			These downsampled micrographs will be used to pick tilt pairs.</li>
		<li>The filtration step is slow, so 
			by setting <i>[filter-radius]=0</i>, you can skip this step. </li>
	</ul>
d206 12
a217 12
	<ul>
		<li>Micrographs can be screened using various display programs.
			To use montagefromdoc.py, from <b>Micrographs/</b>
			(there is a pre-existing <b>.montagefromdoc</b> file there), type:
			<pre>montagefromdoc.py ../filenums.dat sm-mic*</pre>
			The output should also be <b>filenums</b>.</li>
		<li>If you wish to remove micrographs by editing <b>filenums</b>
			(instead of with montagefromdoc),
			renumber it to have consecutive keys, using 
			<a href="../../../man/docren.html"> 'DOC REN'</a>. 
                        (The input and output can have the same name.) </li>
	</ul>
d219 8
a226 8
<li><p>Establish pairings between micrographs</p></li>
	<ul>
		<li>BATCH FILE: <a href="micpair.rct">micpair.rct</a> </li>
		<li>INPUTS: <b>filenums</b> </li>
		<li>OUTPUTS: <b>docmicpairs</b> </li>
		<li>This batch file presumes that the tilted-specimen micrograph precedes the untilted-specimen micrograph.
			Check the output to confirm that the pairings make sense.</li>
	</ul>
d229 10
a238 9
	<ul>
		<li>BATCH FILE: <a href="padmics.rct">padmics.rct</a> </li>
		<li>INPUTS: <b>docmicpairs</b>, <b>Micrographs/sm-mic****</b> </li>
		<li>OUTPUTS: <b>Micrographs/jweb-mic{***[untilted]}</b>, <b>Micrographs/jweb-mic{***[untilted]}_tilted</b> </li>
		<li>JWEB has a "feature" that requires the tilt pair to have the same dimensions. 
			This batch file pads the micrographs to the same size. 
			Another feature is that JWEB expects the tilted micrograph to be second, 
			even though it is typically collected first at the microscope.</li>
	</ul>
d240 1
a240 1
<li><p>Pick tilt pairs (for JWEB, differences for X-Window WEB noted below)</p></li>
d252 1
a252 1
			    for ease of use with the batch files below.</li>
d286 1
a286 1
		        enter the number of the untilted micrograph and click <i>ACCEPT</i>.</li>
d291 2
a292 2
			ideally in the four corners, but the farther apart the better.</li>
		    <li>Click the middle button to open the <i>Particle picking menu_popup</i>.</li>
d298 1
a298 1
			(For the sample micrograph, there are 76 pairs.  Select all of them.)</li>
d300 2
a301 2
		        <i>Draw fitted locations</i>, and <i>Save angles in doc file</i>.</li>
		    <li>Differences between JWEB and X-Window WEB:</li>
d304 1
a304 1
				so the step <a href="padmics.rct">padmics.rct</a> is unnecessary. </li>
d328 1
a328 1
	    you can resume from where you left off.</li>
d333 1
a333 1
		<li>BATCH FILE: <a href="makesomenoise.rct">makesomenoise.rct</a> </li>
d335 1
a335 1
		<li>OUTPUTS: <b>noise</b>, <b>tmpnoise/noi***</b> </li>
d338 1
a338 1
		<li>One noise file will be chosen at random by the batch file.
d340 2
a341 2
			and copy one that looks even "noisier" to <b>noise.dat</b>
			(in the top-level directory).</li>
d344 1
a344 1
<li><p>Window particles from tilted and untilted micrographs.</p></li>
d346 1
a346 1
		<li>BATCH FILE: <a href="windowparticles.rct">windowparticles.rct</a> </li>
d355 3
a357 2
		<li>INPUTS: <b>params</b>, <b>docmicpairs</b>, <b>noise</b>,
			<b>Micrographs/mic****</b>, <b>Micrographs/dcu****</b>, <b>Micrographs/dct****</b></li>
d372 1
a372 1
    in order to see if the stain is the predominant source of variation. </p> </li>
d374 1
a374 1
	    <li>BATCH FILE: <a href="highpass-untilted.rct">highpass-untilted.rct</a></li>
d376 2
a377 2
		<li>INPUTS: <b>Zerodegr/Winrot/unt*****</b> (directory renamed to <b>Unhighpass</b></li>
		<li>OUTPUTS: <b>Zerodegr/Winrot/unt*****</b> </li>
d379 1
a379 1
	    <li>BATCH FILE: <a href="highpass-tilted.rct">highpass-tilted.rct</a></li>
d381 1
a381 1
		<li>INPUTS: <b>Tilted/Winrot/tilt*****</b> (directory renamed to <b>Unhighpass</b></li>
d389 5
a393 3
		<a href="../../../..//montagefromdoc.htm"> montagefromdoc</a>, using the following command:
			<pre>montagefromdoc listparticles.dat Zerodegr/Winrot/unt*</pre>
		Use <b>notgood</b> as the output doc filename.<br /></li>
d396 2
a397 2
			There will be additional rounds of selection downstream.</li>
		<li>If particles are rejected, run: <a href="removebad.rct">removebad.rct</a> </li>
d399 2
a400 1
		    <li>INPUTS: <b>listparticles</b> (will be backed up by <a href="backup.rct">backup.rct</a>), <b>notgood</b> </li>
d402 2
a403 2
		<li>Now screen the tilted images for defects:</li>
			<pre>montagefromdoc listparticles.dat Tilted/Winrot/tilt*</pre>
d406 1
a406 1
			such as dust, edges, double-particles, etc. -- so be more stringent here.</li>
d410 1
a410 1
<li><p>Align the untilted-specimen particles using reference-free alignment.</p></li>
d412 1
a412 1
		<li>BATCH FILE: <a href="pairwise.rct">pairwise.rct</a> </li>
d415 2
a416 2
			<b>Zerodegr/Pairwise/docpairalign</b>, many others </li>
		<li>This batch file first aligns pairs of images, averages them, 
d419 1
a419 1
			and each subsequent level will be faster.</li>
d426 2
a427 2
		    <li>BATCH FILE: <a href="reorientavg.rct">reorientavg.rct</a> </li>
		    <li>INPUTS: <b>Zerodegr/Pairwise/rfreeavg001</b> </li>
d429 1
a429 1
		    <li>This batch file aligns the average to a mirrored version of itself, 
d434 2
a435 2
			    note which solution to use (1 or 2), and run the next batch file, 
			    <a href="sumalign.rct">sumalign.rct</a>.</li>
d440 1
a440 1
			<li>BATCH FILE: <a href="sumalign.rct">sumalign.rct</a> </li>
d447 1
a447 1
				<a href="reorientavg.rct">reorientavg.rct</a>, then run this batch file.  
d457 6
a462 5
		<li>BATCH FILE: <a href="filtershrink.rct">filtershrink.rct</a> </li>
		<li>PARAMETERS: reduction factor, low-pass filter parameters </li>
		<li>INPUT: <b>Zerodegr/Aligned/cenu*****</b></li>
		<li>OUTPUT: <b>Zerodegr/Filtered/flt*****</b> </li>
		<li>Remember to change the input filename if you ran <a href="sumalign.rct">sumalign.rct</a>. </li>
d464 2
a465 2
			To look at the filtered untilted particles, type: </li>
			<pre>montagefromdoc listparticles.dat Zerodegr/Filtered/flt*</pre>
d470 12
a481 12
		<li>BATCH FILE: <a href="ca-pca.rct">ca-pca.rct</a> </li>
		<li>PARAMETERS: </li>
			<ul>
				<li><i>flag for CA (1), PCA (2), or iterative PCA (3)</i> --
					One method or another sometimes crashes due to "numerical inaccuracy."
						I, subjectively, try CA first, then iterative PCA, then PCA last.</li>
				<li><i>number of factors to calculate</i> --
					If after you run this batch file, 
					all of the eigenimages look meaningful,
					increase this parameter and re-run.</li>
			</ul>
		<li>INPUT: <b>Zerodegr/Filtered/flt*****</b> </li>
d483 4
a486 4
		<li>The commands to generate the PostScript eigenvalue histogram requires the 
                    SPIRE Python libraries.
		    Installation instructions for SPIRE can be found 
		    <a href="../../../../spire/install.html">here</a>.</li>
d489 1
a489 1
		    go back to the high-pass filtration step above.</li>
d496 1
a496 1
			<li>BATCH FILE: <a href="kmeans.rct">kmeans.rct</a> </li>
d518 1
a518 1
				<li>BATCH FILE: <a href="hierarchical.rct">hierarchical.rct</a> </li>
d531 1
a531 1
					<li>BATCH FILE: <a href="binarytree.rct">binarytree.rct</a> </li>
d541 1
a541 1
						If this batch file crashes, check this parameter.</li>
d561 1
a561 1
					<li>BATCH FILE: <a href="classavg.rct">classavg.rct</a> </li>
d584 1
a584 1
				<li>BATCH FILE: <a href="cluster.rct">cluster.rct</a> </li>
d595 1
a595 1
				<li>BATCH FILE: <a href="classavg.rct">classavg.rct</a> </li>
d620 4
a623 3
				If not using 
				<a href="../../verify/VerifyDocs/interface.htm">verifybyview.py</a>, 
                            call the output class-selection doc file <b>selclasses</b>.</li>
d625 2
a626 2
			<li>To view+select the averages from K-means, type:</li>
				<pre>verifybyview.py Zerodegr/Kmeans/listclasses.dat</pre>
d628 1
a628 1
				<pre>verifybyview.py Zerodegr/Hierarchical/listclasses.dat</pre>
d631 1
a631 1
                                <a href="binarytree.rct">binarytree.rct</a>):</li>
d633 2
a634 2
			<li>To view+select the averages from Diday's method, type:</li>
				<pre>verifybyview.py Zerodegr/Cluster/listclasses.dat</pre>
d651 1
a651 1
		<li>BATCH FILE: <a href="multirefalign.rct">multirefalign.rct</a> </li>
d656 1
a656 1
		        <a href="../../../man/cgph.html">'CG PH'</a>. 
d676 1
a676 1
		<li>This batch file takes the class averages selected in the previous step, 
d678 1
a678 1
		<li>Be sure that the label <i>[old_class_dir]</i> the batch file 
d686 1
a686 1
		<li>BATCH FILE: <a href="filtershrink.rct">filtershrink.rct</a> </li>
d688 1
a688 1
		<li>INPUT: <b>Zerodegr/Aligned/cenu*****</b></li>
d694 2
a695 2
		<li>BATCH FILE: <a href="classifybyview.rct">classifybyview.rct</a> </li>
		<li>PARAMETERS:</li>
d697 3
a699 3
				<li>reduction factor</li>
				<li>flag for CA (1), PCA (2), or IPCA (3)</li>
				<li>number of factors to use</li>
d702 1
a702 1
			<b>Zerodegr/Multiref/selview***</b>, <b>Zerodegr/Filtered/flt*****</b> </li>
d704 3
a706 3
			<b>Zerodegr/Multiref/View***/classavg***</b>, 
			<b>Zerodegr/Multiref/View***/docclass***</b> </li>
		<li>This batch file performs a separate classification 
d713 1
a713 1
			<pre>verifybyview.py Zerodegr/Multiref/View001/listclasses.dat</pre>
d726 2
a727 1
			proceed to the next solid bullet ("Verify individual particles from last iteration of multireference alignment.").</li>
d757 1
a757 1
			A batch file <a href="multirefalign3.rct">multirefalign3.rct</a> is included, which is 
d762 19
a780 19
<li><p>Verify individual particles from last iteration of multireference alignment.</p>               </li>
	<ul>
		<li>Type the following (assuming you performed 2 rounds of multi-reference alignment):</li>
			<pre>verifybyview.py Zerodegr/Multiref2/View001/listclasses.dat</pre> 
		<li>INPUTS: <b>listclasses</b>, <b>classavg***</b>, <b>docclass***</b>, <b>Zerodegr/Filtered/flt*****</b> </li>
		<li>OUTPUTS: <b>selclasses</b>, <b>byhand***</b>                                       </li>
		<li>At this point, we will keep only good particles.
			Exclude particles that do not resemble the class average.
			Indivudal particles are sorted from best correlation to worst.
			A more thorough description of 
			<a href="../../../../tools-docs/verifybyview.html">
				                        verifybyview.py can be found here</a>         </li>
		<li>In the example above, 
			I assume two iterations of classification and multireference alignment.
			If more or fewer iterations were needed,
			change the corresponding multireference-alignment directory name above.</li>
		<li><i>HINT:</i> Don't forget to save the good-class list in verifybyview.py. 
			It is located in the class-average window under <i>File/SaveSelection</i>. 
			The keyboard shortcut, alternatively, is <i>ALT-s</i>.                 </li>
d785 24
a808 21
		<li>BATCH FILE: <a href="combinegoodclasses.rct">combinegoodclasses.rct</a> </li>
		<li>INPUTS (assuming again that you performed 2 rounds of multi-reference alignment): </li>
			<ul>
				<li><b>Zerodegr/Multiref2/listrefs</b> </li>
				<li><b>Zerodegr/Multiref2/View***/selclasses</b> </li>
				<li><b>Zerodegr/Multiref2/View***/byhand***</b> (or <b>Zerodegr/Multiref2/View***/docclass****)</b> </li>
			</ul>
		<li>OUTPUTS: <b>Zerodegr/Multiref2/View***/goodsel</b> </li>
		<li>This batch files creates one list of particles for each reference view.</li>
		<li>In the example above, 
			I assume two iterations of classification and multireference alignment.
			If more or fewer iterations were needed,
			change the corresponding multireference-alignment directory name above.</li>
		<li><i>HINT:</i> It may be useful to re-classify only the good particles, 
			if, for example, there's an asymmetry present that is washed out by the bad particles.  
			In that case, re-run classifyview using <b>goodsel***</b> instead of <b>selview***</b>.
			Change the output filenames, so that they don't overwrite previous classification output, 
			e.g., add <i>good</i> to the beginning of the filenames. 
			If you find a new class, using the names of the new doc files, re-run
			<a href="multirefalign-descend.rct">multirefalign-descend.rct</a>. 
			It may be useful to classify the bad particles too.</li>
d813 28
a840 28
		<li>BATCH FILE: <a href="viewaverages.rct">viewaverages.rct</a></li>
		<li>SUBROUTINE: <a href="viewaverage1.rct">viewaverage1.rct</a></li>
		<li>INPUTS: <b>Zerodegr/Aligned/cenu*****</b>, <b>Zerodegr/Multiref2/goodsel***</b>    
		    (assuming again that you performed 2 rounds of multi-reference alignment)</li>
		<li>OUTPUTS: <b>goodavg***</b>, <b>goodvar***</b> </li>
	</ul>

<li><p>Center tilted-specimen particles.</p></li>
	<ul>
		<li>BATCH FILE: <a href="centertilt.rct">centertilt.rct</a> </li>
		<li>PARAMETERS: center-of-gravity option (see NOTE below), 
		    filter parameters (see NOTE below)</li>
		<li>INPUT: <b>Tilted/Winrot/tilt*****</b> </li>
		<li>OUTPUTS: <b>Tilted/Aligned/cent*****</b>, <b>Tilted/dalt001</b>, 
			<b>Tilted/avgt001</b> </li>
		<li>This step is straightforward relative to the alignment of the untilted particles. 
			All we are doing here is centering the tilted particles.
			For the three Euler angles needed for backprojection, 
			one is derived from the rotation angle of the untilted images, 
			and the other two are determined by the geometry of the tilt pair.</li>
		<li>To look at the centered tilted particles, type: </li>
			<pre>montagefromdoc.py listparticles.dat Tilted/Aligned/cent*</pre>
		<li>If this batch file runs slowly, you can save time by centering only the selected particles.  
			To do this, change the input <b>listparticles</b> to <b>Zerodegr/Multiref#/combinedgood</b> 
			from the appropriate directory, <i>i.e.</i>, <b>Multiref</b>, <b>Multiref2</b>, etc.</li>
		<li>NOTE: To center the average after reference-free alignment (translation only), 
		    <a href="../../../man/cgph.html"> 'CG PH'</a> is used as the default.  
                    However, as noted in the documention, 
d847 3
a849 3
		<li>NOTE: Low-pass filtration of the images seems to help the 
		<a href="../../../man/apsa.html"> 'AP SA'</a> command. 
                     A strong filter is not needed; feel free to experiment.  
d852 1
a852 1
		</li>
d857 1
a857 1
		<li>BATCH FILE: <a href="storeangles.rct">storeangles.rct</a> </li>
d864 10
a873 5
		    Whether this flag should be set to 0 or 1 depends on numerous variables in the data collection and processing, 
		    such as the direction in which the goniometer is rotated, how the micrographs are digitized, etc. 
		    Unfortunately, it is difficult to determine from first principles whether the handedness needs to be flipped, 
		    so the safest way to know how to set this parameter is to generate a reconstruction of a sample with known handedness.  
		    Once the data-collection/image-processing conventions are set, change them as seldom as possible, or else 
d875 2
a876 1
		<li><p>This batch file stores the three Euler angles in a doc file to use in the backprojection.
d880 2
a881 1
		    there is a possibility that equivalent (as far as the fitting is concerned) solutions are chosen inconsistently. </p>
d884 2
a885 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">Nature Protocols download</a>, 
d887 2
a888 4
		    It is possible for the fitted tilt-axis angle determined by WEB or JWEB to be 0 to -180 degrees.  
		    
		    </p>
		    </li>
a891 1
    
d893 1
a893 1
    as classified in the last iteration of multi-reference alignment. </p></li>
d895 4
a898 5
		<li>BATCH FILE: <a href="bpclass.rct">bpclass.rct</a> </li>
		<li>INPUTS: <b>Zerodegr/Multiref2/listrefs</b>, <b>Zerodegr/Multiref2/goodsel***</b>, 
		    <b>Tilted/dang-store</b>, <b>Tilted/Aligned/cent*****</b> </li>
		<li>OUTPUTS: <b>Volumes/vcla***</b> </li>
<!-- 		<li>details</li> -->
d901 1
a901 1
<li><p>Filter one or all 3D reconstructions</p></li>
d903 1
a903 1
		<li>BATCH FILE: <a href="volfilt.rct">volfilt.rct</a> </li>
d908 1
a908 1
		        enter the number of that class.</li>
d910 1
a910 1
		        parameters for the Fourier filter</li>
d914 1
a914 1
		        will use the values in the docfile instead</li>
d917 1
a917 1
		<li>OUTPUTS: <b>Volumes/vflt***</b>, <b>Volumes/docvolfilt</b> </li>
d921 1
a921 1
		    the filter parameters from this editable file will be used. </li>
d928 3
a930 2
    <p>This batch file aligns two volumes to each other.
       Choose one volume as an alignment reference, to which the rest of class volumes will be aligned.  
d932 1
a932 1
       <a href="../../../man/pj3q.html">'PJ 3Q'</a>,
d934 1
a934 1
       <a href="../../../man/or3q.html">'OR 3Q'</a>
d939 3
a941 3
	<li>BATCH FILE: <a href="volalignprj.rct">volalignprj.rct</a> </li>
	<li>SUBROUTINE: <a href="montageprj.rct">montageprj.rct</a> </li>
	<li>PARAMETERS:</li>
d943 2
a944 2
	    <li><i>[exp-num]</i> -- the number for the experimental volume to align</li>
	    <li><i>[ref-num]</i> -- the number for the reference volume</li>
d948 2
a949 2
		<a href="../../recon/newprogs/refproj.spi">
		refproj.spi</a>.</li>
d951 2
a952 2
	        <a href="../../../man/apsh.html">'AP SH'</a>, as in
		<a href="../../recon/newprogs/apsh.spi"> apsh.spi</a>.</li>
d955 1
a955 1
	<li>OUTPUTS:</li>
d957 3
a959 3
	    <li><b>prj_***</b> -- re-projection stacks </li>
	    <li><b>dalv***</b> -- alignment parameters for each solution requested</li>
	    <li><b>vali***</b> -- aligned class volume</li>
d961 1
a961 1
	        initial and refined alignments, for each solution requested</li>
d971 1
a971 1
       <a href="../../../man/or3q.html">'OR 3Q'</a>.</p>
d983 3
a985 3
	<li>BATCH FILE: <a href="mergevols.rct">mergevols.rct</a> </li>
	<li>INPUTS: <b>dang-store</b>, <b>list2merge</b>, <b>dalv***</b>, 
	    <b>goodsel***</b>, <b>cent*****</b> </li>
d988 4
a991 3
	    <li><b>dang-merged</b> -- combines particles' Euler angles with class-volume alignment angles </li>
	    <li><b>mergedsel</b> -- particle-selection file from merged classes </li>
	    <li><b>vtot999</b> -- merged volume </li>
d1003 2
a1004 1
       Edit <a href="volfilt.rct">volfilt.rct</a> to operate on the <b>vtot***</b> volume(s).</p>
d1007 16
a1022 14
<li><p>Prepare files for reference-based alignment</p></li>
	<ul>
		<li>Before running this step, download the reference-based alignment tarball and untar it by typing:
		    <pre>tar -zxvf spiproject.tar.gz</pre>
		This will create a new directory called <i>myproject</i><br />
		If you rename that directory, remember to change the output in this ensuing batch file accordingly.</li>
		<li>BATCH FILE: <a href="prepare-prjmatch.rct">prepare-prjmatch.rct</a> </li>
		<li>INPUTS:  <b>lots</b> </li>
		<li>OUTPUTS: <b>lots</b> </li>
		<li><p>This batch file will copy information in a form that can be understood by the 
		    <a href="../../recon/mr.html"> reference-based alignment protocol.</a>
		    Begin with the section entitled 
		    <a href="../../recon/mr.html#SH"> "Alignment"</a> with the step 
		    <a href="../../recon/newprogs/sel_by_group.spi"> sel_by_group.spi</a>. </p>
d1024 9
a1032 10
		    <p>We have not (yet) implemented CTF-correction for the tilted-specimen particle images 
		    (we will be using only the tilted images), so we will be ignoring the CTF.  
		    (Adjust your expectations for the resulting reconstruction accordingly.) 
		    For the steps that present the option of accounting for the CTF or not 
		    (such as 
		    <a href="../../recon/newprogs/apshgrp.spi"> apshgrp.spi</a> vs.
		    <a href="../../recon/newprogs/apsh.spi">
		    apsh.spi</a>), use the version that does not take into account the CTF (in this example, 
		    <a href="../../recon/newprogs/apsh.spi"> apsh.spi</a>).</p></li>
	</ul>
d1036 1
a1036 1
<b><p>Miscellaneous batch files</p></b>
d1038 1
a1038 7
<li><p>Projection onto convex sets</p></li>
	<ul>
		<li>BATCH FILE: <a href="batchlink">batchname</a> </li>
		<li>INPUTS: <b>input</b> </li>
		<li>OUTPUTS: <b>output</b> </li>
		<li>details</li>
	</ul>
d1040 1
a1040 7
<!--<li><p>DESCRIPTION</p></li>
	<ul>
		<li>BATCH FILE: <a href="batchlink">batchname</a> </li>
		<li>INPUTS: <b>input</b> </li>
		<li>OUTPUTS: <b>output</b> </li>
		<li>details</li>
	</ul>-->
d1042 6
d1057 2
a1058 1
        (1987) Three-dimensional reconstruction from a single-exposure, random conical tilt series applied to 
d1060 1
a1060 1
        <i>J Microsc.</i>  <b>146</b>:113-36.</li>
d1062 3
a1064 2
        SPIDER image-processing for single-particle reconstruction of biological macromolecules from electron micrographs.
        <i>Nature Protocols</i> <b>3</b>: 1941-74.</li>
@


1.5
log
@updated
@
text
@d2 68
a69 68
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>Random-conical tilt reconstruction</TITLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">

<I><P ALIGN="RIGHT">(Updated 2012 Nov 21)</P></I>

<CENTER><P>
<FONT SIZE="5"><B>Random conical tilt reconstruction</B></font>
<BR>Adapted from the 2007 SPIDER Workshop tutorial
</P></CENTER>

<HR>

<B><P>Outline</P></B>
<UL>
	<LI>General notes</LI>
	<LI>Quick-start guide</LI>
	<LI>Getting started</LI>
	<LI>Procedure </LI>
	<LI>Miscellaneous batch files </LI>
	<LI>References </LI>
</UL>

<HR>

<B><P>General notes</P></B>

<UL>
	<LI>Sequential operations are numbered. Options are lettered.</LI>
	<LI>Data extension assumed to be <B>.dat</B>. Adjust accordingly.</LI>
	<LI>List of inputs and outputs in description is not exhaustive.</LI>
</UL>

<HR>

<B><P>Quick-start guide</P></B>
<OL>
	<LI>tar -xvf $BATCH.tar</LI>
	<LI>spider rct/dat @@makeparams (or copy <B>params.dat</B>)</LI>
	<LI>(optional) tar -xvf $DATA.tar</LI>
	<LI>mkfilenums.py filenums.dat $MICROGRAPHS*</LI>
	<LI>(for non-SPIDER format micrographs) spider rct/dat @@convert</LI>
	<LI>spider rct/dat @@shrinkmics</LI>
	<LI>cd Micrographs/ ; montagefromdoc.py ../filenums.dat</LI>
	<LI>spider rct/dat @@micpair</LI>
	<LI>(required for JWEB) spider rct/dat @@padmics</LI>
	<LI>pick tilt pairs in JWEB or WEB</LI>
	<LI>spider rct/dat @@makesomenoise (or copy <B>noise.dat</B>) </LI>
	<LI>spider rct/dat @@windowparticles</LI>
	<LI>(for negative stain) Do both of:</LI>
		<OL TYPE=A>
			<LI>spider rct/dat @@highpass-untilted</LI>
			<LI>spider rct/dat @@highpass-tilted</LI>
		</OL>
	<LI>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</LI>
	<LI>(if necessary) spider rct/dat @@removebad</LI>
	<LI>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</LI>
	<LI>(if necessary) spider rct/dat @@removebad</LI>
	<LI>(slow) spider rct/dat @@pairwise</LI>
	<LI>(optional) To reorient average, do both of:</LI>
		<OL TYPE=A>
			<LI>spider rct/dat @@reorientavg</LI>
			<LI>spider rct/dat @@sumalign</LI>
		</OL>
<!--</OL>
d71 37
a107 37
	<LI>spider rct/dat @@filtershrink</LI>
	<LI>spider rct/dat @@ca-pca</LI>
	<LI>Classify.  (Ward's method shown here.  For other options, see below.)</LI>
	<OL TYPE=A>
		<LI>spider rct/dat @@hierarchical</LI>
		<LI>spider rct/dat @@binarytree</LI>
		<LI>cd Zerodegr/Tree ; ../../tree.py labeled0001.dat 4 selclasses.dat</LI>
	</OL>
	<LI>Iterate:</LI> 
		<OL TYPE=A>
			<LI>spider rct/dat @@multirefalign (subsequently @@multirefalign-descend)</LI> 
			<LI>spider rct/dat @@filtershrink</LI> 
			<LI>spider rct/dat @@classifybyview</LI>
			<LI>verifybyview.py</LI> 
		</OL>
	<LI>spider rct/dat @@combinegoodclasses</LI> 
	<LI>spider rct/dat @@viewaverages</LI> 
	<LI>spider rct/dat @@centertilt</LI>
	<LI>spider rct/dat @@storeangles</LI>
	<LI>(optional) spider rct/dat @@d6symmetry</LI>
	<LI>spider rct/dat @@bpclass</LI>
	<LI>spider rct/dat @@volfilt</LI>
	<LI>(if multiple orientations) Do both of: </LI>
		<OL TYPE=A>
			<LI>spider rct/dat @@volalignprj</LI>
			<LI>spider rct/dat @@mergevols</LI>
		</OL>
	<LI>spider rct/dat @@prepare-prjmatch</LI>
</OL>

<HR>

<B><P>Getting started</P></B>

<UL>
	<LI>Create a new directory, and change to that directory before unpackaging the 
		batch-file tarball.</LI>
d109 1
a109 1
	<LI>Micrographs should be placed in the <B>Micrographs/</B> directory.  
d111 1
a111 1
		<a href="convert.rct">convert.rct</a> for the conversion. </LI>
d113 1
a113 1
	<LI>The SPIRE libraries are required for various Python scripts, such as
d117 1
a117 1
		<a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html#FullInstall">here</a>.</LI>
d119 2
a120 2
<!-- 	<LI></LI> -->
</UL>
d122 1
a122 1
<HR>
d124 1
a124 1
<B><P>Procedure</P></B>
d126 53
a178 54
<UL>

<LI><P>Prepare directory</P></LI>
	<UL>
		<LI>Download the latest <a href="../tar_archive">batch-file archive</a> 
			and unpackage it by typing:
			<PRE>tar -xvf $ARCHIVE.tar</PRE>
			This command will unpackage the files in the currect directory, 
			so create a new directory if so desired.</LI>
	</UL>

<LI><P>Prepare parameter doc file</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="makeparams.rct">makeparams.rct</a> </LI>
		<LI>OUTPUTS: <B>params</B> </LI>
		<LI>Otherwise, you can copy a <B>params</B> file from elsewhere.<BR>
			An example file called <B>bak-params</B> is present in the tarball.</LI>
		<LI>The following parameters (described <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/params.html">
			here</a>) are used from the <B>params</B> file:</LI>
			<UL>
				<LI><B>1</B> -- zip flag -- if set to 1, then will be uncompressed using gunzip</LI>
					<UL><LI>used by convert.rct</LI></UL>
				<LI><B>2</B> -- format flag -- 0 corresponds to SPIDER, 3 to Z/I TIFF, etc. -- see 
					<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/params.html">
					complete description</a> for additional formats</LI>
					<UL><LI>used by convert.rct</LI></UL>
				<LI><B>5</B> -- pixel size -- in Angstroms</LI>
					<UL><LI>used by shrinkmics.rct</LI></UL>
				<LI><B>17</B> -- window size -- in pixels </LI>
					<UL><LI>used by many batch files</LI></UL>
				<LI><B>18</B> -- particle diameter -- in pixels</LI>
					<UL><LI>used by pairwise.rct </LI></UL>
		<!--		<LI><B>NUMBER</B> -- FLAG -- DESCRIPTION</LI>
					<UL><LI>used by BATCH</LI></UL>-->
			</UL>
	</UL>

<LI><P><I>(optional)</I> Copy sample data.</P></LI>
	<UL>
		<LI>Download the <a href="../tar_archive/data20060817.tar">data archive</a>
			and unpackage it by typing:</LI>
			<PRE>tar -xvf data20060817.tar</PRE>
		<LI>This command will create a directory called <B>Micrographs/</B>, 
			containing phantom micrographs, and a directory called <B>TP1/</B>,
			containing the files used to generate the micrographs.</LI>
	</UL>

<LI><P>Generate a list of micrographs.</P></LI>
	<UL>
		<LI>PYTHON SCRIPT: <a href="mkfilenums.py">mkfilenums.py</a> </LI>
		<LI>To make a list of TIFF files, for example, the syntax would be: </LI>
			<PRE>mkfilenums.py filenums.dat Micrographs/zeiss*.tif</PRE>
		<LI>This Python script requires the Spiderutils library from SPIRE. 
			If SPIRE is not installed, you can generate <B>filenums</B> using other means, 
d180 20
a199 24
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/doccreate.html">
			'DOC CREATE'</a> in SPIDER. </LI>
	</UL>

<LI><P><I>(optional)</I> If the micrographs are not already in SPIDER format, convert them.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="convert.rct">convert.rct</a> </LI>
		<LI>SUBROUTINE: <a href="convert_p.rct">convert_p.rct</a> </LI>
		<LI>INPUTS: <B>filenums</B>, <B>Micrographs/mic****</B> </LI>
		<LI>Downstream batch files will expect files called <B>Micrographs/mic****</B>. 
			Keeping that convention will minimize the number of changes you'll need to make.</LI>
		<LI>If the micrographs are in Z/I TIFF format, 
			<a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">zi2spi</a> 
			will be needed. If it is not installed on your system, the compilation instructions 
			are described at the top of the source code.</LI>
		<LI>TO DO: add conversion flag for MRC files</LI>
	</UL>

<LI><P>Shrink the micrographs for particle-picking.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="shrinkmics.rct">shrinkmics.rct</a> </LI>
		<LI>INPUTS: <B>filenums</B>, <B>Micrographs/mic****</B> </LI>
		<LI>INPUTS: <B>Micrographs/sm-mic****</B> </LI>
		<LI>Choose the reduction factor such that the micrgraph fits on the screen, 
d201 14
a214 14
			These downsampled micrographs will be used to pick tilt pairs.</LI>
		<LI>The filtration step is slow, so 
			by setting <I>[filter-radius]=0</I>, you can skip this step. </LI>
	</UL>

<LI><P>Screen micrographs.</P></LI>
	<UL>
		<LI>Micrographs can be screened using various display programs.
			To use montagefromdoc.py, from <B>Micrographs/</B>
			(there is a pre-existing <B>.montagefromdoc</B> file there), type:
			<PRE>montagefromdoc.py ../filenums.dat sm-mic*</PRE>
			The output should also be <B>filenums</B>.</LI>
		<LI>If you wish to remove micrographs by editing <B>filenums</B>
			(instead of with montagefromdoc.py),
d216 19
a234 19
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/docren.html">
			'DOC REN'</a>. (The input and output can have the same name.) </LI>
	</UL>

<LI><P>Establish pairings between micrographs</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="micpair.rct">micpair.rct</a> </LI>
		<LI>INPUTS: <B>filenums</B> </LI>
		<LI>OUTPUTS: <B>docmicpairs</B> </LI>
		<LI>This batch file presumes that the tilted-specimen micrograph precedes the untilted-specimen micrograph.
			Check the output to confirm that the pairings make sense.</LI>
	</UL>

<LI><P>Resize micrographs (Required for JWEB, not required for X-Window WEB)</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="padmics.rct">padmics.rct</a> </LI>
		<LI>INPUTS: <B>docmicpairs</B>, <B>Micrographs/sm-mic****</B> </LI>
		<LI>OUTPUTS: <B>Micrographs/jweb-mic{***[untilted]}</B>, <B>Micrographs/jweb-mic{***[untilted]}_tilted</B> </LI>
		<LI>JWEB has a "feature" that requires the tilt pair to have the same dimensions. 
d237 2
a238 2
			even though it is typically collected first at the microscope.</LI>
	</UL>
d240 5
a244 5
<LI><P>Pick tilt pairs (for JWEB, differences for X-Window WEB noted below)</P></LI>
	<UL>
	    <LI>INPUTS: <B>Micrographs/jweb-mic{***[untilted]}</B>, <B>Micrographs/jweb-mic{***[untilted]}_tilted</B>
	    <P></P></LI>
	</UL>
d246 4
a249 4
	    <LI>If using JWEB: </LI>
		<OL>
			<LI>From the <B>Micrographs/</B> directory, open JWEB. </LI>
			<LI>Go to <I>File -> Open -> Image Series</I> and select a pair of micrographs. 
d251 6
a256 6
			    Do <U>NOT</U> resize the micrographs using <I>Edit</I> &gt; <I>Resize</I>, 
			    for ease of use with the batch files below.</LI>
			<LI>Click on the <I>Markers/Tilt Pair</I> tab.</LI>
			<LI>In the <I>Marker File Number</I> field, enter the number of the untilted micrograph.</LI>
			<LI>Click on the <I>Show/Edit Marker</I> button, which will display the images.</LI>
			<LI>Select a particle from the untilted micrograph, and 
d261 1
a261 1
				<BR><I>HINT:</I> The middle mouse button will erase a pair of points 
d263 7
a269 7
				<BR><I>HINT:</I> Since the numbering is to the right of the marker, 
				it may be easier to proceed from right to left.</LI>
			<LI>Click on buttons <I>Save Marker Files</I> and <I>Determine Theta</I>, 
				which will determine the magnitude of the tilt angle between the micrographs.</LI>
			<LI>Click on the <I>Fit Angles</I> button.
				This will determine the direction of the tilt axis.</LI>
			<LI>Click on the <I>Draw Fitted Locations</I> button.
d271 12
a282 12
				but does not affect the coordinates selected with the mouse.</LI>
			<LI>Click on the <I>Save Angles</I> button.</LI>
			<LI>Now, when you select a particle in the untilted image, 
				JWEB will send the cursor to the corresponding location in the tilted image.</LI>
			<LI>Select more particles from the tilt pair. 
				(For the sample micrograph, there are 76 pairs.  Select all of them.)</LI>
			<LI>To save the new values, re-click the five buttons: <I>Save Marker Files</I>, <I>Determine Theta</I>, 
				<I>Fit Angles</I>, <I>Draw Fitted Locations</I>, and <I>Save Angles</I>.</LI>
		</OL>
	    <LI>If using X-Window WEB: </LI>
		<OL>
		    <LI>From the menu, select <I>COMMANDS</I> &gt; <I>Tilted Particles</I>, 
d284 4
a287 4
		        and then the tilted-specimen image.  </LI>
		    <LI>In the <I>Particle doc</I> popup window, under <I>Doc file number</I>, 
		        enter the number of the untilted micrograph and click <I>ACCEPT</I>.</LI>
		    <LI>Select a particle from the untilted micrograph, and 
d291 17
a307 17
			ideally in the four corners, but the farther apart the better.</LI>
		    <LI>Click the middle button to open the <I>Particle picking menu_popup</I>.</LI>
		    <LI>Click on <I>Determine tilt axis angles</I>, <I>Draw fitted locations</I>, 
		        and <I>Save angles in doc file</I>.</LI>
		    <LI>Now, when you select a particle in the untilted image, 
			WEB will send the cursor to the corresponding location in the tilted image.</LI>
		    <LI>Select more particles from the tilt pair. 
			(For the sample micrograph, there are 76 pairs.  Select all of them.)</LI>
		    <LI>To save the new values, re-click the three buttons: <I>Determine tilt axis angles</I>, 
		        <I>Draw fitted locations</I>, and <I>Save angles in doc file</I>.</LI>
		    <LI>Differences between JWEB and X-Window WEB:</LI>
			<UL>
			    <LI>X-Window WEB does not require the pair of micrographs to be the same size, 
				so the step <a href="padmics.rct">padmics.rct</a> is unnecessary. </LI>
			    <LI><U>WARNING</U>: If you entered a number under <I>Image reduction factor</I>
				(after setting the reduction factor in <I>OPTIONS</I> &gt; <I>Image</I>)
				do <U>NOT</U> set the parameter <I>[decimation-factor]</I> below in 
d309 10
a318 10
				Using both parameters will be redundant.</LI>
			    <LI>There is no <I>Save Marker Files</I> button.
				Coordinates are saved continuously.</LI>
			    <LI><I>Determine Theta</I> and <I>Fit Angles</I> are merged into one button: 
				<I>Determine tilt axis angles</I>.</LI>
			</UL>
		</OL>
	</OL>
	<UL>
	    <LI><I>HINT:</I> Save the coordinates frequently. 
d321 2
a322 2
		Delete those particles (using the middle mouse button), and re-pick them, as necessary.</LI>
	    <LI><I>HINT:</I> If, while picking pairs, the fitted locations stray from the correct location 
d325 23
a347 23
		it may help to re-do the fitting (summarized under the previous bullet).</LI>
	    <LI><I>HINT:</I> If you close a pair or micrographs and re-open them
		(with the appropriate <I>Marker File Number</I>), 
	    you can resume from where you left off.</LI>
	</UL>

<LI><P>Obtain a noise image for normalization.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="makesomenoise.rct">makesomenoise.rct</a> </LI>
		<LI>INPUTS: a micrograph </LI>
		<LI>OUTPUTS: <B>noise</B>, <B>tmpnoise/noi***</B> </LI>
		<LI>Subsequent windowed images will be normalized against the output noise file.
			If you have a pre-existing noise file, copy it to <B>noise.dat</B></LI>
		<LI>One noise file will be chosen at random by the batch file.
			You can also look at the noise images in the <B>tmpnoise/</B> directory
			and copy one that looks even "noisier" to <B>noise.dat</B>
			(in the top-level directory).</LI>
	</UL>

<LI><P>Window particles from tilted and untilted micrographs.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="windowparticles.rct">windowparticles.rct</a> </LI>
		<LI>PARAMETER: <I>[decimation-factor]</I> -- If you used the output of 
d351 2
a352 2
		    <I>Edit</I> &gt; <I>Resize</I> (for JWEB) or 
		    <I>Image reduction factor</I> (for X-Window WEB). 
d354 6
a359 6
		    the full-sized micrograph and the version used for particle-selection.</LI>
		<LI>INPUTS: <B>params</B>, <B>docmicpairs</B>, <B>noise</B>,
			<B>Micrographs/mic****</B>, <B>Micrographs/dcu****</B>, <B>Micrographs/dct****</B></LI>
		<LI>OUTPUTS: <B>listparticles</B>,
			<B>Zerodegr/Winrot/unt*****</B>, <B>Tilted/Winrot/tilt*****</B> </LI>
	</UL>
d361 1
a361 1
<LI><P>(Recommended for stained images) High-pass filter windowed images</P>
d363 1
a363 1
    <P>For negatively-stained images, it is often the case that the puddle of stain surrounding the particles 
d367 1
a367 1
    the aligning power of the images will be lost.  You may need to tweak the radii.</P> 
d369 1
a369 1
    <P>If you are unsure whether to do this step, feel free to skip it, 
d371 21
a391 22
    in order to see if the stain is the predominant source of variation. </P> </LI>
	<OL>
	    <LI>BATCH FILE: <a href="highpass-untilted.rct">highpass-untilted.rct</a></LI>
	    <UL>
		<LI>INPUTS: <B>Zerodegr/Winrot/unt*****</B> (directory renamed to <B>Unhighpass</B></LI>
		<LI>OUTPUTS: <B>Zerodegr/Winrot/unt*****</B> </LI>
	    </UL>
	    <LI>BATCH FILE: <a href="highpass-tilted.rct">highpass-tilted.rct</a></LI>
	    <UL>
		<LI>INPUTS: <B>Tilted/Winrot/tilt*****</B> (directory renamed to <B>Unhighpass</B></LI>
		<LI>OUTPUTS: <B>Tilted/Winrot/tilt*****</B> </LI>
	    </UL>
	</OL>

<LI><P>Screen the windowed images for defects (micrograph edges, dust, etc.).</P></LI>
	<UL>
		<LI>Screen the untilted--specimen windowed images by running
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
		montagefromdoc.py</a>, using the following command:
			<PRE>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</PRE>
		Use <B>notgood</B> as the output doc filename.<BR></LI>
		<LI>Only click on the bad images.
d393 8
a400 8
			There will be additional rounds of selection downstream.</LI>
		<LI>If particles are rejected, run: <a href="removebad.rct">removebad.rct</a> </LI>
		<UL>
		    <LI>INPUTS: <B>listparticles</B> (will be backed up by <a href="backup.rct">backup.rct</a>), <B>notgood</B> </LI>
		</UL>
		<LI>Now screen the tilted images for defects:</LI>
			<PRE>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</PRE>
		<LI>Only click on the bad images.
d402 11
a412 11
			such as dust, edges, double-particles, etc. -- so be more stringent here.</LI>
		<LI>If tilted particles are rejected, re-run <a href="removebad.rct">removebad.rct</a></LI>
	</UL>

<LI><P>Align the untilted-specimen particles using reference-free alignment.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="pairwise.rct">pairwise.rct</a> </LI>
		<LI>INPUTS: <B>listparticles</B>, <B>Zerodegr/Winrot/unt*****</B> </LI>
		<LI>OUTPUTS: <B>Zerodegr/Pairwise/rfreeavg001</B>, <B>Zerodegr/Aligned/cenu*****</B>, 
			<B>Zerodegr/Pairwise/docpairalign</B>, many others </LI>
		<LI>This batch file first aligns pairs of images, averages them, 
d415 2
a416 2
			and each subsequent level will be faster.</LI>
	</UL>
d418 8
a425 8
<LI><P><I>(optional)</I> Attempt to align average along coordinate axes</P></LI>
	<OL>
	    <LI>Align average along coordinate axes
		<UL>
		    <LI>BATCH FILE: <a href="reorientavg.rct">reorientavg.rct</a> </LI>
		    <LI>INPUTS: <B>Zerodegr/Pairwise/rfreeavg001</B> </LI>
		    <LI>OUTPUTS: <B>Zerodegr/Pairwise/dsolalign</B>, <B>Zerodegr/Pairwise/malign</B> </LI>
		    <LI>This batch file aligns the average to a mirrored version of itself, 
d427 1
a427 1
			    There will be two solutions, along <I>x</I> or along <I>y</I>. 
d431 2
a432 2
			    <a href="sumalign.rct">sumalign.rct</a>.</LI>
		</UL>
d434 9
a442 9
	    <LI>Combine alignments of individual particles with reoriented average</LI>
		<UL>
			<LI>BATCH FILE: <a href="sumalign.rct">sumalign.rct</a> </LI>
			<LI>PARAMETER: solution 1 or 2 (see description below) </LI>
			<LI>INPUTS: <B>Zerodegr/Winrot/unt*****</B>, <B>Zerodegr/Pairwise/dsolalign</B>, 
				<B>Zerodegr/Pairwise/docpairalign</B> </LI>
			<LI>OUTPUTS: <B>Zerodegr/Pairwise/dalu001</B>, <B>Zerodegr/Aligned/cenu*****</B>, 
				<B>Zerodegr/Pairwise/avgu001</B> </LI>
			<LI>If you wish to apply the alignments of the average from
d445 24
a468 24
				Typically, in one solution the major axis is along <I>x</I>.
				and in the other it is along <I>y</I>.
				It is arbitrary which solution to use.</LI>
		</UL>
	</OL>

<LI><P>Filter the aligned, untilted particles.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="filtershrink.rct">filtershrink.rct</a> </LI>
		<LI>PARAMETERS: reduction factor, low-pass filter parameters </LI>
		<LI>INPUT: <B>Zerodegr/Aligned/cenu*****</B></LI>
		<LI>OUTPUT: <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>Remember to change the input filename if you ran <a href="sumalign.rct">sumalign.rct</a>. </LI>
		<LI>The filtered images produced will be used for multivariate data analysis and classification.
			To look at the filtered untilted particles, type: </LI>
			<PRE>montagefromdoc.py listparticles.dat Zerodegr/Filtered/flt*</PRE>
	</UL>

<LI><P>Run correspondence analysis (CA) or principal component analysis (PCA) on filtered images.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="ca-pca.rct">ca-pca.rct</a> </LI>
		<LI>PARAMETERS: </LI>
			<UL>
				<LI><I>flag for CA (1), PCA (2), or iterative PCA (3)</I> --
d470 2
a471 2
						I, subjectively, try CA first, then iterative PCA, then PCA last.</LI>
				<LI><I>number of factors to calculate</I> --
d474 6
a479 5
					increase this parameter and re-run.</LI>
			</UL>
		<LI>INPUT: <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>OUTPUT: <B>Zerodegr/MSA/cas_***</B>, <B>Zerodegr/MSA/reconstituted***</B>, others </LI>
		<LI>The commands to generate the PostScript eigenvalue histogram requires the SPIRE Python libraries.
d481 2
a482 2
		    <a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html#FullInstall">here</a>.</LI>
		<LI>For negatively-stained samples, when looking at the reconstituted images, 
d484 2
a485 2
		    go back to the high-pass filtration step above.</LI>
	</UL>
d487 8
a494 8
<LI><P>Classify images. Chose one of:</P></LI>
	<OL TYPE=A>
		<LI>K-means clasification. </LI>
		<UL>
			<LI>BATCH FILE: <a href="kmeans.rct">kmeans.rct</a> </LI>
			<LI>PARAMETERS:</LI>
				<UL>
					<LI><I>desired number of classes</I> --
d499 2
a500 2
						one class per 50 to 75 particles.</LI>
					<LI><I>number of factors to use</I> --
d503 12
a514 12
						Use of the weaker factors will probably not make a big difference though.</LI>
				</UL>
			<LI>INPUTS: <B>Zerodegr/MSA/cas_***</B>, <B>Zerodegr/Filtered/flt*****</B> </LI>
			<LI>OUTPUTS: <B>classavg***</B>, <B>docclass****</B>, others </LI>
		</UL>

		<LI>Hierarchical classification, using Ward's method. </LI>
		<OL>
			<LI>Run classification. </LI>
			<UL>
				<LI>BATCH FILE: <a href="hierarchical.rct">hierarchical.rct</a> </LI>
				<LI>PARAMETER: <I>number of factors to use</I> --
d517 13
a529 13
					Use of the weaker factors will probably not make a big difference though.</LI>
				<LI>INPUTS: <B>Zerodegr/MSA/cas_***</B> </LI>
				<LI>OUTPUTS: <B>docdendro</B> </LI>
			</UL>

			<LI>Generate class averages. Choose one of:</LI>
			<OL TYPE=a>
				<LI>Generate binary tree using tree.py</LI>
				<UL>
					<LI>BATCH FILE: <a href="binarytree.rct">binarytree.rct</a> </LI>
					<LI>SUBROUTINES: averagenode.rct, update_lut.rct </LI>
					<LI>PARAMETER: <I>ending depth</I> --
						For the depth that you specify here, there will be up to 2^<I>depth</I> averages generated. 
d531 4
a534 4
						It is better to make too many and display fewer in the next step.</LI>
					<LI>INPUT: <B>docdendro</B> </LI>
					<LI>OUTPUTS: <B>avgnode***</B>, <B>labeled***</B> </LI>
					<LI>NOTE: The format of SPIDER's dendrogram doc file changed in version 17.13. 
d536 2
a537 7
						If this batch file crashes, check this parameter.</LI>
					<LI>To view the binary tree, run <A HREF="tree.py">tree.py</A>. It requires 
						<A HREF="http://www.wadsworth.org/spider_doc/spider/docs/python/spipylib/code/Spiderutils.html">
						Spiderutils.py</A> from the 
						<A HREF="http://www.wadsworth.org/spider_doc/spire/doc/packages.html">
						SPIRE</A> installation. Options for the program are described 
						<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/MSA/index.htm">
d539 7
a545 7
						<PRE>cd Zerodegr/Tree ; tree.py labeled0001.dat 4 selclasses.dat</PRE>
						Save the selection file with <I>CTRL-s</I>.<P></P></LI>
				</UL>

				<LI>Generate binary tree as (large) SPIDER image</LI>
				<UL>
					<LI>Alternatively, you can run <a href="tree.rct">tree.rct</a>,
d549 2
a550 2
						and view it in a dedicated image-viewer.</LI>
				</UL>
d552 9
a560 9
				<LI>Simple class averages</LI>
				<UL>
					<LI>This option is equivalent to the bottom row in the binary tree above, 
						or the display in WEB, and similar to simple K-means.</LI>
					<LI>BATCH FILE: <a href="classavg.rct">classavg.rct</a> </LI>
					<LI>PARAMETER: <I>desired number of classes</I></LI>
					<UL>
					</UL>
						<LI>Too small a number, and dissimilar particles will be grouped together, 
d564 2
a565 2
							one class per 50 to 75 particles.</LI>
						<LI>If you're going to run <a href="binarytree.rct">binarytree.rct</a>
d567 14
a580 14
							So, it doesn't matter how many classes you request here.</LI>
					<LI>INPUTS: <B>Zerodegr/Hierarchical/docdendro</B>
					    (other classification options write <B>docdendro</B> in different locations)</LI>
					<LI>OUTPUTS: <B>classavg***</B>, <B>docclass****</B>, <B>listclasses</B>, others </LI>
				</UL>
			</OL>
		</OL>

		<LI>Clustering using Diday's method. </LI>
		<OL>
			<LI>Run classification. </LI>
			<UL>
				<LI>BATCH FILE: <a href="cluster.rct">cluster.rct</a> </LI>
				<LI>PARAMETER: <I>number of factors to use</I> --
d583 9
a591 9
					Use of the weaker factors will probably not make a big difference though.</LI>
				<LI>INPUTS: <B>Zerodegr/MSA/cas_***</B> </LI>
				<LI>OUTPUTS: <B>docdendro</B> </LI>
			</UL>

			<LI>Generate class averages. </LI>
			<UL>
				<LI>BATCH FILE: <a href="classavg.rct">classavg.rct</a> </LI>
				<LI>PARAMETER: <I>desired number of classes</I> --
d596 4
a599 4
						one class per 50 to 75 particles.</LI>
				<LI>INPUTS: <B>docdendro</B> </LI>
				<LI>OUTPUTS: <B>classavg***</B>, <B>docclass****</B>, <B>listclasses</B>, others </LI>
				<LI>I haven't been able to make this compatible with 
d601 9
a609 9
					so for now, it's functionally equivalent to K-means.</LI>
			</UL>
		</OL>

	</OL>

<LI><P>Select unique classes.</P></LI>
	<UL>
		<LI>The classes selected will be used for multireference alignment. 
d613 2
a614 2
			The <B>.verifybyview</B> file included in the tarball 
			<LI>Included in the tarball is a starting <B>.verifybyview</B> file to use. 
d616 7
a622 7
				<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/interface.htm">
				verifybyview.py</a>, call the output class-selection doc file <B>selclasses</B>.</LI>
		<OL TYPE=A>
			<LI>To view+select the averages from K-means, type:</LI>
				<PRE>verifybyview.py Zerodegr/Kmeans/listclasses.dat</PRE>
			<LI>To view+select the averages from hierarchical classification, use one of the following:
				<PRE>verifybyview.py Zerodegr/Hierarchical/listclasses.dat</PRE>
d624 11
a634 10
				<U>OR</U> (if you ran <a href="binarytree.rct">binarytree.rct</a>):</LI>
				<PRE>cd Zerodegr/Tree ; tree.py labeled0001.dat 5 selclasses.dat</PRE>
			<LI>To view+select the averages from Diday's method, type:</LI>
				<PRE>verifybyview.py Zerodegr/Cluster/listclasses.dat</PRE>
		</OL>
		<LI>For verifybyview.py, the filenames at the initial dialog are:</LI>
			<UL>
				<LI><B>listclasses</B> -- can be specified on the command line </LI>
				<LI><B>classavg***</B> -- class-average template </LI>
			</UL>
d636 13
a648 13
			<UL>
				<LI><B>Zerodegr/Filtered/flt*****</B> -- particle template </LI>
				<LI><B>selclasses</B> -- list of selected classes </LI>
				<LI><B>byhand***</B> -- selected particles in a given class</LI>
			</UL>
	</UL>

<LI><P>Run multireference alignment.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="multirefalign.rct">multirefalign.rct</a> </LI>
		<LI>PARAMETERS, notable ones include: </LI>
		  <UL>
		    <LI><I>[cg-option]</I> -- if this is set to 1 (the default), 
d650 1
a650 1
		        <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html">'CG PH'</a>. 
d652 3
a654 3
		        You can look at the <B>Zerodegr/Multiref/ref***</B> files while the 
		        (slow) multi-reference alignment is running to check.</LI>
		    <LI><I>[mirror-option]</I> -- if this is set to 0 (the default), 
d663 10
a672 10
		        </LI>
		  </UL>
		<LI>INPUTS: <B>selclasses</B>, <B>docclass****</B>, 
			<B>Zerodegr/Aligned/cenu*****</B>, <B>Zerodegr/Winrot/unt*****</B> </LI>
		<LI>OUTPUTS: <B>Zerodegr/Multiref/ref***</B>, <B>Zerodegr/Multiref/docalign</B>, 
			<B>Zerodegr/Multiref/selview***</B>, <B>Zerodegr/Aligned/cenu*****</B>, 
			<B>Zerodegr/Multiref/viewavg***</B></LI>
		<LI>This batch file takes the class averages selected in the previous step, 
			re-centers them, and uses these for multireference alignment.</LI>
		<LI>Be sure that the label <I>[old_class_dir]</I> the batch file 
d674 27
a700 27
			For example, by default this label is set to <B>Zerodegr/Tree</B>,
			the location of the outputs of <a href="binarytree.rct">binarytree.rct</a>.</LI>
	</UL>

<LI><P>Re-filter aligned images.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="filtershrink.rct">filtershrink.rct</a> </LI>
		<LI>PARAMETERS: reduction factor, low-pass filter parameters </LI>
		<LI>INPUT: <B>Zerodegr/Aligned/cenu*****</B></LI>
		<LI>OUTPUT: <B>Zerodegr/Filtered/flt*****</B> </LI>
	</UL>

<LI><P>Classify the particles assigned to each reference.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="classifybyview.rct">classifybyview.rct</a> </LI>
		<LI>PARAMETERS:</LI>
			<UL>
				<LI>reduction factor</LI>
				<LI>flag for CA (1), PCA (2), or IPCA (3)</LI>
				<LI>number of factors to use</LI>
			</UL>
		<LI>INPUTS: <B>Zerodegr/Multiref/listrefs</B>, <B>Zerodegr/Multiref/ref***</B>, 
			<B>Zerodegr/Multiref/selview***</B>, <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>OUTPUTS: <B>Zerodegr/Multiref/View***/listclasses</B>, 
			<B>Zerodegr/Multiref/View***/classavg***</B>, 
			<B>Zerodegr/Multiref/View***/docclass***</B> </LI>
		<LI>This batch file performs a separate classification 
d702 1
a702 1
	</UL>
d704 4
a707 4
<LI><P>Check the classification results.</P></LI>
	<UL>
		<LI>Check the classes with the following command:</LI>
			<PRE>verifybyview.py Zerodegr/Multiref/View001/listclasses.dat</PRE>
d709 4
a712 4
				<UL>
					<LI><B>listclasses</B> -- specified on the command line </LI>
					<LI><B>classavg***</B> -- class-average template </LI>
				</UL>
d714 8
a721 8
				<UL>
					<LI><B>Zerodegr/Filtered/flt*****</B> -- particle template </LI>
					<LI><B>selclasses</B> -- list of selected classes </LI>
					<LI><B>byhand***</B> -- selected particles in a given class </LI>
				</UL>
		<LI>If all of the class averages under a particular reference look the same, 
			proceed to the next solid bullet ("Verify individual particles from last iteration of multireference alignment.").</LI>
		<LI>If there are homogeneous subsets under a particular reference, 
d725 1
a725 1
		<LI>There is no need to select similar-looking class averages, 
d728 3
a730 3
		<LI>Re-run the last three steps, <I>i.e.</I>:</LI>
			<OL>
				<LI><a href="multirefalign-descend.rct">multirefalign-descend.rct</a> 
d732 16
a747 16
					The following filenames/parameters are changed:</LI>
					<UL>
						<LI>Input <I>OLD_CLASS_DIR</I> is now the previous 
							multireference alignment directory, e.g., <B>Multiref</B></LI>
						<LI>Output <I>MULTIREF_DIR</I> is now the new directory, 
							for example <B>Multiref2</B></LI>
						<LI>The parameter <I>[subdir-flag]</I> set to <I>1</I> will serve as a flag 
							to look in the <B>View***</B> subdirectories for the class averages
							for subsequent runs.</LI>
					</UL>
				<LI><a href="filtershrink.rct">filtershrink.rct</a></LI>
				<LI><a href="classifybyview.rct">classifybyview.rct</a> -- 
				    Input <I>CLASS_DIR</I> is now the new 
				    multireference alignment directory, <I>e.g.</I>, <B>Multiref2</B></LI>
			</OL>
		<LI>Repeat these three steps as many times as necessary,
d752 2
a753 2
			except for the input and output directory names.  </LI>
	</UL>
d755 7
a761 7
<LI><P>Verify individual particles from last iteration of multireference alignment.</P></LI>
	<UL>
		<LI>Type the following (assuming you performed 2 rounds of multi-reference alignment):</LI>
			<PRE>verifybyview.py Zerodegr/Multiref2/View001/listclasses.dat</PRE> 
		<LI>INPUTS: <B>listclasses</B>, <B>classavg***</B>, <B>docclass***</B>, <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>OUTPUTS: <B>selclasses</B>, <B>byhand***</B> </LI>
		<LI>At this point, we will keep only good particles.
d765 3
a767 3
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/interface.htm">
				verifybyview.py can be found here</a></LI>
		<LI>In the example above, 
d770 18
a787 18
			change the corresponding multireference-alignment directory name above.</LI>
		<LI><i>HINT:</i> Don't forget to save the good-class list in verifybyview.py. 
			It is located in the class-average window under <I>File/SaveSelection</I>. 
			The keyboard shortcut, alternatively, is <I>ALT-s</I>. </LI>
	</UL>

<LI><P>Combine selected particles from classes.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="combinegoodclasses.rct">combinegoodclasses.rct</a> </LI>
		<LI>INPUTS (assuming again that you performed 2 rounds of multi-reference alignment): </LI>
			<UL>
				<LI><B>Zerodegr/Multiref2/listrefs</B> </LI>
				<LI><B>Zerodegr/Multiref2/View***/selclasses</B> </LI>
				<LI><B>Zerodegr/Multiref2/View***/byhand***</B> (or <B>Zerodegr/Multiref2/View***/docclass****)</B> </LI>
			</UL>
		<LI>OUTPUTS: <B>Zerodegr/Multiref2/View***/goodsel</B> </LI>
		<LI>This batch files creates one list of particles for each reference view.</LI>
		<LI>In the example above, 
d790 2
a791 2
			change the corresponding multireference-alignment directory name above.</LI>
		<LI><I>HINT:</I> It may be useful to re-classify only the good particles, 
d793 1
a793 1
			In that case, re-run classifyview using <B>goodsel***</B> instead of <B>selview***</B>.
d795 1
a795 1
			e.g., add <I>good</I> to the beginning of the filenames. 
d798 2
a799 2
			It may be useful to classify the bad particles too.</LI>
	</UL>
d801 18
a818 18
<LI><P>Average selected images</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="viewaverages.rct">viewaverages.rct</a></LI>
		<LI>SUBROUTINE: <a href="viewaverage1.rct">viewaverage1.rct</a></LI>
		<LI>INPUTS: <B>Zerodegr/Aligned/cenu*****</B>, <B>Zerodegr/Multiref2/goodsel***</B>    
		    (assuming again that you performed 2 rounds of multi-reference alignment)</LI>
		<LI>OUTPUTS: <B>goodavg***</B>, <B>goodvar***</B> </LI>
	</UL>

<LI><P>Center tilted-specimen particles.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="centertilt.rct">centertilt.rct</a> </LI>
		<LI>PARAMETERS: center-of-gravity option (see NOTE below), 
		    filter parameters (see NOTE below)</LI>
		<LI>INPUT: <B>Tilted/Winrot/tilt*****</B> </LI>
		<LI>OUTPUTS: <B>Tilted/Aligned/cent*****</B>, <B>Tilted/dalt001</B>, 
			<B>Tilted/avgt001</B> </LI>
		<LI>This step is straightforward relative to the alignment of the untilted particles. 
d822 9
a830 9
			and the other two are determined by the geometry of the tilt pair.</LI>
		<LI>To look at the centered tilted particles, type: </LI>
			<PRE>montagefromdoc.py listparticles.dat Tilted/Aligned/cent*</PRE>
		<LI>If this batch file runs slowly, you can save time by centering only the selected particles.  
			To do this, change the input <B>listparticles</B> to <B>Zerodegr/Multiref#/combinedgood</B> 
			from the appropriate directory, <I>i.e.</I>, <b>Multiref</b>, <b>Multiref2</b>, etc.</LI>
		<LI>NOTE: To center the average after reference-free alignment (translation only), 
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html">
		    'CG PH'</a> is used as the default.  However, as noted in the documention, 
d833 2
a834 2
		    This option is used by setting parameter <I>[cg-option]</I> to 2.  
		    If neither option 1 nor 2 work well, setting <I>[cg-option]</I> will not 
d836 4
a839 4
		    Be sure to inspect the average to ensure that is is centered.</LI>
		<LI>NOTE: Low-pass filtration of the images seems to help the 
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsa.html">
		    'AP SA'</a> command.  A strong filter is not needed; feel free to experiment.  
d842 2
a843 2
		</LI>
	</UL>
d845 9
a853 9
<LI><P>Store Euler angles.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="storeangles.rct">storeangles.rct</a> </LI>
		<LI>PARAMETER: <I>[mirror-yn]</I> (see NOTE below)</LI>
		<LI>INPUTS: <B>docalign</B>, <B>Micrographs/dcb****</B> </LI>
		<LI>OUTPUTS: <B>Tilted/dang-store</B> </LI>
		<LI>Use the most recent aligment doc file for the untilted images, 
			e.g., <B>Zerodegr/Multiref2/docalign</B>.</LI>
		<LI>NOTE: Changing parameter <I>[mirror-yn]</I> will reverse the handedness of the structure. 
d859 2
a860 2
		    you may need to re-test for flips in handedness.</LI>
		<LI><P>This batch file stores the three Euler angles in a doc file to use in the backprojection.
d862 1
a862 1
		    the displayed tilt parameters <U>SHOULD</U> be similar to each other.  
d864 1
a864 1
		    there is a possibility that equivalent (as far as the fitting is concerned) solutions are chosen inconsistently. </P>
d866 1
a866 1
		    <P>For example, in the sample RCT data in the 
d871 3
a873 3
		    </P>
		    </LI>
	</UL>
d875 1
a875 1
<LI><P>Compute 3D reconstructions</P>
d877 16
a892 16
    <P>This step will compute 3D reconstructions for each class, 
    as classified in the last iteration of multi-reference alignment. </P></LI>
	<UL>
		<LI>BATCH FILE: <a href="bpclass.rct">bpclass.rct</a> </LI>
		<LI>INPUTS: <B>Zerodegr/Multiref2/listrefs</B>, <B>Zerodegr/Multiref2/goodsel***</B>, 
		    <B>Tilted/dang-store</B>, <B>Tilted/Aligned/cent*****</B> </LI>
		<LI>OUTPUTS: <B>Volumes/vcla***</B> </LI>
<!-- 		<LI>details</LI> -->
	</UL>

<LI><P>Filter one or all 3D reconstructions</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="volfilt.rct">volfilt.rct</a> </LI>
		<LI>PARAMETERS:</LI>
		  <UL>
		    <LI><I>[single-class]</I> -- The default value of <I>0</I> will filter all class volumes. 
d894 5
a898 5
		        enter the number of that class.</LI>
		    <LI><I>[header-type]</I>, <I>[header-param1]</I>, <I>[header-param2]</I> -- 
		        parameters for the Fourier filter</LI>
		    <LI><I>[override-yn]</I> -- if pre-existing doc file <B>docvolfilt</B> exists 
		        (more on this file below), setting this parameter to <I>1</I> 
d900 5
a904 5
		        will use the values in the docfile instead</LI>
		  </UL>
		<LI>INPUTS: <B>Zerodegr/Multiref2/listrefs</B>, <B>Volumes/vcla***</B> </LI>
		<LI>OUTPUTS: <B>Volumes/vflt***</B>, <B>Volumes/docvolfilt</B> </LI>
		<LI>The output doc file <B>docvolfilt</B> contains a record of 
d906 3
a908 3
		    By setting the parameter <I>[override-yn]</I> to <I>1</I>, 
		    the filter parameters from this editable file will be used. </LI>
	</UL>
d910 1
a910 1
<LI><P>Align volumes to each other</P>
d912 1
a912 1
    <P>Skip this step if you have a single class.</P>
d914 1
a914 1
    <P>This batch file aligns two volumes to each other.
d917 1
a917 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/pj3q.html">'PJ 3Q'</a>,
d919 1
a919 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>
d921 1
a921 1
    </P>
d923 28
a950 29
    <UL>
	<LI>BATCH FILE: <a href="volalignprj.rct">volalignprj.rct</a> </LI>
	<LI>SUBROUTINE: <a href="montageprj.rct">montageprj.rct</a> </LI>
	<LI>PARAMETERS:</LI>
	  <UL>
	    <LI><I>[exp-num]</I> -- the number for the experimental volume to align</LI>
	    <LI><I>[ref-num]</I> -- the number for the reference volume</LI>
	    <LI><I>[num-solns]</I> -- number of initial alignment solutions to compare 
	        -- multiple initial solutions may converge to the same refined solution</LI>
	    <LI><I>[dtheta]</I> -- angular increment for initial search, as in
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/refproj.spi">
		refproj.spi</a>.</LI>
	    <LI><I>[shift-range]</I>,<I>[shift-step]</I>,<I>[first-ring]</I> -- 2D search parameters for 
	        <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsh.html">'AP SH'</a>, as in
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
		apsh.spi</a>.</LI>
	  </UL>
	<LI>INPUTS: <B>Volumes/vcla***</B> (reference and experimental volume to align) </LI>
	<LI>OUTPUTS:</LI>
	  <UL>
	    <LI><B>prj_***</B> -- re-projection stacks </LI>
	    <LI><B>dalv***</B> -- alignment parameters for each solution requested</LI>
	    <LI><B>vali***</B> -- aligned class volume</LI>
	    <LI><B>mproj***</B> -- comparison of reference projection versus 
	        initial and refined alignments, for each solution requested</LI>
	    <LI><B>list2merge</B> -- running list of aligned classes with preferred alignment solution
	        -- more below</LI>
	  </UL>
    </UL>
d952 1
a952 1
    <P>The first row of each slice in <B>mproj***</B> shows the reference projection. 
d956 1
a956 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>.</P>
d958 2
a959 2
    <P>If the better alignment solution is not solution #1, then 
       edit in <B>list2merge</B> column #2, labelled <I>SOLUTIONNUM</I>.  
d961 1
a961 1
       set this value to <I>0</I> in <B>list2merge</B>.</P>
d963 2
a964 2
    <P>The re-projections <B>prj_***</B> will illustrate the missing-cone artifact better than 
       isosurface presentations.</P>
d966 12
a977 12
<LI><P><I>(optional)</I> Merged particles from aligned class volumes into one reconstruction</P></LI>
    <UL>
	<LI>BATCH FILE: <a href="mergevols.rct">mergevols.rct</a> </LI>
	<LI>INPUTS: <B>dang-store</B>, <B>list2merge</B>, <B>dalv***</B>, 
	    <B>goodsel***</B>, <B>cent*****</B> </LI>
	<LI>OUTPUTS:</LI> <B>Volumes/vali***</B>, <B>Volumes/docvolangles</B> 
	  <UL>
	    <LI><B>dang-merged</B> -- combines particles' Euler angles with class-volume alignment angles </LI>
	    <LI><B>mergedsel</B> -- particle-selection file from merged classes </LI>
	    <LI><B>vtot999</B> -- merged volume </LI>
	  </UL>
	</UL>
d979 2
a980 2
    <P>If the parameter <I>[classvols-yn]</I> is set to 1, 
       volumes for each class will be reconstructed of the form <B>vtot***</B>,
d982 1
a982 1
       They should look very similar to the <B>vali***</B> reconstructions from the previous step, 
d984 1
a984 1
       in this case the volume will have undergone one fewer interpolation.</P>
d986 2
a987 2
    <P>You will probably want to filter the reconstruction(s) from this step. 
       Edit <a href="volfilt.rct">volfilt.rct</a> to operate on the <B>vtot***</B> volume(s).</P>
d990 11
a1000 12
<LI><P>Prepare files for reference-based alignment</P></LI>
	<UL>
		<LI>Before running this step, download the reference-based alignment tarball and untar it by typing:
		    <PRE>tar -zxvf spiproject.tar.gz</PRE>
		This will create a new directory called <I>myproject</I><BR>
		If you rename that directory, remember to change the output in this ensuing batch file accordingly.</LI>
		<LI>BATCH FILE: <a href="prepare-prjmatch.rct">prepare-prjmatch.rct</a> </LI>
		<LI>INPUTS: <B>lots</B> </LI>
		<LI>OUTPUTS: <B>lots</B> </LI>
		<LI><P>This batch file will copy information in a form that can be understood by the 
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html">
		    reference-based alignment protocol.</a>
d1002 2
a1003 4
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html#SH">
		    "Alignment"</a> with the step 
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/sel_by_group.spi">
		    sel_by_group.spi</a>. </P>
d1005 1
a1005 1
		    <P>We have not (yet) implemented CTF-correction for the tilted-specimen particle images 
d1010 2
a1011 3
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apshgrp.spi">
		    apshgrp.spi</a> vs.
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
d1013 31
a1043 32
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
		    apsh.spi</a>).</P></LI>
	</UL>

<HR>

<B><P>Miscellaneous batch files</P></B>

<LI><P>Projection onto convex sets</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="batchlink">batchname</a> </LI>
		<LI>INPUTS: <B>input</B> </LI>
		<LI>OUTPUTS: <B>output</B> </LI>
		<LI>details</LI>
	</UL>

<!--<LI><P>DESCRIPTION</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="batchlink">batchname</a> </LI>
		<LI>INPUTS: <B>input</B> </LI>
		<LI>OUTPUTS: <B>output</B> </LI>
		<LI>details</LI>
	</UL>-->


</UL>

<HR>

<B><P>References</P></B>
<OL>
    <LI>
d1046 3
a1048 3
        the 50S ribosomal subunit of <I>Escherichia coli</I>.
        <I>J Microsc.</I>  <B>146</B>:113-36.</LI>
    <LI>Shaikh TR, Gao H, Baxter WT, Asturias F, Boisset N, Leith A, and Frank J. (2008) 
d1050 2
a1051 2
        <I>Nature Protocols</I> <B>3</B>: 1941-74.</LI>
    <LI>Huang T, Shaikh TR, Gupta K, Contreras-Martin LM, Grassucci RA, Van Duyne GD, Frank J, Belfort M .
d1053 2
a1054 2
        <I>Nucleic Acids Res.</I> <B>39</B>: 2845-54.</LI>
</OL>
d1056 1
a1056 1
<HR>
d1058 2
a1059 2
</BODY>
</HTML>
@


1.4
log
@*** empty log message ***
@
text
@d2 68
a69 71
<html>

<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8">
   <title>Random-conical tilt reconstruction</title>
</head>

<body lang="en-US" dir="ltr">

<i><p align="right">(Updated 2012 Nov 21)</p></i>

<center><p>
  <font size="5"><b>Random conical tilt reconstruction</b></font>
  <br>Adapted from the 2007 SPIDER Workshop tutorial
  </p>
</center>

<hr />

<b><p>Outline</p></b>
<ul>
	<li>General notes                 </li>
	<li>Quick-start guide             </li>
	<li>Getting started               </li>
	<li>Procedure                     </li>
	<li>Miscellaneous procedure files </li>
	<li>References                    </li>
</ul>

<hr />

<b><p>General notes</p></b>

<ul>
	<li>Sequential operations are numbered. Options are lettered.</li>
	<li>Data extension assumed to be <b>.dat</b>. Adjust accordingly.</li>
	<li>List of inputs and outputs in description is not exhaustive.</li>
</ul>

<hr />

<b><p>Quick-start guide</p></b>
<ol>
	<li>tar -xvf procedures.tar</li>
	<li>spider rct/dat @@makeparams (or copy <b>params.dat</b>)</li>
	<li>(optional) tar -xvf $DATA.tar</li>
	<li>mkfilenums.py filenums.dat $MICROGRAPHS*</li>
	<li>(for non-SPIDER format micrographs) spider rct/dat @@convert</li>
	<li>spider rct/dat @@shrinkmics</li>
	<li>cd Micrographs/ ; montagefromdoc.py ../filenums.dat</li>
	<li>spider rct/dat @@micpair</li>
	<li>(required for JWEB) spider rct/dat @@padmics</li>
	<li>pick tilt pairs in JWEB or WEB</li>
	<li>spider rct/dat @@makesomenoise (or copy <b>noise.dat</b>) </li>
	<li>spider rct/dat @@windowparticles</li>
	<li>(for negative stain) Do both of:</li>
		<ol type=a>
			<li>spider rct/dat @@highpass-untilted</li>
			<li>spider rct/dat @@highpass-tilted</li>
		</ol>
	<li>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</li>
	<li>(if necessary) spider rct/dat @@removebad</li>
	<li>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</li>
	<li>(if necessary) spider rct/dat @@removebad</li>
	<li>(slow) spider rct/dat @@pairwise</li>
	<li>(optional) To reorient average, do both of:</li>
		<ol type=a>
			<li>spider rct/dat @@reorientavg</li>
			<li>spider rct/dat @@sumalign</li>
		</ol>
<!--</ol>
d71 122
a192 123
	<li>spider rct/dat @@filtershrink</li>
	<li>spider rct/dat @@ca-pca</li>
	<li>Classify.  (Ward's method shown here.  For other options, see below.)</li>
	<ol type=a>
		<li>spider rct/dat @@hierarchical</li>
		<li>spider rct/dat @@binarytree</li>
		<li>cd Zerodegr/Tree ; ../../tree.py labeled0001.dat 4 selclasses.dat</li>
	</ol>
	<li>Iterate:</li> 
		<ol type=a>
			<li>spider rct/dat @@multirefalign (subsequently @@multirefalign-descend)</li> 
			<li>spider rct/dat @@filtershrink</li> 
			<li>spider rct/dat @@classifybyview</li>
			<li>verifybyview.py</li> 
		</ol>
	<li>spider rct/dat @@combinegoodclasses</li> 
	<li>spider rct/dat @@viewaverages</li> 
	<li>spider rct/dat @@centertilt</li>
	<li>spider rct/dat @@storeangles</li>
	<li>(optional) spider rct/dat @@d6symmetry</li>
	<li>spider rct/dat @@bpclass</li>
	<li>spider rct/dat @@volfilt</li>
	<li>(if multiple orientations) Do both of: </li>
		<ol type=a>
			<li>spider rct/dat @@volalignprj</li>
			<li>spider rct/dat @@mergevols</li>
		</ol>
	<li>spider rct/dat @@prepare-prjmatch</li>
</ol>

<hr />

<b><p>Getting started</p></b>

<ul>
   <li>Create a new directory, and change to that directory before 
       unpackaging the procedure-file tarball.                                   </li>

   <li>Micrographs should be placed in the <b>Micrographs/</b> directory.  
       They needn't be in SPIDER format, but you'll then need to run
       <a href="convert.rct">convert.rct</a> for the conversion. </li>

   <li>The SPIRE libraries are required for various Python scripts, such as
       <a href="mkfilenums.py">mkfilenums.py</a> and <a href="tree.py">tree.py</a>. 
       These steps can be substituted with SPIRE-independent analogs. 
       Installation instructions for SPIRE can be found 
       <a href="../../../../spiredoc/download.html">here</a>.</li>

<!-- 	<li></li> -->
</ul>

<hr />

<b><p>Procedure</p></b>

<ul>

<li><p>Prepare directory</p></li>
   <ul>
      <li>Access the latest 
          <a href="../tar_archive/archive.html">procedures archive</a> 
          and unpackage it by typing:
          <pre>tar -xvf procedures.tar</pre>
          This command will unpackage the files in the currect directory, 
          so create a new directory if so desired.</li>
   </ul>

<li><p>Prepare parameter doc file</p></li>
   <ul>
      <li>PROCEDURE FILE: <a href="makeparams.rct">makeparams.rct</a> </li>
      <li>OUTPUTS: <b>params</b> </li>
      <li>Otherwise, you can copy a <b>params</b> file from elsewhere.<BR>
          An example file called <b>bak-params</b> is present in the tarball.</li>
      <li>The following parameters (described <a href="../../..//techs/recon/params.html">
          here</a>) are used from the <b>params</b> file:</li>
      <ul>
         <li><b>1</b> -- zip flag -- if set to 1, then will be uncompressed using gunzip</li>
            <ul><li>used by convert.rct</li></ul>
         <li><b>2</b> -- format flag -- 0 corresponds to SPIDER, 3 to Z/I TIFF, etc. -- see 
            <a href="../../..//techs/recon/params.html">
            complete description</a> for additional formats</li>
            <ul><li>used by convert.rct</li></ul>
         <li><b>5</b> -- pixel size -- in Angstroms</li>
            <ul><li>used by shrinkmics.rct</li></ul>
         <li><b>17</b> -- window size -- in pixels </li>
            <ul><li>used by many procedure files</li></ul>
         <li><b>18</b> -- particle diameter -- in pixels</li>
            <ul><li>used by pairwise.rct </li></ul>
         <!-- <li><b>NUMBER</b> -- FLAG -- DESCRIPTION</li>
              <ul><li>used by PROCEDURE</li></ul> -->
              </ul>
   </ul>

<li><p><i>(optional)</i> Copy sample data.</p></li>
   <ul>
      <li>Access the <a href="../tar_archive/data20060817.tar">data archive</a>
          and unpackage it by typing:   </li>
	  <pre>tar -xvf data20060817.tar</pre>
      <li>This command will create a directory called <b>Micrographs/</b>, 
			containing phantom micrographs, and a directory called <b>TP1/</b>,
			containing the files used to generate the micrographs.</li>
   </ul>

<li><p>Generate a list of micrographs.</p></li>
   <ul>
      <li>PYTHON SCRIPT: <a href="mkfilenums.py">mkfilenums.py</a> </li>
      <li>To make a list of TIFF files, for example, the syntax would be: </li>
          <pre>mkfilenums.py filenums.dat Micrographs/zeiss*.tif</pre>
      <li>This Python script requires the Spiderutils library from SPIRE. 
          If SPIRE is not installed, you can generate <b>filenums</b> using other means, 
          such as by manually entering the filenumbers using 
          <a href="../../..//man/doccreate.html">
          'DOC CREATE'</a> in SPIDER. </li>
   </ul>

<li><p><i>(optional)</i> If the micrographs are not already in SPIDER format, convert them.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="convert.rct">convert.rct</a> </li>
		<li>SUBROUTINE: <a href="convert_p.rct">convert_p.rct</a> </li>
		<li>INPUTS: <b>filenums</b>, <b>Micrographs/mic****</b> </li>
		<li>Downstream procedure files will expect files called <b>Micrographs/mic****</b>. 
			Keeping that convention will minimize the number of changes you'll need to make.</li>
		<li>If the micrographs are in Z/I TIFF format, 
d195 10
a204 10
			are described at the top of the source code.</li>
		<li>TO DO: add conversion flag for MRC files</li>
	</ul>

<li><p>Shrink the micrographs for particle-picking.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="shrinkmics.rct">shrinkmics.rct</a> </li>
		<li>INPUTS: <b>filenums</b>, <b>Micrographs/mic****</b> </li>
		<li>INPUTS: <b>Micrographs/sm-mic****</b> </li>
		<li>Choose the reduction factor such that the micrgraph fits on the screen, 
d206 13
a218 13
			These downsampled micrographs will be used to pick tilt pairs.</li>
		<li>The filtration step is slow, so 
			by setting <i>[filter-radius]=0</i>, you can skip this step. </li>
	</ul>

<li><p>Screen micrographs.</p></li>
	<ul>
		<li>Micrographs can be screened using various display programs.
			To use montagefromdoc.py, from <b>Micrographs/</b>
			(there is a pre-existing <b>.montagefromdoc</b> file there), type:
			<pre>montagefromdoc.py ../filenums.dat sm-mic*</pre>
			The output should also be <b>filenums</b>.</li>
		<li>If you wish to remove micrographs by editing <b>filenums</b>
d221 20
a240 20
			<a href="../../..//man/docren.html">
			'DOC REN'</a>. (The input and output can have the same name.) </li>
	</ul>

<li><p>Establish pairings between micrographs</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="micpair.rct">micpair.rct</a> </li>
		<li>INPUTS: <b>filenums</b> </li>
		<li>OUTPUTS: <b>docmicpairs</b> </li>
		<li>This procedure file presumes that the tilted-specimen micrograph precedes the untilted-specimen micrograph.
			Check the output to confirm that the pairings make sense.</li>
	</ul>

<li><p>Resize micrographs (Required for JWEB, not required for X-Window WEB)</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="padmics.rct">padmics.rct</a> </li>
		<li>INPUTS: <b>docmicpairs</b>, <b>Micrographs/sm-mic****</b> </li>
		<li>OUTPUTS: <b>Micrographs/jweb-mic{***[untilted]}</b>, <b>Micrographs/jweb-mic{***[untilted]}_tilted</b> </li>
		<li>JWEB has a "feature" that requires the tilt pair to have the same dimensions. 
			This procedure file pads the micrographs to the same size. 
d242 2
a243 2
			even though it is typically collected first at the microscope.</li>
	</ul>
d245 5
a249 5
<li><p>Pick tilt pairs (for JWEB, differences for X-Window WEB noted below)</p></li>
	<ul>
	    <li>INPUTS: <b>Micrographs/jweb-mic{***[untilted]}</b>, <b>Micrographs/jweb-mic{***[untilted]}_tilted</b>
	    <p></p></li>
	</ul>
d251 4
a254 4
	    <li>If using JWEB: </li>
		<ol>
			<li>From the <b>Micrographs/</b> directory, open JWEB. </li>
			<li>Go to <i>File -> Open -> Image Series</i> and select a pair of micrographs. 
d256 6
a261 6
			    Do <U>NOT</U> resize the micrographs using <i>Edit</i> &gt; <i>Resize</i>, 
			    for ease of use with the procedure files below.</li>
			<li>Click on the <i>Markers/Tilt Pair</i> tab.</li>
			<li>In the <i>Marker File Number</i> field, enter the number of the untilted micrograph.</li>
			<li>Click on the <i>Show/Edit Marker</i> button, which will display the images.</li>
			<li>Select a particle from the untilted micrograph, and 
d266 1
a266 1
				<BR><i>HINT:</i> The middle mouse button will erase a pair of points 
d268 7
a274 7
				<BR><i>HINT:</i> Since the numbering is to the right of the marker, 
				it may be easier to proceed from right to left.</li>
			<li>Click on buttons <i>Save Marker Files</i> and <i>Determine Theta</i>, 
				which will determine the magnitude of the tilt angle between the micrographs.</li>
			<li>Click on the <i>Fit Angles</i> button.
				This will determine the direction of the tilt axis.</li>
			<li>Click on the <i>Draw Fitted Locations</i> button.
d276 12
a287 12
				but does not affect the coordinates selected with the mouse.</li>
			<li>Click on the <i>Save Angles</i> button.</li>
			<li>Now, when you select a particle in the untilted image, 
				JWEB will send the cursor to the corresponding location in the tilted image.</li>
			<li>Select more particles from the tilt pair. 
				(For the sample micrograph, there are 76 pairs.  Select all of them.)</li>
			<li>To save the new values, re-click the five buttons: <i>Save Marker Files</i>, <i>Determine Theta</i>, 
				<i>Fit Angles</i>, <i>Draw Fitted Locations</i>, and <i>Save Angles</i>.</li>
		</ol>
	    <li>If using X-Window WEB: </li>
		<ol>
		    <li>From the menu, select <i>COMMANDS</i> &gt; <i>Tilted Particles</i>, 
d289 4
a292 4
		        and then the tilted-specimen image.  </li>
		    <li>In the <i>Particle doc</i> popup window, under <i>Doc file number</i>, 
		        enter the number of the untilted micrograph and click <i>ACCEPT</i>.</li>
		    <li>Select a particle from the untilted micrograph, and 
d296 17
a312 17
			ideally in the four corners, but the farther apart the better.</li>
		    <li>Click the middle button to open the <i>Particle picking menu_popup</i>.</li>
		    <li>Click on <i>Determine tilt axis angles</i>, <i>Draw fitted locations</i>, 
		        and <i>Save angles in doc file</i>.</li>
		    <li>Now, when you select a particle in the untilted image, 
			WEB will send the cursor to the corresponding location in the tilted image.</li>
		    <li>Select more particles from the tilt pair. 
			(For the sample micrograph, there are 76 pairs.  Select all of them.)</li>
		    <li>To save the new values, re-click the three buttons: <i>Determine tilt axis angles</i>, 
		        <i>Draw fitted locations</i>, and <i>Save angles in doc file</i>.</li>
		    <li>Differences between JWEB and X-Window WEB:</li>
			<ul>
			    <li>X-Window WEB does not require the pair of micrographs to be the same size, 
				so the step <a href="padmics.rct">padmics.rct</a> is unnecessary. </li>
			    <li><U>WARNING</U>: If you entered a number under <i>Image reduction factor</i>
				(after setting the reduction factor in <i>OPTIONS</i> &gt; <i>Image</i>)
				do <U>NOT</U> set the parameter <i>[decimation-factor]</i> below in 
d314 10
a323 10
				Using both parameters will be redundant.</li>
			    <li>There is no <i>Save Marker Files</i> button.
				Coordinates are saved continuously.</li>
			    <li><i>Determine Theta</i> and <i>Fit Angles</i> are merged into one button: 
				<i>Determine tilt axis angles</i>.</li>
			</ul>
		</ol>
	</ol>
	<ul>
	    <li><i>HINT:</i> Save the coordinates frequently. 
d326 2
a327 2
		Delete those particles (using the middle mouse button), and re-pick them, as necessary.</li>
	    <li><i>HINT:</i> If, while picking pairs, the fitted locations stray from the correct location 
d330 23
a352 23
		it may help to re-do the fitting (summarized under the previous bullet).</li>
	    <li><i>HINT:</i> If you close a pair or micrographs and re-open them
		(with the appropriate <i>Marker File Number</i>), 
	    you can resume from where you left off.</li>
	</ul>

<li><p>Obtain a noise image for normalization.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="makesomenoise.rct">makesomenoise.rct</a> </li>
		<li>INPUTS: a micrograph </li>
		<li>OUTPUTS: <b>noise</b>, <b>tmpnoise/noi***</b> </li>
		<li>Subsequent windowed images will be normalized against the output noise file.
			If you have a pre-existing noise file, copy it to <b>noise.dat</b></li>
		<li>One noise file will be chosen at random by the procedure file.
			You can also look at the noise images in the <b>tmpnoise/</b> directory
			and copy one that looks even "noisier" to <b>noise.dat</b>
			(in the top-level directory).</li>
	</ul>

<li><p>Window particles from tilted and untilted micrographs.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="windowparticles.rct">windowparticles.rct</a> </li>
		<li>PARAMETER: <i>[decimation-factor]</i> -- If you used the output of 
d356 2
a357 2
		    <i>Edit</i> &gt; <i>Resize</i> (for JWEB) or 
		    <i>Image reduction factor</i> (for X-Window WEB). 
d359 6
a364 6
		    the full-sized micrograph and the version used for particle-selection.</li>
		<li>INPUTS: <b>params</b>, <b>docmicpairs</b>, <b>noise</b>,
			<b>Micrographs/mic****</b>, <b>Micrographs/dcu****</b>, <b>Micrographs/dct****</b></li>
		<li>OUTPUTS: <b>listparticles</b>,
			<b>Zerodegr/Winrot/unt*****</b>, <b>Tilted/Winrot/tilt*****</b> </li>
	</ul>
d366 1
a366 1
<li><p>(Recommended for stained images) High-pass filter windowed images</p>
d368 1
a368 1
    <p>For negatively-stained images, it is often the case that the puddle of stain surrounding the particles 
d372 1
a372 1
    the aligning power of the images will be lost.  You may need to tweak the radii.</p> 
d374 1
a374 1
    <p>If you are unsure whether to do this step, feel free to skip it, 
d376 18
a393 18
    in order to see if the stain is the predominant source of variation. </p> </li>
	<ol>
	    <li>PROCEDURE FILE: <a href="highpass-untilted.rct">highpass-untilted.rct</a></li>
	    <ul>
		<li>INPUTS: <b>Zerodegr/Winrot/unt*****</b> (directory renamed to <b>Unhighpass</b></li>
		<li>OUTPUTS: <b>Zerodegr/Winrot/unt*****</b> </li>
	    </ul>
	    <li>PROCEDURE FILE: <a href="highpass-tilted.rct">highpass-tilted.rct</a></li>
	    <ul>
		<li>INPUTS: <b>Tilted/Winrot/tilt*****</b> (directory renamed to <b>Unhighpass</b></li>
		<li>OUTPUTS: <b>Tilted/Winrot/tilt*****</b> </li>
	    </ul>
	</ol>

<li><p>Screen the windowed images for defects (micrograph edges, dust, etc.).</p></li>
	<ul>
		<li>Screen the untilted--specimen windowed images by running
		<a href="../../..//techs/verify/VerifyDocs/montagefromdoc.htm">
d395 3
a397 3
			<pre>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</pre>
		Use <b>notgood</b> as the output doc filename.<BR></li>
		<li>Only click on the bad images.
d399 8
a406 8
			There will be additional rounds of selection downstream.</li>
		<li>If particles are rejected, run: <a href="removebad.rct">removebad.rct</a> </li>
		<ul>
		    <li>INPUTS: <b>listparticles</b> (will be backed up by <a href="backup.rct">backup.rct</a>), <b>notgood</b> </li>
		</ul>
		<li>Now screen the tilted images for defects:</li>
			<pre>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</pre>
		<li>Only click on the bad images.
d408 11
a418 11
			such as dust, edges, double-particles, etc. -- so be more stringent here.</li>
		<li>If tilted particles are rejected, re-run <a href="removebad.rct">removebad.rct</a></li>
	</ul>

<li><p>Align the untilted-specimen particles using reference-free alignment.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="pairwise.rct">pairwise.rct</a> </li>
		<li>INPUTS: <b>listparticles</b>, <b>Zerodegr/Winrot/unt*****</b> </li>
		<li>OUTPUTS: <b>Zerodegr/Pairwise/rfreeavg001</b>, <b>Zerodegr/Aligned/cenu*****</b>, 
			<b>Zerodegr/Pairwise/docpairalign</b>, many others </li>
		<li>This procedure file first aligns pairs of images, averages them, 
d421 2
a422 2
			and each subsequent level will be faster.</li>
	</ul>
d424 8
a431 8
<li><p><i>(optional)</i> Attempt to align average along coordinate axes</p></li>
	<ol>
	    <li>Align average along coordinate axes
		<ul>
		    <li>PROCEDURE FILE: <a href="reorientavg.rct">reorientavg.rct</a> </li>
		    <li>INPUTS: <b>Zerodegr/Pairwise/rfreeavg001</b> </li>
		    <li>OUTPUTS: <b>Zerodegr/Pairwise/dsolalign</b>, <b>Zerodegr/Pairwise/malign</b> </li>
		    <li>This procedure file aligns the average to a mirrored version of itself, 
d433 1
a433 1
			    There will be two solutions, along <i>x</i> or along <i>y</i>. 
d436 14
a449 14
			    note which solution to use (1 or 2), and run the next procedure file, 
			    <a href="sumalign.rct">sumalign.rct</a>.</li>
		</ul>

	    <li>Combine alignments of individual particles with reoriented average</li>
		<ul>
			<li>PROCEDURE FILE: <a href="sumalign.rct">sumalign.rct</a> </li>
			<li>PARAMETER: solution 1 or 2 (see description below) </li>
			<li>INPUTS: <b>Zerodegr/Winrot/unt*****</b>, <b>Zerodegr/Pairwise/dsolalign</b>, 
				<b>Zerodegr/Pairwise/docpairalign</b> </li>
			<li>OUTPUTS: <b>Zerodegr/Pairwise/dalu001</b>, <b>Zerodegr/Aligned/cenu*****</b>, 
				<b>Zerodegr/Pairwise/avgu001</b> </li>
			<li>If you wish to apply the alignments of the average from
				<a href="reorientavg.rct">reorientavg.rct</a>, then run this procedure file.  
d451 24
a474 24
				Typically, in one solution the major axis is along <i>x</i>.
				and in the other it is along <i>y</i>.
				It is arbitrary which solution to use.</li>
		</ul>
	</ol>

<li><p>Filter the aligned, untilted particles.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="filtershrink.rct">filtershrink.rct</a> </li>
		<li>PARAMETERS: reduction factor, low-pass filter parameters </li>
		<li>INPUT: <b>Zerodegr/Aligned/cenu*****</b></li>
		<li>OUTPUT: <b>Zerodegr/Filtered/flt*****</b> </li>
		<li>Remember to change the input filename if you ran <a href="sumalign.rct">sumalign.rct</a>. </li>
		<li>The filtered images produced will be used for multivariate data analysis and classification.
			To look at the filtered untilted particles, type: </li>
			<pre>montagefromdoc.py listparticles.dat Zerodegr/Filtered/flt*</pre>
	</ul>

<li><p>Run correspondence analysis (CA) or principal component analysis (PCA) on filtered images.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="ca-pca.rct">ca-pca.rct</a> </li>
		<li>PARAMETERS: </li>
			<ul>
				<li><i>flag for CA (1), PCA (2), or iterative PCA (3)</i> --
d476 3
a478 3
						I, subjectively, try CA first, then iterative PCA, then PCA last.</li>
				<li><i>number of factors to calculate</i> --
					If after you run this procedure file, 
d480 5
a484 5
					increase this parameter and re-run.</li>
			</ul>
		<li>INPUT: <b>Zerodegr/Filtered/flt*****</b> </li>
		<li>OUTPUT: <b>Zerodegr/MSA/cas_***</b>, <b>Zerodegr/MSA/reconstituted***</b>, others </li>
		<li>The commands to generate the PostScript eigenvalue histogram requires the SPIRE Python libraries.
d486 2
a487 2
		    <a href="../../../../spiredoc/download.html#FullInstall">here</a>.</li>
		<li>For negatively-stained samples, when looking at the reconstituted images, 
d489 2
a490 2
		    go back to the high-pass filtration step above.</li>
	</ul>
d492 8
a499 8
<li><p>Classify images. Chose one of:</p></li>
	<ol type=a>
		<li>K-means clasification. </li>
		<ul>
			<li>PROCEDURE FILE: <a href="kmeans.rct">kmeans.rct</a> </li>
			<li>PARAMETERS:</li>
				<ul>
					<li><i>desired number of classes</i> --
d504 2
a505 2
						one class per 50 to 75 particles.</li>
					<li><i>number of factors to use</i> --
d508 12
a519 12
						Use of the weaker factors will probably not make a big difference though.</li>
				</ul>
			<li>INPUTS: <b>Zerodegr/MSA/cas_***</b>, <b>Zerodegr/Filtered/flt*****</b> </li>
			<li>OUTPUTS: <b>classavg***</b>, <b>docclass****</b>, others </li>
		</ul>

		<li>Hierarchical classification, using Ward's method. </li>
		<ol>
			<li>Run classification. </li>
			<ul>
				<li>PROCEDURE FILE: <a href="hierarchical.rct">hierarchical.rct</a> </li>
				<li>PARAMETER: <i>number of factors to use</i> --
d522 13
a534 13
					Use of the weaker factors will probably not make a big difference though.</li>
				<li>INPUTS: <b>Zerodegr/MSA/cas_***</b> </li>
				<li>OUTPUTS: <b>docdendro</b> </li>
			</ul>

			<li>Generate class averages. Choose one of:</li>
			<ol type=a>
				<li>Generate binary tree using tree.py</li>
				<ul>
					<li>PROCEDURE FILE: <a href="binarytree.rct">binarytree.rct</a> </li>
					<li>SUBROUTINES: averagenode.rct, update_lut.rct </li>
					<li>PARAMETER: <i>ending depth</i> --
						For the depth that you specify here, there will be up to 2^<i>depth</i> averages generated. 
d536 4
a539 4
						It is better to make too many and display fewer in the next step.</li>
					<li>INPUT: <b>docdendro</b> </li>
					<li>OUTPUTS: <b>avgnode***</b>, <b>labeled***</b> </li>
					<li>NOTE: The format of SPIDER's dendrogram doc file changed in version 17.13. 
d541 3
a543 3
						If this procedure file crashes, check this parameter.</li>
					<li>To view the binary tree, run <A HREF="tree.py">tree.py</A>. It requires 
						<A HREF="../../..//python/spipylib/code/Spiderutils.html">
d545 1
a545 1
						<A HREF="../../../../spiredoc/packages.html">
d547 1
a547 1
						<a href="../../..//techs/MSA/index.htm">
d549 7
a555 7
						<pre>cd Zerodegr/Tree ; tree.py labeled0001.dat 4 selclasses.dat</pre>
						Save the selection file with <i>CTRL-s</i>.<p></p></li>
				</ul>

				<li>Generate binary tree as (large) SPIDER image</li>
				<ul>
					<li>Alternatively, you can run <a href="tree.rct">tree.rct</a>,
d559 2
a560 2
						and view it in a dedicated image-viewer.</li>
				</ul>
d562 9
a570 9
				<li>Simple class averages</li>
				<ul>
					<li>This option is equivalent to the bottom row in the binary tree above, 
						or the display in WEB, and similar to simple K-means.</li>
					<li>PROCEDURE FILE: <a href="classavg.rct">classavg.rct</a> </li>
					<li>PARAMETER: <i>desired number of classes</i></li>
					<ul>
					</ul>
						<li>Too small a number, and dissimilar particles will be grouped together, 
d574 2
a575 2
							one class per 50 to 75 particles.</li>
						<li>If you're going to run <a href="binarytree.rct">binarytree.rct</a>
d577 14
a590 14
							So, it doesn't matter how many classes you request here.</li>
					<li>INPUTS: <b>Zerodegr/Hierarchical/docdendro</b>
					    (other classification options write <b>docdendro</b> in different locations)</li>
					<li>OUTPUTS: <b>classavg***</b>, <b>docclass****</b>, <b>listclasses</b>, others </li>
				</ul>
			</ol>
		</ol>

		<li>Clustering using Diday's method. </li>
		<ol>
			<li>Run classification. </li>
			<ul>
				<li>PROCEDURE FILE: <a href="cluster.rct">cluster.rct</a> </li>
				<li>PARAMETER: <i>number of factors to use</i> --
d593 9
a601 9
					Use of the weaker factors will probably not make a big difference though.</li>
				<li>INPUTS: <b>Zerodegr/MSA/cas_***</b> </li>
				<li>OUTPUTS: <b>docdendro</b> </li>
			</ul>

			<li>Generate class averages. </li>
			<ul>
				<li>PROCEDURE FILE: <a href="classavg.rct">classavg.rct</a> </li>
				<li>PARAMETER: <i>desired number of classes</i> --
d606 4
a609 4
						one class per 50 to 75 particles.</li>
				<li>INPUTS: <b>docdendro</b> </li>
				<li>OUTPUTS: <b>classavg***</b>, <b>docclass****</b>, <b>listclasses</b>, others </li>
				<li>I haven't been able to make this compatible with 
d611 9
a619 9
					so for now, it's functionally equivalent to K-means.</li>
			</ul>
		</ol>

	</ol>

<li><p>Select unique classes.</p></li>
	<ul>
		<li>The classes selected will be used for multireference alignment. 
d623 2
a624 2
			The <b>.verifybyview</b> file included in the tarball 
			<li>Included in the tarball is a starting <b>.verifybyview</b> file to use. 
d626 7
a632 7
				<a href="../../..//techs/verify/VerifyDocs/interface.htm">
				verifybyview.py</a>, call the output class-selection doc file <b>selclasses</b>.</li>
		<ol type=a>
			<li>To view+select the averages from K-means, type:</li>
				<pre>verifybyview.py Zerodegr/Kmeans/listclasses.dat</pre>
			<li>To view+select the averages from hierarchical classification, use one of the following:
				<pre>verifybyview.py Zerodegr/Hierarchical/listclasses.dat</pre>
d634 10
a643 10
				<U>OR</U> (if you ran <a href="binarytree.rct">binarytree.rct</a>):</li>
				<pre>cd Zerodegr/Tree ; tree.py labeled0001.dat 5 selclasses.dat</pre>
			<li>To view+select the averages from Diday's method, type:</li>
				<pre>verifybyview.py Zerodegr/Cluster/listclasses.dat</pre>
		</ol>
		<li>For verifybyview.py, the filenames at the initial dialog are:</li>
			<ul>
				<li><b>listclasses</b> -- can be specified on the command line </li>
				<li><b>classavg***</b> -- class-average template </li>
			</ul>
d645 13
a657 13
			<ul>
				<li><b>Zerodegr/Filtered/flt*****</b> -- particle template </li>
				<li><b>selclasses</b> -- list of selected classes </li>
				<li><b>byhand***</b> -- selected particles in a given class</li>
			</ul>
	</ul>

<li><p>Run multireference alignment.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="multirefalign.rct">multirefalign.rct</a> </li>
		<li>PARAMETERS, notable ones include: </li>
		  <ul>
		    <li><i>[cg-option]</i> -- if this is set to 1 (the default), 
d659 1
a659 1
		        <a href="../../..//man/cgph.html">'CG PH'</a>. 
d661 3
a663 3
		        You can look at the <b>Zerodegr/Multiref/ref***</b> files while the 
		        (slow) multi-reference alignment is running to check.</li>
		    <li><i>[mirror-option]</i> -- if this is set to 0 (the default), 
d672 10
a681 10
		        </li>
		  </ul>
		<li>INPUTS: <b>selclasses</b>, <b>docclass****</b>, 
			<b>Zerodegr/Aligned/cenu*****</b>, <b>Zerodegr/Winrot/unt*****</b> </li>
		<li>OUTPUTS: <b>Zerodegr/Multiref/ref***</b>, <b>Zerodegr/Multiref/docalign</b>, 
			<b>Zerodegr/Multiref/selview***</b>, <b>Zerodegr/Aligned/cenu*****</b>, 
			<b>Zerodegr/Multiref/viewavg***</b></li>
		<li>This procedure file takes the class averages selected in the previous step, 
			re-centers them, and uses these for multireference alignment.</li>
		<li>Be sure that the label <i>[old_class_dir]</i> the procedure file 
d683 27
a709 27
			For example, by default this label is set to <b>Zerodegr/Tree</b>,
			the location of the outputs of <a href="binarytree.rct">binarytree.rct</a>.</li>
	</ul>

<li><p>Re-filter aligned images.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="filtershrink.rct">filtershrink.rct</a> </li>
		<li>PARAMETERS: reduction factor, low-pass filter parameters </li>
		<li>INPUT: <b>Zerodegr/Aligned/cenu*****</b></li>
		<li>OUTPUT: <b>Zerodegr/Filtered/flt*****</b> </li>
	</ul>

<li><p>Classify the particles assigned to each reference.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="classifybyview.rct">classifybyview.rct</a> </li>
		<li>PARAMETERS:</li>
			<ul>
				<li>reduction factor</li>
				<li>flag for CA (1), PCA (2), or IPCA (3)</li>
				<li>number of factors to use</li>
			</ul>
		<li>INPUTS: <b>Zerodegr/Multiref/listrefs</b>, <b>Zerodegr/Multiref/ref***</b>, 
			<b>Zerodegr/Multiref/selview***</b>, <b>Zerodegr/Filtered/flt*****</b> </li>
		<li>OUTPUTS: <b>Zerodegr/Multiref/View***/listclasses</b>, 
			<b>Zerodegr/Multiref/View***/classavg***</b>, 
			<b>Zerodegr/Multiref/View***/docclass***</b> </li>
		<li>This procedure file performs a separate classification 
d711 1
a711 1
	</ul>
d713 4
a716 4
<li><p>Check the classification results.</p></li>
	<ul>
		<li>Check the classes with the following command:</li>
			<pre>verifybyview.py Zerodegr/Multiref/View001/listclasses.dat</pre>
d718 4
a721 4
				<ul>
					<li><b>listclasses</b> -- specified on the command line </li>
					<li><b>classavg***</b> -- class-average template </li>
				</ul>
d723 8
a730 8
				<ul>
					<li><b>Zerodegr/Filtered/flt*****</b> -- particle template </li>
					<li><b>selclasses</b> -- list of selected classes </li>
					<li><b>byhand***</b> -- selected particles in a given class </li>
				</ul>
		<li>If all of the class averages under a particular reference look the same, 
			proceed to the next solid bullet ("Verify individual particles from last iteration of multireference alignment.").</li>
		<li>If there are homogeneous subsets under a particular reference, 
d734 1
a734 1
		<li>There is no need to select similar-looking class averages, 
d737 3
a739 3
		<li>Re-run the last three steps, <i>i.e.</i>:</li>
			<ol>
				<li><a href="multirefalign-descend.rct">multirefalign-descend.rct</a> 
d741 16
a756 16
					The following filenames/parameters are changed:</li>
					<ul>
						<li>Input <i>OLD_CLASS_DIR</i> is now the previous 
							multireference alignment directory, e.g., <b>Multiref</b></li>
						<li>Output <i>MULTIREF_DIR</i> is now the new directory, 
							for example <b>Multiref2</b></li>
						<li>The parameter <i>[subdir-flag]</i> set to <i>1</i> will serve as a flag 
							to look in the <b>View***</b> subdirectories for the class averages
							for subsequent runs.</li>
					</ul>
				<li><a href="filtershrink.rct">filtershrink.rct</a></li>
				<li><a href="classifybyview.rct">classifybyview.rct</a> -- 
				    Input <i>CLASS_DIR</i> is now the new 
				    multireference alignment directory, <i>e.g.</i>, <b>Multiref2</b></li>
			</ol>
		<li>Repeat these three steps as many times as necessary,
d759 1
a759 1
			A procedure file <a href="multirefalign3.rct">multirefalign3.rct</a> is included, which is 
d761 2
a762 2
			except for the input and output directory names.  </li>
	</ul>
d764 7
a770 7
<li><p>Verify individual particles from last iteration of multireference alignment.</p></li>
	<ul>
		<li>Type the following (assuming you performed 2 rounds of multi-reference alignment):</li>
			<pre>verifybyview.py Zerodegr/Multiref2/View001/listclasses.dat</pre> 
		<li>INPUTS: <b>listclasses</b>, <b>classavg***</b>, <b>docclass***</b>, <b>Zerodegr/Filtered/flt*****</b> </li>
		<li>OUTPUTS: <b>selclasses</b>, <b>byhand***</b> </li>
		<li>At this point, we will keep only good particles.
d774 3
a776 3
			<a href="../../..//techs/verify/VerifyDocs/interface.htm">
				verifybyview.py can be found here</a></li>
		<li>In the example above, 
d779 18
a796 18
			change the corresponding multireference-alignment directory name above.</li>
		<li><i>HINT:</i> Don't forget to save the good-class list in verifybyview.py. 
			It is located in the class-average window under <i>File/SaveSelection</i>. 
			The keyboard shortcut, alternatively, is <i>ALT-s</i>. </li>
	</ul>

<li><p>Combine selected particles from classes.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="combinegoodclasses.rct">combinegoodclasses.rct</a> </li>
		<li>INPUTS (assuming again that you performed 2 rounds of multi-reference alignment): </li>
			<ul>
				<li><b>Zerodegr/Multiref2/listrefs</b> </li>
				<li><b>Zerodegr/Multiref2/View***/selclasses</b> </li>
				<li><b>Zerodegr/Multiref2/View***/byhand***</b> (or <b>Zerodegr/Multiref2/View***/docclass****)</b> </li>
			</ul>
		<li>OUTPUTS: <b>Zerodegr/Multiref2/View***/goodsel</b> </li>
		<li>This procedure files creates one list of particles for each reference view.</li>
		<li>In the example above, 
d799 2
a800 2
			change the corresponding multireference-alignment directory name above.</li>
		<li><i>HINT:</i> It may be useful to re-classify only the good particles, 
d802 1
a802 1
			In that case, re-run classifyview using <b>goodsel***</b> instead of <b>selview***</b>.
d804 1
a804 1
			e.g., add <i>good</i> to the beginning of the filenames. 
d807 2
a808 2
			It may be useful to classify the bad particles too.</li>
	</ul>
d810 18
a827 18
<li><p>Average selected images</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="viewaverages.rct">viewaverages.rct</a></li>
		<li>SUBROUTINE: <a href="viewaverage1.rct">viewaverage1.rct</a></li>
		<li>INPUTS: <b>Zerodegr/Aligned/cenu*****</b>, <b>Zerodegr/Multiref2/goodsel***</b>    
		    (assuming again that you performed 2 rounds of multi-reference alignment)</li>
		<li>OUTPUTS: <b>goodavg***</b>, <b>goodvar***</b> </li>
	</ul>

<li><p>Center tilted-specimen particles.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="centertilt.rct">centertilt.rct</a> </li>
		<li>PARAMETERS: center-of-gravity option (see NOTE below), 
		    filter parameters (see NOTE below)</li>
		<li>INPUT: <b>Tilted/Winrot/tilt*****</b> </li>
		<li>OUTPUTS: <b>Tilted/Aligned/cent*****</b>, <b>Tilted/dalt001</b>, 
			<b>Tilted/avgt001</b> </li>
		<li>This step is straightforward relative to the alignment of the untilted particles. 
d831 8
a838 8
			and the other two are determined by the geometry of the tilt pair.</li>
		<li>To look at the centered tilted particles, type: </li>
			<pre>montagefromdoc.py listparticles.dat Tilted/Aligned/cent*</pre>
		<li>If this procedure file runs slowly, you can save time by centering only the selected particles.  
			To do this, change the input <b>listparticles</b> to <b>Zerodegr/Multiref#/combinedgood</b> 
			from the appropriate directory, <i>i.e.</i>, <b>Multiref</b>, <b>Multiref2</b>, etc.</li>
		<li>NOTE: To center the average after reference-free alignment (translation only), 
		    <a href="../../..//man/cgph.html">
d842 2
a843 2
		    This option is used by setting parameter <i>[cg-option]</i> to 2.  
		    If neither option 1 nor 2 work well, setting <i>[cg-option]</i> will not 
d845 3
a847 3
		    Be sure to inspect the average to ensure that is is centered.</li>
		<li>NOTE: Low-pass filtration of the images seems to help the 
		<a href="../../..//man/apsa.html">
d851 2
a852 2
		</li>
	</ul>
d854 9
a862 9
<li><p>Store Euler angles.</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="storeangles.rct">storeangles.rct</a> </li>
		<li>PARAMETER: <i>[mirror-yn]</i> (see NOTE below)</li>
		<li>INPUTS: <b>docalign</b>, <b>Micrographs/dcb****</b> </li>
		<li>OUTPUTS: <b>Tilted/dang-store</b> </li>
		<li>Use the most recent aligment doc file for the untilted images, 
			e.g., <b>Zerodegr/Multiref2/docalign</b>.</li>
		<li>NOTE: Changing parameter <i>[mirror-yn]</i> will reverse the handedness of the structure. 
d868 2
a869 2
		    you may need to re-test for flips in handedness.</li>
		<li><p>This procedure file stores the three Euler angles in a doc file to use in the backprojection.
d873 1
a873 1
		    there is a possibility that equivalent (as far as the fitting is concerned) solutions are chosen inconsistently. </p>
d875 2
a876 2
		    <p>For example, in the sample RCT data in the 
		    <a href="../../..//protocol_download.html">Nature Protocols download</a>, 
d880 3
a882 3
		    </p>
		    </li>
	</ul>
d884 1
a884 1
<li><p>Compute 3D reconstructions</p>
d886 16
a901 16
    <p>This step will compute 3D reconstructions for each class, 
    as classified in the last iteration of multi-reference alignment. </p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="bpclass.rct">bpclass.rct</a> </li>
		<li>INPUTS: <b>Zerodegr/Multiref2/listrefs</b>, <b>Zerodegr/Multiref2/goodsel***</b>, 
		    <b>Tilted/dang-store</b>, <b>Tilted/Aligned/cent*****</b> </li>
		<li>OUTPUTS: <b>Volumes/vcla***</b> </li>
<!-- 		<li>details</li> -->
	</ul>

<li><p>Filter one or all 3D reconstructions</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="volfilt.rct">volfilt.rct</a> </li>
		<li>PARAMETERS:</li>
		  <ul>
		    <li><i>[single-class]</i> -- The default value of <i>0</i> will filter all class volumes. 
d903 5
a907 5
		        enter the number of that class.</li>
		    <li><i>[header-type]</i>, <i>[header-param1]</i>, <i>[header-param2]</i> -- 
		        parameters for the Fourier filter</li>
		    <li><i>[override-yn]</i> -- if pre-existing doc file <b>docvolfilt</b> exists 
		        (more on this file below), setting this parameter to <i>1</i> 
d909 5
a913 5
		        will use the values in the docfile instead</li>
		  </ul>
		<li>INPUTS: <b>Zerodegr/Multiref2/listrefs</b>, <b>Volumes/vcla***</b> </li>
		<li>OUTPUTS: <b>Volumes/vflt***</b>, <b>Volumes/docvolfilt</b> </li>
		<li>The output doc file <b>docvolfilt</b> contains a record of 
d915 3
a917 3
		    By setting the parameter <i>[override-yn]</i> to <i>1</i>, 
		    the filter parameters from this editable file will be used. </li>
	</ul>
d919 1
a919 1
<li><p>Align volumes to each other</p>
d921 1
a921 1
    <p>Skip this step if you have a single class.</p>
d923 1
a923 1
    <p>This procedure file aligns two volumes to each other.
d926 1
a926 1
       <a href="../../..//man/pj3q.html">'PJ 3Q'</a>,
d928 1
a928 1
       <a href="../../..//man/or3q.html">'OR 3Q'</a>
d930 1
a930 1
    </p>
d932 29
a960 29
    <ul>
	<li>PROCEDURE FILE: <a href="volalignprj.rct">volalignprj.rct</a> </li>
	<li>SUBROUTINE: <a href="montageprj.rct">montageprj.rct</a> </li>
	<li>PARAMETERS:</li>
	  <ul>
	    <li><i>[exp-num]</i> -- the number for the experimental volume to align</li>
	    <li><i>[ref-num]</i> -- the number for the reference volume</li>
	    <li><i>[num-solns]</i> -- number of initial alignment solutions to compare 
	        -- multiple initial solutions may converge to the same refined solution</li>
	    <li><i>[dtheta]</i> -- angular increment for initial search, as in
		<a href="../../..//techs/recon/newprogs/refproj.spi">
		refproj.spi</a>.</li>
	    <li><i>[shift-range]</i>,<i>[shift-step]</i>,<i>[first-ring]</i> -- 2D search parameters for 
	        <a href="../../..//man/apsh.html">'AP SH'</a>, as in
		<a href="../../..//techs/recon/newprogs/apsh.spi">
		apsh.spi</a>.</li>
	  </ul>
	<li>INPUTS: <b>Volumes/vcla***</b> (reference and experimental volume to align) </li>
	<li>OUTPUTS:</li>
	  <ul>
	    <li><b>prj_***</b> -- re-projection stacks </li>
	    <li><b>dalv***</b> -- alignment parameters for each solution requested</li>
	    <li><b>vali***</b> -- aligned class volume</li>
	    <li><b>mproj***</b> -- comparison of reference projection versus 
	        initial and refined alignments, for each solution requested</li>
	    <li><b>list2merge</b> -- running list of aligned classes with preferred alignment solution
	        -- more below</li>
	  </ul>
    </ul>
d962 1
a962 1
    <p>The first row of each slice in <b>mproj***</b> shows the reference projection. 
d966 1
a966 1
       <a href="../../..//man/or3q.html">'OR 3Q'</a>.</p>
d968 2
a969 2
    <p>If the better alignment solution is not solution #1, then 
       edit in <b>list2merge</b> column #2, labelled <i>SOLUTIONNUM</i>.  
d971 1
a971 1
       set this value to <i>0</i> in <b>list2merge</b>.</p>
d973 2
a974 2
    <p>The re-projections <b>prj_***</b> will illustrate the missing-cone artifact better than 
       isosurface presentations.</p>
d976 12
a987 12
<li><p><i>(optional)</i> Merged particles from aligned class volumes into one reconstruction</p></li>
    <ul>
	<li>PROCEDURE FILE: <a href="mergevols.rct">mergevols.rct</a> </li>
	<li>INPUTS: <b>dang-store</b>, <b>list2merge</b>, <b>dalv***</b>, 
	    <b>goodsel***</b>, <b>cent*****</b> </li>
	<li>OUTPUTS:</li> <b>Volumes/vali***</b>, <b>Volumes/docvolangles</b> 
	  <ul>
	    <li><b>dang-merged</b> -- combines particles' Euler angles with class-volume alignment angles </li>
	    <li><b>mergedsel</b> -- particle-selection file from merged classes </li>
	    <li><b>vtot999</b> -- merged volume </li>
	  </ul>
	</ul>
d989 2
a990 2
    <p>If the parameter <i>[classvols-yn]</i> is set to 1, 
       volumes for each class will be reconstructed of the form <b>vtot***</b>,
d992 1
a992 1
       They should look very similar to the <b>vali***</b> reconstructions from the previous step, 
d994 1
a994 1
       in this case the volume will have undergone one fewer interpolation.</p>
d996 2
a997 2
    <p>You will probably want to filter the reconstruction(s) from this step. 
       Edit <a href="volfilt.rct">volfilt.rct</a> to operate on the <b>vtot***</b> volume(s).</p>
d1000 11
a1010 11
<li><p>Prepare files for reference-based alignment</p></li>
	<ul>
		<li>Before running this step, download the reference-based alignment tarball and untar it by typing:
		    <pre>tar -zxvf spiproject.tar.gz</pre>
		This will create a new directory called <i>myproject</i><BR>
		If you rename that directory, remember to change the output in this ensuing procedure file accordingly.</li>
		<li>PROCEDURE FILE: <a href="prepare-prjmatch.rct">prepare-prjmatch.rct</a> </li>
		<li>INPUTS: <b>lots</b> </li>
		<li>OUTPUTS: <b>lots</b> </li>
		<li><p>This procedure file will copy information in a form that can be understood by the 
		    <a href="../../..//techs/recon/mr.html">
d1013 1
a1013 1
		    <a href="../../..//techs/recon/mr.html#SH">
d1015 2
a1016 2
		    <a href="../../..//techs/recon/newprogs/sel_by_group.spi">
		    sel_by_group.spi</a>. </p>
d1018 1
a1018 1
		    <p>We have not (yet) implemented CTF-correction for the tilted-specimen particle images 
d1023 1
a1023 1
		    <a href="../../..//techs/recon/newprogs/apshgrp.spi">
d1025 1
a1025 1
		    <a href="../../..//techs/recon/newprogs/apsh.spi">
d1027 32
a1058 32
		    <a href="../../..//techs/recon/newprogs/apsh.spi">
		    apsh.spi</a>).</p></li>
	</ul>

<hr />

<b><p>Miscellaneous procedure files</p></b>

<li><p>Projection onto convex sets</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="procedurelink">procedurename</a> </li>
		<li>INPUTS:         <b>input</b> </li>
		<li>OUTPUTS:        <b>output</b> </li>
		<li>details</li>
	</ul>

<!--<li><p>DESCRIPTION</p></li>
	<ul>
		<li>PROCEDURE FILE: <a href="procedurelink">procedurename</a> </li>
		<li>INPUTS: <b>input</b> </li>
		<li>OUTPUTS: <b>output</b> </li>
		<li>details</li>
	</ul>-->


</ul>

<hr />

<b><p>References</p></b>
<ol>
    <li>
d1061 3
a1063 4
        the 50S ribosomal subunit of <i>Escherichia coli</i>.
        <i>J Microsc.</i>  <b>146</b>:113-36.</li>

    <li>Shaikh TR, Gao H, Baxter WT, Asturias F, Boisset N, Leith A, and Frank J. (2008) 
d1065 2
a1066 3
        <i>Nature Protocols</i> <b>3</b>: 1941-74.</li>

    <li>Huang T, Shaikh TR, Gupta K, Contreras-Martin LM, Grassucci RA, Van Duyne GD, Frank J, Belfort M .
d1068 2
a1069 2
        <i>Nucleic Acids Res.</i> <b>39</b>: 2845-54.</li>
</ol>
d1071 1
a1071 1
<hr />
d1073 2
a1074 2
</body>
</html>
@


1.3
log
@tar archive, html update, cosmetic, links fixed
@
text
@d109 2
a110 2
   <li>Create a new directory, and change to that directory before unpackaging the 
       procedure-file tarball.                                   </li>
d133 2
a134 1
      <li>Access the latest <a href="../procedures.tar">procedures archive</a> 
d169 1
a169 1
      <li>Access the <a href="../data20060817.tar">data archive</a>
@


1.2
log
@tar archive, html update, cosmetic
@
text
@d110 1
a110 1
       procedure-file tarball.</li>
d120 1
a120 1
       <a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html">here</a>.</li>
d133 1
a133 1
      <li>Access the latest <a href="procedures.tar">procedures archive</a> 
d166 1
a166 1
<li><p><I>(optional)</I> Copy sample data.</p></li>
d168 1
a168 1
      <li>Access the <a href="data20060817.tar">data archive</a>
d188 1
a188 1
<li><p><I>(optional)</I> If the micrographs are not already in SPIDER format, convert them.</p></li>
d211 1
a211 1
			by setting <I>[filter-radius]=0</I>, you can skip this step. </li>
d257 1
a257 1
			<li>Go to <I>File -> Open -> Image Series</I> and select a pair of micrographs. 
d259 1
a259 1
			    Do <U>NOT</U> resize the micrographs using <I>Edit</I> &gt; <I>Resize</I>, 
d261 3
a263 3
			<li>Click on the <I>Markers/Tilt Pair</I> tab.</li>
			<li>In the <I>Marker File Number</I> field, enter the number of the untilted micrograph.</li>
			<li>Click on the <I>Show/Edit Marker</I> button, which will display the images.</li>
d269 1
a269 1
				<BR><I>HINT:</I> The middle mouse button will erase a pair of points 
d271 1
a271 1
				<BR><I>HINT:</I> Since the numbering is to the right of the marker, 
d273 1
a273 1
			<li>Click on buttons <I>Save Marker Files</I> and <I>Determine Theta</I>, 
d275 1
a275 1
			<li>Click on the <I>Fit Angles</I> button.
d277 1
a277 1
			<li>Click on the <I>Draw Fitted Locations</I> button.
d280 1
a280 1
			<li>Click on the <I>Save Angles</I> button.</li>
d285 2
a286 2
			<li>To save the new values, re-click the five buttons: <I>Save Marker Files</I>, <I>Determine Theta</I>, 
				<I>Fit Angles</I>, <I>Draw Fitted Locations</I>, and <I>Save Angles</I>.</li>
d290 1
a290 1
		    <li>From the menu, select <I>COMMANDS</I> &gt; <I>Tilted Particles</I>, 
d293 2
a294 2
		    <li>In the <I>Particle doc</I> popup window, under <I>Doc file number</I>, 
		        enter the number of the untilted micrograph and click <I>ACCEPT</I>.</li>
d300 3
a302 3
		    <li>Click the middle button to open the <I>Particle picking menu_popup</I>.</li>
		    <li>Click on <I>Determine tilt axis angles</I>, <I>Draw fitted locations</I>, 
		        and <I>Save angles in doc file</I>.</li>
d307 2
a308 2
		    <li>To save the new values, re-click the three buttons: <I>Determine tilt axis angles</I>, 
		        <I>Draw fitted locations</I>, and <I>Save angles in doc file</I>.</li>
d313 3
a315 3
			    <li><U>WARNING</U>: If you entered a number under <I>Image reduction factor</I>
				(after setting the reduction factor in <I>OPTIONS</I> &gt; <I>Image</I>)
				do <U>NOT</U> set the parameter <I>[decimation-factor]</I> below in 
d318 1
a318 1
			    <li>There is no <I>Save Marker Files</I> button.
d320 2
a321 2
			    <li><I>Determine Theta</I> and <I>Fit Angles</I> are merged into one button: 
				<I>Determine tilt axis angles</I>.</li>
d326 1
a326 1
	    <li><I>HINT:</I> Save the coordinates frequently. 
d330 1
a330 1
	    <li><I>HINT:</I> If, while picking pairs, the fitted locations stray from the correct location 
d334 2
a335 2
	    <li><I>HINT:</I> If you close a pair or micrographs and re-open them
		(with the appropriate <I>Marker File Number</I>), 
d355 1
a355 1
		<li>PARAMETER: <I>[decimation-factor]</I> -- If you used the output of 
d359 2
a360 2
		    <I>Edit</I> &gt; <I>Resize</I> (for JWEB) or 
		    <I>Image reduction factor</I> (for X-Window WEB). 
d427 1
a427 1
<li><p><I>(optional)</I> Attempt to align average along coordinate axes</p></li>
d436 1
a436 1
			    There will be two solutions, along <I>x</I> or along <I>y</I>. 
d454 2
a455 2
				Typically, in one solution the major axis is along <I>x</I>.
				and in the other it is along <I>y</I>.
d477 1
a477 1
				<li><I>flag for CA (1), PCA (2), or iterative PCA (3)</I> --
d480 1
a480 1
				<li><I>number of factors to calculate</I> --
d489 1
a489 1
		    <a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html#FullInstall">here</a>.</li>
d502 1
a502 1
					<li><I>desired number of classes</I> --
d508 1
a508 1
					<li><I>number of factors to use</I> --
d522 1
a522 1
				<li>PARAMETER: <I>number of factors to use</I> --
d536 2
a537 2
					<li>PARAMETER: <I>ending depth</I> --
						For the depth that you specify here, there will be up to 2^<I>depth</I> averages generated. 
d548 1
a548 1
						<A HREF="http://www.wadsworth.org/spider_doc/spire/doc/packages.html">
d553 1
a553 1
						Save the selection file with <I>CTRL-s</I>.<p></p></li>
d570 1
a570 1
					<li>PARAMETER: <I>desired number of classes</I></li>
d593 1
a593 1
				<li>PARAMETER: <I>number of factors to use</I> --
d604 1
a604 1
				<li>PARAMETER: <I>desired number of classes</I> --
d660 1
a660 1
		    <li><I>[cg-option]</I> -- if this is set to 1 (the default), 
d666 1
a666 1
		    <li><I>[mirror-option]</I> -- if this is set to 0 (the default), 
d684 1
a684 1
		<li>Be sure that the label <I>[old_class_dir]</I> the procedure file 
d740 1
a740 1
		<li>Re-run the last three steps, <I>i.e.</I>:</li>
d746 1
a746 1
						<li>Input <I>OLD_CLASS_DIR</I> is now the previous 
d748 1
a748 1
						<li>Output <I>MULTIREF_DIR</I> is now the new directory, 
d750 1
a750 1
						<li>The parameter <I>[subdir-flag]</I> set to <I>1</I> will serve as a flag 
d756 2
a757 2
				    Input <I>CLASS_DIR</I> is now the new 
				    multireference alignment directory, <I>e.g.</I>, <b>Multiref2</b></li>
d784 2
a785 2
			It is located in the class-average window under <I>File/SaveSelection</I>. 
			The keyboard shortcut, alternatively, is <I>ALT-s</I>. </li>
d803 1
a803 1
		<li><I>HINT:</I> It may be useful to re-classify only the good particles, 
d807 1
a807 1
			e.g., add <I>good</I> to the beginning of the filenames. 
d839 1
a839 1
			from the appropriate directory, <I>i.e.</I>, <b>Multiref</b>, <b>Multiref2</b>, etc.</li>
d845 2
a846 2
		    This option is used by setting parameter <I>[cg-option]</I> to 2.  
		    If neither option 1 nor 2 work well, setting <I>[cg-option]</I> will not 
d860 1
a860 1
		<li>PARAMETER: <I>[mirror-yn]</I> (see NOTE below)</li>
d865 1
a865 1
		<li>NOTE: Changing parameter <I>[mirror-yn]</I> will reverse the handedness of the structure. 
d904 1
a904 1
		    <li><I>[single-class]</I> -- The default value of <I>0</I> will filter all class volumes. 
d907 1
a907 1
		    <li><I>[header-type]</I>, <I>[header-param1]</I>, <I>[header-param2]</I> -- 
d909 2
a910 2
		    <li><I>[override-yn]</I> -- if pre-existing doc file <b>docvolfilt</b> exists 
		        (more on this file below), setting this parameter to <I>1</I> 
d918 1
a918 1
		    By setting the parameter <I>[override-yn]</I> to <I>1</I>, 
d940 3
a942 3
	    <li><I>[exp-num]</I> -- the number for the experimental volume to align</li>
	    <li><I>[ref-num]</I> -- the number for the reference volume</li>
	    <li><I>[num-solns]</I> -- number of initial alignment solutions to compare 
d944 1
a944 1
	    <li><I>[dtheta]</I> -- angular increment for initial search, as in
d947 1
a947 1
	    <li><I>[shift-range]</I>,<I>[shift-step]</I>,<I>[first-ring]</I> -- 2D search parameters for 
d972 1
a972 1
       edit in <b>list2merge</b> column #2, labelled <I>SOLUTIONNUM</I>.  
d974 1
a974 1
       set this value to <I>0</I> in <b>list2merge</b>.</p>
d979 1
a979 1
<li><p><I>(optional)</I> Merged particles from aligned class volumes into one reconstruction</p></li>
d992 1
a992 1
    <p>If the parameter <I>[classvols-yn]</I> is set to 1, 
d1007 1
a1007 1
		This will create a new directory called <I>myproject</I><BR>
d1064 2
a1065 2
        the 50S ribosomal subunit of <I>Escherichia coli</I>.
        <I>J Microsc.</I>  <b>146</b>:113-36.</li>
d1069 1
a1069 1
        <I>Nature Protocols</I> <b>3</b>: 1941-74.</li>
d1073 1
a1073 1
        <I>Nucleic Acids Res.</I> <b>39</b>: 2845-54.</li>
@


1.1
log
@Initial revision
@
text
@d2 71
a72 68
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>Random-conical tilt reconstruction</TITLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">

<I><P ALIGN="RIGHT">(Updated 2012 Nov 21)</P></I>

<CENTER><P>
<FONT SIZE="5"><B>Random conical tilt reconstruction</B></font>
<BR>Adapted from the 2007 SPIDER Workshop tutorial
</P></CENTER>

<HR>

<B><P>Outline</P></B>
<UL>
	<LI>General notes</LI>
	<LI>Quick-start guide</LI>
	<LI>Getting started</LI>
	<LI>Procedure </LI>
	<LI>Miscellaneous batch files </LI>
	<LI>References </LI>
</UL>

<HR>

<B><P>General notes</P></B>

<UL>
	<LI>Sequential operations are numbered. Options are lettered.</LI>
	<LI>Data extension assumed to be <B>.dat</B>. Adjust accordingly.</LI>
	<LI>List of inputs and outputs in description is not exhaustive.</LI>
</UL>

<HR>

<B><P>Quick-start guide</P></B>
<OL>
	<LI>tar -xvf $BATCH.tar</LI>
	<LI>spider rct/dat @@makeparams (or copy <B>params.dat</B>)</LI>
	<LI>(optional) tar -xvf $DATA.tar</LI>
	<LI>mkfilenums.py filenums.dat $MICROGRAPHS*</LI>
	<LI>(for non-SPIDER format micrographs) spider rct/dat @@convert</LI>
	<LI>spider rct/dat @@shrinkmics</LI>
	<LI>cd Micrographs/ ; montagefromdoc.py ../filenums.dat</LI>
	<LI>spider rct/dat @@micpair</LI>
	<LI>(required for JWEB) spider rct/dat @@padmics</LI>
	<LI>pick tilt pairs in JWEB or WEB</LI>
	<LI>spider rct/dat @@makesomenoise (or copy <B>noise.dat</B>) </LI>
	<LI>spider rct/dat @@windowparticles</LI>
	<LI>(for negative stain) Do both of:</LI>
		<OL TYPE=A>
			<LI>spider rct/dat @@highpass-untilted</LI>
			<LI>spider rct/dat @@highpass-tilted</LI>
		</OL>
	<LI>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</LI>
	<LI>(if necessary) spider rct/dat @@removebad</LI>
	<LI>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</LI>
	<LI>(if necessary) spider rct/dat @@removebad</LI>
	<LI>(slow) spider rct/dat @@pairwise</LI>
	<LI>(optional) To reorient average, do both of:</LI>
		<OL TYPE=A>
			<LI>spider rct/dat @@reorientavg</LI>
			<LI>spider rct/dat @@sumalign</LI>
		</OL>
<!--</OL>
d74 122
a195 122
	<LI>spider rct/dat @@filtershrink</LI>
	<LI>spider rct/dat @@ca-pca</LI>
	<LI>Classify.  (Ward's method shown here.  For other options, see below.)</LI>
	<OL TYPE=A>
		<LI>spider rct/dat @@hierarchical</LI>
		<LI>spider rct/dat @@binarytree</LI>
		<LI>cd Zerodegr/Tree ; ../../tree.py labeled0001.dat 4 selclasses.dat</LI>
	</OL>
	<LI>Iterate:</LI> 
		<OL TYPE=A>
			<LI>spider rct/dat @@multirefalign (subsequently @@multirefalign-descend)</LI> 
			<LI>spider rct/dat @@filtershrink</LI> 
			<LI>spider rct/dat @@classifybyview</LI>
			<LI>verifybyview.py</LI> 
		</OL>
	<LI>spider rct/dat @@combinegoodclasses</LI> 
	<LI>spider rct/dat @@viewaverages</LI> 
	<LI>spider rct/dat @@centertilt</LI>
	<LI>spider rct/dat @@storeangles</LI>
	<LI>(optional) spider rct/dat @@d6symmetry</LI>
	<LI>spider rct/dat @@bpclass</LI>
	<LI>spider rct/dat @@volfilt</LI>
	<LI>(if multiple orientations) Do both of: </LI>
		<OL TYPE=A>
			<LI>spider rct/dat @@volalignprj</LI>
			<LI>spider rct/dat @@mergevols</LI>
		</OL>
	<LI>spider rct/dat @@prepare-prjmatch</LI>
</OL>

<HR>

<B><P>Getting started</P></B>

<UL>
	<LI>Create a new directory, and change to that directory before unpackaging the 
		batch-file tarball.</LI>

	<LI>Micrographs should be placed in the <B>Micrographs/</B> directory.  
		They needn't be in SPIDER format, but you'll then need to run
		<a href="convert.rct">convert.rct</a> for the conversion. </LI>

	<LI>The SPIRE libraries are required for various Python scripts, such as
		<a href="mkfilenums.py">mkfilenums.py</a> and <a href="tree.py">tree.py</a>. 
		These steps can be substituted with SPIRE-independent analogs. 
		Installation instructions for SPIRE can be found 
		<a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html#FullInstall">here</a>.</LI>

<!-- 	<LI></LI> -->
</UL>

<HR>

<B><P>Procedure</P></B>

<UL>

<LI><P>Prepare directory</P></LI>
	<UL>
		<LI>Download the latest <a href="../tar_archive">batch-file archive</a> 
			and unpackage it by typing:
			<PRE>tar -xvf $ARCHIVE.tar</PRE>
			This command will unpackage the files in the currect directory, 
			so create a new directory if so desired.</LI>
	</UL>

<LI><P>Prepare parameter doc file</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="makeparams.rct">makeparams.rct</a> </LI>
		<LI>OUTPUTS: <B>params</B> </LI>
		<LI>Otherwise, you can copy a <B>params</B> file from elsewhere.<BR>
			An example file called <B>bak-params</B> is present in the tarball.</LI>
		<LI>The following parameters (described <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/params.html">
			here</a>) are used from the <B>params</B> file:</LI>
			<UL>
				<LI><B>1</B> -- zip flag -- if set to 1, then will be uncompressed using gunzip</LI>
					<UL><LI>used by convert.rct</LI></UL>
				<LI><B>2</B> -- format flag -- 0 corresponds to SPIDER, 3 to Z/I TIFF, etc. -- see 
					<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/params.html">
					complete description</a> for additional formats</LI>
					<UL><LI>used by convert.rct</LI></UL>
				<LI><B>5</B> -- pixel size -- in Angstroms</LI>
					<UL><LI>used by shrinkmics.rct</LI></UL>
				<LI><B>17</B> -- window size -- in pixels </LI>
					<UL><LI>used by many batch files</LI></UL>
				<LI><B>18</B> -- particle diameter -- in pixels</LI>
					<UL><LI>used by pairwise.rct </LI></UL>
		<!--		<LI><B>NUMBER</B> -- FLAG -- DESCRIPTION</LI>
					<UL><LI>used by BATCH</LI></UL>-->
			</UL>
	</UL>

<LI><P><I>(optional)</I> Copy sample data.</P></LI>
	<UL>
		<LI>Download the <a href="../tar_archive/data20060817.tar">data archive</a>
			and unpackage it by typing:</LI>
			<PRE>tar -xvf data20060817.tar</PRE>
		<LI>This command will create a directory called <B>Micrographs/</B>, 
			containing phantom micrographs, and a directory called <B>TP1/</B>,
			containing the files used to generate the micrographs.</LI>
	</UL>

<LI><P>Generate a list of micrographs.</P></LI>
	<UL>
		<LI>PYTHON SCRIPT: <a href="mkfilenums.py">mkfilenums.py</a> </LI>
		<LI>To make a list of TIFF files, for example, the syntax would be: </LI>
			<PRE>mkfilenums.py filenums.dat Micrographs/zeiss*.tif</PRE>
		<LI>This Python script requires the Spiderutils library from SPIRE. 
			If SPIRE is not installed, you can generate <B>filenums</B> using other means, 
			such as by manually entering the filenumbers using 
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/doccreate.html">
			'DOC CREATE'</a> in SPIDER. </LI>
	</UL>

<LI><P><I>(optional)</I> If the micrographs are not already in SPIDER format, convert them.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="convert.rct">convert.rct</a> </LI>
		<LI>SUBROUTINE: <a href="convert_p.rct">convert_p.rct</a> </LI>
		<LI>INPUTS: <B>filenums</B>, <B>Micrographs/mic****</B> </LI>
		<LI>Downstream batch files will expect files called <B>Micrographs/mic****</B>. 
			Keeping that convention will minimize the number of changes you'll need to make.</LI>
		<LI>If the micrographs are in Z/I TIFF format, 
d198 10
a207 10
			are described at the top of the source code.</LI>
		<LI>TO DO: add conversion flag for MRC files</LI>
	</UL>

<LI><P>Shrink the micrographs for particle-picking.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="shrinkmics.rct">shrinkmics.rct</a> </LI>
		<LI>INPUTS: <B>filenums</B>, <B>Micrographs/mic****</B> </LI>
		<LI>INPUTS: <B>Micrographs/sm-mic****</B> </LI>
		<LI>Choose the reduction factor such that the micrgraph fits on the screen, 
d209 13
a221 13
			These downsampled micrographs will be used to pick tilt pairs.</LI>
		<LI>The filtration step is slow, so 
			by setting <I>[filter-radius]=0</I>, you can skip this step. </LI>
	</UL>

<LI><P>Screen micrographs.</P></LI>
	<UL>
		<LI>Micrographs can be screened using various display programs.
			To use montagefromdoc.py, from <B>Micrographs/</B>
			(there is a pre-existing <B>.montagefromdoc</B> file there), type:
			<PRE>montagefromdoc.py ../filenums.dat sm-mic*</PRE>
			The output should also be <B>filenums</B>.</LI>
		<LI>If you wish to remove micrographs by editing <B>filenums</B>
d224 20
a243 20
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/docren.html">
			'DOC REN'</a>. (The input and output can have the same name.) </LI>
	</UL>

<LI><P>Establish pairings between micrographs</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="micpair.rct">micpair.rct</a> </LI>
		<LI>INPUTS: <B>filenums</B> </LI>
		<LI>OUTPUTS: <B>docmicpairs</B> </LI>
		<LI>This batch file presumes that the tilted-specimen micrograph precedes the untilted-specimen micrograph.
			Check the output to confirm that the pairings make sense.</LI>
	</UL>

<LI><P>Resize micrographs (Required for JWEB, not required for X-Window WEB)</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="padmics.rct">padmics.rct</a> </LI>
		<LI>INPUTS: <B>docmicpairs</B>, <B>Micrographs/sm-mic****</B> </LI>
		<LI>OUTPUTS: <B>Micrographs/jweb-mic{***[untilted]}</B>, <B>Micrographs/jweb-mic{***[untilted]}_tilted</B> </LI>
		<LI>JWEB has a "feature" that requires the tilt pair to have the same dimensions. 
			This batch file pads the micrographs to the same size. 
d245 2
a246 2
			even though it is typically collected first at the microscope.</LI>
	</UL>
d248 5
a252 5
<LI><P>Pick tilt pairs (for JWEB, differences for X-Window WEB noted below)</P></LI>
	<UL>
	    <LI>INPUTS: <B>Micrographs/jweb-mic{***[untilted]}</B>, <B>Micrographs/jweb-mic{***[untilted]}_tilted</B>
	    <P></P></LI>
	</UL>
d254 4
a257 4
	    <LI>If using JWEB: </LI>
		<OL>
			<LI>From the <B>Micrographs/</B> directory, open JWEB. </LI>
			<LI>Go to <I>File -> Open -> Image Series</I> and select a pair of micrographs. 
d260 5
a264 5
			    for ease of use with the batch files below.</LI>
			<LI>Click on the <I>Markers/Tilt Pair</I> tab.</LI>
			<LI>In the <I>Marker File Number</I> field, enter the number of the untilted micrograph.</LI>
			<LI>Click on the <I>Show/Edit Marker</I> button, which will display the images.</LI>
			<LI>Select a particle from the untilted micrograph, and 
d272 6
a277 6
				it may be easier to proceed from right to left.</LI>
			<LI>Click on buttons <I>Save Marker Files</I> and <I>Determine Theta</I>, 
				which will determine the magnitude of the tilt angle between the micrographs.</LI>
			<LI>Click on the <I>Fit Angles</I> button.
				This will determine the direction of the tilt axis.</LI>
			<LI>Click on the <I>Draw Fitted Locations</I> button.
d279 12
a290 12
				but does not affect the coordinates selected with the mouse.</LI>
			<LI>Click on the <I>Save Angles</I> button.</LI>
			<LI>Now, when you select a particle in the untilted image, 
				JWEB will send the cursor to the corresponding location in the tilted image.</LI>
			<LI>Select more particles from the tilt pair. 
				(For the sample micrograph, there are 76 pairs.  Select all of them.)</LI>
			<LI>To save the new values, re-click the five buttons: <I>Save Marker Files</I>, <I>Determine Theta</I>, 
				<I>Fit Angles</I>, <I>Draw Fitted Locations</I>, and <I>Save Angles</I>.</LI>
		</OL>
	    <LI>If using X-Window WEB: </LI>
		<OL>
		    <LI>From the menu, select <I>COMMANDS</I> &gt; <I>Tilted Particles</I>, 
d292 4
a295 4
		        and then the tilted-specimen image.  </LI>
		    <LI>In the <I>Particle doc</I> popup window, under <I>Doc file number</I>, 
		        enter the number of the untilted micrograph and click <I>ACCEPT</I>.</LI>
		    <LI>Select a particle from the untilted micrograph, and 
d299 15
a313 15
			ideally in the four corners, but the farther apart the better.</LI>
		    <LI>Click the middle button to open the <I>Particle picking menu_popup</I>.</LI>
		    <LI>Click on <I>Determine tilt axis angles</I>, <I>Draw fitted locations</I>, 
		        and <I>Save angles in doc file</I>.</LI>
		    <LI>Now, when you select a particle in the untilted image, 
			WEB will send the cursor to the corresponding location in the tilted image.</LI>
		    <LI>Select more particles from the tilt pair. 
			(For the sample micrograph, there are 76 pairs.  Select all of them.)</LI>
		    <LI>To save the new values, re-click the three buttons: <I>Determine tilt axis angles</I>, 
		        <I>Draw fitted locations</I>, and <I>Save angles in doc file</I>.</LI>
		    <LI>Differences between JWEB and X-Window WEB:</LI>
			<UL>
			    <LI>X-Window WEB does not require the pair of micrographs to be the same size, 
				so the step <a href="padmics.rct">padmics.rct</a> is unnecessary. </LI>
			    <LI><U>WARNING</U>: If you entered a number under <I>Image reduction factor</I>
d317 10
a326 10
				Using both parameters will be redundant.</LI>
			    <LI>There is no <I>Save Marker Files</I> button.
				Coordinates are saved continuously.</LI>
			    <LI><I>Determine Theta</I> and <I>Fit Angles</I> are merged into one button: 
				<I>Determine tilt axis angles</I>.</LI>
			</UL>
		</OL>
	</OL>
	<UL>
	    <LI><I>HINT:</I> Save the coordinates frequently. 
d329 2
a330 2
		Delete those particles (using the middle mouse button), and re-pick them, as necessary.</LI>
	    <LI><I>HINT:</I> If, while picking pairs, the fitted locations stray from the correct location 
d333 2
a334 2
		it may help to re-do the fitting (summarized under the previous bullet).</LI>
	    <LI><I>HINT:</I> If you close a pair or micrographs and re-open them
d336 2
a337 2
	    you can resume from where you left off.</LI>
	</UL>
d339 17
a355 17
<LI><P>Obtain a noise image for normalization.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="makesomenoise.rct">makesomenoise.rct</a> </LI>
		<LI>INPUTS: a micrograph </LI>
		<LI>OUTPUTS: <B>noise</B>, <B>tmpnoise/noi***</B> </LI>
		<LI>Subsequent windowed images will be normalized against the output noise file.
			If you have a pre-existing noise file, copy it to <B>noise.dat</B></LI>
		<LI>One noise file will be chosen at random by the batch file.
			You can also look at the noise images in the <B>tmpnoise/</B> directory
			and copy one that looks even "noisier" to <B>noise.dat</B>
			(in the top-level directory).</LI>
	</UL>

<LI><P>Window particles from tilted and untilted micrographs.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="windowparticles.rct">windowparticles.rct</a> </LI>
		<LI>PARAMETER: <I>[decimation-factor]</I> -- If you used the output of 
d362 6
a367 6
		    the full-sized micrograph and the version used for particle-selection.</LI>
		<LI>INPUTS: <B>params</B>, <B>docmicpairs</B>, <B>noise</B>,
			<B>Micrographs/mic****</B>, <B>Micrographs/dcu****</B>, <B>Micrographs/dct****</B></LI>
		<LI>OUTPUTS: <B>listparticles</B>,
			<B>Zerodegr/Winrot/unt*****</B>, <B>Tilted/Winrot/tilt*****</B> </LI>
	</UL>
d369 1
a369 1
<LI><P>(Recommended for stained images) High-pass filter windowed images</P>
d371 1
a371 1
    <P>For negatively-stained images, it is often the case that the puddle of stain surrounding the particles 
d375 1
a375 1
    the aligning power of the images will be lost.  You may need to tweak the radii.</P> 
d377 1
a377 1
    <P>If you are unsure whether to do this step, feel free to skip it, 
d379 18
a396 18
    in order to see if the stain is the predominant source of variation. </P> </LI>
	<OL>
	    <LI>BATCH FILE: <a href="highpass-untilted.rct">highpass-untilted.rct</a></LI>
	    <UL>
		<LI>INPUTS: <B>Zerodegr/Winrot/unt*****</B> (directory renamed to <B>Unhighpass</B></LI>
		<LI>OUTPUTS: <B>Zerodegr/Winrot/unt*****</B> </LI>
	    </UL>
	    <LI>BATCH FILE: <a href="highpass-tilted.rct">highpass-tilted.rct</a></LI>
	    <UL>
		<LI>INPUTS: <B>Tilted/Winrot/tilt*****</B> (directory renamed to <B>Unhighpass</B></LI>
		<LI>OUTPUTS: <B>Tilted/Winrot/tilt*****</B> </LI>
	    </UL>
	</OL>

<LI><P>Screen the windowed images for defects (micrograph edges, dust, etc.).</P></LI>
	<UL>
		<LI>Screen the untilted--specimen windowed images by running
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
d398 3
a400 3
			<PRE>montagefromdoc.py listparticles.dat Zerodegr/Winrot/unt*</PRE>
		Use <B>notgood</B> as the output doc filename.<BR></LI>
		<LI>Only click on the bad images.
d402 8
a409 8
			There will be additional rounds of selection downstream.</LI>
		<LI>If particles are rejected, run: <a href="removebad.rct">removebad.rct</a> </LI>
		<UL>
		    <LI>INPUTS: <B>listparticles</B> (will be backed up by <a href="backup.rct">backup.rct</a>), <B>notgood</B> </LI>
		</UL>
		<LI>Now screen the tilted images for defects:</LI>
			<PRE>montagefromdoc.py listparticles.dat Tilted/Winrot/tilt*</PRE>
		<LI>Only click on the bad images.
d411 11
a421 11
			such as dust, edges, double-particles, etc. -- so be more stringent here.</LI>
		<LI>If tilted particles are rejected, re-run <a href="removebad.rct">removebad.rct</a></LI>
	</UL>

<LI><P>Align the untilted-specimen particles using reference-free alignment.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="pairwise.rct">pairwise.rct</a> </LI>
		<LI>INPUTS: <B>listparticles</B>, <B>Zerodegr/Winrot/unt*****</B> </LI>
		<LI>OUTPUTS: <B>Zerodegr/Pairwise/rfreeavg001</B>, <B>Zerodegr/Aligned/cenu*****</B>, 
			<B>Zerodegr/Pairwise/docpairalign</B>, many others </LI>
		<LI>This batch file first aligns pairs of images, averages them, 
d424 2
a425 2
			and each subsequent level will be faster.</LI>
	</UL>
d427 8
a434 8
<LI><P><I>(optional)</I> Attempt to align average along coordinate axes</P></LI>
	<OL>
	    <LI>Align average along coordinate axes
		<UL>
		    <LI>BATCH FILE: <a href="reorientavg.rct">reorientavg.rct</a> </LI>
		    <LI>INPUTS: <B>Zerodegr/Pairwise/rfreeavg001</B> </LI>
		    <LI>OUTPUTS: <B>Zerodegr/Pairwise/dsolalign</B>, <B>Zerodegr/Pairwise/malign</B> </LI>
		    <LI>This batch file aligns the average to a mirrored version of itself, 
d439 14
a452 14
			    note which solution to use (1 or 2), and run the next batch file, 
			    <a href="sumalign.rct">sumalign.rct</a>.</LI>
		</UL>

	    <LI>Combine alignments of individual particles with reoriented average</LI>
		<UL>
			<LI>BATCH FILE: <a href="sumalign.rct">sumalign.rct</a> </LI>
			<LI>PARAMETER: solution 1 or 2 (see description below) </LI>
			<LI>INPUTS: <B>Zerodegr/Winrot/unt*****</B>, <B>Zerodegr/Pairwise/dsolalign</B>, 
				<B>Zerodegr/Pairwise/docpairalign</B> </LI>
			<LI>OUTPUTS: <B>Zerodegr/Pairwise/dalu001</B>, <B>Zerodegr/Aligned/cenu*****</B>, 
				<B>Zerodegr/Pairwise/avgu001</B> </LI>
			<LI>If you wish to apply the alignments of the average from
				<a href="reorientavg.rct">reorientavg.rct</a>, then run this batch file.  
d456 22
a477 22
				It is arbitrary which solution to use.</LI>
		</UL>
	</OL>

<LI><P>Filter the aligned, untilted particles.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="filtershrink.rct">filtershrink.rct</a> </LI>
		<LI>PARAMETERS: reduction factor, low-pass filter parameters </LI>
		<LI>INPUT: <B>Zerodegr/Aligned/cenu*****</B></LI>
		<LI>OUTPUT: <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>Remember to change the input filename if you ran <a href="sumalign.rct">sumalign.rct</a>. </LI>
		<LI>The filtered images produced will be used for multivariate data analysis and classification.
			To look at the filtered untilted particles, type: </LI>
			<PRE>montagefromdoc.py listparticles.dat Zerodegr/Filtered/flt*</PRE>
	</UL>

<LI><P>Run correspondence analysis (CA) or principal component analysis (PCA) on filtered images.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="ca-pca.rct">ca-pca.rct</a> </LI>
		<LI>PARAMETERS: </LI>
			<UL>
				<LI><I>flag for CA (1), PCA (2), or iterative PCA (3)</I> --
d479 3
a481 3
						I, subjectively, try CA first, then iterative PCA, then PCA last.</LI>
				<LI><I>number of factors to calculate</I> --
					If after you run this batch file, 
d483 5
a487 5
					increase this parameter and re-run.</LI>
			</UL>
		<LI>INPUT: <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>OUTPUT: <B>Zerodegr/MSA/cas_***</B>, <B>Zerodegr/MSA/reconstituted***</B>, others </LI>
		<LI>The commands to generate the PostScript eigenvalue histogram requires the SPIRE Python libraries.
d489 2
a490 2
		    <a href="http://www.wadsworth.org/spider_doc/spire/doc/download.html#FullInstall">here</a>.</LI>
		<LI>For negatively-stained samples, when looking at the reconstituted images, 
d492 2
a493 2
		    go back to the high-pass filtration step above.</LI>
	</UL>
d495 8
a502 8
<LI><P>Classify images. Chose one of:</P></LI>
	<OL TYPE=A>
		<LI>K-means clasification. </LI>
		<UL>
			<LI>BATCH FILE: <a href="kmeans.rct">kmeans.rct</a> </LI>
			<LI>PARAMETERS:</LI>
				<UL>
					<LI><I>desired number of classes</I> --
d507 2
a508 2
						one class per 50 to 75 particles.</LI>
					<LI><I>number of factors to use</I> --
d511 12
a522 12
						Use of the weaker factors will probably not make a big difference though.</LI>
				</UL>
			<LI>INPUTS: <B>Zerodegr/MSA/cas_***</B>, <B>Zerodegr/Filtered/flt*****</B> </LI>
			<LI>OUTPUTS: <B>classavg***</B>, <B>docclass****</B>, others </LI>
		</UL>

		<LI>Hierarchical classification, using Ward's method. </LI>
		<OL>
			<LI>Run classification. </LI>
			<UL>
				<LI>BATCH FILE: <a href="hierarchical.rct">hierarchical.rct</a> </LI>
				<LI>PARAMETER: <I>number of factors to use</I> --
d525 12
a536 12
					Use of the weaker factors will probably not make a big difference though.</LI>
				<LI>INPUTS: <B>Zerodegr/MSA/cas_***</B> </LI>
				<LI>OUTPUTS: <B>docdendro</B> </LI>
			</UL>

			<LI>Generate class averages. Choose one of:</LI>
			<OL TYPE=a>
				<LI>Generate binary tree using tree.py</LI>
				<UL>
					<LI>BATCH FILE: <a href="binarytree.rct">binarytree.rct</a> </LI>
					<LI>SUBROUTINES: averagenode.rct, update_lut.rct </LI>
					<LI>PARAMETER: <I>ending depth</I> --
d539 4
a542 4
						It is better to make too many and display fewer in the next step.</LI>
					<LI>INPUT: <B>docdendro</B> </LI>
					<LI>OUTPUTS: <B>avgnode***</B>, <B>labeled***</B> </LI>
					<LI>NOTE: The format of SPIDER's dendrogram doc file changed in version 17.13. 
d544 3
a546 3
						If this batch file crashes, check this parameter.</LI>
					<LI>To view the binary tree, run <A HREF="tree.py">tree.py</A>. It requires 
						<A HREF="http://www.wadsworth.org/spider_doc/spider/docs/python/spipylib/code/Spiderutils.html">
d550 1
a550 1
						<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/MSA/index.htm">
d552 7
a558 7
						<PRE>cd Zerodegr/Tree ; tree.py labeled0001.dat 4 selclasses.dat</PRE>
						Save the selection file with <I>CTRL-s</I>.<P></P></LI>
				</UL>

				<LI>Generate binary tree as (large) SPIDER image</LI>
				<UL>
					<LI>Alternatively, you can run <a href="tree.rct">tree.rct</a>,
d562 2
a563 2
						and view it in a dedicated image-viewer.</LI>
				</UL>
d565 9
a573 9
				<LI>Simple class averages</LI>
				<UL>
					<LI>This option is equivalent to the bottom row in the binary tree above, 
						or the display in WEB, and similar to simple K-means.</LI>
					<LI>BATCH FILE: <a href="classavg.rct">classavg.rct</a> </LI>
					<LI>PARAMETER: <I>desired number of classes</I></LI>
					<UL>
					</UL>
						<LI>Too small a number, and dissimilar particles will be grouped together, 
d577 2
a578 2
							one class per 50 to 75 particles.</LI>
						<LI>If you're going to run <a href="binarytree.rct">binarytree.rct</a>
d580 14
a593 14
							So, it doesn't matter how many classes you request here.</LI>
					<LI>INPUTS: <B>Zerodegr/Hierarchical/docdendro</B>
					    (other classification options write <B>docdendro</B> in different locations)</LI>
					<LI>OUTPUTS: <B>classavg***</B>, <B>docclass****</B>, <B>listclasses</B>, others </LI>
				</UL>
			</OL>
		</OL>

		<LI>Clustering using Diday's method. </LI>
		<OL>
			<LI>Run classification. </LI>
			<UL>
				<LI>BATCH FILE: <a href="cluster.rct">cluster.rct</a> </LI>
				<LI>PARAMETER: <I>number of factors to use</I> --
d596 9
a604 9
					Use of the weaker factors will probably not make a big difference though.</LI>
				<LI>INPUTS: <B>Zerodegr/MSA/cas_***</B> </LI>
				<LI>OUTPUTS: <B>docdendro</B> </LI>
			</UL>

			<LI>Generate class averages. </LI>
			<UL>
				<LI>BATCH FILE: <a href="classavg.rct">classavg.rct</a> </LI>
				<LI>PARAMETER: <I>desired number of classes</I> --
d609 4
a612 4
						one class per 50 to 75 particles.</LI>
				<LI>INPUTS: <B>docdendro</B> </LI>
				<LI>OUTPUTS: <B>classavg***</B>, <B>docclass****</B>, <B>listclasses</B>, others </LI>
				<LI>I haven't been able to make this compatible with 
d614 9
a622 9
					so for now, it's functionally equivalent to K-means.</LI>
			</UL>
		</OL>

	</OL>

<LI><P>Select unique classes.</P></LI>
	<UL>
		<LI>The classes selected will be used for multireference alignment. 
d626 2
a627 2
			The <B>.verifybyview</B> file included in the tarball 
			<LI>Included in the tarball is a starting <B>.verifybyview</B> file to use. 
d629 7
a635 7
				<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/interface.htm">
				verifybyview.py</a>, call the output class-selection doc file <B>selclasses</B>.</LI>
		<OL TYPE=A>
			<LI>To view+select the averages from K-means, type:</LI>
				<PRE>verifybyview.py Zerodegr/Kmeans/listclasses.dat</PRE>
			<LI>To view+select the averages from hierarchical classification, use one of the following:
				<PRE>verifybyview.py Zerodegr/Hierarchical/listclasses.dat</PRE>
d637 10
a646 10
				<U>OR</U> (if you ran <a href="binarytree.rct">binarytree.rct</a>):</LI>
				<PRE>cd Zerodegr/Tree ; tree.py labeled0001.dat 5 selclasses.dat</PRE>
			<LI>To view+select the averages from Diday's method, type:</LI>
				<PRE>verifybyview.py Zerodegr/Cluster/listclasses.dat</PRE>
		</OL>
		<LI>For verifybyview.py, the filenames at the initial dialog are:</LI>
			<UL>
				<LI><B>listclasses</B> -- can be specified on the command line </LI>
				<LI><B>classavg***</B> -- class-average template </LI>
			</UL>
d648 13
a660 13
			<UL>
				<LI><B>Zerodegr/Filtered/flt*****</B> -- particle template </LI>
				<LI><B>selclasses</B> -- list of selected classes </LI>
				<LI><B>byhand***</B> -- selected particles in a given class</LI>
			</UL>
	</UL>

<LI><P>Run multireference alignment.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="multirefalign.rct">multirefalign.rct</a> </LI>
		<LI>PARAMETERS, notable ones include: </LI>
		  <UL>
		    <LI><I>[cg-option]</I> -- if this is set to 1 (the default), 
d662 1
a662 1
		        <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html">'CG PH'</a>. 
d664 3
a666 3
		        You can look at the <B>Zerodegr/Multiref/ref***</B> files while the 
		        (slow) multi-reference alignment is running to check.</LI>
		    <LI><I>[mirror-option]</I> -- if this is set to 0 (the default), 
d675 10
a684 10
		        </LI>
		  </UL>
		<LI>INPUTS: <B>selclasses</B>, <B>docclass****</B>, 
			<B>Zerodegr/Aligned/cenu*****</B>, <B>Zerodegr/Winrot/unt*****</B> </LI>
		<LI>OUTPUTS: <B>Zerodegr/Multiref/ref***</B>, <B>Zerodegr/Multiref/docalign</B>, 
			<B>Zerodegr/Multiref/selview***</B>, <B>Zerodegr/Aligned/cenu*****</B>, 
			<B>Zerodegr/Multiref/viewavg***</B></LI>
		<LI>This batch file takes the class averages selected in the previous step, 
			re-centers them, and uses these for multireference alignment.</LI>
		<LI>Be sure that the label <I>[old_class_dir]</I> the batch file 
d686 27
a712 27
			For example, by default this label is set to <B>Zerodegr/Tree</B>,
			the location of the outputs of <a href="binarytree.rct">binarytree.rct</a>.</LI>
	</UL>

<LI><P>Re-filter aligned images.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="filtershrink.rct">filtershrink.rct</a> </LI>
		<LI>PARAMETERS: reduction factor, low-pass filter parameters </LI>
		<LI>INPUT: <B>Zerodegr/Aligned/cenu*****</B></LI>
		<LI>OUTPUT: <B>Zerodegr/Filtered/flt*****</B> </LI>
	</UL>

<LI><P>Classify the particles assigned to each reference.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="classifybyview.rct">classifybyview.rct</a> </LI>
		<LI>PARAMETERS:</LI>
			<UL>
				<LI>reduction factor</LI>
				<LI>flag for CA (1), PCA (2), or IPCA (3)</LI>
				<LI>number of factors to use</LI>
			</UL>
		<LI>INPUTS: <B>Zerodegr/Multiref/listrefs</B>, <B>Zerodegr/Multiref/ref***</B>, 
			<B>Zerodegr/Multiref/selview***</B>, <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>OUTPUTS: <B>Zerodegr/Multiref/View***/listclasses</B>, 
			<B>Zerodegr/Multiref/View***/classavg***</B>, 
			<B>Zerodegr/Multiref/View***/docclass***</B> </LI>
		<LI>This batch file performs a separate classification 
d714 1
a714 1
	</UL>
d716 4
a719 4
<LI><P>Check the classification results.</P></LI>
	<UL>
		<LI>Check the classes with the following command:</LI>
			<PRE>verifybyview.py Zerodegr/Multiref/View001/listclasses.dat</PRE>
d721 4
a724 4
				<UL>
					<LI><B>listclasses</B> -- specified on the command line </LI>
					<LI><B>classavg***</B> -- class-average template </LI>
				</UL>
d726 8
a733 8
				<UL>
					<LI><B>Zerodegr/Filtered/flt*****</B> -- particle template </LI>
					<LI><B>selclasses</B> -- list of selected classes </LI>
					<LI><B>byhand***</B> -- selected particles in a given class </LI>
				</UL>
		<LI>If all of the class averages under a particular reference look the same, 
			proceed to the next solid bullet ("Verify individual particles from last iteration of multireference alignment.").</LI>
		<LI>If there are homogeneous subsets under a particular reference, 
d737 1
a737 1
		<LI>There is no need to select similar-looking class averages, 
d740 3
a742 3
		<LI>Re-run the last three steps, <I>i.e.</I>:</LI>
			<OL>
				<LI><a href="multirefalign-descend.rct">multirefalign-descend.rct</a> 
d744 12
a755 12
					The following filenames/parameters are changed:</LI>
					<UL>
						<LI>Input <I>OLD_CLASS_DIR</I> is now the previous 
							multireference alignment directory, e.g., <B>Multiref</B></LI>
						<LI>Output <I>MULTIREF_DIR</I> is now the new directory, 
							for example <B>Multiref2</B></LI>
						<LI>The parameter <I>[subdir-flag]</I> set to <I>1</I> will serve as a flag 
							to look in the <B>View***</B> subdirectories for the class averages
							for subsequent runs.</LI>
					</UL>
				<LI><a href="filtershrink.rct">filtershrink.rct</a></LI>
				<LI><a href="classifybyview.rct">classifybyview.rct</a> -- 
d757 3
a759 3
				    multireference alignment directory, <I>e.g.</I>, <B>Multiref2</B></LI>
			</OL>
		<LI>Repeat these three steps as many times as necessary,
d762 1
a762 1
			A batch file <a href="multirefalign3.rct">multirefalign3.rct</a> is included, which is 
d764 2
a765 2
			except for the input and output directory names.  </LI>
	</UL>
d767 7
a773 7
<LI><P>Verify individual particles from last iteration of multireference alignment.</P></LI>
	<UL>
		<LI>Type the following (assuming you performed 2 rounds of multi-reference alignment):</LI>
			<PRE>verifybyview.py Zerodegr/Multiref2/View001/listclasses.dat</PRE> 
		<LI>INPUTS: <B>listclasses</B>, <B>classavg***</B>, <B>docclass***</B>, <B>Zerodegr/Filtered/flt*****</B> </LI>
		<LI>OUTPUTS: <B>selclasses</B>, <B>byhand***</B> </LI>
		<LI>At this point, we will keep only good particles.
d777 3
a779 3
			<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/interface.htm">
				verifybyview.py can be found here</a></LI>
		<LI>In the example above, 
d782 2
a783 2
			change the corresponding multireference-alignment directory name above.</LI>
		<LI><i>HINT:</i> Don't forget to save the good-class list in verifybyview.py. 
d785 2
a786 2
			The keyboard shortcut, alternatively, is <I>ALT-s</I>. </LI>
	</UL>
d788 12
a799 12
<LI><P>Combine selected particles from classes.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="combinegoodclasses.rct">combinegoodclasses.rct</a> </LI>
		<LI>INPUTS (assuming again that you performed 2 rounds of multi-reference alignment): </LI>
			<UL>
				<LI><B>Zerodegr/Multiref2/listrefs</B> </LI>
				<LI><B>Zerodegr/Multiref2/View***/selclasses</B> </LI>
				<LI><B>Zerodegr/Multiref2/View***/byhand***</B> (or <B>Zerodegr/Multiref2/View***/docclass****)</B> </LI>
			</UL>
		<LI>OUTPUTS: <B>Zerodegr/Multiref2/View***/goodsel</B> </LI>
		<LI>This batch files creates one list of particles for each reference view.</LI>
		<LI>In the example above, 
d802 2
a803 2
			change the corresponding multireference-alignment directory name above.</LI>
		<LI><I>HINT:</I> It may be useful to re-classify only the good particles, 
d805 1
a805 1
			In that case, re-run classifyview using <B>goodsel***</B> instead of <B>selview***</B>.
d810 2
a811 2
			It may be useful to classify the bad particles too.</LI>
	</UL>
d813 18
a830 18
<LI><P>Average selected images</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="viewaverages.rct">viewaverages.rct</a></LI>
		<LI>SUBROUTINE: <a href="viewaverage1.rct">viewaverage1.rct</a></LI>
		<LI>INPUTS: <B>Zerodegr/Aligned/cenu*****</B>, <B>Zerodegr/Multiref2/goodsel***</B>    
		    (assuming again that you performed 2 rounds of multi-reference alignment)</LI>
		<LI>OUTPUTS: <B>goodavg***</B>, <B>goodvar***</B> </LI>
	</UL>

<LI><P>Center tilted-specimen particles.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="centertilt.rct">centertilt.rct</a> </LI>
		<LI>PARAMETERS: center-of-gravity option (see NOTE below), 
		    filter parameters (see NOTE below)</LI>
		<LI>INPUT: <B>Tilted/Winrot/tilt*****</B> </LI>
		<LI>OUTPUTS: <B>Tilted/Aligned/cent*****</B>, <B>Tilted/dalt001</B>, 
			<B>Tilted/avgt001</B> </LI>
		<LI>This step is straightforward relative to the alignment of the untilted particles. 
d834 8
a841 8
			and the other two are determined by the geometry of the tilt pair.</LI>
		<LI>To look at the centered tilted particles, type: </LI>
			<PRE>montagefromdoc.py listparticles.dat Tilted/Aligned/cent*</PRE>
		<LI>If this batch file runs slowly, you can save time by centering only the selected particles.  
			To do this, change the input <B>listparticles</B> to <B>Zerodegr/Multiref#/combinedgood</B> 
			from the appropriate directory, <I>i.e.</I>, <b>Multiref</b>, <b>Multiref2</b>, etc.</LI>
		<LI>NOTE: To center the average after reference-free alignment (translation only), 
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/cgph.html">
d848 3
a850 3
		    Be sure to inspect the average to ensure that is is centered.</LI>
		<LI>NOTE: Low-pass filtration of the images seems to help the 
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsa.html">
d854 2
a855 2
		</LI>
	</UL>
d857 9
a865 9
<LI><P>Store Euler angles.</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="storeangles.rct">storeangles.rct</a> </LI>
		<LI>PARAMETER: <I>[mirror-yn]</I> (see NOTE below)</LI>
		<LI>INPUTS: <B>docalign</B>, <B>Micrographs/dcb****</B> </LI>
		<LI>OUTPUTS: <B>Tilted/dang-store</B> </LI>
		<LI>Use the most recent aligment doc file for the untilted images, 
			e.g., <B>Zerodegr/Multiref2/docalign</B>.</LI>
		<LI>NOTE: Changing parameter <I>[mirror-yn]</I> will reverse the handedness of the structure. 
d871 2
a872 2
		    you may need to re-test for flips in handedness.</LI>
		<LI><P>This batch file stores the three Euler angles in a doc file to use in the backprojection.
d876 1
a876 1
		    there is a possibility that equivalent (as far as the fitting is concerned) solutions are chosen inconsistently. </P>
d878 2
a879 2
		    <P>For example, in the sample RCT data in the 
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">Nature Protocols download</a>, 
d883 3
a885 3
		    </P>
		    </LI>
	</UL>
d887 1
a887 1
<LI><P>Compute 3D reconstructions</P>
d889 16
a904 16
    <P>This step will compute 3D reconstructions for each class, 
    as classified in the last iteration of multi-reference alignment. </P></LI>
	<UL>
		<LI>BATCH FILE: <a href="bpclass.rct">bpclass.rct</a> </LI>
		<LI>INPUTS: <B>Zerodegr/Multiref2/listrefs</B>, <B>Zerodegr/Multiref2/goodsel***</B>, 
		    <B>Tilted/dang-store</B>, <B>Tilted/Aligned/cent*****</B> </LI>
		<LI>OUTPUTS: <B>Volumes/vcla***</B> </LI>
<!-- 		<LI>details</LI> -->
	</UL>

<LI><P>Filter one or all 3D reconstructions</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="volfilt.rct">volfilt.rct</a> </LI>
		<LI>PARAMETERS:</LI>
		  <UL>
		    <LI><I>[single-class]</I> -- The default value of <I>0</I> will filter all class volumes. 
d906 4
a909 4
		        enter the number of that class.</LI>
		    <LI><I>[header-type]</I>, <I>[header-param1]</I>, <I>[header-param2]</I> -- 
		        parameters for the Fourier filter</LI>
		    <LI><I>[override-yn]</I> -- if pre-existing doc file <B>docvolfilt</B> exists 
d912 5
a916 5
		        will use the values in the docfile instead</LI>
		  </UL>
		<LI>INPUTS: <B>Zerodegr/Multiref2/listrefs</B>, <B>Volumes/vcla***</B> </LI>
		<LI>OUTPUTS: <B>Volumes/vflt***</B>, <B>Volumes/docvolfilt</B> </LI>
		<LI>The output doc file <B>docvolfilt</B> contains a record of 
d919 2
a920 2
		    the filter parameters from this editable file will be used. </LI>
	</UL>
d922 1
a922 1
<LI><P>Align volumes to each other</P>
d924 1
a924 1
    <P>Skip this step if you have a single class.</P>
d926 1
a926 1
    <P>This batch file aligns two volumes to each other.
d929 1
a929 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/pj3q.html">'PJ 3Q'</a>,
d931 1
a931 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>
d933 1
a933 1
    </P>
d935 29
a963 29
    <UL>
	<LI>BATCH FILE: <a href="volalignprj.rct">volalignprj.rct</a> </LI>
	<LI>SUBROUTINE: <a href="montageprj.rct">montageprj.rct</a> </LI>
	<LI>PARAMETERS:</LI>
	  <UL>
	    <LI><I>[exp-num]</I> -- the number for the experimental volume to align</LI>
	    <LI><I>[ref-num]</I> -- the number for the reference volume</LI>
	    <LI><I>[num-solns]</I> -- number of initial alignment solutions to compare 
	        -- multiple initial solutions may converge to the same refined solution</LI>
	    <LI><I>[dtheta]</I> -- angular increment for initial search, as in
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/refproj.spi">
		refproj.spi</a>.</LI>
	    <LI><I>[shift-range]</I>,<I>[shift-step]</I>,<I>[first-ring]</I> -- 2D search parameters for 
	        <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsh.html">'AP SH'</a>, as in
		<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
		apsh.spi</a>.</LI>
	  </UL>
	<LI>INPUTS: <B>Volumes/vcla***</B> (reference and experimental volume to align) </LI>
	<LI>OUTPUTS:</LI>
	  <UL>
	    <LI><B>prj_***</B> -- re-projection stacks </LI>
	    <LI><B>dalv***</B> -- alignment parameters for each solution requested</LI>
	    <LI><B>vali***</B> -- aligned class volume</LI>
	    <LI><B>mproj***</B> -- comparison of reference projection versus 
	        initial and refined alignments, for each solution requested</LI>
	    <LI><B>list2merge</B> -- running list of aligned classes with preferred alignment solution
	        -- more below</LI>
	  </UL>
    </UL>
d965 1
a965 1
    <P>The first row of each slice in <B>mproj***</B> shows the reference projection. 
d969 1
a969 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/or3q.html">'OR 3Q'</a>.</P>
d971 2
a972 2
    <P>If the better alignment solution is not solution #1, then 
       edit in <B>list2merge</B> column #2, labelled <I>SOLUTIONNUM</I>.  
d974 1
a974 1
       set this value to <I>0</I> in <B>list2merge</B>.</P>
d976 2
a977 2
    <P>The re-projections <B>prj_***</B> will illustrate the missing-cone artifact better than 
       isosurface presentations.</P>
d979 12
a990 12
<LI><P><I>(optional)</I> Merged particles from aligned class volumes into one reconstruction</P></LI>
    <UL>
	<LI>BATCH FILE: <a href="mergevols.rct">mergevols.rct</a> </LI>
	<LI>INPUTS: <B>dang-store</B>, <B>list2merge</B>, <B>dalv***</B>, 
	    <B>goodsel***</B>, <B>cent*****</B> </LI>
	<LI>OUTPUTS:</LI> <B>Volumes/vali***</B>, <B>Volumes/docvolangles</B> 
	  <UL>
	    <LI><B>dang-merged</B> -- combines particles' Euler angles with class-volume alignment angles </LI>
	    <LI><B>mergedsel</B> -- particle-selection file from merged classes </LI>
	    <LI><B>vtot999</B> -- merged volume </LI>
	  </UL>
	</UL>
d992 2
a993 2
    <P>If the parameter <I>[classvols-yn]</I> is set to 1, 
       volumes for each class will be reconstructed of the form <B>vtot***</B>,
d995 1
a995 1
       They should look very similar to the <B>vali***</B> reconstructions from the previous step, 
d997 1
a997 1
       in this case the volume will have undergone one fewer interpolation.</P>
d999 2
a1000 2
    <P>You will probably want to filter the reconstruction(s) from this step. 
       Edit <a href="volfilt.rct">volfilt.rct</a> to operate on the <B>vtot***</B> volume(s).</P>
d1003 4
a1006 4
<LI><P>Prepare files for reference-based alignment</P></LI>
	<UL>
		<LI>Before running this step, download the reference-based alignment tarball and untar it by typing:
		    <PRE>tar -zxvf spiproject.tar.gz</PRE>
d1008 6
a1013 6
		If you rename that directory, remember to change the output in this ensuing batch file accordingly.</LI>
		<LI>BATCH FILE: <a href="prepare-prjmatch.rct">prepare-prjmatch.rct</a> </LI>
		<LI>INPUTS: <B>lots</B> </LI>
		<LI>OUTPUTS: <B>lots</B> </LI>
		<LI><P>This batch file will copy information in a form that can be understood by the 
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html">
d1016 1
a1016 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html#SH">
d1018 2
a1019 2
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/sel_by_group.spi">
		    sel_by_group.spi</a>. </P>
d1021 1
a1021 1
		    <P>We have not (yet) implemented CTF-correction for the tilted-specimen particle images 
d1026 1
a1026 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apshgrp.spi">
d1028 1
a1028 1
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
d1030 32
a1061 32
		    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/newprogs/apsh.spi">
		    apsh.spi</a>).</P></LI>
	</UL>

<HR>

<B><P>Miscellaneous batch files</P></B>

<LI><P>Projection onto convex sets</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="batchlink">batchname</a> </LI>
		<LI>INPUTS: <B>input</B> </LI>
		<LI>OUTPUTS: <B>output</B> </LI>
		<LI>details</LI>
	</UL>

<!--<LI><P>DESCRIPTION</P></LI>
	<UL>
		<LI>BATCH FILE: <a href="batchlink">batchname</a> </LI>
		<LI>INPUTS: <B>input</B> </LI>
		<LI>OUTPUTS: <B>output</B> </LI>
		<LI>details</LI>
	</UL>-->


</UL>

<HR>

<B><P>References</P></B>
<OL>
    <LI>
d1065 3
a1067 2
        <I>J Microsc.</I>  <B>146</B>:113-36.</LI>
    <LI>Shaikh TR, Gao H, Baxter WT, Asturias F, Boisset N, Leith A, and Frank J. (2008) 
d1069 3
a1071 2
        <I>Nature Protocols</I> <B>3</B>: 1941-74.</LI>
    <LI>Huang T, Shaikh TR, Gupta K, Contreras-Martin LM, Grassucci RA, Van Duyne GD, Frank J, Belfort M .
d1073 2
a1074 2
        <I>Nucleic Acids Res.</I> <B>39</B>: 2845-54.</LI>
</OL>
d1076 1
a1076 1
<HR>
d1078 2
a1079 2
</BODY>
</HTML>
@
