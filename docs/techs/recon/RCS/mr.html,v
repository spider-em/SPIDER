head	1.124;
access;
symbols;
locks; strict;
comment	@# @;


1.124
date	2025.03.26.00.46.41;	author dean;	state Exp;
branches;
next	1.123;

1.123
date	2019.02.13.18.44.01;	author leith;	state Exp;
branches;
next	1.122;

1.122
date	2019.02.13.16.57.38;	author leith;	state Exp;
branches;
next	1.121;

1.121
date	2019.01.16.19.28.44;	author leith;	state Exp;
branches;
next	1.120;

1.120
date	2019.01.16.16.52.02;	author leith;	state Exp;
branches;
next	1.119;

1.119
date	2016.08.25.17.37.29;	author leith;	state Exp;
branches;
next	1.118;

1.118
date	2016.06.20.17.08.28;	author leith;	state Exp;
branches;
next	1.117;

1.117
date	2014.08.05.14.41.36;	author leith;	state Exp;
branches;
next	1.116;

1.116
date	2014.04.02.18.38.38;	author leith;	state Exp;
branches;
next	1.115;

1.115
date	2014.01.18.20.19.42;	author leith;	state Exp;
branches;
next	1.114;

1.114
date	2013.12.12.14.15.37;	author leith;	state Exp;
branches;
next	1.113;

1.113
date	2013.12.12.14.09.54;	author leith;	state Exp;
branches;
next	1.112;

1.112
date	2013.02.25.14.49.28;	author leith;	state Exp;
branches;
next	1.111;

1.111
date	2013.02.07.15.21.46;	author leith;	state Exp;
branches;
next	1.110;

1.110
date	2013.01.30.13.29.36;	author leith;	state Exp;
branches;
next	1.109;

1.109
date	2013.01.14.14.52.47;	author leith;	state Exp;
branches;
next	1.108;

1.108
date	2012.11.08.13.08.33;	author leith;	state Exp;
branches;
next	1.107;

1.107
date	2012.07.16.16.26.55;	author leith;	state Exp;
branches;
next	1.106;

1.106
date	2012.06.22.18.04.25;	author tapu;	state Exp;
branches;
next	1.105;

1.105
date	2012.06.21.18.45.15;	author leith;	state Exp;
branches;
next	1.104;

1.104
date	2012.05.23.15.58.06;	author leith;	state Exp;
branches;
next	1.103;

1.103
date	2012.05.07.14.25.45;	author leith;	state Exp;
branches;
next	1.102;

1.102
date	2012.05.04.17.45.07;	author leith;	state Exp;
branches;
next	1.101;

1.101
date	2012.04.12.16.44.01;	author leith;	state Exp;
branches;
next	1.100;

1.100
date	2012.04.11.15.40.46;	author leith;	state Exp;
branches;
next	1.99;

1.99
date	2012.04.11.15.33.54;	author leith;	state Exp;
branches;
next	1.98;

1.98
date	2012.04.11.02.22.41;	author tapu;	state Exp;
branches;
next	1.97;

1.97
date	2012.04.10.15.40.51;	author leith;	state Exp;
branches;
next	1.96;

1.96
date	2012.04.02.17.27.53;	author leith;	state Exp;
branches;
next	1.95;

1.95
date	2011.02.01.19.08.42;	author leith;	state Exp;
branches;
next	1.94;

1.94
date	2010.11.03.19.19.36;	author leith;	state Exp;
branches;
next	1.93;

1.93
date	2010.09.30.13.40.15;	author leith;	state Exp;
branches;
next	1.92;

1.92
date	2010.09.15.18.47.59;	author leith;	state Exp;
branches;
next	1.91;

1.91
date	2010.09.15.13.43.33;	author leith;	state Exp;
branches;
next	1.90;

1.90
date	2010.07.19.15.52.51;	author leith;	state Exp;
branches;
next	1.89;

1.89
date	2010.01.19.16.22.17;	author leith;	state Exp;
branches;
next	1.88;

1.88
date	2009.12.22.16.37.23;	author leith;	state Exp;
branches;
next	1.87;

1.87
date	2009.12.22.13.16.18;	author leith;	state Exp;
branches;
next	1.86;

1.86
date	2009.12.03.13.18.41;	author leith;	state Exp;
branches;
next	1.85;

1.85
date	2009.04.08.13.51.37;	author leith;	state Exp;
branches;
next	1.84;

1.84
date	2009.03.09.16.26.26;	author leith;	state Exp;
branches;
next	1.83;

1.83
date	2008.12.03.13.52.58;	author leith;	state Exp;
branches;
next	1.82;

1.82
date	2008.05.29.15.49.16;	author bbaxter;	state Exp;
branches;
next	1.81;

1.81
date	2007.04.05.13.38.39;	author leith;	state Exp;
branches;
next	1.80;

1.80
date	2007.03.20.13.12.46;	author leith;	state Exp;
branches;
next	1.79;

1.79
date	2007.02.02.14.39.13;	author leith;	state Exp;
branches;
next	1.78;

1.78
date	2007.01.26.19.46.48;	author leith;	state Exp;
branches;
next	1.77;

1.77
date	2007.01.22.15.42.35;	author leith;	state Exp;
branches;
next	1.76;

1.76
date	2007.01.17.16.46.19;	author leith;	state Exp;
branches;
next	1.75;

1.75
date	2006.09.22.14.09.18;	author leith;	state Exp;
branches;
next	1.74;

1.74
date	2006.08.29.20.48.11;	author bimal;	state Exp;
branches;
next	1.73;

1.73
date	2005.12.15.15.57.46;	author bimal;	state Exp;
branches;
next	1.72;

1.72
date	2005.10.22.22.17.58;	author bbaxter;	state Exp;
branches;
next	1.71;

1.71
date	2005.07.27.18.58.54;	author bimal;	state Exp;
branches;
next	1.70;

1.70
date	2005.07.26.20.30.38;	author bimal;	state Exp;
branches;
next	1.69;

1.69
date	2005.07.26.18.34.56;	author bimal;	state Exp;
branches;
next	1.68;

1.68
date	2005.07.08.12.27.56;	author leith;	state Exp;
branches;
next	1.67;

1.67
date	2005.07.01.16.01.37;	author bbaxter;	state Exp;
branches;
next	1.66;

1.66
date	2005.04.04.14.27.59;	author leith;	state Exp;
branches;
next	1.65;

1.65
date	2005.02.04.15.22.32;	author leith;	state Exp;
branches;
next	1.64;

1.64
date	2005.01.12.16.57.48;	author bbaxter;	state Exp;
branches;
next	1.63;

1.63
date	2004.12.30.21.11.38;	author leith;	state Exp;
branches;
next	1.62;

1.62
date	2004.12.10.15.30.10;	author bbaxter;	state Exp;
branches;
next	1.61;

1.61
date	2004.12.10.13.53.07;	author bbaxter;	state Exp;
branches;
next	1.60;

1.60
date	2004.12.01.17.57.15;	author bbaxter;	state Exp;
branches;
next	1.59;

1.59
date	2004.11.23.14.28.48;	author bbaxter;	state Exp;
branches;
next	1.58;

1.58
date	2004.11.10.15.43.43;	author bbaxter;	state Exp;
branches;
next	1.57;

1.57
date	2004.11.09.20.08.04;	author leith;	state Exp;
branches;
next	1.56;

1.56
date	2004.11.02.20.08.27;	author bbaxter;	state Exp;
branches;
next	1.55;

1.55
date	2004.10.28.19.01.09;	author bbaxter;	state Exp;
branches;
next	1.54;

1.54
date	2004.09.17.18.54.40;	author bbaxter;	state Exp;
branches;
next	1.53;

1.53
date	2004.08.11.13.36.07;	author bbaxter;	state Exp;
branches;
next	1.52;

1.52
date	2004.08.10.19.15.48;	author bbaxter;	state Exp;
branches;
next	1.51;

1.51
date	2004.08.09.20.42.39;	author bbaxter;	state Exp;
branches;
next	1.50;

1.50
date	2004.08.09.14.58.56;	author bbaxter;	state Exp;
branches;
next	1.49;

1.49
date	2004.08.07.21.04.36;	author bbaxter;	state Exp;
branches;
next	1.48;

1.48
date	2004.08.06.20.31.33;	author bbaxter;	state Exp;
branches;
next	1.47;

1.47
date	2004.08.03.21.26.48;	author bbaxter;	state Exp;
branches;
next	1.46;

1.46
date	2004.08.03.16.28.35;	author leith;	state Exp;
branches;
next	1.45;

1.45
date	2004.08.03.13.41.08;	author bbaxter;	state Exp;
branches;
next	1.44;

1.44
date	2004.07.29.14.17.24;	author leith;	state Exp;
branches;
next	1.43;

1.43
date	2004.06.30.16.27.37;	author bbaxter;	state Exp;
branches;
next	1.42;

1.42
date	2004.06.30.14.20.47;	author bbaxter;	state Exp;
branches;
next	1.41;

1.41
date	2004.06.25.17.56.38;	author bimal;	state Exp;
branches;
next	1.40;

1.40
date	2004.06.10.21.34.37;	author bbaxter;	state Exp;
branches;
next	1.39;

1.39
date	2004.06.04.15.47.40;	author bbaxter;	state Exp;
branches;
next	1.38;

1.38
date	2004.06.04.14.49.41;	author leith;	state Exp;
branches;
next	1.37;

1.37
date	2004.06.03.16.34.52;	author bbaxter;	state Exp;
branches;
next	1.36;

1.36
date	2004.06.03.15.15.10;	author leith;	state Exp;
branches;
next	1.35;

1.35
date	2004.06.02.20.49.40;	author bbaxter;	state Exp;
branches;
next	1.34;

1.34
date	2004.06.02.15.04.10;	author leith;	state Exp;
branches;
next	1.33;

1.33
date	2004.06.01.19.34.58;	author leith;	state Exp;
branches;
next	1.32;

1.32
date	2004.06.01.15.28.56;	author leith;	state Exp;
branches;
next	1.31;

1.31
date	2004.05.27.14.22.50;	author leith;	state Exp;
branches;
next	1.30;

1.30
date	2004.04.28.19.46.50;	author leith;	state Exp;
branches;
next	1.29;

1.29
date	2004.04.23.17.49.05;	author leith;	state Exp;
branches;
next	1.28;

1.28
date	2004.04.20.16.58.03;	author leith;	state Exp;
branches;
next	1.27;

1.27
date	2004.04.19.19.28.58;	author leith;	state Exp;
branches;
next	1.26;

1.26
date	2004.04.19.16.34.45;	author leith;	state Exp;
branches;
next	1.25;

1.25
date	2004.03.29.18.40.34;	author leith;	state Exp;
branches;
next	1.24;

1.24
date	2004.03.29.15.32.03;	author leith;	state Exp;
branches;
next	1.23;

1.23
date	2004.03.10.16.23.33;	author bbaxter;	state Exp;
branches;
next	1.22;

1.22
date	2004.01.28.19.15.53;	author bbaxter;	state Exp;
branches;
next	1.21;

1.21
date	2004.01.07.22.00.33;	author bimal;	state Exp;
branches;
next	1.20;

1.20
date	2004.01.06.19.34.32;	author bimal;	state Exp;
branches;
next	1.19;

1.19
date	2004.01.06.19.22.06;	author bimal;	state Exp;
branches;
next	1.18;

1.18
date	2003.11.18.20.49.48;	author bbaxter;	state Exp;
branches;
next	1.17;

1.17
date	2003.10.09.22.04.02;	author bbaxter;	state Exp;
branches;
next	1.16;

1.16
date	2003.07.31.16.54.01;	author bbaxter;	state Exp;
branches;
next	1.15;

1.15
date	2003.07.29.21.17.25;	author bbaxter;	state Exp;
branches;
next	1.14;

1.14
date	2003.07.29.20.22.20;	author bbaxter;	state Exp;
branches;
next	1.13;

1.13
date	2003.07.29.16.26.16;	author bbaxter;	state Exp;
branches;
next	1.12;

1.12
date	2003.07.24.18.46.40;	author leith;	state Exp;
branches;
next	1.11;

1.11
date	2003.07.24.17.44.24;	author bbaxter;	state Exp;
branches;
next	1.10;

1.10
date	2003.07.24.17.30.00;	author bbaxter;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.16.19.06.35;	author leith;	state Exp;
branches;
next	1.8;

1.8
date	2003.04.23.16.09.32;	author leith;	state Exp;
branches;
next	1.7;

1.7
date	2003.04.16.14.48.25;	author leith;	state Exp;
branches;
next	1.6;

1.6
date	2003.04.09.20.30.44;	author bbaxter;	state Exp;
branches;
next	1.5;

1.5
date	2003.04.02.19.44.05;	author leith;	state Exp;
branches;
next	1.4;

1.4
date	2003.03.26.21.37.17;	author leith;	state Exp;
branches;
next	1.3;

1.3
date	2003.03.18.22.08.20;	author bbaxter;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.10.15.37.23;	author leith;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.07.17.31.19;	author leith;	state Exp;
branches;
next	;


desc
@@


1.124
log
@links
@
text
@<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>

<head>
  <title>Single Particle Reconstruction Techniques</title> 
  <link rel='stylesheet' href='mrstyle.css' type='text/css' />
</head>

<body link="#0000ee" vlink="#0000ee" alink="#ff0000" bgcolor="#cccccc">

<br />

<table class="top" width = "100%" border="8" bordercolor="#99ccff">
   <tr>
   <td  align="left">
   <img width="108" height="103" src="pics/new11.jpg" align="left"></td>

   <td>
   <h2 class="top">Three Dimensional Reconstruction of Single Particle 
       Specimens using Reference Projections With Defocus Groups</h2>
   </td>

   <td  align="right">
   <img width="108" height="104" src="pics/new22.jpg" align="right"></td>
   </tr>
</table>
<p />

<!-- xxxxxxxxxxxxxxxxxxxxxxxx Introduction xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<h3 align="center">Introduction</h3>

<P>
This page describes methods for creating a 3D reconstruction from electron micrographs 
using defocus groups. 
Once a set of particle images has been obtained, 
an initial 3D reconstruction is calculated using coarse projection angles. 
This is followed by refinement, which iteratively adjusts the angles for finer resolution. 
The CTF is accounted for by computing reconstructions of groups of particles from micrographs 
with simlar defocus values ("defocus groups"), and
CTF-correction is performed when these reconstructions are merged.
</p>

<p>
An alternative method is available for 
<a href="../recon1a/Docs/mr1.html">
creating a 3D reconstruction from electron micrographs without defocus groups</a>. 
The advantages of using defocus groups is as follows. 
First is that it can readily account for the non-uniform distribution of 
signal-to-noise in projection data (<a href="#PP12">Penczek, 2012</a>).  
Second, we find that reconstructions using particle-level CTF-correction 
sometimes show artifacts when using iterative backprojection methods, such as 
<a href="../../man/bprp.html"> <b>'BP RP'</b></a> or
<a href="../../man/bpcg.html"> <b>'BP CG'</b></a>, 
whereas the use of defocus groups does not present such limitations.  However most
laboratories have abandoned the use of defocus groups. 
</p>

<p>
In comparison, CTF-correction is applied at the level of windowed particle images offers 
its own advantages.  
First, it circumvents one of the approximations when using defocus groups, namely that 
all particle in a defocus group follow the same CTF profile.  At high resolution,
where the CTF oscillates more rapidly, this assumption will not hold.  
Second, parallelization can be more efficient, since groups can be of identical 
size, independent of the number of particles at each defocus.  Third, particles 
from what would be sparsely populated defocus groups need not be thrown out.  
Lastly, interoperability with other software packages which correct for the CTF at 
the level of particle images will be more straightforward.
</p>

<p>The procedures are described in greater detail below.</p>

<p />

<hr />

<!-- --------------------- Outline ------------------------------------ -->

<a name="Links">
<table class="heading" width="100%" >
   <p />  
   <tr> <td> <h3 class="heading">Outline</h3> </td> </tr>
</table>
</a>
<p />
<p />

<dl>

  <dt> <a href="#CTF">Contrast Transfer Function (CTF) Estimation</a> </dt>
  <dd>The CTF is estimated for each micrograph, and the micrographs 
     are sorted into defocus groups.</dd>

  <dt> <a href="#AUTO">Particle Picking and Selection</a> </dt> 
  <dd>Identifies likely particles from the micrographs, 
     and extracts windowed images of individual particles from the micrographs.</dd>

  <dt> <a href="#SH">Alignment</a> </dt>
  <dd>The particle images are aligned to reference projections using shifts 
      and rotations.</dd>

  <dt> <a href="#CA">Averaging</a> </dt>
  <dd>The averages of each reference view are computed, to assess the distribution 
      of projection views.</dd>

  <dt> <a href="#3D">3D Reconstruction</a></dt>
  <dd>An initial volume is calculated by back projection, along with an estimate 
      of its resolution.</dd>

  <dt> <a href="#REF">Refinement</a> </dt>
  <dd>Initial alignments are iteratively improved, as each projection is given a
      chance "to find a better home" in terms of its orientation and phase
      origin, thus improving the resolution of the initial reconstruction.</dd>

  <dt> <a href="#OTHER">Additional methods</a> </dt>
  <dd>Other useful methods, such as classification, difference maps, and 
      frequency correction by X-ray scattering.  Additional details about these 
      methods may be found at the <a href="../../techniques.html">techniques</a> page.</dd>

</dl>
 
<p \>

<a name="Links"></a>
<table class="heading" width="100%" >
   <tr> <td> <p />
   <h3 class="heading">Links to further information</h3> 
   <p /> </td> </tr>
</table>
<p />

<ul>
  <li> <a href="../../../glossary.html"> Glossary</a>.                              </li>

  <li> <a href="../../../strategies.html">Reconstruction strategies</a>.            </li>

  <li> <a href="flowchart/flowchart.html">Flowchart of operations</a>.              </li>
  
  <li> <a href= "mr1_verify.html">Classification-based particle verification</a>.   </li>
  
  <li> <a href="docfiles.html">Format information for doc files</a>.                </li>
  
  <li> <a href="../Docs/params.html">Description of reconstruction parameters</a>.  </li>
  
  <li> <a href="../zi/zidoc.html">Using images from a ZI scanner</a>.               </li>

  <li> <a href="quantifoil.html">Handling circular images from Quantifoil grids</a>.</li>
  
  <li> <a href="#Refs">References</a>.</li>

</ul>


<p />

<hr>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxx Running  SPIDER procedure files xxxxxxxxxxxxxxxxxx -->

<a name="RunningSPIDER"></a>
<table class="heading" width="100%" >
   <tr> <td>    <br />  
   <h3 class="heading">Running SPIDER procedure files</h3>
   </td> </tr>
</table>

<p />
In the sections below, various file types are denoted by different fonts:

<ul>
<li><b>Each step in the process is bold and marked  by a bullet</b><br />
   <a href="./newprogs">procedure files</a> are links to the procedure script, <br />
   <font class="input">input files</font> for that procedure are marked in pink, <br />
   <code class="output">output files</code> created by that procedure are marked in green., <br />
   Sometimes more than one approach is available. 
   Lists starting with lowercase letters indicate that you should choose

   <ol class="choice">
      <li>one approach, or</li>
      <li>the other approach,</li>
   </ol>
   but not both (unless you want to compare the two techniques) <br />

   <p />

   If you have <a href="https://spider-em.github.io/spire/tools-docs/install.html">installed</a> them,   
   <a href="https://spider-em.github.io/spire/tools-docs/tools.html"> SPIDER's Python Tools</a>   
   <font class="guitool"> (marked in brown)</font>  
   are usefull for analyzing some results. 
</li>
</ul>
<p />

There are two different choices for running SPIDER procedures: Using 
<a href="https://spider-em.github.io/spire/spire-docs/index.html">
<font class="guitool">SPIRE</font></a> 
or using SPIDERprocedures directly.

<p />

<ol class="choice">
   <li> If you are using  
   <a href="https://spider-em.github.io/spire/spire-docs/index.html"> 
   <font class="guitool">SPIRE</font></a>, then read 
   <a href="mrspire.html">how to run SPIDER procedure files in SPIRE</a>. 
   <font class="guitool">SPIRE</font> will create the necessary 
   top level directory. </li>
   <p />

   <li> If you are running SPIDER at the Unix prompt the processing steps are 
   carried out by procedure files,
   which run many SPIDER operations automatically. To use a procedure
   in this document, click the procedure filename and copy the procedure
   to your current working directory. At the beginning of each
   procedure, there is a list of parameters that can be adjusted
   according to the particular project. Some of the procedures will
   call additional procedure(s) (listed below the procedure
   filename). You need not change anything in the procedures. Use the
   following format to run a SPIDER procedure: <br />

   <code class="snippet">spider spi/dat @@proc</code> <br />
   
   where <code class="snippet">spi</code> is the procedure file extension, 
   <code class="snippet">dat</code>       is the project data file extension, and 
   <code class="snippet">proc.spi</code>  is the procedure file.
  </li>
</ol>

<p />
   The data below are sometimes shown plotted with <i>gnuplot</i>.  See the
   <a href="http://www.gnuplot.info/">Gnuplot manual</a> 
<p />


<h4>After each SPIRE step or after running each procedure file, check the 
  output files to make sure the results are sensible. If you are not sure what is
  "sensible", ask an expert.</h4> 
</p>


<hr />
<!-- xxxxxxxxxxxxxxxxx Creating new reconstruction project xxxxxxxxxxxxxxxxxxxxx -->

<a name="CreatingProject"></a>

<table class="heading" width="100%" >
   <tr> <td>    <br />
   <h3 class="heading">Creating new reconstruction project</h3>

   <p class="explain">At the start of a reconstruction project, a project 
   directory should be set up with the proper subdirectories and procedure files. </p>

   <p>These procedures should be run in the <i>project</i> directory.   </p>
   </td> </tr>
</table>

   <p />

   <ul>
   <li><p class="action">Create a project directory containing the required 
   subdirectories and procedure files                                 </li> 

   <ol class="choice">
   <li> If using SPIRE it will create the necessary top level directory and populate 
   the directories with the current set of procedure files.          </li>

   <p />

   <li> If using SPIDER procedures, the procedure files below are packed into the 
   zipped tar file <a href="./spiproject.tar.gz">spiproject.tar.gz</a>  
   Copy this archive to your working directory and unpack it:           <br />
   <b><code>tar -zxvf spiproject.tar </code> </b>                       <br />
   This will create a directory called <i>myproject</i>, containing 
   the procedure files and subdirectories for a reconstruction project. Rename 
   <i>myproject</i> to the name of your project directory, usually the same three letters 
   as the data extension, e.g.:                                          <br />
   <b><code>mv myproject acn</code></b> 
   </li>

   <p />

   <!-- SPIRE directory=_top_level_project -->

   <a name="PROTOCOLS"></a>
   <li><small>
    <p class="action"> If using data from Nature Protocols for testing, 
    you can untar the data set and use the directory structure as your project directory.</p>
 
    The data from the tar archive will then be already in place. However you must replace 
    the procedures from the data set and 
    stack the particle images before using the set of current procedures. The procedure 
    <a class="project" href="./newprogs/nat2stk.spi">nat2stk.spi</a> 
    reads <font class="input">win/ser******</font>,
    <font class="input">../sel_micrograph</font>, 
    <font class="input">good/ngood***</font>, and
    <font class="input">order_select</font> 
    to stack images by defocus groups and creates: <br />
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
         <td><code class="output">Alignment/data***</code>: </td>
         <td>Stacks of particle images.</td></tr>
      <tr valign="top"><td>&curren;</td>
         <td><code class="output">Alignment/sel_particles_***</code>: </td>
         <td>Lists of particle images by group.</td></tr>
      <tr valign="top"><td>&curren;</td>
         <td><code class="output">Alignment/sel_group</code>: </td>
         <td>Group selection doc file.</td></tr>
   </table>
   It also renames the data set's micrograph files as necessary. </li>
</small>
</li>
</ol>

<p />

<li><p class="action">Create a parameter document file</p>

   Some information is stored in project-wide document files that are used 
   by many procedure files.
   Run the interactive procedure 
   <a class="project" href="./newprogs/makeparams.spi">makeparams.spi</a> 
   in the top directory of your project. It makes a document file: <br />
   <table class="outs">
      <tr valign="top">  <td>&curren;</td>
          <td><code class="output">params</code>:</td>
          <td>A doc. file containing the 
             <a href="./params.html">reconstruction parameters</td> 
      </tr>
   </table>
</li>
<p />

<p class="action">[<b>Optional</b>] Resize reference volume</p>
<p>   <li>A reference volume is required. If the pixel size of your reference 
   volume (key 5 in the <font class="input">params</font> file) and/or the 
   dimensions do not match the dimensions of the data that you will be
   processing, then you must run the procedure 
   <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>
   in the top-level project directory to resize the volume. This creates:  <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">reference_volume</code>: </td>
          <td>&nbsp; Resized reference volume.</td></tr>
   </table>
   The reported interpolated pixel size may not exactly match the target 
   pixel size due to rounding errors, but the values should be close.
   </li>
</p>


<li><p class="action">Place micrograph files in  <i>Micrographs</i> directory</p>

<p> Files of the digitized micrographs should be placed in the <i>Micrographs</i> 
   directory if they are not already there. 
   For example:  <br />
   <code class="snippet">mv  /actual/location/of/micrographs/raw* &nbsp; Micrographs/ </code></p>

<p>The procedures below can accept 
   SPIDER, Hiscan TIFF, PerkinElmer, ZI, and Nikon Coolscan outputs.  
   Any of these files may have been compressed with 
   <i>gzip</i>.  Because micrographs require so much disk space, it may be desirable to 
   keep the Micrographs in another location, and make <i>Micrographs</i> a 
   symbolic link. In that case, 
   <code>cd</code> to your project directory, remove <i>Micrographs</i>, and 
   make a symbolic link:  <br />
   <b><code>rmdir Micrographs</code></b> <br />
   <b><code>ln -s  /the/actual/location/of/the/micrographs &nbsp; Micrographs </code></b>
</li>
</p>
</ul>

<hr />
<!-- ------------------- Selecting micrographs ------------------- -->

<a name="Micrographs"></a>
<table class="heading" width="100%" >
   <tr> <td>    <br />
   <h3 class="heading">Selecting micrographs</h3>

   <p class="explain">Generate a list of micrographs and screen the micrographs.</p>

   <p>These procedures should be run in the <i>Micrographs/ </i> directory.   </p>
   </td> </tr>
</table>

<ul>
 
<li><p class="action">Create a selection doc file for micrograph file numbers</p>

   The procedure
   <a class="project" href="./newprogs/makefilelist.spi">makefilelist.spi</a>  
   creates a micrograph selection doc file containing non-consecutive file numbers in 
   the top-level project directory: <br/>

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">sel_micrograph</code>:</td>
          <td>Micrograph selection doc file listing the numbers of 
             the micrograph files to be processed. </td> </tr>
   </table>
   The  text part of the filenames are entered as templates in the top 
   level procedure files - see below).  If you need to add/exclude
   files from this list, use a text editor to edit the appropriate
   lines, then use the <a href="../../man/docren.html"><b>'DOC REN'</b></a> 
   operation in SPIDER to renumber lines in the selection doc file.
</li>
<p />


</ul>


<hr />

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx CTF  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --> 

<a name="CTF"></a> 

<table class="heading" width="100%"><tr><td>              <br />
   <h3 class="heading">Contrast Transfer Function estimation</h3>

   <p class="explain">Estimate the defocus of each micrograph by calculating its 
   power spectrum. Then group the micrographs into groups of similar defocus.
   </p>

   <p>These procedures should be run in the <i>Power_Spectra</i> directory.  <br />
</td></tr>
</table>

<!-- SPIRE directory=Power_Spectra subdirectories=power -->
 <p>
 For more information, see;

 <ul class="options">
    <li> <a href="../ctf/ctf.html">Contrast transfer function correction</a> tutorial. </li>
    <li> <a href="https://spider-em.github.io/spire/tools-docs/ctfdemo.html">
         <font class="guitool">ctfdemo</font></a>, a program that demonstrates 
         the effects of various parameters on the CTF.                              </li>
    <li> <a href="#PP97">Penczek et al. 1997</a> for a fuller discussion.           </li>
  </ul>
  </p>

<ul>
<a name="DEF"></a>

<li><p class="action"> Calculate the power spectrum for each micrograph and
   determine defocus using one of the following three methods</p> 

<ol class="choice">

<li> Use SPIDER procedure:
   <a class="project" href="./newprogs/powdefocus.spi">powdefocus.spi</a> which
   calls SPIDER procedure  
   <a class="project" href="./newprogs/loadmic.spi">loadmic.spi</a>
   to read each micrograph, computes an averaged power spectrum, and estimates defocus
   using SPIDER operation: 
   <a href="../../../docs/man/ctfed.html"><b>'CTF ED'</b></a>. 
  This creates four  output files for each micrograph: 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">power/pw_avg****</font> </td>
          <td>2D power spectra, each is an average of many smaller
              power spectra calculated over the surface of the micrograph. </td> </tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">power/roo****</font></td>
          <td>Doc files of 1D profiles of the rotationally averaged power spectra.  
          These doc files can be plotted with <b>gnuplot</b> or 
          <a href="../../../tools/docs/pyplot.html">
          <font class="guitool">pyplot</font></a> </td>  </tr>

       <tr valign="top"> <td>&curren;</td>
          <td><font class="output">power/ctf****</font>: </td>
          <td>Doc files of the background-subtracted 1D power spectra.</td></tr>

       <tr valign="top"> <td>&curren;</td>
          <td><font class="output">defocus</font>:</td>
          <td>A doc file of defocus and astigmatism values.</td></tr>
   </table>

   The <font class="output">ctf****</font> files can be verified with 
   <a href="../../../tools/docs/ctfmatch.html">
   <font class="guitool">ctfmatch.py</font></a>
</li>
<p />
 

<li> Use SPIDER procedure:
   <a class="project" href="./newprogs/ctffind.spi">ctffind.spi</a> 
   to read each micrograph using
   <a class="project" href="./newprogs/loadmic.spi">loadmic.spi</a>,
   compute an averaged power spectrum, and estimate defocus, 
   astigmatism, and cut-off frequency using SPIDER operation 
   <a href="../../man/ctffind.html"><b>'CTF FIND'</b></a>.
   This invokes the MRC 
   <a href="http://emlab.rose2.brandeis.edu/software">ctffind3</a> 
   program and creates two  output files for each micrograph: 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">power/powchk***</code> </td>
          <td>2D power spectra, each is an average of many smaller
              power spectra calculated over the surface of the 
              micrograph and half is replaced by an idealized
              power spectrum. </td> </tr>

       <tr valign="top"> <td>&curren;</td>
          <td><code class="output">defocus</code>:</td>
          <td>A doc file of defocus and astigmatism values.</td></tr>
   </table>

<li>Run <a href="./newprogs/powdefocus.spi">powdefocus.spi</a> 
    as in <b>a.</b> to create power spectra: 
    <font class="input">power/roo***</font>.  Then use  
    <a href="https://spider-em.github.io/Web/docs/ctf.html">CTF from doc file</a>
    in <b>WEB</b> to read <font class="input">power/roo***</font> 
    and  manually fit a CTF model to the 1D profiles.
</li>
<p />

</ol>
<p />

<li>
   <p class="action">Check the rings in the power spectrum images.</p>

   <p>
   Make a montage using <a href="https://spider-em.github.io/Web/docs/web.html">WEB</a> 
   (reduction factor 4) to
   look at these power spectra. They are equivalent to diffraction
   patterns obtained in the optical diffractometer. It is absolutely
   important that you screen these spectra before proceeding any
   further. Things to look out for: 
   <ul>
      <li>Are the Thon rings round?              </li>
      <li>Do the rings extend to high resolution?</li>
   </ul>
   <br />

   See this example:
   <p><a href="pics/power.jpg"><img width="182" height="243" src="pics/power.jpg"></a></p>

   You can discard micrographs that show one of the following artifacts, 
   by removing them from the <font class="input">sel_micrograph</font> micrograph 
   selection doc file:
   <ul>
      <li>Rings that are cut off unidirectionally (evidence of drift).             </li>
      <li>Rings that are elliptical, or even  hyperbolic (evidence of astigmatism).</li>
   </ul>

   See this example:
   <p><a href="pics/power.jpg"><img width="182" height="243" src="pics/power.jpg"></a></p>
</li>


   <p>
   <li>
      <p class="action">Assign defocus groups according to the power spectrum.</p>

      <p>
      <a class="project" href="./newprogs/defsort.spi">defsort.spi</a>: reads 
      a <font class="input">defocus</font> doc file generated by one of the above methods, 
      and the <font class="input">sel-micrograph</font> micrograph selection file 
      and assigns the micrographs to a tentative defocus group.  It creates: <br />

      <table class="outs">
         <tr valign="top"><td>&curren;</td>
             <td><code class="output">def_sort</code>: </td>
             <td>A doc file with the group assignments sorted by defocus.</td></tr>
      </table>
      <b> These automated defocus group assignments are only a starting point, however. 
      You must manually inspect the defocus groupings to see
      which micrographs belong together, ensuring that they are "in phase".</b>
   
      <p>
      Spectral profiles (that is, the roo*** or ctf*** files) from the same defocus
      group should be plotted together, to ensure that their zeroes (minima)
      line up, and do not cancel out. Plot the power spectrum for each
      micrograph and assign them to defocus groups such that the curves are in phase.
      Use either:

      <ol class="choice">
      <li> <a href="../../../tools/docs/ctfgroup.html">
           <font class="guitool">ctfgroup.py</font></a>
      </li>

      <li> <a href="../../../tools/docs/pyplot.html">
           <font class="guitool">pyplot.py</font></a>
      </li>

      <li> <b>gnuplot</b>   <br />
         Gnuplot commands can be saved in a
         text file, such as <a href="./newprogs/plotpower.plot">plotpower.plot</a>,
         then run in <i>gnuplot</i> using the <i>load</i> command:    <br />
         <code>gnuplot&gt; load 'plotpower.plot'</code>
         <p><a href="pics/plotpower1.gif">
            <img width="200" height="150" src="pics/plotpower1.gif"></a></p>
      </li>
      </ol>

   When you have determined a satisfactory set of groupings, update the 
   docfile: <code class="output">def_sort</code>, which is used in the next step.
</li>
</p>

<p>
<li><p class="action">Compute averages for each defocus group</p>

   <a class="project" href="./newprogs/defavg.spi">defavg.spi</a>,   
   uses the updated values in <font class="input">def_sort</font>, to compute the
   averages for each defocus group, creating: <br />

   <table class="outs">
      <tr valign="top"> <td>&curren;</td>
          <td> <code class="output">def_avg</code>: </td>
          <td>A micrograph selection doc file containg average defocus level,
              and defocus group assignment.</td> </tr>

      <tr valign="top"><td>&curren; </td>
          <td><code class="output">sel_group</code>: </td>
          <td>A defocus group selection doc file containing 
          average defocus level.</td> </tr>
    </table>

</li>
</p>
</ul>

<hr>
<!-- xxxxxxxxxxxxxxxxxxxxxxx Particle Picking and Selection xxxxxxxxxxxxxxxxxxxx -->

<!-- ------------------- Particle Windowing and Verification ------------------- -->

<a name="AUTO"></a> 
<table class="heading" width="100%"><tr><td>      <br />
   <h3 class="heading">Particle Windowing and Initial Verification</h3>

   <p class="explain">A particle picking procedure file analyzes each micrograph, 
      cutting out small windows of likely particle candidates. This is followed 
      by a manual selection process that identifies the good particle images and 
      rejects the bad ones. Particles automatically output by the procedure file are 
      said to be <i>windowed</i>; the subset that are manually chosen are said to 
      be <i>verified</i>.
   </p>

   <p>These procedures should be run in the <i>Particles/</i> directory.</p>
   </td></tr>
</table>

<!-- SPIRE directory=Particles subdirectories=coords, good, win, flt -->

<ul>

<li><p class="action">Select a background noise file</p>
   A noise image is required to normalize the backgrounds of the
   particle images. Do one of the following:
   <p />
   <ol class="choice">
      <li>Use a noise image from a previous project (this is the easier
         way). The window sizes do not need to match.
      </li>
      <p />

      <li>
         Use the procedure:  <a class="project" href="./newprogs/noise.spi">noise.spi</a> 
         (which calls 
         <a class="project" href="./newprogs/convert_p.spi">convert_p.spi</a>) to
         read the micrograph images: <font class="input">../Micrographs/raw****</font> 
         and create: <br />
 
         <table class="outs">
            <tr valign="top"><td>&curren;</td>
                <td><code class="output">noise</code>: </td>
                <td> &nbsp; A noise image.</td></tr>
         </table>

         This noise file is randomly selected from a set of files 
         (<code class="output">tmpnoise/noi***</code>) that are windowed from regions 
         in the micrograph that appear not to contain any particles.   
     
         View the selected noise file.   
         If it has any structure (i.e. particles or junk), then select another one of the
         candidates and copy it to: <code class="output">noise.ext</code>.
      </li>
  </ol>

  <p />

  <li> <p class="action">Run automatic phase of particle selection.</p>

   Either of the following two approaches can be used. They both
   require the image format conversion procedure: 
   <a href="./newprogs/convert_p.spi">convert_p.spi</a> 
   <p />

   <ol class="choice">
     <li>
       SPIDER procedure <a class="project" href="../newprogs/pick.spi">pick.spi</a> (which calls:  
       <a class="project" href="./newprogs/convert_p.spi">convert_p.spi</a> 
       and <a class="project" href="./newprogs/pick_p.spi">pick_p.spi</a>)
       applys correlation with a Gaussian blob to window particles.
       <br />
       The micrographs are decimated by 1/4,
       Fourier filtered with a Gaussian low pass filter, and searched for
       peaks over regions corresponding to particle dimensions. Particles
       are windowed out and centered, then peak locations are corrected, and
       particles are windowed again. This procedure uses histogram
       equalization. Output files:<br />

       <table class="outs">
          <tr valign="top"><td>&curren;</td>
              <td><font class="output">win/winser****</font>: </td>
              <td>Stacked particle images.</td></tr>
          <tr valign="top"><td>&curren;</td>
              <td><font class="output">win/sel_particle****</font>: </td>
              <td>Particle selection doc file for each micrograph.</td></tr>
          <tr valign="top"><td>&curren;</td>
              <td><font class="output">coords/sndc****</font>: </td>
              <td>Peak coordinates for particles.</td></tr>
       </table>
    </li>
    <p />

    <li>SPIDER procedure <a class="project" href="./newprogs/lfc_pick.spi">lfc_pick.spi</a> 
       (which calls  
       <a class="project" href="./newprogs/convert_p.spi">convert_p.spi</a> and
       <a class="project" href="./newprogs/pickparticle.spi">pickparticle.spi</a>) 
       uses the Local Fast Correlation algorithm to window particles.  
       This procedure uses <a href="../../../../partpick.html#LFC">local cross-correlation</a> 
       calculated using Fourier methods outlined by
       <a href="#AR03">Roseman (2003)</a>. This implementation is described in 
       <a href="#BR04">Rath and Frank (2004)</a>. A reference volume is required
       to generate projections at desired Eulerian angles for 
       searching different orientations of the search image in the micrograph. 
       Procedure <a  href="./newprogs/lfc_pick.spi">lfc_pick.spi</a>
       also performs a histogram-fitting normalization of the images.
       Output files:<br />

        <table class="outs">
          <tr valign="top"><td>&curren; </td>
              <td><font class="output">win/winser_****</font>: </td>
              <td>Stacks of particle images for each micrograph.</td></tr>
          <tr valign="top"><td>&curren; </td>
              <td><font class="output">win/sel_particle_****</font>: </td>
              <td>Particle selection doc file for each micrograph.</td></tr>
          <tr valign="top"><td>&curren; </td>
              <td><font class="output">coords/sndc****</font>: </td>
              <td>Pixel coordinates for <i>center</i> of particle images.</td></tr>
        </table>
    </li>
  </ol>

 <a name="PFILT"></a>
 <li><p class="action">[<b>Optional</b>] Low-pass filter particle images before
     particle selection</p>

     The procedure <a class="project" href="./newprogs/pfilt.spi">pfilt.spi</a> 
     filters a set of images, adjusting filter settings for each micrograph, 
     based on its defocus and creates:      <br />
     <table class="outs">
       <tr valign="top"><td>&curren;</td>
         <td><code class="output">flt/winser_***</code>: </td>
         <td>&nbsp;&nbsp;Stacks of low-pass filtered particle images.</td></tr>
    </table>
    Manual selection of good particles (the next step) is easier if
    the particles have been low-pass filtered beforehand. Use the 
    filtered particles, not the raw particles, during selection in 
    <a href= "https://spider-em.github.io/Web/docs/web.html">WEB</a>. 
 </li>
 <p />


<li><p class="action">Verify the windowed particles</p>

   This step is optional if using 
   <a href="mrverify.html">classification-based verification</a> later on.</p>

   Sort through the output files to eliminate any non-particles. 
   This step is optional if using 
   <a href="mrverify.html">classification-based verification</a> later on.</p>

   Sorting can be done in <a href="https://spider-em.github.io/Web/docs/web.html">WEB</a>
   using the <b>Categorize from sequential montage</b> operation. When
   the particle image files are displayed on the screen, use the mouse
   to click on each good particle. For each micrograph, save your 
   selections to a file called <code class="output">good/good***</code>. (More
   details in the <a href="../../faq.html#pick">SPIDER FAQ</a> and 
   <a href="../../partpick.html">partpick.html</a>). This creates:   <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
         <td><code class="output">good/good***</code>: </td>
         <td>A set of particle selection doc files, one for each micrograph.</td></tr>
   </table>
</li>
<p />

<li><p class="action">Remove any duplicated particles and list number of picked and 
   selected particles by micrograph</p>

   The procedure: <a class="project" href="./newprogs/renumber.spi">renumber.spi</a> creates: <br />
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
         <td><code class="output">good/ngood***</code>: </td>
         <td>A set of particle selection doc files, one for each micrograph,
             listing unduplicated selected particle numbers.</td></tr>
      <tr valign="top"><td>&curren;</td>
         <td> <code class="output">percent_selected</code>: </td>
         <td>A doc file listing percentages of automatically picked vs 
             manually selected particles for each micrograph and overall.</td></tr>
   </table>
   <p />
   When manually selecting particles in <a href="https://spider-em.github.io/Web/docs/web.html">WEB</a>,
   sometimes a particle is accidentely double clicked. This procedure 
   will delete the appropriate lines from the file. Run this procedure, 
   even you you don't think you made any mistakes - subsequent procedure files 
   will require the <code class="output">ngood***</code> files as input.
</li>
<p />


<p />


</ul>

<hr />

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxx Alignment xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<a name="SH"></a> 
<table class="heading" width="100%"><tr><td> <br />
   <h3 class="heading">Alignment</h3>

   <p class="explain">
   Reference images are generated from the reference volume. Data particles 
   are compared to each reference to find the best match, and the corresponding 
   transformations (shifts and rotations) are written to a doc file. Finally, 
   the transformations are applied to the data images, aligning them to the 
   references.
   </p>

   <p>These procedures should be run in the <i>Alignment</i> directory.</p
   </td></tr>
</table>

<!-- SPIRE directory=Alignment subdirectories=ali,projs -->


<ul>


<li><p class="action">Create lists of images in each defocus group   </p>

   <a class="project" href="./newprogs/sel_by_group.spi">sel_by_group.spi</a> reads 
   <font class="input">../Power_Spectra/def_avg</font>, 
   <font class="input">../Power_Spectra/sel_group</font>, and 
   <font class="input">../Particles/good/ngood****</font> to 
   create  selection document files and a group summary file:        <br />
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">sel_particles_***</code>: </td>
          <td>A doc file for each defocus group, listing all the particles in 
              that group.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">sel_group</code>:  </td> 
          <td>A summary doc file with 4 columns listing: <br />
              Defocus group, Number of particles, Cumulative number of particles, <br /> 
              and Average defocus value for each group. </td>  </tr>
   </table>
   <small>Note: this step is not necessary when using Nature Protocols data set.</small>
</li>
<p />

<li><p class="action">Create stacks of images for each defocus group</p>
   <a class="project" href="./newprogs/win2stk.spi">win2stk.spi</a> reads 
   <font class="input">sel_group</font>, 
   creates stacks: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">data***</code>: </td>
          <td>A stack file for each defocus group, containing all particle 
              images from that group.</td></tr>
   </table>
   <small>Note: this step is not necessary when using the Nature Protocols data set.</small>
</li>

<p />

<li><p class="action">Create reference projections for alignment from a reference
     volume  </p>

    <p> Reference projections (images) are views of the object at known angles.
    In what follows, angular accuracy is set to 15 degrees, which
    results in 83 reference projections. A reference volume
    is needed in the top level project directory to create the projections. 
    The row and column dimensions of the reference volume must match the 
    dimensions of the particle windows. (see 
    <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>)
    </p>

   <a class="project" href="./newprogs/refproj.spi">refproj.spi</a> reads 
   <font class="input">../reference_volume</font> and 
   <font class="input">sel_group</font>
   to create two sets of files:        <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">refangles</code>: </td>
          <td>A doc. file from
             <a href="../../man/voea.html"><b>VO EA</b></a>
            listing the three Euler angles for each of the projections.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">projs/prj_****</code>: </td>
          <td>Stacked reference images from   
              <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> 
              corresponding to the angles in the preceeding file.</td></tr>
   </table>
   <p />
    
   There are two types of reference projections:
   <ol class="choice">
     <li>You can use the same stack of references for all defocus groups, by 
         setting register [usectf] = 0. They will be in the file: 
         <code class="output">projs/prj_001</code>     </li>

     <li>Generate more realistic references by multiplying them by the CTF  
         There will be a stack of reference projections for each defocus 
         group.     </li>
   </ol>
</li>

<p />

<li><p class="action">Align particles to the reference projections</p>
   <ol class="choice">
   <li> If you are using the same reference stack for each defocus group: <br />
      <a class="project" href="./newprogs/apsh.spi">apsh.spi</a> reads
      <font class="input">projs/prj_***</font>, 
      <font class="input">refangles</font>, and 
      <font class="input">data***</font> to create an alignment parameters
      document file and a stack of the aligned images.<br />

      <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">align_01_001</code>: </td> 
          <td>Shift and rotation parameters for the best matched projection.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">dala01_001</code>:</td>
          <td>Aligned stack of the particle images.</td></tr>
      </table>
   </li>

   <p />
   <li> If you have references for each defocus group: <br />
      <a class="project" href="./newprogs/apshgrp.spi">apshgrp.spi</a> reads
      <font class="input">sel_group</font>, <font class="input">projs/prj_***</font>, 
      <font class="input">refangles</font>, and 
      <font class="input">data***</font> to create a set of 
      alignment parameter document files and stacks of aligned images.<br />

      <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">align_01_***</code>:</td>
          <td>Shift and rotation parameters for the best matched projections.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">dala01_***</code>:</td>
          <td>Aligned stacks of the particle images.</td></tr>
      </table>

     If you are using <a href="../../../pubsub/pubsub.html">Publish and Subscribe</a>
      on a Cluster, activate <i>PubSub</i> within <i>apshgrp.spi</i> procedure heading.</p>
   </li>
<p />

</ul>

<hr>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxx Compute Averages xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<a name="CA"></a> 
<table class="heading" width="100%"><tr><td> <br />
   <h3 class="heading">Compute Averages</h3>

   <p class="explain">For all projections, all aligned particles of a 
   given reference view are averaged together. Further particle selection is 
   made by selecting a correlation cutoff threshold to reject some particles. 
   The distribution of particles among projections can be displayed.
   </p>

   <p>These procedures should be run in the <i>Reconstruction</i> directory.</p>
   </td></tr>
</table>

<!-- SPIRE directory=Reconstruction subdirectories=hist,ctf, avg, display -->

<ul>
<li><p class="action"> Make particle selection document files listing 
   particles cooresponding to each reference projection</p>
   <a class="project" href="./newprogs/select.spi">select.spi</a></i> reads  
   <font class="input">../Alignment/sel_group</font>, and
   <font class="input">../Alignment/align_01_***</font> 
   to create the following doc files:<br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">df***/how_many</code>: </td>
          <td>Lists number of particles associated with each reference view for 
              each group. </td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">df***/ref_sel???</code>: </td>
          <td>Lists the particles numbers associated with each reference view for
              each group (from 'VO MQ'). </td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">how_many</code>: </td>
          <td>Summary file listing total number of particles associated 
              with each reference view.</td></tr>
   </table>
</li>

<p />

<li> <p class="action">Create average images for all projection groups and
       combine all alignment parameter files into a single 
       summary file (if necessary). </p>

    <a class="project" href="./newprogs/average.spi">average.spi</a> 
    reads
    <font class="input">df***/how_many</font>, 
    <font class="input">select/sel***</font>,  
    <font class="input">../Alignment/sel_group</font>, and 
    <font class="input">../Alignment/dala01_***</font> to
    create the following files for all defocus groups.
    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">avg***</code>:    </td>
          <td>Stacks of average images for each set of projections.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">var***</code>: </td>
          <td>Stacks of variance images for each set of projections</td></tr>

   </table>
   <p />

   <!-- if avgs were made for def grp 1, use df001
   -d = doc file template, -i = particle template
   classavg.py -d df001/select/sel**.ext -i ../Alignment/ali/sar******.ext avg/avg*
   -->
</li>

<p>The next three operations help to identify a threshold
   correlation coefficient that describes true particles as opposed to any 
   erroneously selected particles. Create histograms of each defocus
   group that plots the number of particles vs. the cross correlation
   value. For example, if the histograms display a bimodal
   distribution, the higher peak may correspond to actual particles,
   while the lower peak may show noise. The threshold should be chosen
   between two such peaks.</p>

<p />

<li><p class="action">Identify a threshold correlation coefficient for 
   selecting true particles. </p>

    <p>Create histograms for each defocus
    group that plots the number of particles vs. the cross correlation
    value. If the histograms display a bimodal
    distribution, the higher peak may correspond to actual particles,
    while the lower peak may show noise. The threshold should be chosen
    between two such peaks.</p>

   <a class="project" href="./newprogs/cchistogram.spi">cchistogram.spi</a> reads 
   <font class="input">../Alignment/sel_group</font>, 
   <font class="input">../Alignment/align_01_***</font>, and 
   <font class="input">align_01_all</font> to
   to create histograms and a gnuplot control script:

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">hist/cchist_***</code>: </td>
          <td>Set of histogram doc files of cross correlation values by defocus group.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">hist/cchist_all</code>: </td>
          <td>Overall histogram doc file of cross correlation values.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">gnuplot_cchist_***</code>: </td> 
          <td>Gnuplot scripts to display group cross correlation values histograms.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">gnuplot_cchist_all</code>: </td> 
          <td>Gnuplot script to display overall cross correlation values histogram.</td></tr>
   </table>

   <p />

   To view the overall histogram plot issue following system command:  
   <code>gnuplot -persist gnuplot_hist_all.ext</code>               <br />
</li>


<li><p class="action">Compute correlation thresholds for discarding 
    particles</p>

   <a class="project" href="./newprogs/ccthresh.spi">ccthresh.spi</a> reads   
   <font class="input">../Alignment/sel_group</font>, 
   <font class="input">../Alignment/align_01_***</font>, and 
   <font class="input">hist/cchist***</font>.   
   Using the given percent cutoff level, it creates:                   <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">thresh</code>  </td>
          <td> Doc file listing CC Value thresholds for each defocus group. </td></tr>

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">sav_particles_***</code></td>
          <td> Particle selection files listing particle numbers of images
               with correlation values above the threshold,sorted by 
               correlation value..</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">rej_particles_***</code></td>
          <td> Particle selection files listing particle numbers of images
               with correlation values below the threshold, sorted by 
               correlation value.</td></tr>
   </table>

   E.g., if a threshold of 0.20 is selected, then 20% of all particles in each 
   defocus group having the lowest correlation values will be rejected. The output
   doc file <code class="output">thresh</code> lists, for each defocus group, 
   the cutoff correlation threshold, and the numbers 
   of particles above and below the threshold. NB, BECAUSE THE HISTOGRAM 'BINS' 
   THE VALUES, THE NUMBERS OF PARTICLES ARE 
   NOT EXACT, AND THEREFORE WILL NOT EXACTLY MATCH THE OUTPUT OF 
   <a href="./newprogs/dftotals.spi">dftotals.spi</a>.

   <p />

   Use the <b>Montage from doc file</b> operation in 
   <a href="https://spider-em.github.io/Web/docs/web.html">WEB</a> to display the rejected
   particles identified in the selection doc file (e.g. rej_particles_001).  
   The greater the correlation coefficient value, the more
   similiar the particle should look to the reference projection.
   This will help you determine whether the correlation coefficient threshold that
   you chose is appropriate for selecting true particles. Select
   <b>Compute Average</b> to view an average of the particles displayed.
   <p />

   <p> The correlation thresholds in <code class="output">thresh</code> may be 
   edited at this time, if you wish to apply different cutoff thresholds.</p>
</li>
<p />

<li>
   <p class="action">Make final selection of particles above the correlation thresholds</p>

   <a class="project" href="./newprogs/dftotals.spi">dftotals.spi</a> reads 
   <font class="input">../Alignment/sel_group</font>, 
   <font class="input">../Alignment/align_01_***</font>, and   
   <font class="input">thresh</font>.  It applies the updated cutoff levels
   from thresh to create:                        <br />
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">sel_particles_***</code></td>
          <td> Particle selection files.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">sel_group_cclim</code></td>
          <td> Group selection file with updated numbers of particles in each group.</td></tr>
   </table>
  The particle selection files list particles with correlation values greater 
  than the threshold and are used to select particles for inclusion in the
  reconstruction.</td></tr>
</li>
<p />

<li>
   <p class="action">Check the spatial distribution of views 
   (angular directions) for the reconstruction.     </p>

   <p> <a class="project" href="./newprogs/plotrefviews.spi">plotrefviews.spi</a> reads  
   <font class="input">../Alignment/sel_group</font>,
   <font class="input">how_many</font>, and 
   <font class="input">df{***[grp]}/how_many</font>.
   It creates script files of gnuplot commands: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">gnuplot_view</code></td>
          <td> Gnuplot script to plot overall histogram of number of particles vs projection view.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">display/gnuplot_views_***</code></td>
          <td> Gnuplot scripts to plot histogram of number of particles vs projection view 
               for each defocus group.</td></tr>
   </table>

   <p />

   <a class="project" href="./newprogs/plotangs.spi">plotangs.spi</a> and its procedure 
   <a class="project" href="./newprogs/plotangs_p.spi">plotangs_p.spi</a> read 
   <font class="input">../Alignment/sel_group</font>,  
   <font class="input">../Alignment/refangles</font>, and 
   <font class="input">df***/how_many</font> to create: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">display/angdis_by_group</code>: </td> 
          <td>A stack of SPIDER images showing distribution of sample images 
             among various reference projections for each group. </td></tr>

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">display/angdis_all_groups</code>: </td> 
          <td>Combined SPIDER image file showing distribution of sample images 
             among various reference projections for all groups. </td></tr>

   </table> 

   These images show the various angular reference groups represented by small 
   circles. The radii of these circles are proportional to the number of 
   particles in each group.

   <p> Use the <b>Montage</b> operation in <a href="https://spider-em.github.io/Web/docs/web.html">WEB</a> 
   to display the images.</p>
</li>

<li>
   <p class="action">[Optional] Limit strongly over-represented angular projections</p>

   <p> <a class="project" href="./newprogs/bestim.spi">bestim.spi</a> reads 
   <font class="input">../Alignment/sel_group</font>,  
   <font class="input">../Alignment/refangles</font>,  
   <font class="input">df***/how_many</font>, and 
   <font class="input">df***/ref_sel{***[grp]}</font> to create: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">sel_group_cclim</code></td>
          <td> Group selection file for specified defocus group</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">sel_particles_***</code></td>
          <td> Particle selection file for specified defocus group</td></tr>
   </table> 

   The selection limits the numbers of images per reference view direction to a 
   certain specified count. This will limit strongly over-represented 
   angular projections which may cause a shape error in the reconstruction.
   Continue reconstruction with the limited set of particles.
</p>
</li>

</ul>

<p />

<hr>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxx 3D Reconstruction xxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<a name="3D"></a> 
<table class="heading" width="100%"><tr><td> <br />
   <h3 class="heading">3D Reconstruction</h3>

   <p class="explain">Use the selected aligned particles to create an initial 3D volume. 
   To estimate the resolution of the resulting structure, the particle images are split 
   into two equal sets, and the two resulting reconstruction volumes are compared. 
   </p>

   <p>These procedures should be run in the <i>Reconstruction</i> directory.</p>
</td></tr></table>

<p />

<ul>

<li><p class="action">Split the particle images, create reconstructions,
    merge reconstructions into final reconstruction.  </p>

    <p> Split the particle images from each defocus group into two 
    sets, create paired reconstructions, determine resolution for each 
    reconstruction,  merge group reconstuctions into final combined 
    reconstruction and compute reconstruction resolution. Choose one of the
    following two procedures</p>

   <ol class="choice">
      <li> For normal serial reconstruction use 
           <a class="project" href="./newprogs/recon.spi">recon.spi</a>. </li> 

      <li>For parallel reconstruction under control of PubSub use 
      <a class="project" href="./newprogs/pub_recon.spi">pub_recon.spi</a> and 
      <a class="project" href="./newprogs/recon.spi">recon.spi</a>.
   </ol>
   <p />
   These procedures read  
   <font class="input">sel_group_cclim</font>, <font class="input">sel_particles_***</font>,  
   <font class="input">../Alignment/dala01_***</font>, and 
   <font class="input">../Alignment/align_01_***</font>.  

   They create two subset reconstructions for each defocus group using 
   <a href="../../man/bprp3.html">'BP RP 3'</a> for 
   back projection, compute the resolution of each defocus group 
   reconstruction by comparing the two volumes, and create a CTF
   correction file for each group: 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">df***/vol01_sub1</code>: </td>
          <td> Reconstructed volume from first subset of images for each defocus group.</td></tr> 

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">df***/vol01_sub2</code>: </td>
          <td> Reconstructed volume from second subset of images for each defocus group.</td></tr> 

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">df***/fscdoc</code>: </td>
          <td> Doc files containing  <a href="../../glossary.html#Fourier">FSC curve</a> 
               for each defocus group.</td></tr> 

    <tr valign="top"><td>&curren;</td>
          <td> <code class="output">df***/ctffile</code>: </td>
          <td> <a href="../../glossary.html#CTR">CTF</a> correction file for
               each defocus group:</td></tr> 
   </table>

   <p />

     Finally, they apply CTF correction to all the defocus group subset volumes 
     (see the <a href="../../man/tfcts.html">TF CTS</a> operation),   
     add together the two subset volumes to make a volume for the entire data set, . 
     and  calculate the FSC resolution curve for the combined reconstruction  
     (see <a href="../../man/fsc.html">FSC</a> operation) creating 
     the following files:                                        

    <table class="outs">
      <tr valign="top"><td>&curren;                               </td>
          <td> <code class="output">vol01</code>:                 </td>
          <td> 3D reconstruction from entire set of particles.    </td></tr> 

      <tr valign="top"><td>&curren;                               </td>
          <td> <code class="output">combires</code>:              </td>
          <td> Doc file containing FSC curve for final reconstruction. </td></tr>

      <tr valign="top"><td>&curren;                               </td>
          <td> <code class="output">resolution</code>:            </td>
          <td> Doc file containing group number,  
              normalized frequency, and resolution (in Angstroms). </td> </tr> 
    </table>

   <p />

   This reconstruction is known as the <i>initial volume</i> and will be
   used as the input for the Refinement step. 
</li>

<p />

<li><p class="action">Check the defocus group volumes by viewing a central 
    slice from each volume </p>

    <a class="project" href="./newprogs/slices.spi">slices.spi</a> reads
   <font class="input">sel_group_cclim</font>, and  
   <font class="input">df***/vol01_sub1</font> to create:    <br />

    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">central_slices</code>:  </td>
          <td> Stack of central slices from each first subset defocus group volume. </td></tr> 
    </table>
    <p />

    Use the <b>Montage</b> operation in <a href="https://spider-em.github.io/Web/docs/web.html">WEB</a> 
    to view the stacked slices. Ideally, each 
    image should show a particle isolated from its surroundings, exhibiting 
    some internal structure - somewhat like the reference images. If any 
    images are blank or otherwise unusual, go back and check the processing of 
    that defocus group.
</li>

<p />

<li><p class="action">Check the FSC curves from the group volumes by viewing a plot
    of the curves </p>

   <a class="project" href="./newprogs/plotres.spi">plotres.spi</a> reads
   <font class="input">sel_group_cclim</font>,  
   <font class="input">combires</font>, and <font class="input">df***/fscdoc</font>.  
   It creates a text file of gnuplot commands:  

    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">gnuplot_res</code>: </td>
          <td> Gnuplot script for plotting the resolution curve of each 
               defocus group, along with the combined resolution curve. </td></tr> 
    </table>   

   <p>
   <a href="pics/plotres2.gif"><img width="200" height="150" src="./pics/plotres2.gif"></a></p>

   Examine this plot and see if there are any unusual curves, if so, go back and check 
   the processing of that defocus group.
</li>

<p />

<li><p class="action">Filter the initial volume</p>
   Information at spatial frequencies above the cutoff value is  
   considered to be uncorrelated noise, and should be filtered out.  <br />

   <a class="project" href="./newprogs/filt.spi">filt.spi</a> reads 
   <font class="input">resolution</font> and   
   <font class="input">vol01</font>. It filters the 
   initial volume at the cutoff frequency to create: <br />

    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">volfq01</code>: </td>
          <td>Filtered volume.  </td></tr> 
    </table>   
   <p />
    
   Use the <b>Surface</b> operation in 
   <a href="https://spider-em.github.io/Web/docs/web.html">WEB</a> 
   to view the filtered volume.
</li>

</ul>

<hr>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxx Refinement xxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<a name="REF"></a> 
<table class="heading" width="100%"><tr><td> <br />
   <h3 class="heading">Refinement</h3>

   <p class="explain">Refinement essentially performs the reconstruction steps repeatedly, 
     decreasing the angular resolution of reference projections with each iteration, 
     thereby giving the data particles a chance to find a better approximating 
     reference match each time. Thus the data particles are allowed to "settle in" 
     and find better fitting angles, than the initial choices.  Refinement is a 
     computationally expensive operation. Before starting a refinement, check the 
     results of the above reconstructions, to ensure that <u>all</u> defocus groups
     have reasonable particle volumes. Remove any groups that are defective.
   </p>

   <p>These procedures should be run in the <i>Refinement</i> directory.</p>
</td></tr></table>

<!-- SPIRE directory=Refinement subdirectories=input, final, work -->

<ul>

<li><p> The refinement step uses the following input files ('***' denotes
  group number and '##' denotes iteration number </p>

   <table>  
   <tr><td> <font class="input">../params</font>: </td> 
       <td> Parameter definition file.</td></tr>
   <tr><td> <font class="input">../Reconstruction/sel_group_cclim</font>: </td> 
       <td> Group selection file.</td></tr>
   <tr><td> <font class="input">../Reconstruction/vol01</font>: </td> 
       <td> Initial starting volume.</td></tr>
   <tr><td> <font class="input">../Reconstruction/sel_particles_***</font>: </td> 
       <td> Particle selection files.</td></tr> 
   <tr><td> <font class="input">../Alignment/align_01_***</font>: </td> 
       <td> Initial alignment parameter files.</td></tr> 
   <tr><td> <font class="input">../Alignment/data***</font>: </td> 
       <td> Unaligned stacked image files.</td></tr>
   <tr><td> <font class="input">input/scattering</font>: </td> 
       <td> Optional amplitude enhancement scatter file.</td></tr>
   <tr><td> <font class="input">input/mask</font>: </td> 
       <td> Optional amplitude enhancement mask file.</td></tr>
   </table>
</li>
<p />

<li><p class="action">Edit the values in 
  <a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a>
  to set necessary values for refinement parameters and specify any non-standard input 
   file names.</p>
</li>

<li><p class="action">If you are using  <i>PubSub</i>, copy latest SPIDER executable into the 
    current directory and rename it: <i>spider</i>. e.g. <br />
   <i>cp /spider/bin/spider_linux_mp_opt64.18.16 &nbsp;&nbsp; spider </i> </p>
     This ensures that the same SPIDER executable is available throughout whole refinement.
</li>

<li><p class="action"> Run either:
    <a class="project" href="./newprogs/refine.pam">refine.pam</a> 
    (If using normal serial operation) or 
    <a class="project" href="./newprogs/pub_refine.pam">pub_refine.pam</a> 
    (If  using parallel refinement on a cluster with PubSub) 
    </p>

  There are a number of sub-procedures used in refinement: 
   <a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a>, &nbsp;
   <a class="project" href="./newprogs/prepare.pam">        prepare.pam</a>,         &nbsp;
   <a class="project" href="./newprogs/enhance.pam">        enhance.pam</a>,         &nbsp; 
   <a class="project" href="./newprogs/grploop.pam">        grploop.pam</a>,         &nbsp; 
   <a class="project" href="./newprogs/smangloop.pam">      smangloop.pam</a>,       &nbsp;
   <a class="project" href="./newprogs/mergegroups.pam">    mergegroups.pam</a>,     &nbsp;
   <a class="project" href="./newprogs/endmerge.pam">       endmerge.pam</a>,        &nbsp;
   <a class="project" href="./newprogs/endrefine.pam">      endrefine.pam</a>, and   &nbsp;
   <p />

   If you are running on a cluster using <i>PubSub</i> you will also need: 
   <a href="../../../pubsub/publish.perl">publish.perl</a>,                                     &nbsp; 
   <a class="project" href="./newprogs/pub_refine_start.pam">     pub_refine_start.pam</a>,     &nbsp;
   <a class="project" href="./newprogs/pub_refine_doc_sync.pam">  pub_refine_doc_sync.pam</a>,  &nbsp;
   <a class="project" href="./newprogs/pub_refine_wait.pam">      pub_refine_wait.pam</a>,          &nbsp;

   <a class="project" href="./newprogs/pub_ref_loop_clone.pam">   pub_ref_loop_clone.pam</a>,   &nbsp;
   <a class="project" href="./newprogs/pub_ref_loop_declone.pam"> pub_ref_loop_declone.pam</a>, &nbsp;
   <a class="project" href="./newprogs/pub_ref_merge_clone.pam">  pub_ref_merge_clone.pam</a>,  &nbsp;
   <a class="project" href="./newprogs/pub_ref_merge_declone.pam">pub_ref_merge_declone.pam</a>, and 
   <a class="project" href="./newprogs/pub_fixrefine.pam">        pub_fixrefine.pam</a>.

  <p />
  Further details are given in the <a href="refine.html">Refinement</a> page.  
  <p />

  Among the outputs of refinement are volumes, images, and document files. Some of the
  important outputs are listed here ('***' denotes group number and '##' denotes iteration number):

    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">final/align_##_***</code>: </td>
          <td>Alignment parameter doc files</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">final/fscdoc##_***</code>: </td>
          <td> FSC curve doc. file</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">final/val##</code>: </td>
          <td> Unfiltered volume </td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/vol##</code>: </td>
          <td>Filtered volume from all images</td></tr> 
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">final/vol##_sub1</code>: </td>
          <td>Filtered volume from first subset of images</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/vol##_sub</code>: </td>
          <td>Filtered volume from second subset of images</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/dbpr##_***</code>: </td>
          <td>Resolution curve doc file</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/bpr##_***</code>: </td>
          <td>Group volume</td></tr> 
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/bpr##_***_sub1</code>: </td>
          <td>Group volume from first subset of images</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/bpr##_***_sub2</code>: </td>
          <td>Group volume from second subset of images</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/bpr##</code>: </td>
          <td>Final volume from all images</td></tr>    
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">final/bpr##_sub1</code>: </td>
          <td>Final volume from first subset of images</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/bpr##_sub2</code>: </td>
          <td>Final volume from second subset of images</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">final/ofscdoc##</code>: </td>
          <td>Overall FSC curve doc file</td></tr>
       <tr valign="top"><td>&curren;</td>
          <td><code class="output">resolutions</code>: </td>
          <td>Doc file listing resolution at each iteration.</td></tr> 
    </table>
</li>
<p />



<li><p class="action">Plot the refinement FSC curves</p>

   The procedure <a class="project" href="./newprogs/plotrefres.spi">plotrefres.spi</a> reads
   <font class="input">input/sel_group</font>, 
   <font class="input">final/resolutions</font>, 
   <font class="input">dres##</font>, 
   <font class="input">dbpr##_***</font>, and
   <font class="input">dbpr##</font>. 
   It creates two text files of gnuplot commands: <br /> 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">gnuplot_refi</code>: </td>
          <td>Plots combined resolution curve for each iteration of refinement.</td></tr> 

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">gnuplot_refd</code>: </td>
          <td>Plots resolution curve for each defocus group for the last iteration.</td></tr> 
    </table>   
</li>
</p> 

<p>
<li><p class="action">[Optional] View angular data output from Refinement
   procedure files</p>

   The procedure <a class="project" href="./newprogs/angdisp.spi">angdisp.spi</a> reads
   <font class="input">final/align_##_***</font> 
   and  creates angular distribution images: <br /> 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">disp_<i>ii</i>_***</code>: </td>
          <td>Set of images showing angular positions from the  
             <code class="output">align_<i>ii</i>_***</code> refined alignment 
             parameter output files. </td></tr> 
    </table>   

   The procedure <a class="project" href="./newprogs/angdiff.spi">angdiff.spi</a> reads
   <font class="input">final/align_##_***</font> 
   and creates: 
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">diff_<i>ii</i>_***</code>: </td>
          <td>Image showing changes in angular positions from iteration <i>n-1</i> to 
             iteration <i>n</i>.</td></tr> 
    </table>   
</li>

</p>

<!-- SPIRE end -->

<hr \>

<a name="OTHER"></a> 
<table class="heading" width="100%">
   <tr><td>    <br /> <h3> Other Useful Methods </h3>  </td></tr>
</table>

<dl>
<p><dt><u>Create tar files for backup</u></dt>
<dd><a href="backup">backup</a> a shell script, puts a number of vital 
   files into tar files, which can be backed up on tape. Edit the 
   shell script to correspond to your data extension, make sure it is 
   executable and run it from your project directory. It creates 2 tar files 
   <code class="output">order.tar</code>, and 
   <code class="output">project.tar</code>
</dd>
</p>

<p><dt><a href="../diffmaps/diffmaps.html">Difference Maps</a> </dt>
<dd>Differences between volumes can be assessed by subtracting one 
    volume from the other.</dd>
</p>

<p><dt><a href="../xray/xray.html">Frequency amplitude correction with X-ray
      scattering data</a></dt>
<dd>Enhance the Fourier amplitudes of a reconstructed cryo-EM volume so they more 
   closely resemble those of experimental low-angle X-ray scattering data. </dd>
</p>

<p><dt><a href="../classification/index.html">Classification of Particles</a></dt>
<dd>This method can be used to investigate differences between particles.</dd>
</p>

<p><dt>See more methods on the <a href="../../techniques.html">techniques page</a></dt>
<dd></dd>
</p>

</dl>

<hr>

<a name="Refs"></a> 

<table class="heading" width="100%">
   <tr><td> <h3 class="heading"> References</h3> </td></tr>
</table>

<ol>

<li> <a href="http://dx.doi.org/10.1016/j.jsb.2014.05.002">
     Spherical Deconvolution Improves Quality of Single Particle Reconstruction</a>. &nbsp;&nbsp;&nbsp;
  Kishchenko GP and Leith A.                              &nbsp;&nbsp;
 <i>J. Structural Biol.</i> 187: 84-92 (2014).            &nbsp;&nbsp;

<li> <a href="http://dx.doi.org/doi:10.1107/97809553602060000874">
     Use of SPIDER and SPIRE in Image Reconstruction </a>.&nbsp;&nbsp;&nbsp;
  Leith A, Baxter W and Frank J.                          &nbsp;&nbsp;  
  <i>International Tables for Crystallography.</i>        &nbsp;&nbsp; 
 Vol. F, ch. 19.8, 620-623 (2012)                         &nbsp;&nbsp;

<li>Fundamentals of three-dimensional reconstruction from projections. &nbsp;&nbsp;&nbsp;
 Penczek PA.                                              &nbsp;&nbsp;
 <i>Methods in Enzymology</i> 482: pages 1-33 (2012)    . &nbsp;&nbsp;


<li> Prevention of overfitting in cryo-EM structure determination.&nbsp;&nbsp;&nbsp;
 Scheres SHW and Chen S.                                          &nbsp;&nbsp;    
 <i>Nature Methods</i>. 9: 853-854 (2012)                         &nbsp;&nbsp;  

<li> <a href="http://www.nature.com/nprot/journal/v3/n12/full/nprot.2008.156.html">
    SPIDER image processing for single-particle reconstruction of 
    biological macromolecules from electron micrographs</a>.               &nbsp;&nbsp;&nbsp;
 Shaikh TR, Gao H, Baxter WT, Asturias FJ, Boisset N, Leith A, and Frank J &nbsp;&nbsp;
 Nature Protocols. (online) </i> 3: 1941-1974 (2008)                       &nbsp;&nbsp;

<li><a href="http://www.amazon.com/gp/product/0195182189/">
   Three-Dimensional Electron Microscopy of Macromolecular Assemblies</a>  &nbsp;&nbsp;&nbsp; 
 Oxford University Press, (2006)                                           &nbsp;&nbsp;

<li>A cryo-electron microscopic study of ribosome-bound termination factor RF2.&nbsp;&nbsp;&nbsp; 
 Rawat UBS., Zavialov A, Sengupta J, Valle JM, Grassucci R, 
    Linde J, Vestergaard B, Ehrenberg M, and Frank J.                          &nbsp;&nbsp; 
 <i>Nature</i> 421: 87-90 (2003)                                               &nbsp;&nbsp;

<li>Ribosomal dynamics explored by cryo-electron microscopy.&nbsp;&nbsp;&nbsp; 
 J Frank                                                    &nbsp;&nbsp; 
 <i>Methods</i> 25: 309-315 (2001)                          &nbsp;&nbsp;

<li>Three Dimensional Reconstruction with Contrast Transfer Compensation 
    from Defocus Series.                                    &nbsp;&nbsp;&nbsp;
 Penczek PA, Zhu J, Schrder R, and Frank J.                &nbsp;&nbsp;
 <i>Scanning Microscopy</i> 11: 147- (1997)                 &nbsp;&nbsp; 

<li>SPIDER and WEB: Processing and Visualization of Images in 3D 
    Electron Microscopy and Related Fields.                               &nbsp;&nbsp;&nbsp; 
 Frank J, Radermacher M, Penczek P, Zhu J, Li Y, Ladjadj M, and Leith A.  &nbsp;&nbsp; 
 <i>J. Structural Biol.</i> 116: 190-199 (1996)                           &nbsp;&nbsp;

<li>The ribosome at improved resolution: New techniques for merging and 
    orientation refinement in 3D cryo-electron microscopy of biological 
    particles.                               &nbsp;&nbsp;&nbsp; 
  Penczek P, Grassucci RA and Frank J.       &nbsp;&nbsp;   
  <i>Ultramicroscopy</i> 53: 251-270 (1994)  &nbsp;&nbsp;
 
<li>Three-dimensional reconstruction of single particles embedded in ice.&nbsp;&nbsp;&nbsp;
 Penczek P, Rademacher M, and Frank J.       &nbsp;&nbsp;
 <i>Ultramicroscopy</i> 40: 33-53 (1992)     &nbsp;&nbsp;

<li> SPIDER -- a modular software system for electron image processing.&nbsp;&nbsp;&nbsp;
 Frank J, Shimkin B, Dowse H.                &nbsp;&nbsp; 
 <i>Ultramicroscopy</i> 6: 343-358 (1981)    &nbsp;&nbsp;

</ol>


<hr />
<p />

<small>
  Source: mr.html         &nbsp;&nbsp;&nbsp; 
  Page updated: 8/5/14    &nbsp;&nbsp;&nbsp;
  ArDean Leith                              <br />
</small>

</body>
</html>

@


1.123
log
@bad link fixed
@
text
@d186 2
a187 2
   If you have <a href="../../../tools/install.html">installed</a> them,   
   <a href="../../../../tools/docs/tools.html"> SPIDER's Python Tools</a>   
d195 1
a195 1
<a href="../../../spire/spire-docs/index.html">
d203 1
a203 1
   <a href="../../../spire/spire-docs/index.html"> 
d437 1
a437 1
    <li> <a href="../../../tools/docs/ctfdemo.html">
d517 1
a517 1
    <a href="../../../../web/docs/ctf.html">CTF from doc file</a>
d530 1
a530 1
   Make a montage using <a href="../../../../web/docs/web.html">WEB</a> 
d770 1
a770 1
    <a href= "../../../../web/docs/web.html">WEB</a>. 
d784 1
a784 1
   Sorting can be done in <a href="../../../../web/docs/web.html">WEB</a>
d815 1
a815 1
   When manually selecting particles in <a href="../../../../web/docs/web.html">WEB</a>,
d1152 1
a1152 1
   <a href="../../../../web/docs/web.html">WEB</a> to display the rejected
d1235 1
a1235 1
   <p> Use the <b>Montage</b> operation in <a href="../../../../web/docs/web.html">WEB</a> 
d1382 1
a1382 1
    Use the <b>Montage</b> operation in <a href="../../../../web/docs/web.html">WEB</a> 
d1433 1
a1433 1
   <a href="../../../../web/docs/web.html">WEB</a> 
@


1.122
log
@links
@
text
@d195 3
a197 3
<a href="../../../spire/doc/index.html">
<font class="guitool">SPIRE</font></a> or using SPIDER
procedures directly.
d203 5
a207 3
   <a href="../../../spire/doc/index.html"> 
   <font class="guitool">SPIRE</font></a>, then read <a href="mrspire.html">how to run SPIDER procedure files in SPIRE</a>. 
   <font class="guitool">SPIRE</font> will create the necessary top level directory. </li>
d1659 3
a1661 3
<p><dt><a href="../diffmaps/index.html">Difference Maps</a> </dt>
<dd>Differences between volumes can be assessed by subtracting one volume 
    from the other.</dd>
@


1.121
log
@removed wadsworth link
@
text
@d134 1
a134 1
  <li> <a href="../../../glossary.html"> Glossary</a>. </li>
d136 1
a136 1
  <li> <a href="../../../strategies.html">Reconstruction strategies</a>.  </li>
d138 1
a138 1
  <li> <a href="flowchart/flowchart.html">Flowchart of operations</a>.</li>
d140 1
a140 1
  <li> <a href= "mr1_verify.html">Classification-based particle verification</a>.</li>
d142 1
a142 1
  <li> <a href="docfiles.html">Format information for doc files</a>. </li>
d144 1
a144 1
  <li> <a href="params.html">Description of reconstruction parameters</a>.</li>
d146 1
a146 1
  <li> <a href="../zi/zidoc.html">Using images from a ZI scanner</a>. </li>
d148 1
a148 1
  <li> <a href="../../recon/quantifoil.html">Handling circular images from Quantifoil grids</a>.</li>
d269 2
a270 4
   <small> (for an archive of older procedure files used at Albany, 
   <a href="Attic/batcharch">click here</a>)</small>.  Copy this archive to your 
   working directory and unpack it:                                      <br />
   <b><code>tar -zxvf spiproject.tar </code> </b>                        <br />
@


1.120
log
@link fixed
@
text
@a1762 1
  <address> Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a> </address>
@


1.119
log
@updated some links
@
text
@d46 1
a46 1
<a href="../recon1/Docs/mr1.html">
d55 2
a56 1
whereas the use of defocus groups does not present such limitations.   
a81 1
   <tr> <td>       
d83 1
a83 3
   <h3 class="heading">Outline</h3>
   <p />
   </td> </tr>
d86 2
@


1.118
log
@zi2spi loc
@
text
@a122 3

<p><a href="./flowchart/flowchart.html">A flowchart of operations</a></p>

d125 7
a131 1
For further information:
d134 1
a134 3
  <li> See the <a href="../../strategies.html">reconstruction strategies</a> page 
    and the <a href="../../glossary.html">glossary</a>.
  </li>
d136 1
a136 3
  <li> <a href="#PP92">Penczek et al. (1992)</a> describe the technique 
       of 3D reconstruction from particle images.
  </li>
d138 13
a150 3
  <li> <a href="#PP94">Penczek et al. (1994)</a> describe reconstruction using 
       projection matching (the approach outlined below).
  </li>
d152 1
a152 11
  <li> <a href="http://www.amazon.com/gp/product/0195182189/">
       Three-Dimensional Electron Microscopy of Macromolecular Assemblies</a>
       Oxford University Press,  (February 2006)
  </li>

  <li> <a href="../../ref.html">More references</a></li>

  <li>Information about images from the <b><a href="zi/zidoc.html">ZI scanner</a></b></li>

  <li>Convert ZI scanner TIF files to SPIDER format: 
      <b><a href="../../recon/zi/zi2spi.c">zi2spi.c</a></b></li>
a153 3
  <li>Procedure files for circular images from 
      <b><a href= "quantifoil.html">Quantifoil grids</a></b>.</li>
</ul>
d1682 4
a1685 4
<a name="RRRRRRR"></a> 
<table class="heading" width="100%"><tr><td> <br />
   <h3 > References</h3>
   </td></tr>
a1686 1
<p />
a1688 5
   <a name="PP92" />
   <li> Penczek P., Rademacher M, and Frank J. (1992) &nbsp;&nbsp;  
   Three-dimensional reconstruction of single particles embedded in ice.&nbsp;&nbsp; 
    <i>Ultramicroscopy</i> 40:33-53.
   </li>
d1690 62
a1751 6
   <a name="PP94" />
   <li> Penczek P, Grassucci RA and Frank J. (1994) &nbsp;&nbsp;  
   The ribosome at improved resolution: New techniques for merging and orientation 
   refinement in 3D cryo-electron microscopy of biological particles. &nbsp;&nbsp; 
   <i>Ultramicroscopy</i> 53, 251-270.
   </li>
d1753 1
a1753 33
   <a name="PP97" />
   <li>Penczek PA, Zhu J, Schrer R, Frank J. (1997) &nbsp;&nbsp; 
   <a href="../ctf/pfefferkorn.pdf">Three Dimensional Reconstruction with Contrast 
   Transfer Compensation from Defocus Series.</a> &nbsp;&nbsp; 
   Special Issue on Signal and Image Processing, <i>Scanning Microscopy</i> 
   Volume 11, page 147.
   </li>

   <a name="PP12" />
   <li>Penczek PA. (2012) &nbsp;&nbsp; 
   Fundamentals of three-dimensional reconstruction from projections. &nbsp;&nbsp; 
   <i>Methods in Enzymology</i> Volume 482, pages 1-33.
   </li>

   <a name="BR04" />
   <li>Rath BK and Frank J. (2004) &nbsp;&nbsp; 
   <i>Journal of Structural Biology</i>, Volume 145, Issues 1-2, January 2004, 
   Pages 84-90.
   </li>

   <a name="AR03" />
   <li>Alan Roseman (2003) &nbsp;&nbsp;
   <i>Ultramicroscopy</i>, Vol 94 (3-4), pp. 225-236
   </li>

   <a name="SH08" />
   <li>Shaikh TR, Gao H, Baxter WT, Asturias FJ, Boisset N, Leith A, Frank J. (2008) 
   &nbsp;&nbsp;
   <a href="http://www.nature.com/nprot/journal/v3/n12/full/nprot.2008.156.html">
   SPIDER image processing for single-particle reconstruction of 
   biological macromolecules from electron micrographs.</a>  &nbsp;&nbsp;
   Nature Protocols 3, 1941-1974 
   </li>
a1754 1
</ol>
@


1.117
log
@tools update,  cosmetic
@
text
@d140 1
a140 1
       projection matching (the approach  outlined below).
d153 1
a153 1
      <b><a href="../../../download/zi2spi.c">zi2spi.c</a></b></li>
@


1.116
log
@mr1 link was wrong
@
text
@d34 2
a35 1
This page describes methods for creating a 3D reconstruction from electron micrographs using defocus groups. 
d59 2
a60 1
In comparison, CTF-correction is applied at the level of windowed particle images offers its own advantages.  
d67 2
a68 2
Lastly, interoperability with other software packages 
which also correct for the CTF at the level of particle images will be more straightforward.
d73 3
a75 1
<p></p>
a76 1
<HR>
d78 1
d81 2
a82 1
   <tr> <td>    <br />  
d84 1
a84 5
   
   <p class="explain"></p>
   
   <P></P>
   
d188 6
a193 4
   <font class="guitool"> Graphical tools </font> : 
   Some results can be analyzed with  
   <a href="../../../spire/doc/guitools/index.html">graphical interfaces</a>, 
   if they have been installed. 
d441 1
a441 1
    <li> <a href="../../../spire/doc/guitools/ctfdemo.html">
d475 1
a475 1
          <a href="../../../spire/doc/guitools/pyplot.html">
d488 1
a488 1
   <a href="../../../spire/doc/guitools/ctfmatch/ctfmatch.html">
d589 1
a589 1
      <li> <a href="../../../spire/doc/guitools/ctfgroup.html">
d593 1
a593 1
      <li> <a href="../../../spire/doc/guitools/pyplot.html">
d1046 1
a1046 1
    create the following files for a all defocus groups.
d1695 1
a1695 1
   <li> Penczek, P., M. Rademacher, and J. Frank (1992) &nbsp;&nbsp;  
d1701 1
a1701 1
   <li> Penczek, P., Grassucci, R.A. and Frank, J. (1994) &nbsp;&nbsp;  
d1708 1
a1708 1
   <li>P.A. Penczek, J. Zhu, R. Schrer, J. Frank (1997) &nbsp;&nbsp; 
d1716 1
a1716 1
   <li>P.A. Penczek (2012) &nbsp;&nbsp; 
d1722 1
a1722 1
   <li>B.K. Rath and J. Frank (2004) &nbsp;&nbsp; 
d1744 1
a1746 2

<p>
d1748 3
a1750 9
  Page updated: 12/12/13  &nbsp;&nbsp;&nbsp;
  ArDean Leith
</p>

<p>
  <address>  
  Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a>
  </address>
</p>
@


1.115
log
@lfc_pic dir wrong
@
text
@d45 1
a45 1
<a href="../recon1/myproject/Docs/mr.html">
d861 1
a861 1
   <font class="input">../Particles/good/ngood****</newprognewprogssfont> to 
@


1.114
log
@batcharch moved to Attic
@
text
@d701 3
a703 3
       SPIDER procedure <a class="project" href="../Particles/pick.spi">pick.spi</a> (which calls:  
       <a class="project" href="../Particles/convert_p.spi">convert_p.spi</a> 
       and <a class="project" href="../Particles/pick_p.spi">pick_p.spi</a>)
d727 1
a727 1
    <li>SPIDER procedure <a class="project" href="../Particles/lfc_pick.spi">lfc_pick.spi</a> 
d729 2
a730 2
       <a class="project" href="../Particles/convert_p.spi">convert_p.spi</a> and
       <a class="project" href="../Particles/pickparticle.spi">pickparticle.spi</a>) 
d738 1
a738 1
       Procedure <a  href="../Particles/lfc_pick.spi">lfc_pick.spi</a>
d861 1
a861 1
   <font class="input">../Particles/good/ngood****</font> to 
@


1.113
log
@changes
@
text
@d270 2
a271 2
   (for the <b>archive</b> of <b>older</b> procedure files,
   <a href="batcharch/Attic">click here</a>).  Copy this file to your 
d1741 1
d1745 3
a1747 3
Source: mr.html         &nbsp;&nbsp;&nbsp; 
Page updated: 02/24/13  &nbsp;&nbsp;&nbsp;
ArDean Leith
d1751 3
a1753 3
<address>&copy; <a href="../../copyright.html">Copyright notice</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a>
</address>
@


1.112
log
@ctf ed link bug
@
text
@d29 1
a29 1
<!-- xxxxxxxxxxxxxxxxxxxxxxxx Overview xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
d31 1
a31 1
<h3 align="center">Overview</h3>
d41 1
a41 1
</P>
d71 1
a71 1
<P></P>
d90 29
a118 29
<dt> <a href="#CTF">Contrast Transfer Function (CTF) Estimation</a> </dt>
<dd>The CTF is estimated for each micrograph, and the micrographs 
   are sorted into defocus groups.</dd>

<dt> <a href="#AUTO">Particle Picking and Selection</a> </dt> 
<dd>Identifies likely particles from the micrographs, 
   and extracts windowed images of individual particles from the micrographs.</dd>

<dt> <a href="#SH">Alignment</a> </dt>
<dd>The particle images are aligned to reference projections using shifts 
    and rotations.</dd>

<dt> <a href="#CA">Averaging</a> </dt>
<dd>The averages of each reference view are computed, to assess the distribution 
    of projection views.</dd>

<dt> <a href="#3D">3D Reconstruction</a></dt>
<dd>An initial volume is calculated by back projection, along with an estimate 
    of its resolution.</dd>

<dt> <a href="#REF">Refinement</a> </dt>
<dd>Initial alignments are iteratively improved, as each projection is given a
    chance "to find a better home" in terms of its orientation and phase
    origin, thus improving the resolution of the initial reconstruction.</dd>

<dt> <a href="#OTHER">Additional methods</a> </dt>
<dd>Other useful methods, such as classification, difference maps, and 
    frequency correction by X-ray scattering.  Additional details about these 
    methods may be found at the <a href="../../techniques.html">techniques</a> page.</dd>
d185 1
a185 1
   but not both (unless you want to compare the two techniques!) <br />
d189 1
a189 1
   <a href="../../../spire/spire_linux-1.5.4/doc/guitools/index.html">graphical interfaces</a>, 
d195 3
a197 1
There are two different choices for running SPIDER procedures: Using SPIRE or using SPIDER
d203 4
a206 3
   <li> If you are using  <a href="../../../spire/spire_linux-1.5.4/doc/index.html">SPIRE</a>, 
   then read <a href="mrspire.html">how to run SPIDER procedure files in SPIRE</a>. 
   SPIRE will create the necessary top level directory. </li>
d219 7
a225 5
   <b><code>spider spi/dat @@proc</code></b> <br />
   where <b><code>spi</code></b> is the procedure file extension, 
   <b><code>dat</code></b> is the project data file extension, and 
   <b><code>proc.spi</code></b> is the procedure file.
   </li>
d235 1
a235 1
  output files to make ure the results are sensible. If you are not sure what is
d240 1
a240 1
<hr \>
d273 1
a273 1
   <b><code>gunzip spiproject.tar.gz; tar xvf spiproject.tar</code> </b> <br />
d334 7
a340 6
<li><p class="action">Create a selection doc file for micrograph file numbers</p>

   The procedure
   <a class="project" href="./newprogs/makefilelist.spi">makefilelist.spi</a>  
   creates a micrograph selection doc file containing consecutive file numbers in 
   the top-level project directory: <br/>
d344 2
a345 3
          <td><code class="output">sel_micrograph</code>:</td>
          <td>Micrograph selection doc file listing the numbers of 
             the micrograph files to be processed. </td> </tr>
d347 7
a353 7
   The  text part of the filenames are entered as templates in the top 
   level procedure files - see below).  If you need to add/exclude
   files from this list , use a text editor to edit the appropriate
   lines, then use the <a href="../../man/tfed.html"><b>'DOC REN'</b></a> 
   operation in SPIDER to renumber lines in the selection doc file.
</li>
<p />
a354 1
<li><p class="action">Put micrograph files in  <i>Micrographs</i> directory</p>
d356 7
a362 3
   directory if they are not already there. The procedures below can accept 
   SPIDER, Hiscan TIFF, PerkinElmer, ZI, and
   Nikon Coolscan outputs.  Any of these files may have been compressed with 
d372 19
d392 4
a395 7
<p>
   <li>A reference volume is required. If the pixel size of your reference 
   volume (key 5 in the <font class="input">params</font> file) and/or the 
   dimensions do not match the window size (key 17 in <code class="output">params</code>),
   then you must run the procedure 
   <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>
   in the top-level project directory to resize the volume. This creates:      <br />
d399 3
a401 2
          <td> <code class="output">reference_volume</code>: </td>
          <td>&nbsp; Resized reference volume.</td></tr>
d403 9
a411 2
   </li>
</p>
d438 1
a438 1
    <li> <a href="../../../spire/spire_linux-1.5.4/doc/guitools/ctfdemo.html">
d454 6
a459 5
   <a class="project" href="./newprogs/powdefocus.spi">powdefocus.spi</a> 
   to read each micrograph using
   <a class="project" href="./newprogs/loadmic.spi">loadmic.spi</a>,
   compute an averaged power spectrum, and estimate defocus using 
   <a href="../../man/ctfed.html"><b>CTF ED</b></a>. 
d464 1
a464 1
          <td><code class="output">power/pw_avg***</code> </td>
d469 1
a469 1
          <td><code class="output">power/roo***</code> </td>
d472 1
a472 1
          <a href="../../../spire/spire_linux-1.5.4/doc/guitools/pyplot.html">
d476 1
a476 1
          <td><code class="output">power/ctf***</code>: </td>
d480 1
a480 1
          <td><code class="output">defocus</code>:</td>
d484 2
a485 2
   The <code class="output">ctf***</code> files can be verified with 
   <a href="../../../spire/spire_linux-1.5.4/doc/guitools/ctfmatch/ctfmatch.html">
a489 9
<li>Run <a href="./newprogs/powdefocus.spi">powdefocus.spi</a> 
    as in <b>a.</b> to create power spectra: 
    <font class="input">power/roo***</font>.  Then use  
    <a href="../../../../web/docs/ctf.html">CTF from doc file</a>
    in <b>WEB</b> to read <font class="input">power/roo***</font> 
    and  manually fit a CTF model to the 1D profiles.
</li>
<p />

d497 1
a497 1
   <a href="../../man/ctffind.html"><b>CTF FIND</b></a>.
d515 6
d524 3
d543 3
d586 1
a586 1
      <li> <a href="../../../spire/spire_linux-1.5.4/doc/guitools/ctfgroup.html">
d590 1
a590 1
      <li> <a href="../../../spire/spire_linux-1.5.4/doc/guitools/pyplot.html">
d635 2
d639 1
a639 1
   <h3 class="heading">Particle Picking and Selection</h3>
d645 2
a646 2
      said to be <i>picked</i>; the subset that are manually chosen are said to 
      be <i>selected</i>.
d649 1
a649 1
   <p>These procedures should be run in the <i>Particles</i> directory.</p>
d700 5
a704 5
    <li>The procedure 
       <a class="project" href="./newprogs/pick.spi">pick.spi</a> (which calls 
       <a class="project" href="./newprogs/pick_p.spi">pick_p.spi</a>)  
       uses <a class="project" href="../../autopartpick.html">Correlation with a Gaussian blob</a>
       to search  for particles.
d706 2
a707 2
       The micrographs are decimated by 1/4, Fourier filtered with a Gaussian 
       low pass filter, and searched for
d709 2
a710 2
       are windowed out and centered; then peak locations are corrected, and
       particles are windowed again.  This procedure uses histogram
d715 1
a715 1
              <td><code class="output">win/winser_****</code>: </td>
a716 1

d718 2
a719 4
              <td><code class="output">coords/sndc****</code>: </td>
              <td>Peak coordinates (center of particle) and height 
                  from 1/4 decimated image.</td></tr>

d721 2
a722 2
              <td><code class="output">coords/pkcoord****</code>: </td>
              <td>Top left pixel coordinates for particle images.</td></tr>
d727 1
a727 2
   <li>The procedure 
       <a class="project" href="./newprogs/lfc_pick.spi">lfc_pick.spi</a> 
d729 7
a735 5
       <a class="project" href="./newprogs/pickparticle.spi">pickparticle.spi</a>)  
       uses <a href="../../partpick.html#LFC">local Fast cross-correlation</a> 
       calculated using Fourier methods proposed by
       <a href="#AR03">Roseman (2003)</a>. The implementation is described in 
       <a href="#BR04">Rath and Frank (2004)</a>.  A reference volume is required
d738 1
a738 1
       The  <a  href="./newprogs/lfc_pick.spi">lfc_pick.spi</a> procedure 
d740 1
a740 1
       Output files:                                         <br />
d744 1
a744 1
              <td><code class="output">win/winser_***</code>: </td>
d747 2
a748 3

              <td><code class="output">win/sel_particle_***</code>: </td>
              <td> Particle selection doc file for each micrograph.</td></tr>
d750 1
a750 2

              <td><code class="output">coords/sndc***</code>: </td>
d753 1
a753 1
   </li>
a754 2
</li>
<p />
d756 9
a764 9
<a name="PFILT"></a>
<li><p class="action">[<b>Optional</b>] Low-pass filter particle images before
    particle selection</p>

    The procedure <a class="project" href="./newprogs/pfilt.spi">pfilt.spi</a> 
       filters a set of images, adjusting filter settings for each micrograph, 
       based on its defocus and creates:      <br />
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
d767 10
a776 7
   </table>
   Manual selection of good particles (the next step) is easier if
   the particles have been low-pass filtered beforehand. Use the 
   filtered particles, not the raw particles, during selection in 
   <a href= "../../../../web/docs/web.html">WEB</a>. 
</li>
<p />
d778 2
d781 3
a783 1
<li><p class="action">Verify the automatically selected particles</p>
d785 1
a785 2
   Sort through the output files to eliminate any non-particles. This
   can be done in <a href="../../../../web/docs/web.html">WEB</a>
d791 2
a792 1
   <a href="../../partpick.html">partpick.html</a>). <br />
d817 1
a817 1
   sometimes a particle is accidently double clicked. This procedure 
d1213 2
a1214 2
   <a class="project" href="./newprogs/display.spi">display.spi</a> and its procedure 
   <a class="project" href="./newprogs/display_p.spi">display_p.spi</a> read 
d1221 1
a1221 1
          <td> <code class="output">display/cndis_by_group</code>: </td> 
d1226 1
a1226 1
          <td> <code class="output">display/cndis_all_groups</code>: </td> 
@


1.111
log
@*** empty log message ***
@
text
@d426 1
a426 1
   <a href="../../man/tfed.html"><b>TF ED</b></a>. 
d473 1
a473 1
   <a href="../../man/tffind.html"><b>TF FIND</b></a>.
d1706 1
a1706 1
Page updated: 09/04/12  &nbsp;&nbsp;&nbsp;
@


1.110
log
@was missing: <!-- SPIRE directory=_top......
@
text
@d239 1
d245 1
a245 1
   directory has to be set up with the proper subdirectories and procedure files. </p>
d255 1
a255 1
   subdirectories and procedure files </li> 
d259 1
a259 1
   the directories with the current set of procedure files. </li>
d266 2
a267 2
   <a href="batcharch">click here</a>).  Copy this file to your 
   working directory and unpack it:               <br />
d272 1
a272 1
   as the data extension, e.g.:                          <br />
@


1.109
log
@*** empty log message ***
@
text
@d277 2
d614 1
a614 1
<!-- SPIRE directory=Particles subdirectories=coords, good, win, flt xxxxxxxxxx -->
@


1.108
log
@*** empty log message ***
@
text
@d52 3
a54 5
<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bprp.html">
<b>'BP RP'</b></a> or
<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bpcg.html">
<b>'BP CG'</b></a>, whereas the use of defocus groups does not present such 
limitations.   
@


1.107
log
@removed: astigmatism, and cut-off frequency
note
@
text
@d1271 2
a1272 15
   They first create two particle selection doc files for each defocus group 
   by partitioning alternate images into two sets: 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">df***/sel_even</code>: </td> 
          <td> List of odd numbered images for each defocus group.</td></tr>  

      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">df***/sel_odd</code>: </td> 
          <td> List of even numbered images for each defocus group.</td></tr> 
   </table>
   <p />

   They then create two reconstructions for each defocus group using 
d1275 1
a1275 1
   correction file for that group: 
d1279 2
a1280 2
          <td> <code class="output">df***/vol01_odd</code>: </td>
          <td> Reconstructed volume from odd images for each defocus group.</td></tr> 
d1283 2
a1284 2
          <td> <code class="output">df***/vol01_even</code>: </td>
          <td> Reconstructed volume from even images for each defocus group.</td></tr> 
d1299 1
a1299 1
     Finally, they apply CTF correction to all the defocus group odd/even volumes 
d1301 1
a1301 1
     add together the 'odd' and 'even 'volumes to make a volume for the entire data set, . 
d1303 1
a1303 1
     (see <a href="../../man/rf3.html">RF 3</a> operation) creating 
d1317 2
a1318 3
          <td> Doc. file containing group number, FSC cutoff,  
              corresponding normalized frequency, and 
              resolution (in Angstroms).                          </td> </tr> 
d1334 1
a1334 1
   <font class="input">df***/vol01_odd</font> to create:    <br />
d1339 1
a1339 1
          <td> Stack of central slices from each odd defocus group volume. </td></tr> 
d1468 8
a1475 10
   <a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a>,  &nbsp;
   <a class="project" href="./newprogs/prepare.pam">prepare.pam</a>,           &nbsp;
   <a class="project" href="./newprogs/enhance.pam">enhance.pam</a>,           &nbsp; 
   <a class="project" href="./newprogs/grploop.pam">grploop.pam</a>,           &nbsp; 
   <a class="project" href="./newprogs/smangloop.pam">smangloop.pam</a>,       &nbsp;
   <a class="project" href="./newprogs/mergegroups.pam">mergegroups.pam</a>,   &nbsp;
   <a class="project" href="./newprogs/saveresp.pam">saveresp.pam</a>,         &nbsp;
   <a class="project" href="./newprogs/endmerge.pam">endmerge.pam</a>,         &nbsp;
   <a class="project" href="./newprogs/endrefine.pam">endrefine.pam</a>, and   &nbsp;
   <a class="project" href="./newprogs/softmask.pam">softmask.pam</a>.
d1478 9
a1486 9
   If you are running on a cluster with <i>PubSub</i> you will also need: 
   <a href="../../../pubsub/publish.perl">publish.perl</a>,                                  &nbsp; 
   <a class="project" href="./newprogs/pub_refine_start.pam">pub_refine_start.pam</a>,        &nbsp;
   <a class="project" href="./newprogs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a>,  &nbsp;
   <a class="project" href="./newprogs/pub_refine_wait.pam">pub_refine_wait.pam</a>,          &nbsp;

   <a class="project" href="./newprogs/pub_ref_loop_clone.pam">pub_ref_loop_clone.pam</a>,     &nbsp;
   <a class="project" href="./newprogs/pub_ref_loop_declone.pam">pub_ref_loop_declone.pam</a>, &nbsp;
   <a class="project" href="./newprogs/pub_ref_merge_clone.pam">pub_ref_merge_clone.pam</a>,   &nbsp;
d1488 1
a1488 1
   <a class="project" href="./newprogs/pub_fixrefine.pam">pub_fixrefine.pam</a>.
d1502 2
a1503 2
          <td> <code class="output">final/dres##_***</code>: </td>
          <td> Resolution curve doc. file</td></tr>
d1511 2
a1512 2
          <td> <code class="output">final/vol##_odd</code>: </td>
          <td>Filtered volume from odd numbered images</td></tr>
d1514 2
a1515 2
          <td><code class="output">final/vol##_even</code>: </td>
          <td>Filtered volume from even numbered images</td></tr>
d1523 2
a1524 2
          <td><code class="output">final/bpr##_***_odd</code>: </td>
          <td>Group volume from odd numbered images</td></tr>
d1526 2
a1527 2
          <td><code class="output">final/bpr##_***_even</code>: </td>
          <td>Group volume from even numbered images</td></tr>
d1532 2
a1533 2
          <td><code class="output">final/bpr##_even</code>: </td>
          <td>Final volume from even numbered images</td></tr>
d1535 2
a1536 2
          <td> <code class="output">final/bpr##_odd</code>: </td>
          <td>Final volume from odd numbered images</td></tr>
d1538 2
a1539 2
          <td><code class="output">final/dbpr##</code>: </td>
          <td>Overall resolution curve doc file</td></tr>
d1549 1
a1549 1
<li><p class="action">Plot the refinement resolution curves</p>
d1704 2
a1705 2
Source: mr.html        &nbsp;&nbsp;&nbsp; 
Page updated: 07/16/12  &nbsp;&nbsp;&nbsp;
@


1.106
log
@Added intro paragraphs comparing with without-defocus-group method
@
text
@d424 1
a424 2
   compute an averaged power spectrum, and estimate defocus, 
   astigmatism, and cut-off frequency using SPIDER operation 
d435 1
a435 1
          <td><code class="output">power/roo***</code></td>
d1721 1
a1721 1
Page updated: 06/16/12  &nbsp;&nbsp;&nbsp;
@


1.105
log
@with defocus groups
@
text
@d33 36
a68 6
<p>This page describes methods for creating a 3D reconstruction of
a ribosome from electron micrographs. Once a set of particle images
has been obtained, an initial 3D reconstruction is calculated using
coarse projection angles. This is followed by refinement, which
iteratively adjusts the angles for finer resolution. The following
procedures are described in greater detail below.
d71 19
d1687 6
@


1.104
log
@CTFFIND3 changes
@
text
@d20 1
a20 1
       Specimens using Reference Projections </h2>
d1218 1
a1218 1
   these procedures read  
a1405 2
   <tr><td> <font class="input">../Alignment/dala01_***</font>: </td> 
       <td> Initial aligned stacked image files.</td></tr>
d1667 1
a1667 1
Page updated: 05/7/12  &nbsp;&nbsp;&nbsp;
@


1.103
log
@pickpart improved txt
@
text
@d413 1
a413 1
    and the allow the user manually fits a CTF model to the 1D profiles.
a416 11
<li>Run <a href="./defmrc.html">CTFFIND3</a> using SPIDER procedure:   
    <a class="project" href="./newprogs/mrcctf.spi">mrcctf.spi</a>. 
    This procedure  reads    
    <font class="input">../sel_micrograph</font> and 
    <font class="input">../Micrographs/raw****</font>. 
    It calls 
    <a class="project" href="./newprogs/loadmic.spi">loadmic.spi</a>, 
    <a href="http://emlab.rose2.brandeis.edu/software">ctffind3</a> 
    (the MRC CTFFIND3 program), and
    <a class="project" href="./newprogs/readmrc.py">readmrc.py</a>, 
    (python script), and creates: <br />
d418 24
a441 20
    <table class="outs">
       <tr valign="top"> 
          <td>&curren;</td>
          <td><code class="output">defocus-mrc</code>:</td>
          <td>A doc file of defocus and astigmatism values. 
          <a href="./def/defocus-mrc.txt">Example</a></td>
       </tr>
 
       <tr valign="top">
          <td>&curren;</td>
          <td><code class="output">powchk****</code>:</td>
          <td>SPIDER power spectra files for evaluating defocus. 
              <a href="./def/powchk4078.png">Example</a></td></tr>
       <tr valign="top">
          <td>&curren;</td>
          <td><code class="output">report****</code>:</td>
          <td>CTFFIND report <a href="./def/report4078.txt">Example</a>.</td></tr>
    </table>
    Note that <a href="../../man/tfed.html"><b>TF ED</b></a> produces different
    values for the astigmatism and astigmatism angle from CTFFIND3. 
a442 5
</ol>




@


1.102
log
@*** empty log message ***
@
text
@d376 1
a376 1
   astigmatism, and cuttoff frequency using SPIDER operation 
d593 5
a597 3
         <a class="project" href="./newprogs/noise.spi">noise.spi</a> calls 
         <a class="project" href="./newprogs/convert_p.spi">convert_p.spi</a>, 
         reads <font class="input">../Micrographs/raw****</font> and creates: <br />
d610 2
a611 2
         If it has any structure (particle, junk), then select one of the other
         candidates and copy it to <code class="output">noise.ext</code>..
d620 2
a621 1
   require the conversion procedure:  <a href="./newprogs/convert_p.spi">convert_p.spi</a> 
d625 5
a629 4
    <li>
       <a class="project" href="./newprogs/pick.spi">pick.spi</a> and its procedure 
       <a class="project" href="./newprogs/pick_p.spi">pick_p.spi</a>, 
       Apply correlation with a Gaussian blob.
d631 2
a632 3
       The micrographs are decimated by 1/4,
       Fourier filtered with a Gaussian low pass filter, and 
       <a class="project" href="../autopick.html">searched</a> for
d655 8
a662 8
   <li><a class="project" href="./newprogs/lfc_pick.spi">lfc_pick.spi</a> 
       (and procedure 
       <a class="project" href="./newprogs/pickparticle.spi">pickparticle.spi</a>) 
       use the Local Fast Correlation algorithm.  
       This procedure uses <a href="../../partpick.html#LFC">local cross-correlation</a> 
       calculated using Fourier methods outlined by
       <a href="#AR03">Roseman (2003)</a>. This implementation is described in 
       <a href="#BR04">Rath and Frank (2004)</a>. A reference volume is required
d665 1
a665 1
       Procedure: <a  href="./newprogs/lfc_pick.spi">lfc_pick.spi</a>
d667 1
a667 1
       Output files:<br />
d697 1
a697 1
         <td>Stacks of low-pass filtered particle images.</td></tr>
d1681 1
a1681 1
Page updated: 05/4/12  &nbsp;&nbsp;&nbsp;
@


1.101
log
@*** empty log message ***
@
text
@d29 2
a30 1
<!-- --------------------- Overview ------------------------------------ -->
d114 1
a114 1
<!-- ------------------- Running  SPIDER procedure files ------------------- -->
d188 2
a189 2
<hr>
<!-- ------------------- Creating new reconstruction project ------------------- -->
d255 1
a255 2
   It also renames the data set's micrograph files as necessary. You can skip the 
   next step creating a parameter doc. file as it is already present.</li>
d334 3
a336 1
<!-- --------------------------------- CTF ------------------------------- -> 
d347 2
a348 1
</td></tr></table>
d560 1
a560 1
<!-- ------------------- Particle Picking and Selection ------------------- -->
d578 1
a578 1
<!-- SPIRE directory=Particles subdirectories=coords, good, win, flt ------ -->
d618 1
a618 1
   require the converting procedure  <a href="./newprogs/convert_p.spi">convert_p.spi</a> 
d628 2
a629 1
       Fourier filtered with a Gaussian low pass filter, and searched for
d631 2
a632 2
       are windowed out and centered, then peak locations are corrected, and
       particles are windowed again. This procedure uses histogram
d639 1
d641 4
a644 2
              <td><code class="output">coords/ndc****</code>: </td>
              <td>Peak coordinates and height from 1/4 decimated image.</td></tr>
d671 1
d675 1
d753 2
a754 1
<!-- ---------------------------- Alignment ------------------------------ -->
d908 1
a908 1
<!-- -------------------------- Compute Averages--------------------------- -->
d1191 1
a1191 1
<!-- -------------------------- 3D Reconstruction ------------------------ -->
d1376 1
a1376 1
<!-- -------------------------- Refinement ------------------------ -->
d1678 1
a1678 1
Page updated: 04/10/12  &nbsp;&nbsp;&nbsp;
@


1.100
log
@*** empty log message ***
@
text
@d931 1
a931 1
          <td><code class="output">df***/sel???</code>: </td>
@


1.99
log
@typos
@
text
@d948 2
a949 1
    <a class="project" href="./newprogs/average.spi">average.spi</a> reads
a966 5
   Use the <b>Montage</b> operation in <a href="../../../../web/docs/web.html">WEB</a> 
   to view the sets of average images. Projection views with many particles will 
   have averages that reasemble the reference projection. Projection views 
   with few particles will be noisy.

d985 1
a985 1
   selecting true particles </p>
@


1.98
log
@Updated description of resizevol.spi
@
text
@a962 3
     <tr valign="top"><td>&curren;</td>
          <td><code class="output">align_01_all</code>: </td> 
          <td>Merged alignment parameters from all images in all defocus groups. </td></tr>
d1072 1
a1072 1
   This will help you dtermine whether the correlation coefficient threshold that
@


1.97
log
@misc input/output fine name typos
@
text
@d316 3
a318 3
   <li>A reference volume is required. If the dimensions of your reference 
   volume do not match the window size (key 17 in the 
   <code class="output">params</code> file), 
d320 1
a320 1
   <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>.
@


1.96
log
@gnuplot links, sel_micrograph, tiff--> png, Tapu's R
@
text
@d334 1
a334 1
<!-- --------------------------------- CTF ------------------------------- --> 
d633 1
a633 1
              <td><code class="output">stk_****</code>: </td>
d655 1
a655 1
       Proceduree; <a  href="./newprogs/lfc_pick.spi">lfc_pick.spi</a>
d786 1
a786 1
   <small>Note: this step is not necessary when using Nature Protocol's data set.</small>
d801 1
a801 1
   <small>Note: this step is not necessary when using Nature Protocol's data set.</small>
d856 1
a856 1
      <font class="input">projs/prj***</font>, 
d875 1
a875 1
      <font class="input">sel_group</font>, <font class="input">projs/prj***</font>, 
d921 1
a921 1
   <font class="input">../Alignment/align_01***</font> 
d1165 1
a1165 1
   <font class="input">df***/sel**</font> to create: <br />
d1675 1
a1675 1
Page updated: 11/8/10  &nbsp;&nbsp;&nbsp;
@


1.95
log
@*** empty log message ***
@
text
@d177 1
a177 3
   <a href="http://www.gnuplot.info/docs/gnuplot.html">Gnuplot manual</a>
   and much more about <i>gnuplot</i> is available at
   <a href="http://www.gnuplot.info">Gnuplot Central</a> 
d288 1
a288 1
          <td><code class="output">sel_micro</code>:</td>
d438 1
a438 1
              <a href="./def/powchk4078.tif">Example</a></td></tr>
d471 1
a471 1
   by removing them from the <font class="input">sel_micro</font> micrograph 
d1644 2
a1645 1
   Special Issue on Signal and Image Processing, <i>Scanning Microscopy</i> Volume 11, page 147.
d1660 2
a1661 1
   <li>Shaikh TH, Gao H, Baxter WT, Asturias FJ, Boisset N, Leith A, Frank J. (2008) &nbsp;&nbsp;
@


1.94
log
@spire_linux-1.5.4 loc
@
text
@d335 2
a336 2
<hr>
<!-- --------------------------------- CTF ------------------------------- -->
d491 3
a493 3
      the <font class="input">defocus</font> doc file generated by one of the above methods, 
      and the <font class="input">sel-micrograph</font> selection doc file 
      and creates:        <br />
d498 1
a498 1
             <td>A doc file with the same information sorted by defocus.</td></tr>
a499 1
      It also tentatively assigns each micrograph to a defocus group. 
d746 1
a746 1
<!-- ---------------------------- Alignment  ------------------------------ -->
d783 1
a783 1
          <td><code class="output">sel_group </code>:  </td> 
d828 3
a830 3
          <td>A doc. file listing the three Euler angles for each of the projections, 
              generated with the SPIDER operation 
              <a href="../../man/voea.html"><b>VO EA</b></a></td></tr>
d834 3
a836 3
          <td>Stacked reference images produced with  
              <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> using the above
              file.</td></tr>
d843 1
a843 1
         setting register [usectf] = 0. They will be in the file
d846 2
a847 2
     <li>Generate more realistic references by multiplying them by the CTF (the 
         default). There will be a stack of reference projections for each defocus 
d1520 1
a1520 1
          <td>Doc file containing resolution at each iteration.</td></tr> 
d1522 1
a1522 1
/li>
d1675 1
a1675 1
Page updated: 11/1/10  &nbsp;&nbsp;&nbsp;
@


1.93
log
@defocus changes ctffind3, etc
@
text
@d141 1
a141 1
   <a href="../../../spire/doc/guitools/index.html">graphical interfaces</a>, 
d153 1
a153 1
   <li> If you are using  <a href="../../../spire/doc/index.html">SPIRE</a>, 
d355 1
a355 1
    <li> <a href="../../../spire/doc/guitools/ctfdemo.html">
d389 1
a389 1
          <a href="../../../spire/doc/guitools/pyplot.html">
d402 1
a402 1
   <a href="../../../spire/doc/guitools/ctfmatch/ctfmatch.html">
d513 1
a513 1
      <li> <a href="../../../spire/doc/guitools/ctfgroup.html">
d517 1
a517 1
      <li> <a href="../../../spire/doc/guitools/pyplot.html">
d1676 1
a1676 1
Page updated: 9/15/10  &nbsp;&nbsp;&nbsp;
@


1.92
log
@updates
@
text
@d5 2
a6 2
<title>Single Particle Reconstruction Techniques</title> 
<link rel='stylesheet' href='mrstyle.css' type='text/css' />
d9 1
a9 1
<body  link="#0000ee" vlink="#0000ee" alink="#ff0000" bgcolor="#cccccc">
d363 6
a368 2
<li>
   <p class="action">Calculate the power spectrum for each micrograph</p>
d370 8
a377 4
   <p>
   <a class="project" href="./newprogs/power.spi">power.spi</a> reads each micrograph 
   and computes an averaged power spectrum for it.  Each micrograph has two  
   corresponding output files: </p>
d391 8
d400 13
d416 40
a465 1

d467 2
a468 2
      <li>Are the Thon rings round?         </li>
      <li>Do they extend to high resolution?</li>
a483 52
<li><a name="DEF"> <p class="action">Determine defocus</p>
   <p>
   Use one of the following methods to estimate defocus for each micrograph: 

   <ol class="choice">
      <li><a class="project" href="./newprogs/defocus.spi">defocus.spi</a> reads
         <font class="input">../sel_micrograph</font> and 
         <font class="input">power/pw_avg****</font>.  
         It estimates defocus, astigmatism, and cuttoff frequency
         for the micrograph using SPIDER operation 
         <a href="../../man/tfed.html"><b>TF ED</b></a> and creates: <br />

        <table class="outs">
          <tr valign="top"> <td>&curren;</td>
             <td><code class="output">defocus</code>:</td>
             <td>A doc file of defocus and astigmatism values.</td></tr>

          <tr valign="top"> <td>&curren;</td>
             <td><code class="output">power/ctf***</code>: </td>
             <td>Doc files of the background-subtracted 1D power spectra.</td></tr>
        </table>
        The <code class="output">ctf***</code> files can be verified with 
        <a href="../../../spire/doc/guitools/ctfmatch/ctfmatch.html">
        <font class="guitool">ctfmatch.py</font></a>
      </li>
      <p />

      <li><a href="../../../../web/docs/ctf.html">CTF from doc file</a>
         in <b>WEB</b>. Reads <font class="input">power/roo***</font> and the user
         manually fits a CTF model to the 1D profiles.
      </li>
      <p />

      <li><a class="project" href="./newprogs/mrcctf.spi">mrcctf.spi</a> reads 
         <font class="input">../sel_micrograph</font> and 
         <font class="input">../Micrographs/raw****</font>. 
         It calls 
         <a class="project" href="./newprogs/convert_p.spi">convert_p.spi</a> 
         (a SPIDER procedure), 
         <a class="project" href="http://emlab.rose2.brandeis.edu/software">ctffind3</a> 
         (the MRC CTFFIND3 program), and
         <a class="project" href="./newprogs/readmrc.py">readmrc.py</a>, 
         (python script), and creates: <br />

        <table class="outs">
          <tr valign="top"> <td>&curren;</td>
             <td><code class="output">defocus</code>:</td>
             <td>A doc file of defocus and astigmatism values.</td></tr>
        </table> 
      </li>
   </ol>
   </li>
@


1.91
log
@mrcctf changes
@
text
@d901 1
a901 1
<!-- SPIRE directory=Reconstruction subdirectories=hist,ctf avg, display -->
d1660 1
a1660 1
Page updated: 9/115/10  &nbsp;&nbsp;&nbsp;
@


1.90
log
@usr8/spider/spire
@
text
@d453 6
a458 4
         <a class="project" href="./newprogs/convert_p.spi">convert_p.spi</a>, 
         <a class="project" href="./newprogs/ctffind.sh">ctffind.sh</a>, a shell script, and 
         <a class="project" href="./newprogs/readmrc.py">readmrc.py</a>, a python script,  
         and creates: <br />
d1417 1
a1417 1
   <i>cp /spider/bin/spider_linux_mp_opt64.18.06 &nbsp;&nbsp; spider </i> </p>
d1660 1
a1660 1
Page updated: 7/20/10  &nbsp;&nbsp;&nbsp;
@


1.89
log
@rewrite
@
text
@d77 3
a79 1
<p>For further information:</p>
d104 1
a104 1
      <b><a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">download zi2spi.c</a></b></li>
d110 11
a120 5
<p>
   The data below are sometimes shown plotted with <i>gnuplot</i>.  An
   <a href="http://www.gnuplot.info/docs/gnuplot.html">online manual</a>
   for <i>gnuplot</i> is available. Much more about <i>gnuplot</i> is
   at <a href="http://www.gnuplot.info">Gnuplot Central</a> </p>
d122 1
a122 1
<p>
a125 1

d141 1
a141 1
   <a href="../../../../spire/doc/guitools/index.html">graphical interfaces</a>, 
d144 37
a181 1
</ul>
d183 3
d188 1
d190 1
a190 1
<!-- ------------------- Running  SPIDER procedure files ------------------- -->
d192 1
a192 1
<a name="RunningSPIDER"></a>
d195 1
a195 1
   <h3 class="heading">Running SPIDER procedure files</h3>
a203 5
<p />

<ul>
   <li> If you are running SPIDER at the Unix prompt, then read below to learn 
   how to execute SPIDER procedure files. </li>
d206 3
a208 4
   <li> If you are using  <a href="../../../../spire/doc/index.html">SPIRE</a>, 
   then skip this section and read <a href="mrspire.html">how to 
   run SPIDER procedure files in SPIRE</a>. </li>
</ul>
d210 3
a212 17
<p />
 
<p>Processing steps are carried out by procedure files,
  which run many SPIDER operations automatically. To use a procedure
  in this document, click the procedure filename and copy the procedure
  to your current working directory. At the beginning of each
  procedure, there is a list of parameters that can be adjusted
  according to the particular project. Some of the procedures will
  call additional procedure(s) (listed below the procedure
  filename). You need not change anything in the procedures. Use the
  following format to run a SPIDER procedure:   </p>

<blockquote><b><code>spider spi/dat @@proc</code></b></blockquote>

<p>where <b><code>spi</code></b> is the procedure file extension, 
  <b><code>dat</code></b> is the project data file extension, and 
  <b><code>proc.spi</code></b> is the procedure file. </p>
d214 1
a214 4
<p>
<ul>
   <li><p class="action">Create a project directory containing the required 
   subdirectories and procedure files   </p> 
d216 2
a217 2
   The procedure files below are packed into the zipped tar file 
   <a href= "./spiproject.tar.gz">spiproject.tar.gz</a>  
d220 2
a221 5
   working directory and unpack it:            <br />
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <b><code>gunzip spiproject.tar.gz; tar xvf spiproject.tar</code>
   </b>                                              <br />

d226 2
a227 2
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><code>mv myproject acn</code></b> </li>
</p>
d229 1
a229 1
<p />
d231 9
a239 14
<p>Some information is stored in project-wide document files
   that are used by many procedure files.  The following procedures should be
   run in the top-level project directory:     </p>
</ul>

<!-- SPIRE directory=_top_level_project -->

<ul>
<a name="PROTOCOLS"></a>
<small>
<li><p class="action">[<b>Optional</b>] If using data from Nature Protocols for testing, 
    you must stack the particle images before using the some of the procedures.</p>

    The procedure <a class="project" href="./newprogs/nat2stk.spi">nat2stk.spi</a> 
d244 1
a244 1
    to stacks images by defocus groups and creates: <br />
d256 2
a257 2
   It also renames the Protocol's micrograph files as 
   necessary. This step NOT necessary except to accomodate this older data set.</li>
d260 3
d266 2
a267 1
   Many procedure files read project parameters from this doc file. 
a299 1
</ul>
d302 4
a305 6
Input files needed for a reconstruction project:

<ul>
<p>
   <li>Files of the digitized micrographs should be placed in the <i>Micrographs</i> 
   directory. The procedures below can accept SPIDER, Hiscan TIFF, PerkinElmer, ZI, and
d312 3
a314 4
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b><code>rmdir Micrographs</code></b> <br />
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      <b><code>ln -s  /the/actual/location/of/the/micrographs &nbsp;&nbsp; Micrographs </code></b>
   </li>
d319 2
a320 1
   volume do not match the window size (key 17 in the parameter file), 
d323 1
a323 1
   in the top-level project directory to resize the volume:      <br />
a333 4
<p><h4>After running each procedure file, check the output files to make
  sure the results are sensible. If you are not sure what is
  "sensible", ask an expert.</h4> 
</p>
d339 1
a339 1
<table class="heading" width="100%"><tr><td>   <br />
a346 1
   The micrographs should be in the <i>Micrographs</i> directory.            </p>
d355 1
a355 1
    <li> <a href="../../../../spire/doc/guitools/ctfdemo.html">
d381 1
a381 1
          <a href="../../../../spire/doc/guitools/pyplot.html">
d421 5
a425 4
      <li><a class="project" href="./newprogs/defocus.spi">defocus.spi</a>
         reads <font class="input">../sel_micrograph</font> and 
              <font class="input">power/pw_avg****</font>.  
         It estimates defocus for the micrograph using SPIDER operation 
d437 2
a438 2
        The <code class="output">ctf***</code> files can be analyzed with 
        <a href="../../../../spire/doc/guitools/ctfmatch/ctfmatch.html">
d444 2
a445 1
         in <b>WEB</b>. Manually fitting a CTF model to the 1D profiles.
d449 14
a462 8
      <li><a class="project" href="./newprogs/mrc.spi">mrc.spi</a> a procedure file 
         that calls the MRC program <b>ctffind2</b>. It estimates both the defocus
         and astigmatism, and creates the output file:
         <code class="output">defocus</code>. It calls 
         <a class="project" href="./newprogs/ctffind">ctffind</a>, a shell script, and 
         <a class="project" href="./newprogs/readmrc.py">readmrc.py</a>, a python script. 
         See the <a href="defmrc.html">defmrc manual page</a> for more
         information.
d495 1
a495 1
      <li> <a href="../../../../spire/doc/guitools/ctfgroup.html">
d499 3
a501 1
      <li> <font class="guitool">pyplot</font></a> </li>
d505 1
a505 1
         text file, such as <a href="./newprogs/plotpower">plotpower</a>,
d507 1
a507 1
         <code>gnuplot&gt; load 'plotpower'</code>
d575 2
a576 1
         <a class="project" href="./newprogs/noise.spi">noise.spi</a> 
d588 1
a588 1
        . 
d591 1
a591 7
         candidates and copy it to <code class="output">noise.ext</code>. This 
         procedure file requires a micrograph in SPIDER format.  If your micrographs 
         are <b>TIF</b> and/or <b>gzipped</b> files, use
         <a class="project" href="./newprogs/convert.spi">convert.spi</a> and 
         its procedure 
         <a class="project" href="./newprogs/convert_p.spi">
         convert_p.spi</a> to convert one of these images to SPIDER format.
d746 1
a746 1
<!-- SPIRE directory=Alignment subdirectories=ali,prj -->
d899 1
a899 1
<!-- SPIRE directory=Reconstruction subdirectories=hist, avg, display -->
d1508 2
d1658 2
a1659 1
Page updated: 1/18/10 &nbsp;&nbsp;&nbsp;
@


1.88
log
@defgrp***/dbpr## bug
@
text
@d27 1
a27 1
<p></p>
d47 2
a48 2
<dd>Identifies likely  particles from the micrographs, 
   and extracts small images of individual particles from the micrographs.</dd>
d51 1
a51 1
<dd>The particle images are aligned to reference  projections using shifts 
d55 2
a56 2
<dd>The averages of each reference view
    are computed, to assess the distribution of projection views.</dd>
d59 2
a60 2
<dd>An initial volume is calculated by back projection,
    along with an estimate of its resolution.</dd>
d68 3
a70 3
<dd> Other useful methods, such as classification, difference maps, and 
   frequency correction by X-ray scattering. Additional details about these 
   methods may be found at the <a href="../../techniques.html">techniques</a> page.</dd>
d84 2
a85 2
  <li> <a href="#PP92">Penczek et al. (1992)
       </a> describe the technique of 3D reconstruction from particle images.
d88 1
a88 1
  <li> <a href="#PP94">Penczek et al. (1994) </a> describe reconstruction using 
d93 2
a94 2
        Three-Dimensional Electron Microscopy of Macromolecular Assemblies</a>
        Oxford University Press,  (February 2006)
d101 1
a101 1
  <li>Convert ZI scanner tif files to SPIDER format: 
d104 2
a105 1
  <li>Procedure files for circular images from <b><a href= "quantifoil.html">Quantifoil grids</a></b> .</li>
d109 1
a109 1
   The data below is sometimes shown plotted with <i>gnuplot</i>. An
d147 1
a147 1
   <tr> <td> <br />
d151 3
a153 2
   directory has to be set up with the proper subdirectories and procedure files.
   </p>
d177 1
a177 1
  call a corresponding procedure (listed below the procedure
d195 1
a195 1
   <a href="batcharch">click here</a>).  Download this file to your 
d197 3
a199 2
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><code>gunzip spiproject.tar.gz; tar xvf spiproject.tar</code>
   </b>   <br />
a205 1
</ul>
d208 2
d211 1
a211 1
   that are used by many procedure files.  The following files should be
d213 1
d218 26
d265 2
a266 1
   creates a micrograph selection doc file in the top-level project directory: <br/>
d275 4
a278 4
   level procedure files - see below).  If you need to exclude
   files from this list, use a text editor to delete the appropriate
   lines, then use the 'DOC REN' operation in SPIDER to renumber lines
   in the doc file.
d287 4
a290 2
   <li>Files of the digitized micrographs should be in the <i>Micrographs</i> 
   directory. Because they require so much disk space, it may be desirable to 
d311 1
a311 1
          <td>Resized reference volume.</td></tr>
d326 1
a326 1
<table class="heading" width="100%"><tr><td> <br />
d333 2
a334 2
   <p>These procedures should be run in the <i>Power_Spectra</i> directory.<br />
   The micrographs should be in the <i>Micrographs</i> directory.</p>
d342 1
a342 1
    <li> <a href="../ctf/ctf.html">contrast transfer function correction</a> tutorial. </li>
d355 2
a356 3
   <a class="project" href="./newprogs/power.spi">power.spi</a>, and its procedure 
   <a class="project" href="./newprogs/power_p1.spi">power_p1.spi</a>, read each micrograph 
   and compute an averaged power spectrum for it.  Each micrograph has two  
d410 4
a413 2
         estimates defocus with SPIDER operation <a href="../../man/tfed.html"><b>TF
         ED</b></a>, creating: <br />
a423 3
        It uses the procedure: 
        <a class="project" href="./newprogs/calcparms.spi">calcparms.spi</a>, 
        which checks values in the <a href="./params.html">parameter file</a>. <br />
d499 3
a501 4
   When you have finalized the values in def_sort.ext, compute the
   averages for each defocus group using
   <a class="project" href="./newprogs/defavg.spi">defavg.spi</a> which 
   creates: <br />
d504 1
a504 1
      <tr valign="top"> <td>&curren; </td>
d506 3
a508 1
          <td>A selection doc file of defocus group averages.</td> </tr>
d510 4
a513 9
          <td><code class="output">order_defgrps</code>: </td>
          <td>A selection doc file of defocus group averages.</td> </tr>
      <tr valign="top"><td>&curren; </td>
          <td><code class="output">dat_group</code>: </td>
          <td>A doc file of defocus group averages.</td> </tr>
      <tr valign="top"><td>&curren; </td>
          <td><code class="output">dat_mic</code>: </td>
          <td>A doc file of micrograph defocus values.</td> </tr>
   </table>
d553 2
a554 1
         <a class="project" href="./newprogs/noise.spi">noise.spi</a> creates: <br />
d558 2
a559 2
                <td><code class="output">noise.ext</code>: </td>
                <td>A noise image.</td></tr>
d562 6
a567 6
         This is selected at
         random from a set of regions in the micrograph that appear not to
         contain any particles (the files 
         <code class="output">tmpnoise/noi***</code>). 
         View the selected noise file; 
         if it has any structure (particle, junk), then select one of the other
d569 2
a570 2
         procedure file requires a micrograph in SPIDER format. If your micrographs 
         are <b>tif</b> and/or <b>gzipped</b> files, use
d578 1
a578 1
  <p></p>
d584 1
a584 1
   <p></p>
d601 1
a601 1
              <td><code class="output">winser_****</code>: </td>
d604 2
a605 2
              <td><code class="output">coords/ndc***</code>: </td>
              <td>Peak coordinates from 1/4 decimated image.</td></tr>
d607 1
a607 1
              <td><code class="output">coords/sndc***</code>: </td>
d647 1
a647 2
   <ol class="choice">
   <li>The procedure <a class="project" href="./newprogs/pfilt.spi">pfilt.spi</a> 
d649 1
a649 7
       based on its defocus. </li>
   <li>The procedure <a class="project" href="./newprogs/pfilt2.spi">pfilt2.spi</a> 
       is a simpler version. </li>
   </ol>
   <p />

   Both procedure files create: <br />
a654 2
   <p />
   
d672 1
a672 2
   <a href="../../partpick.html">partpick.html</a>). 
   This procedure creates: <br />
d695 1
a695 1
   <p></p>
d704 4
d731 31
a761 2
<p>
  <b>Reference projections</b> <br />
d763 8
a770 9
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  Reference projections (images) are views of the object at known angles.
  In what follows, angular accuracy is set to 15 degrees, which
  results in 83 reference projections. A reference volume
  is needed in the top level project directory to create the projections. 
  The row and column dimensions of the reference volume must match the 
  dimensions of the particle windows. (see 
  <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>)
</p>
d772 1
a772 1
<ul>
d775 1
a775 1
     volume</p>
d777 13
a789 2
   <a class="project" href="./newprogs/refproj.spi">refproj.spi</a> creates
   two sets of files:<br />
d804 1
a804 1
   <p></p>
d808 7
a814 11
     <li>
       You can use the same stack of references for all defocus groups, by 
       setting register [usectf] = 0. They will be in the file
       <code class="output">projs/prj_001</code>
     </li>

     <li>
        Generate more realistic references by multiplying them by the CTF (the 
        default). There will be a stack of reference projections for each defocus 
        group.
     </li>
a815 1
  
a816 1
<p></p>
d818 1
a818 31
<li><p class="action">Create lists of images in each defocus group</p>
   <a class="project" href="./newprogs/sel_by_group.spi">sel_by_group.spi</a> 
   creates  selection document files and a group summary file: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">sel_particles_***</code>: </td>
          <td>A doc file for each defocus group, listing all the particles in 
              that group.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><code class="output">sel_group</code>:  </td> 
          <td>A summary doc file with 4 columns listing: Defocus group, 
              Number of particles, Cumulative number of particles, and 
              Average defocus value for each group. </td> </tr>
   </table>
</li>
<p></p>

<li><p class="action">Create stacks of images for each defocus group</p>
   <a class="project" href="./newprogs/win2stk.spi">win2stk.spi</a> 
   creates stacks: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">data***</code>: </td>
          <td>A stack file for each defocus group, containing all particle 
              images from that group.</td></tr>
   </table>
</li>
<p></p>
d823 4
a826 2
      <a class="project" href="./newprogs/apsh.spi">apsh.spi</a> uses 
      <a href="../../man/apsh.html"><b>AP SH</b></a>, to create an alignment parameters
d840 1
a840 1
   <p></p>
d842 4
a845 2
      <a class="project" href="./newprogs/apshgrp.spi">apshgrp.spi</a> uses 
      <a href="../../man/apsh.html"><b>AP SH</b></a>,  to create a set of 
d859 1
a859 1
      on a Cluster, activate PubSub within <i>apshgrp.spi</i> procedure heading.</p>
d861 1
a861 1
<p></p>
d882 1
a882 1
<!-- SPIRE directory=Reconstruction subdirectories=select, hist, avg, display -->
d886 5
a890 3
   particles for each projection</p>
   <a class="project" href="./newprogs/select.spi">select.spi</a></i> 
   creates the following doc files:<br />
d899 3
a901 3
          <td><code class="output">df***/select/sel???</code>: </td>
          <td>Lists the particles associated with each reference view for
              each group. </td></tr>
d910 1
a910 1
<p></p>
d916 7
a922 3
   <a class="project" href="./newprogs/average.spi">average.spi</a> 
   creates the following files for a selected defocus group.
      <table class="outs">
d924 2
a925 2
          <td><code class="output">avg/avg***</code>:    </td>
          <td>Average images for each projection group.</td></tr>
d928 2
a929 2
          <td><code class="output">avg/var***</code>: </td>
          <td>Variance images for each projection group.</td></tr>
d931 1
a931 1
      <tr valign="top"><td>&curren;</td>
d933 1
a933 2
          <td>Merged alignment parameters from  all defocus groups. 
            (Not necessary if only a single group is used).</td></tr>
d935 1
a935 2

   <p></p>
d938 1
a938 1
   to view the set of average images. Projection views with many particles will 
d948 1
a948 1
<p>The next several operations help to identify a threshold
d957 1
a957 1
<p></p>
d960 14
a973 5
   selecting true particles</p>
   
   <p></p>
   <a class="project" href="./newprogs/cchistogram.spi">cchistogram.spi</a> 
   creates histograms and a gnuplot control script:
d978 1
a978 1
          <td>Set of histograms by defocus group.</td></tr>
d982 1
a982 1
          <td>Overall histogram.</td></tr>
d985 6
a990 2
          <td><code class="output">plot_hist</code>: </td> 
          <td>Gnuplot script for displaying overall histogram.</td></tr>
d993 1
a993 1
   <p></p>
d995 2
a996 2
   To view the overall histgram plot issue following system command:  
   <code>gnuplot -persist  plot_hist.ext &gt;</code><br />
a998 12
<p>
   View the particles corresponding to each reference view. <br />
   Use the <b>Montage from doc file</b> operation in 
   <a href="../../../../web/docs/web.html">WEB</a> to display the aligned
   particles identified in the selection doc file (sel001.ext for
   example). The greater the correlation coefficient value, the more
   similiar the particle will look to the reference projection.
   Identify a minimum correlation coefficient that describes true
   particles as opposed to erroneously selected particles. Select
   <b>Compute Average</b> to view an average of the particles
   displayed.
</p>
d1003 5
a1007 2
   <a class="project" href="./newprogs/ccthresh.spi">ccthresh.spi</a>,  
   given a percent cutoff level, creates threshold and select doc file: <br />
d1012 2
a1013 1
          <td> Thresholds for each defocus group. </td></tr>
d1015 10
a1024 2
          <td> <code class="output">df***/seltotal</code></td>
          <td> Particle selection files.</td></tr>
d1026 5
a1030 3
   E.g., if a threshold of 0.20 is selected, then 20% of all 
   particles with low correlation values will be rejected. The doc file lists, 
   for each defocus group, the cutoff correlation threshold, and the numbers 
d1035 15
a1049 2
   <p>The correlation thresholds in <code class="output">thresh</code> may be 
   edited, if you wish to use different cutoff levels.</p>
d1051 1
a1051 1
<p></p>
d1054 7
a1060 3
   <p class="action">Select particles above the correlation thresholds</p>
   <a class="project" href="./newprogs/dftotals.spi">dftotals.spi</a> applies the cutoff levels
   from <code class="output">thresh</code> to create: <br />
d1065 4
d1070 1
a1070 1
  The selection files list particles with correlation values greater 
d1074 1
a1074 1
<p></p>
d1077 8
a1084 3
   <p class="action">Check the distribution of reference views (angular directions)</p>
   <p> <a class="project" href="./newprogs/plotview.spi">plotview.spi</a> creates a 
   text file of gnuplot commands: <br />
d1088 7
a1094 2
          <td> <code class="output">plot_view</code></td>
          <td> gnuplot commands </td></tr>
d1096 2
a1097 2
    which plots the file <b>how_many.ext</b>,  
    showing the number of particles vs projection view.</p>
a1098 1
   <p></p>
d1100 4
a1103 2
   <a class="project" href="./newprogs/display_p.spi">display_p.spi</a> 
   create:<br />
d1107 9
a1115 3
          <td> <code class="output">display/cndis***</code>: </td> 
          <td>SPIDER image files showing distribution of sample images 
             among various reference projections. </td></tr>
d1118 1
a1118 1
   These files show the various angular reference groups represented by small 
d1122 2
a1123 3
   <p>
   Use the <b>Montage</b> operation in <a href="../../../../web/docs/web.html">WEB</a> 
   to display the plots.</p>
d1129 6
a1134 2
   <p> <a class="project" href="./newprogs/bestim.spi">bestim.spi</a> 
   creates: <br />
d1147 1
a1147 1
   Continue with the set of limited particles.
d1153 1
a1153 1
<p></p>
d1170 2
a1171 1
<p></p>
d1174 2
a1175 2
<li><p class="action">Split the particle images, create paired reconstructions, and 
   compute resolution for each defocus group</p>
d1177 23
a1199 3
   <a class="project" href="./newprogs/deffsc.spi">deffsc.spi</a>
   creates two selection doc files for particles 
   by randomly partitioning the images into two equal sets: 
d1202 3
a1204 2
          <td> <code class="output">df***/seleven</code>: </td> 
          <td> Odd numbered images for each defocus group.</td></tr>  
d1206 2
a1207 2
          <td> <code class="output">df***/selodd</code>: </td> 
          <td> Even numbered images for each defocus group.</td></tr> 
d1209 1
a1209 1
   <p></p>
d1211 4
a1214 1
   It then creates two half-reconstructions for each defocus group using back projection: <br />
d1218 1
a1218 1
          <td> <code class="output">df***/vol001_odd</code>: </td>
d1220 1
d1222 1
a1222 1
          <td> <code class="output">df***/vol001_even</code>: </td>
a1223 2
   </table>
   <p></p>
a1224 3
   Finally it computes the resolution of each defocus group by 
   comparing the two half volumes and creates:<br />
   <table class="outs">
d1226 7
a1232 2
          <td> <code class="output">df***/doccmp001</code>: </td>
          <td> Doc files containing  <a href="../../glossary.html#Fourier">FSC curves</a> for 
d1235 30
d1267 1
a1267 1
<p></p>
d1270 1
a1270 1
    slice from each volume</p>
d1272 3
a1274 2
    <a class="project" href="./newprogs/slices.spi">slices.spi</a> extracts a 
    central slice from a volume in each defocus group: <br />
d1278 2
a1279 2
          <td> <code class="output">slices/slice***</code>:  </td>
          <td> Central slice from each defocus group volume. </td></tr> 
d1281 1
a1281 1
    <p></p>
d1284 1
a1284 1
    to view the slices. Ideally, each 
d1291 1
a1291 33
<p></p>

<li><p class="action">Apply CTF correction, construct an initial volume, 
       and compute the combined resolution</p>

      The procedure <a class="project" href="./newprogs/ctf.spi">ctf.spi</a> 
      applies CTF correction to all the defocus group odd/even volumes 
      (see the <a href="../../man/tfcts.html">TF CTS</a> operation), 
      adds together the odd and even volumes to make a volume for the entire data set. 
      Finally it calculates the FSC resolution curve for the combined data set 
      (see <a href="../../man/rf3.html">RF 3</a> operation) creating 
      the following files: <br />

    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">combires</code>: </td>
          <td> Combined resolution doc file. </td></tr>
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">vol001</code>:   </td>
          <td> 3D structure from entire set of particles. </td></tr> 
    </table>

   <p></p>
   This structure is known as the <i>initial volume</i> and will be
   used as the input for the Refinement step. 
</li>
<p></p>

<li><p class="action">Determine resolution of the initial volume</p>
   View the combined resolution doc file to determine where the Fourier shell 
   correlation drops below threshold (0.5), and identify the corresponding 
   spatial frequency. Then, <b>resolution = pixel size/spatial 
   frequency</b>.<br />
d1293 2
a1294 2
   <a class="project" href="./newprogs/res.spi">res.spi</a> creates the 
   doc file:<br />
d1296 4
a1299 6
    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <code class="output">resolution</code>: </td>
          <td> Doc. file ontaining the cutoff, the corresponding normalized 
               frequency, and resolution (in Angstroms). </td></tr> 
    </table>
a1300 5
   <p></p>

   <a class="project" href="./newprogs/plotres.spi">plotres.spi</a> creates a text file of 
   gnuplot commands: <br />

d1303 1
a1303 1
          <td> <code class="output">plot_res</code>: </td>
d1310 3
d1315 1
a1315 1
<p></p>
d1318 7
a1324 2
   Information at spatial frequencies above the cutoff value are 
   considered to be uncorrelated noise, and must be filtered out.<br />
a1325 2
   <a class="project" href="./newprogs/filt.spi">filt.spi</a> filters the 
   initial volume at the cutoff frequency.
d1328 1
a1328 1
          <td> <code class="output">volfq001</code>: </td>
d1331 1
a1331 1
   <p></p>
d1347 1
a1347 1
   <p class="explain">Refinement essentially performs the above steps repeatedly, 
d1353 2
a1354 2
      results of the above reconstructions, to ensure that <u>all</u> defocus groups
      have reasonable particle volumes. 
d1360 1
a1360 1
<!-- SPIRE directory=Refinement subdirectories=input, final -->
d1364 22
a1385 36
<p></p>
<li>A more detailed set of instructions for refinement is given on the 
    <a href="refine.html">Refinement</a> page.
</li>
<p></p>


<li><p class="action">Collect necessary files in the <i>Refinement/input</i> directory</p>

   <a class="project" href="./newprogs/copyin.pam">copyin.pam</a>
       assembles the necessary input files: 
   <table class="outs">
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input</code>: </td> 
          <td> Directory for input files.</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/order_select</code>: </td> 
          <td> Group selection file.</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/order_select_sort</code>: </td> 
          <td> Sorted group selection file.</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/vol01</code>: </td> 
          <td> Initial starting volume.</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/select_{***[grp]}</code>: </td> 
          <td> Particle selection files.</td></tr> 
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/align_01_{***[grp]}</code>: </td> 
          <td> Alignment parameter files.</td></tr> 
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/data{***[grp]}</code>: </td> 
          <td> Unaligned stacked image files.</td></tr>
   <tr valign="top"><td>&curren;</td>
          <td> <code class="output">input/dala01_{***[grp]}</code>: </td> 
          <td> Initial aligned stacked image files.</td></tr>
d1388 1
a1388 6
<p></p>

<li>
  <p class="action">Set the parameters in 
  <a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a>.</p> 
</li>
d1390 18
a1407 4
<li>
  <p class="action">Run <a class="project" href="./newprogs/refine.pam">refine.pam</a> (or 
      <a class="project" href="./newprogs/pub_refine.pam">pub_refine.pam</a> 
      if running on the cluster with PubSub). </p>
d1410 11
a1420 27
   <a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a>, 
   <a class="project" href="./newprogs/prepare.pam">prepare.pam</a>, 
   <a class="project" href="./newprogs/cpang.pam">cpang.pam</a>, 
   <a class="project" href="./newprogs/enhance.pam">enhance.pam</a>, 
   <a class="project" href="./newprogs/grploop.pam">grploop.pam</a>, 
   <a class="project" href="./newprogs/smangloop.pam">smangloop.pam</a>, 
   <a class="project" href="./newprogs/mergegroups.pam">mergegroups.pam</a>, 
   <a class="project" href="./newprogs/saveresp.pam">saveresp.pam</a>, 
   <a class="project" href="./newprogs/endmerge.pam">endmerge.pam</a>, and 
   <a class="project" href="./newprogs/endrefine.pam">endrefine.pam</a>
  <p></p>

  If you are running on a cluster with PubSub you may also need: 
    <a href="../../../pubsub/publish.perl">publish.perl</a>, 
    <a class="project" href="./newprogs/pub_refine_start.pam">pub_refine_start.pam</a>, 
    <a class="project" href="./newprogs/pub_refine_doc_sync.pam">pub_refine_doc_sync.pam</a>, and 
    <a class="project" href="./newprogs/pub_refine_wait.pam">pub_refine_wait.pam</a>.

    <a class="project" href="./newprogs/pub_ref_loop_clone.pam">pub_ref_loop_clone.pam</a>.
    <a class="project" href="./newprogs/pub_ref_loop_declone.pam">pub_ref_loop_declone.pam</a>.
    <a class="project" href="./newprogs/pub_ref_merge_clone.pam">pub_ref_merge_clone.pam</a>.
    <a class="project" href="./newprogs/pub_ref_merge_declone.pam">pub_ref_merge_declone.pam</a>.
    <a class="project" href="./newprogs/pub_fixrefine.pam">pub_fixrefine.pam</a>.

  <p></p>
    Further Details are given in the <a href="refine.html">Refinement</a> page.  
  <p></p>
d1422 15
d1438 2
a1439 2
  Among the outputs of refinement are image and document files with '***' denoting
  group number and '##' denoting iteration number: <br />
d1488 2
a1489 2
</li>
<p></p>
d1493 7
a1499 2
   The procedure <a class="project" href="./newprogs/plotref.spi">plotref.spi</a> 
      creates two text files of gnuplot commands: <br /> 
d1503 1
a1503 1
          <td><code class="output">plot_refi</code>: </td>
d1507 1
a1507 1
          <td><code class="output">plot_refd</code>: </td>
d1517 4
a1520 2
   The procedure <a class="project" href="./newprogs/angdisp.spi">angdisp.spi</a> creates
   angular distribution images: <br /> 
d1529 3
a1531 1
   The procedure <a class="project" href="./newprogs/angdiff.spi">angdiff.spi</a> creates: 
a1546 1

d1548 2
a1549 3
   <tr><td> <br />
   <h3> Other Useful Methods </h3>
</td></tr></table>
d1554 3
a1556 4
   program files into tar files, which can be backed up on tape. Save the 
   shell script, make it executable:
   <pre>chmod 775 backup</pre>
   and run it in the project directory. It creates 2 tar files 
d1562 1
a1562 1
<p><dt><a href="../diffmaps/index.html">Difference Maps</a></dt>
d1577 1
a1577 1
<p><dt>See more approaches at the <a href="../../techniques.html">techniques page</a></dt>
d1590 1
d1634 1
d1639 1
a1639 1
Page updated: 12/02/09 &nbsp;&nbsp;&nbsp;
@


1.87
log
@refinement outputs wrong
@
text
@d1353 1
a1353 1
          <td><code class="output">final/defgrp***/dbpr##</code>: </td>
@


1.86
log
@mainly cosmetic & defsort
@
text
@d1345 1
a1345 1
          <td>Filtered volume from even numbered images</td></tr>
d1351 1
a1351 1
          <td>Filtered volume from all images</td></tr> 
d1356 1
a1356 1
          <td><code class="output">final/defgrp***/bpr##</code>: </td>
d1359 1
a1359 1
          <td><code class="output">final/defgrp***/bpr_##_odd</code>: </td>
d1362 1
a1362 1
          <td><code class="output">final/defgrp***/bpr_##_even</code>: </td>
d1366 1
a1366 1
          <td>Final filtered volume from all images</td></tr>    
d1368 2
a1369 2
          <td><code class="output">final/bpr1##</code>: </td>
          <td>Final filtered volume from even numbered images</td></tr>
d1371 2
a1372 2
          <td> <code class="output">final/bpr2##</code>: </td>
          <td>Final filtered volume from odd numbered images</td></tr>
@


1.85
log
@note about lfc-pic histogram fitting normalization.
@
text
@d29 1
d42 11
a52 11
<dt> <a href="#CTF">Contrast Transfer Function</a></dt>
<dd>(CTF) is estimated for each micrograph, and the micrographs 
   are placed in defocus groups.</dd>

<dt> <a href="#AUTO">Particle Picking and Selection</a></dt>
<dd>identifies likely  particles from the micrographs, 
   and extracts small images of individual particles.</dd>

<dt> <a href="#SH">Alignment</a></dt>
<dd>The particle images are aligned to reference
   projections through shifts and rotations.</dd>
d54 1
a54 1
<dt> <a href="#CA">Averages</a></dt>
d56 1
a56 1
   are computed, to assess the distribution of projection views.</dd>
d60 1
a60 1
   along with an estimate of resolution.</dd>
d62 1
a62 1
<dt> <a href="#REF">Refinement</a></dt>
d64 2
a65 3
   chance "to find a better home" in terms of its orientation and phase
   origin, thus improving the resolution of the initial
   reconstruction.</dd>
d67 1
a67 1
<dt> <a href="#OTHER">Additional methods</a></dt>
d69 2
a70 3
   frequency correction by X-ray scattering.
   Additional details about these methods may be found at the <a href=
   "../../techniques.html">techniques</a> page.</dd>
d75 1
a75 2
<p><a href="./flowchart/flowchart.html">A flowchart of
   operations</a></p>
d85 1
a85 1
    </a> describe the technique of 3D reconstruction from particle images.
d88 2
a89 3
  <li> <a href="#PP94">Penczek et al. (1994)
    </a> describe reconstruction using projection matching (the approach
    outlined below).
d95 1
a95 1
   </li>
d97 1
a97 2
   <li>
   <a href="../../ref.html">More references</a></li>
d99 1
a99 2
   <li>Information about images from the <b><a href="zi/zidoc.html">ZI
     scanner</a></b></li>
d101 2
a102 2
   <li>Convert ZI scanner tif files to SPIDER format: 
   <b><a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">download zi2spi.c</a></b></li>
d104 1
a104 2
   <li>Batch files for circular images from 
      <b><a href= "quantifoil.html">Quantifoil grids</a></b> .</li>
d108 4
a111 4
The data below is sometimes shown plotted with <i>gnuplot</i>. An
<a href="http://www.gnuplot.info/docs/gnuplot.html">online manual</a>
for <i>gnuplot</i> is available. Much more about <i>gnuplot</i> is
at <a href="http://www.gnuplot.info">Gnuplot Central</a> </p>
d119 3
a121 4
   <a href="./newprogs">procedure files</a> are links,<br />
   <code class="output">output files</code> created by that procedure file 
   are marked in green.
   <br />
d129 2
a130 2
   but not both (unless you want to compare the two techniques!)
   <br />
d132 1
a132 1
   some results can be analyzed with  
d136 1
d142 1
d146 1
a146 1
   <tr><td> <br />
d152 1
a152 3
   <br />
   </td> 
   </tr>
d155 1
a155 1
<p>
d158 3
a160 5
<li>
   If you are running SPIDER at the Unix prompt, then read below to learn 
   how to execute SPIDER procedure files.
</li>
<p></p>
d162 1
a162 2
<li>
   If you are using  <a href="../../../../spire/doc/index.html">SPIRE</a>, 
d164 1
a164 2
   run SPIDER procedure files in SPIRE</a>.
</li>
d166 2
a167 1
</p>
d170 8
a177 8
which run many SPIDER operations automatically. To use a procedure
in this document, click the procedure filename and copy the procedure
to your current working directory. At the beginning of each
procedure, there is a list of parameters that can be adjusted
according to the particular project. Some of the procedures will
call a corresponding procedure (listed below the procedure
filename). You need not change anything in the procedures. Use the
following format to run a SPIDER procedure:</p>
d179 1
a179 1
<center><b><code>spider spi/dat @@proc</code></b></center>
a180 2
<br />
 
d182 2
a183 3
<b><code>dat</code></b> is
   the project data file extension, and <b><code>proc.spi</code></b> is the
   procedure file. </p>
d187 3
a189 2
   <li><p class="action">Create a project directory with the required 
   subdirectories and procedure files</p> 
d191 2
a192 2
   <a href= "./spiproject.tar.gz">spiproject.tar.gz</a> (for the 
   <b>archive </b>of<b> older </b>procedure files,
d194 1
a194 1
   working directory and unpack it:<br />
d196 7
a202 9
   </b><br />
It will create a directory called <i>myproject</i>, containing 
the procedure files 
and subdirectories for a reconstruction project. Rename 
<i>myproject</i> to the
 name of your project directory, usually the same three letters 
as the data 
extension, e.g.:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><code>mv myproject acn</code></b>
d207 2
a208 2
that are used by many procedure files. The following files should be
run in the top-level project directory:</p>
d219 1
a219 2
in the top 
   directory of your project. It makes a document file: <br />
d221 2
a222 2
      <tr valign="top"><td>&curren;</td>
          <td><code class="output"> params</code>:</td>
d224 2
a225 1
             <a href="./params.html">reconstruction parameters</td></tr>
d228 1
a228 1
<p></p>
d240 1
a240 1
             the micrograph files to be processed.</td></tr>
d243 1
a243 2
   level procedure
   files - see below).  If you need to exclude
a246 1
<p></p>
d249 1
d255 4
a258 4
   <li>Files of the digitized micrographs should be 
   in the <i>Micrographs</i> directory. Because they require so much disk 
   space, it may be desirable to keep the Micrographs in another 
   location, and make <i>Micrographs</i> a symbolic link. In that case, 
d260 4
a263 6
   make a symbolic link: 
   <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
   <b><code>rmdir Micrographs</code></b> 
   <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
   <b><code>ln -s </code></b><code>/the/actual/location/of/the/micrographs</code> 
                 <b><code>Micrographs </code></b>
d266 1
d271 2
a272 2
    <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>.
    in the top-level project directory to resize the volume:< br/>
a278 1

d285 2
a286 1
  "sensible", ask an expert.</h4></p>
d304 11
a314 11
<p>
 For more information, see the <br />
 &nbsp;&nbsp;&nbsp;&nbsp;
 <a href="../ctf/ctf.html">contrast transfer function correction</a> tutorial, <br />
 &nbsp;&nbsp;&nbsp;&nbsp;
 <a href="../../../../spire/doc/guitools/ctfdemo.html">
 <font class="guitool">ctfdemo</font></a>, a program that demonstrates 
 the effects of various parameters on the CTF, and
 <br />&nbsp;&nbsp;&nbsp;&nbsp;
 <a href="#PP97">Penczek et al. 1997</a> for a fuller discussion.
</p>
d319 1
d324 1
a324 1
   corresponding output files:</p>
d328 1
a328 1
          <td><code class="output">power/pw_avg***</code></td>
d330 1
a330 1
              power spectra calculated over the surface of the micrograph.</td></tr>
d337 1
a337 1
          <font class="guitool">pyplot</font></a></td></tr>
d340 1
a340 1
<p></p>
d354 1
a354 1
      <li>Are the Thon rings round?</li>
a356 1

a357 1
   You can discard micrographs that show one of the following artifacts: 
d359 3
d363 1
a363 1
      <li>Rings that are cut off unidirectionally(evidence of drift)</li>
d369 1
a369 1
   </li>
d371 1
a371 1
   <li><a name="DEF"> <p class="action">Determine defocus</p>
d381 1
a381 1
          <tr valign="top"><td>&curren;</td>
d385 1
a385 1
          <tr valign="top"><td>&curren;</td>
d396 1
a396 1
      <p></p>
d401 1
a401 1
      <p></p>
d418 1
d421 3
a423 1
      the "defocus" doc file generated by one of the above methods, and creates: <br />
d431 2
a432 2
      <b> These automated defocus group assignments are only a starting point,
      however. You must manually inspect the defocus groupings to see
d441 1
d443 2
a444 3
      <li>
         <a href="../../../../spire/doc/guitools/ctfgroup.html">
         <font class="guitool">ctfgroup.py</font></a>
d447 1
a447 4
      <li>
         <a href="../../../../spire/doc/guitools/pyplot.html">
         <font class="guitool">pyplot</font></a>
      </li>
d449 1
a449 2
      <li>
         <b>gnuplot</b><br />
d452 1
a452 1
         then run in <i>gnuplot</i> using the <i>load</i> command:<br />
d454 2
a455 2
         <p><a href="pics/plotpower1.gif"><img width="200" height="150" src=
         "pics/plotpower1.gif"></a></p>
d459 2
a460 2
   When you have determined a satisfactory set of groupings, update the
   docfile <code class="output">def_sort</code>, which is used in the next step.
d473 4
a476 4
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">def_avg</code>: </td>
          <td>A selection doc file of defocus group averages.</td></tr>
      <tr valign="top"><td>&curren;</td>
d478 2
a479 2
          <td>A selection doc file of defocus group averages.</td></tr>
      <tr valign="top"><td>&curren;</td>
d481 2
a482 2
          <td>A doc file of defocus group averages.</td></tr>
      <tr valign="top"><td>&curren;</td>
d484 1
a484 1
          <td>A doc file of micrograph defocus values.</td></tr>
d495 1
a495 1
<table class="heading" width="100%"><tr><td> <br />
d507 2
a508 1
</td></tr></table>
d510 1
a510 1
<!-- SPIRE directory=Particles subdirectories=coords, good, win, flt -->
d517 1
a517 1
   <p></p>
d522 1
a522 1
      <p></p>
d533 1
a533 1
          This is selected at
d554 1
a554 2
   require the converting procedure 
   <a href="./newprogs/convert_p.spi">convert_p.spi</a> 
d582 1
a582 1
    <p></p>
d599 1
a599 1
          <tr valign="top"><td>&curren;</td>
d602 1
a602 1
          <tr valign="top"><td>&curren;</td>
d605 1
a605 1
          <tr valign="top"><td>&curren;</td>
d612 1
a612 1
<p></p>
d625 1
a625 1
   <p></p>
d633 1
a633 1
   <p></p>
d640 1
a640 1
<p></p>
d660 1
a660 1
<p></p>
d683 1
a683 1
<p></p>
d686 2
a687 1
<hr>
d705 1
d724 1
a724 1
   volume</p>
d776 1
a776 1
              Average defocus value for each group.</td></tr>
d1478 3
a1480 3
   <a name="PP92">
   <li> Penczek, P., M. Rademacher, and J. Frank (1992) 
   Three-dimensional reconstruction of single particles embedded in ice.
d1484 2
a1485 2
   <a name="PP94">
   <li> Penczek, P., Grassucci, R.A. and Frank, J. (1994) 
d1487 1
a1487 1
   refinement in 3D cryo-electron microscopy of biological particles 
d1491 2
a1492 2
   <a name="PP97">
   <li>P.A. Penczek, J. Zhu, R. Schrer, J. Frank (1997) 
d1494 2
a1495 3
   Transfer Compensation from Defocus Series</a> 
   Special Issue on Signal and Image Processing, <i>Scanning Microscopy</i> Volume 11,
   1997, page 147.
d1498 2
a1499 2
   <a name="BR04">
   <li>B.K. Rath and J. Frank (2004) 
d1504 2
a1505 2
   <a name="AR03">
   <li>Alan Roseman (2003) 
d1509 8
d1523 1
a1523 1
Page updated: 04/09/09 &nbsp;&nbsp;&nbsp;
@


1.84
log
@added missing .pam files
@
text
@d608 3
a610 1
       searching different orientations of the search image in the micrograph.  
d1529 1
a1529 1
Page updated: 03/09/09 &nbsp;&nbsp;&nbsp;
@


1.83
log
@spire loc
@
text
@d1271 1
a1271 1
   assembles the necessary input files: 
d1314 2
d1317 1
d1324 1
a1324 1
  If you are running on a cluster with PubSub you will also need: 
d1330 6
d1527 1
a1527 1
Page updated: 12/05/08 &nbsp;&nbsp;&nbsp;
@


1.82
log
@added link to download zi2spi.c
@
text
@d106 2
a107 1
   <li>Convert ZI scanner tif files to SPIDER format: <b><a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">download zi2spi.c</a></b></li>
d140 1
a140 1
   <a href="../../spire/guitools/index.html">graphical interfaces</a>, 
d172 1
a172 1
   If you are using  <a href="../../spire/index.html">SPIRE</a>, 
d193 2
a194 1
<p>where <b><code>spi</code></b> is the procedure file extension, <b><code>dat</code></b> is
d209 6
a214 3
It will create a directory called <i>myproject</i>, containing the procedure files 
and subdirectories for a reconstruction project. Rename <i>myproject</i> to the
 name of your project directory, usually the same three letters as the data 
d232 2
a233 1
   <a class="project" href="./newprogs/makeparams.spi">makeparams.spi</a> in the top 
d256 2
a257 1
   The  text part of the filenames are entered as templates in the top level procedure
d325 1
a325 1
 <a href="../../spire/guitools/ctfdemo.html">
d351 1
a351 1
          <a href="../../spire/guitools/pyplot.html">
d407 1
a407 1
        <a href="../../spire/guitools/ctfmatch/ctfmatch.html">
d454 2
a455 1
         <a href="../../spire/guitools/ctfgroup.html"><font class="guitool">ctfgroup.py</font></a>
d459 2
a460 1
         <a href="../../spire/guitools/pyplot.html"><font class="guitool">pyplot</font></a>
d549 2
a550 1
         contain any particles (the files <code class="output">tmpnoise/noi***</code>). 
d1518 1
a1518 1
Page updated: 04/05/07 &nbsp;&nbsp;&nbsp;
@


1.81
log
@fixed
@
text
@d106 2
d1484 1
a1484 1
   <li>P.A. Penczek, J. Zhu, R. Schrder, J. Frank (1997) 
@


1.80
log
@for stacked recon
@
text
@d576 1
a576 1
              <td>Particle images.</td></tr>
d663 1
a663 1
<li><p class="action">Remove any duplicated particles adn list number of picked and 
d736 2
a737 2
          <td><code class="output">prj_****</code>: </td>
          <td>Reference images produced with  
d748 1
a748 1
       <code class="output">prj_001</code>
d1506 1
a1506 1
Page updated: 03/20/07 &nbsp;&nbsp;&nbsp;
@


1.79
log
@bestim output changed'
@
text
@a13 1

d19 2
a20 3
   <h2 class="top">
   Three Dimensional Reconstruction of Single Particle Specimens using Reference Projections
   </h2>
a26 1

a28 1
<br />
d213 1
a213 1
<p>Some information may be stored in project-wide document files
d236 1
a236 1
<li><p class="action">Create a selection doc file for file numbers</p>
d240 1
a240 1
   creates a selection doc file in the top-level project directory: <br/>
d244 3
a246 2
          <td><code class="output">filenums</code>:</td>
          <td>A doc file containing the numbers of the files to be processed</td></tr>
d268 1
a268 1
   <b><code> rmdir Micrographs </code></b> 
d270 2
a271 3
   <b><code> ln -s </code></b><code>/the/actual/location/of/the/micrographs
   </code>  <b><code>Micrographs 
   </code></b>
d312 9
a320 9
 For more information, see also <br />
&nbsp;&nbsp;&nbsp;&nbsp;
the <a href="../ctf/ctf.html">contrast transfer function correction</a> tutorial,<br />
&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../../spire/guitools/ctfdemo.html">
<font class="guitool">ctfdemo</font></a>, a program that demonstrates 
the effects of various parameters on the CTF, and
<br />&nbsp;&nbsp;&nbsp;&nbsp;
<a href="#PP97">Penczek et al. 1997</a> for a fuller discussion.
a323 1

d329 1
a329 1
   and compute an averaged power spectrum for it. Each micrograph has two  
d334 1
a334 1
          <td><code class="output">pw_avg***</code></td>
d339 1
a339 1
          <td><code class="output">roo***</code></td>
d343 1
a343 1
            <font class="guitool">pyplot</font></a></td></tr>
a372 1

d376 1
a376 4

   <li><a name="DEF"></a></li>

   <li><p class="action">Determine defocus</p>
d391 1
a391 1
             <td><code class="output">ctf***</code>: </td>
a417 1
 
d479 1
a479 1
          <td>A doc file of defocus group averages.</td></tr>
d482 3
d486 3
d539 1
a539 1
         View the selected noise file;
d575 1
a575 1
              <td><code class="output">win/ser*****</code>: </td>
d591 2
a592 2
       This procedure uses <a href="../../partpick.html#LFC">local
       cross-correlation</a> calculated using Fourier methods outlined by
d594 1
a594 1
       <a href="#BR04">Rath and Frank (2004)</a>. A 3D reference volume is required
d601 5
a605 2
              <td><code class="output">win/ser*****</code>: </td>
              <td>Particle images.</td></tr>
d608 2
a609 2
              <td> Pixel coordinates for <i>center</i> of particle images..</td></tr>
       </table>
a614 11
<li><p class="action">Determine particle numbers corresponding to each micrograph</p>

   The procedure <a class="project" href="./newprogs/pnums.spi">pnums.spi</a> creates:
    <table class="outs">
       <tr valign="top"><td>&curren;</td>
           <td><code class="output">order_picked</code>: </td>
           <td>A doc file listing the range of particle 
               numbers associated with each micrograph</td></tr>
    </table>
 </li>

a615 1

d617 1
a617 1
   particle selection</p>
a622 1

d626 1
d631 2
a632 2
         <td><code class="output">flt/ser*****</code>: </td>
         <td>A set of low-pass filtered particle images.</td></tr>
d634 2
d643 1
d647 1
a647 1
   is accomplished in <a href="../../../../web/docs/web.html">WEB</a>
d652 3
a654 2
   details at the <a href="../../faq.html#pick">SPIDER FAQ</a> and 
   <a href="../../partpick.html">partpick.html</a>). This procedure creates: <br />
d658 2
a659 2
         <td>A set of doc files, one for each micrograph.</td></tr>
    </table>
d663 2
a664 1
<li><p class="action">Remove any duplicated particles</p>
d666 1
a666 1
   <a class="project" href="./newprogs/renumber.spi">renumber.spi</a> creates: <br />
d670 9
a678 5
         <td>A set of doc files, one for each micrograph listing unduplicated
             particle numbers.</td></tr>
    </table>
   When manually 
   selecting particles in <a href="../../../../web/docs/web.html">WEB</a>,
d680 1
a680 1
   will delete the appropriate lines from the file. Run this procedure file, 
a685 15
<li><p class="action">List percentages of selected particles</p>

   <a class="project" href="./newprogs/snums.spi">snums.spi</a> creates<br />
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
         <td><code class="output">order_selected</code>: </td>
         <td>A doc file listing selected particles for each micrograph.</td></tr>
      <tr valign="top"><td>&curren;</td>
         <td> <code class="output">percent_selected</code>: </td>
         <td>A doc file listing percentages of automatically picked vs 
             manually selected particles.</td></tr>
    </table>
</li>
<p></p>

a686 1

d787 2
a788 2
          <td>A stack file for each defocus group, containing all particles 
              from that group.</td></tr>
d806 1
a806 1
          <td><code class="output">data01_001</code>:</td>
d1072 2
a1073 2
   To estimate the resolution of the resulting structure, the data are split 
   into two equal sets, and the two resulting volumes are compared. 
d1082 1
a1082 1
<li><p class="action">Split the data, create paired reconstructions, and 
d1086 2
a1087 2
   creates  selection doc files of odd and even numbered particles 
   by splitting the data into two equal sets: 
d1263 1
a1263 1
          <td> Directory
d1266 1
a1266 1
          <td> Group selection file</td></tr>
d1269 1
a1269 1
          <td> Sorted group selection file</td></tr>
d1272 1
a1272 1
          <td> Initial starting volume</td></tr>
d1275 1
a1275 1
          <td> Particle selection files</td></tr> 
d1278 1
a1278 1
          <td> Alignment parameter files</td></tr> 
d1281 1
a1281 1
          <td> Unaligned stacked image files</td></tr>
d1284 1
a1284 1
          <td> Initial aligned stacked image files</td></tr>
d1506 1
a1506 1
Page updated: 01/23/07 &nbsp;&nbsp;&nbsp;
@


1.78
log
@<code class="output">part_by_group_***</code>
@
text
@d792 1
a792 1
          <td><code class="output">sel_defocus</code>:  </td> 
d794 2
a795 2
              Number of particles, Cumulative number of particles, and Average 
              defocus for each group.</td></tr>
d1066 5
a1070 2
          <td> <code class="output">df***/limited_seltotal</code></td>
          <td> Particle selection file for the specified defocus group</td></tr>
d1076 1
a1076 4
  <br />
   After renaming this file to <code class="output">df***/seltotal</code>, 
   go back to <a href="#CA">select.spi</a>, and repeat this section
   with the new set of limited particles.
@


1.77
log
@class output
@
text
@d205 1
a205 1
   <a href="batcharch">click here</a>) . Download this file to your 
d725 1
d787 1
a787 1
          <td><code class="output">part_by_group_***</code>: </td>
d1016 1
a1016 1
          <td> <code class="output">part_by_group_***</code></td>
d1526 1
a1526 1
Page updated: 12/13/06 &nbsp;&nbsp;&nbsp;
@


1.76
log
@increased stack usage
@
text
@d439 1
a439 1
             <code class="output">def_sort</code>: </td>
@


1.75
log
@procedures
@
text
@d224 1
a224 1
<p>
d226 3
a228 2
   Many procedure files read project
   parameters from this doc file. Run the interactive procedure file<br />
d230 23
a252 13
   directory of your project. It makes a document file called<br />
   <code class="output">params</code>. <a href="./params.html">
    The parameters are described here</a>.</li>
   </p>
<p>
<li><p class="action">Create a doc file for file numbers</p>
   This file contains
   the numbers of the files to be processed in DO loops (the text part
   of the filenames are entered as templates in the top level procedure
   files - see below). Run the interactive procedure file <br />
   <a class="project" href="./newprogs/makefilelist.spi">makefilelist.spi</a> to 
   create the doc file <code class="output">filenums</code>, which 
   is also in the top-level project directory. If you need to exclude
d255 3
a257 2
   in the doc file.</li>
   </p>
a258 1
<br />
d279 12
a290 7
   <li>A reference volume is required. If the 
   dimensions of your reference volume do not match the window size 
   (key 17 in the parameter file), then you must resize the volume with 
   <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>. 
   This procedure file should
   be run in the top-level project directory, creating an output 
   <code class="output">reference_volume</code>.
a294 1

d328 2
a329 1
   <li>
d332 1
a332 1
   <a class="project" href="./newprogs/power.spi">power.spi</a>, at its procedure 
d334 1
a334 1
   and compute an averaged power spectrum for it. Each micrograph has 2 
d337 15
a351 14
   <ul>
       <li>
       <code class="output">pw_avg***</code> : 2D power spectra, each is an 
       average of many smaller
       power spectra calculated over the surface of the micrograph.
       </li> 

       <li>
       <code class="output">roo***</code> : doc files of 1D profiles of 
       the rotationally averaged power spectra.  These doc files can be 
       plotted with <b>gnuplot</b> or 
       <a href="../../spire/guitools/pyplot.html"><font class="guitool">pyplot</font></a>
       </li>
   </ul>
d353 1
a353 4
   </li>

   <p>
   <li>
d390 1
a390 1
      <li><a class="project" href="./newprogs/defocus.spi">defocus.spi</a> : 
d393 16
a408 10
         <code class="output">defocus</code>, a document file of defocus and
         astigmatism values, and<br />
         <code class="output">ctf***</code> doc files of the background-subtracted
         1D power spectra.<br />
         It uses the procedure 
         <a class="project" href="./newprogs/calcparms.spi">calcparms.spi</a>, which checks values in
         the <a href="./params.html">parameter file</a>.<br />
         The <code class="output">ctf***</code> files can be analyzed with 
         <a href="../../spire/guitools/ctfmatch/ctfmatch.html">
         <font class="guitool">ctfmatch.py</font></a>
d410 1
d413 1
a413 1
         in <b>WEB</b>. Manual fitting a CTF model to the 1D profiles.
d415 1
d419 1
a419 1
         and astigmatism, and writes the output file 
d435 9
a443 6
      the "defocus"
      doc file generated by one of the above methods, and writes out<br />
      <code class="output">def_sort</code>, a doc file with the same information 
      sorted by defocus.
      It also tentatively assigns each micrograph to a defocus group. <b>
      These automated defocus group assignments are only a starting point,
d482 12
a493 5
   averages for each defocus group:<br />
   <a class="project" href="./newprogs/defavg.spi">defavg.spi</a> creates 
   two doc files
   of defocus group averages: <code class="output">def_avg</code> and 
<code class="output">order_defgrps</code>.
d532 9
a540 2
         <a class="project" href="./newprogs/noise.spi">noise.spi</a> creates 
         a noise image, <code class="output">noise.ext</code>. This is selected at
d542 2
a543 2
         contain any particles (the files 
         <code class="output">tmpnoise/noi***</code>). View the selected noise file;
d546 2
a547 3
         procedure file
         requires a micrograph in SPIDER format. If your micrographs are <b>tif</b>
         and/or <b>gzipped</b> files, use
d551 1
a551 1
         convert_p.spi</a> to convert one to SPIDER format.
d576 12
a587 5
       <code class="output">win/ser*****</code> : Particle images <br />
       <code class="output">coords/ndc***</code> : Peak coordinates
       from 1/4 decimated image <br />
       <code class="output">coords/sndc***</code> : Top left pixel
       coordinates for particle images. <br />
d594 1
a594 1
       use the Local Fast Correlation algorithm.<br />
d600 1
a600 1
       searching different orientations of the search image in the micrograph.<br />
d602 9
a610 3
       <code class="output">win/ser*****</code> : Particle images <br />
       <code class="output">coords/sndc***</code> : Pixel
       coordinates for <i>center</i> of particle images. <br />
a613 1

d618 8
a625 5
   <a class="project" href="./newprogs/pnums.spi">pnums.spi</a> Creates the 
   doc file        <br />
   <code class="output">order_picked</code>, which lists the range of particle 
   numbers associated with each micrograph.
</li>
d627 1
a627 1
<li><a name="PFILT"></a></li>
d633 3
a635 5
   <li>
      <a class="project" href="./newprogs/pfilt.spi">pfilt.spi</a> Filters a 
      set of images,
      adjusting filter settings for each micrograph, based on its defocus.
   </li>
d637 2
a638 4
   <li>
      <a class="project" href="./newprogs/pfilt2.spi">pfilt2.spi</a> is a 
       simpler version.
   </li>
d641 6
a646 4
   Both procedure files create:<br />
   <code class="output">flt/ser*****</code>, a set of low-pass filtered 
   particle images. <br />

a651 1

d663 6
a668 3
   <a href="../../partpick.html">partpick.html</a>). The output of this
   procedure should be a set of <code class="output">good/good***</code> 
   document files, one for each micrograph.
a669 1

d674 8
a681 2
   <a class="project" href="./newprogs/renumber.spi">renumber.spi</a> creates
   <code class="output">good/ngood***</code> doc files. When manually 
a687 1

d693 9
a701 4
   <code class="output">order_selected</code>, a doc file listing selected 
   particles for each micrograph, and<br />
   <code class="output">percent_selected</code>, lists percentages of 
   automatically picked vs manually selected particles.
d703 1
a725 2
<!-- SPIRE directory=Alignment subdirectories=ali,prj -->

d745 1
a745 4
   three sets of files.<br />
   <ul>
   <li><code class="output">projlist</code>: &nbsp;&nbsp;&nbsp;
      A doc file listing the 83 projection numbers.</li>
d747 14
a760 11
   <li><code class="output">refangles</code>: &nbsp;&nbsp;&nbsp;
      A doc file with listing the 3 Euler angles for each of the 83 projections, 
      generated with the SPIDER operation 
      <a href="../../man/voea.html"><b>VO EA</b></a></li>

   <li><code class="output">prj_****</code>: &nbsp;&nbsp;&nbsp;
      The reference images produced with the operation 
      <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> using the above
      two files.</li>
   </ul>
<p></p>
d766 1
a766 1
       setting register x90 = 0. They will be in the file
d773 1
a773 1
        group
a777 1

d782 16
a797 6
   creates  selection document files and a group summary file.<br />
   <ul>
   <li>
      <code class="output">part_by_group_***</code>: &nbsp;&nbsp;&nbsp;
      A doc file for each defocus group, listing all the particles in 
      that group.</li>
d799 10
a808 5
   <li>
      <code class="output">order_defocus</code>: &nbsp;&nbsp;&nbsp; 
      A summary doc file with 3 columns listing Number of particles, 
      Cumulative number of particles, and Average defocus for each group.</li>
   </ul>
d816 12
a827 3
      <a href="../../man/apsh.html"><b>AP SH</b></a>, to create a single document file: <br />
      <code class="output">align_01_001</code>: &nbsp;&nbsp;&nbsp; 
      Contains shift and rotation parameters for the best matched projection.</p>
d830 1
d834 13
a846 5
      document files.<br />
      <code class="output">align_01_***</code>: &nbsp;&nbsp;&nbsp;
      Containing shift and rotation parameters for the best matched projections.
      <br />
      If you are using <a href="../../../pubsub/pubsub.html">Publish and Subscribe</a>
a848 12
   </ol>
<p></p>

<li>
   <p class="action">Rotate and shift particles according to alignment parameters</p>
   <a class="project" href="./newprogs/alignsh.spi">alignsh.spi</a> 
   applies the shifts and rotations in the <code class="output">align_01_***</code> 
   alignment parameter files to the raw particle images. <br />
   <code class="output">ali/sar******</code>: &nbsp;&nbsp;&nbsp;
   aligned versions of the particle images.<br />
</li>

d873 2
a874 1
<li><p class="action"> Make selection document files listing particles for each projection</p>
d876 7
a882 6
   Creates the following doc files:
   <ul>
   <li>
      <code class="output">df***/how_many</code>: &nbsp;&nbsp;&nbsp;
      Lists number of particles associated with each reference view for 
      each group. </li>
d884 4
a887 4
   <li>
      <code class="output">df***/select/sel???</code>: &nbsp;&nbsp;&nbsp;
      Lists the particles associated with each reference view for
      each group. </li>
d889 5
a893 5
   <li>
      <code class="output">how_many</code>: &nbsp;&nbsp;&nbsp;
      Summary file listing total number of particles associated with each 
      reference view.</li>
   </ul>
d898 3
a900 1
<li> <p class="action">Create average images for all projection groups</p>
d904 16
a919 8
   <ul>
   <li>
      <code class="output">avg/avg***</code>: &nbsp;&nbsp;&nbsp;
      Average images for each projection group.</li>
   <li>
      <code class="output">avg/var***</code>: &nbsp;&nbsp;&nbsp;
      Variance images for each projection group.</li>
   </ul>
d926 5
a930 4
<!-- if avgs were made for def grp 1, use df001
-d = doc file template, -i = particle template
classavg.py -d df001/select/sel**.ext -i ../Alignment/ali/sar******.ext avg/avg*
-->
d932 1
a932 1
</li><p>The next several operations help to identify a threshold
a940 8
<li><p class="action">Combine all alignment parameter files into a single 
   summary file (if necessary)</p>
   <a class="project" href="./newprogs/combine.spi">combine.spi</a> creates:<br />
   <code class="output">align_01_all</code>, containing merged alignment
   parameters from  all defocus groups. (Not necessary if only a single
   group is used).
</li>

d947 16
a962 10
   <a class="project" href="./newprogs/cchistogram.spi">cchistogram.spi</a> Creates 
   histograms. 
   <ul>
   <li>
      <code class="output">hist/cchist_***</code>: &nbsp;&nbsp;&nbsp;
      The set of histograms by defocus group.</li>
   <li>
      <code class="output">hist/cchist_all</code>: &nbsp;&nbsp;&nbsp;
      The overall histogram.</li>
   </ul>
d966 2
a967 6
   <a class="project" href="./newprogs/plothist.spi">plothist.spi</a> creates: <br />
   <code class="output">plot_hist</code>: &nbsp;&nbsp;&nbsp;
   Text file of gnuplot commands for displaying the histogram. To view this file, 
   start gnuplot with the <code>'gnuplot'</code> command, and load the file:<br />
   <code>gnuplot&gt; load 'plot_hist.ext'</code><br />
   (<code>'ex'</code> exits gnuplot)
d971 1
a971 1
   View the particles corresponding to each reference view. 
d986 12
a997 5
   <a class="project" href="./newprogs/ccthresh.spi">ccthresh.spi</a> 
   Given a percent cutoff 
   level, this procedure creates the doc file: <br />
   <code class="output">thresh</code>,  containing thresholds for each defocus 
   group. E.g., if a threshold of 0.20 is selected, then 20% of all 
d1002 2
a1003 1
   NOT EXACT, AND THEREFORE WILL NOT EXACTLY MATCH THE OUTPUT OF DFTOTALS.SPI.
d1011 10
a1020 4
   <a class="project" href="./newprogs/dftotals.spi">dftotals.spi</a> creates a set of
   particle selection files: <br />
   <code class="output">df***/seltotal</code>, which list the
   particles with correlation values greater than the threshold.
d1027 8
a1034 2
    text file of gnuplot commands: <br />
    <code class="output">plot_view</code>, whichs plots the file <b>how_many.ext</b>,  
d1040 1
a1040 3
   create SPIDER image files showing the distribution of the sample images 
   among the various reference projections. They produce the output 
   files:<br />
d1042 8
a1049 2
   <code class="output">display/cndis***</code>: &nbsp;&nbsp;&nbsp; 
   These files show the 83 angular reference groups represented by small 
d1051 1
a1051 1
   particles in each group.<br />
d1062 8
a1069 4
   creates a new particle selection file for the specified defocus
   group: <br />
       <code class="output">df***/limited_seltotal</code>
   which limits the numbers of images per reference view direction to a 
d1090 1
a1090 1
   <p class="explain">Use the aligned particles to create an initial 3D volume. 
d1107 11
a1117 7
   <ul>
      <li>
          <code class="output">df***/seleven</code>: &nbsp;&nbsp;&nbsp; 
          Odd numbered images for each defocus group.</li>  
      <li><code class="output">df***/selodd</code>: &nbsp;&nbsp;&nbsp; 
          Even numbered images for each defocus group.</li> 
   </ul>
d1119 9
a1127 7
   It then creates two half-reconstructions for each defocus group using back projection: 
   <ul>
      <li> <code class="output">df***/vol001_odd</code>: &nbsp;&nbsp;&nbsp;
          Reconstructed volume from odd images for each defocus group.</li>
      <li> <code class="output">df***/vol001_even</code>: &nbsp;&nbsp;&nbsp;
          Reconstructed volume from even images for each defocus group.</li>
   </ul>
d1130 7
a1136 6
   comparing the two half volumes and creates:
   <ul>
      <li><code class="output">df***/doccmp001</code>: &nbsp;&nbsp;&nbsp;
          Doc files containing  <a href="../../glossary.html#Fourier">FSC curves</a> for 
          each defocus group: 
   </ul>
d1147 7
a1153 5
    <ul> <li>    
       <code class="output">slices/slice***</code>: &nbsp;&nbsp;&nbsp; 
       central slice from each defocus group volume
    </li>
    </ul>    
d1167 2
a1168 2
   <a class="project" href="./newprogs/ctf.spi">ctf.spi</a> applies CTF 
      correction to all the defocus group odd/even volumes 
d1172 2
a1173 1
      (see <a href="../../man/rf3.html">RF 3</a> operation) creating the following files.
d1175 10
a1184 8
   <ul>
   <li>
       <code class="output">combires</code>: &nbsp;&nbsp;&nbsp;
       Combined resolution doc file.</li>
   <li>
      <code class="output">vol001</code>: &nbsp;&nbsp;&nbsp;
      3D structure from the entire set of particles.</li>
   </ul>
d1186 1
a1186 1
   used as the input for the Refinement step.</li>
a1187 1

d1196 2
a1197 1
   <a class="project" href="./newprogs/res.spi">res.spi</a> creates the doc file.<br />
d1199 6
a1204 5
   <ul> <li>    
   <code class="output">resolution</code>: &nbsp;&nbsp;&nbsp;
       Doc. file ontaining the cutoff, the corresponding normalized frequency, and 
       the resolution (in Angstroms).
   </li></ul>    
d1209 1
a1209 1
   gnuplot commands.
d1211 6
a1216 4
   <ul> <li>    
   <code class="output">plot_res</code>: &nbsp;&nbsp;&nbsp; 
       plots the resolution curveof each defocus group, along with the combined resolution curve.
   </li></ul>    
d1230 6
a1235 5
   <ul> 
   <li>    
       <code class="output">volfq001</code>: &nbsp;&nbsp;&nbsp;Filtered volume.
   </li>
   </ul>
d1237 2
a1238 1
   Use the <b>Surface</b> operation in <a href="../../../../web/docs/web.html">WEB</a> 
d1255 4
a1258 1
     and find better fitting angles, than the initial 83 choices. 
a1265 9
<p></p>

<p>
  <b>Refinement is a computationally expensive operation.</b>
  Before running the refinement procedure files, check the results of the
  above reconstructions, to ensure that <u>all</u> defocus groups
  have reasonable particle volumes.
</p>

d1268 3
a1270 11
<li> <p class="action">Create a document file summarizing the selected 
   particles</p>

   <a class="project" href="./newprogs/ordselect.spi">ordselect.spi</a> creates 
    a doc file similar to <code class="output">../Reconstruction/order_defocus</code>.

   <ul> <li>    
   <code class="output">order_select</code>: &nbsp;&nbsp;&nbsp;
      Contains  number of remaining particles in each group after applying the cross 
      correlation cutoff, and the CTF value for that group.
   </li></ul>    
a1271 1

a1273 7
<li> <p class="action">Prepare the data file stacks and alignment parameter files</p>
   <a class="project" href="./newprogs/stack.spi">stack.spi</a> creates: 
   <ul>
      <li>
      <code class="output">input/data***</code>: &nbsp;&nbsp;&nbsp; 
         Set of <a href="../../user_doc.html#file_stack">image stack files</a> that 
         contain all the selected original particles.</li>
d1275 1
a1275 3
      <li>
      <code class="output">input/dala***</code>: &nbsp;&nbsp;&nbsp; 
         Set of image stack files that contain all the selected aligned particles.</li>
d1277 28
a1304 5
      <li>
      <code class="output">input/align_01_***</code>: &nbsp;&nbsp;&nbsp; 
         Set of doc files that contain original alignment parameters for all the 
         selected particles.</li>
   </ul>
a1305 1

d1308 4
a1311 1
<p><li><a href="./refine.html">SPIDER Refinement</a></p>
d1313 14
a1326 10
<p>
  Refinment is a complex and time-consuming process, with many parameters.<br /> 
  First, set the parameters in 
  <a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a>. <br />
  Then run <a class="project" href="./newprogs/refine.pam">refine.pam</a> (or 
  <a class="project" href="./newprogs/pub_refine.pam">pub_refine.pam</a> if running on 
  the cluster with PubSub).<br />
  There are several sub-procedures used in refinement, see the 
  <a href="./refine.html">refinement page</a> for details.<br />
  Among the outputs of refinement are image and document files.</p>
d1328 5
a1332 6
Image files:
   <ul>
   <li>
      <code class="output">bpr**</code>: &nbsp;&nbsp;&nbsp;
      the final volume.</li>
   </ul>
d1334 3
a1336 5
Document files:
   <ul>
   <li>
      <code class="output">align_<i>ii</i>_***</code>: &nbsp;&nbsp;&nbsp; 
      alignment parameters for iteration <i>ii</i></li>
a1337 3
   <li>
      <code class="output">dres<i>ii</i></code>: &nbsp;&nbsp;&nbsp; 
      Doc files with resolution curves for each iteration.</li>
d1339 2
a1340 3
   <li>
      <code class="output">dbpr***</code>: &nbsp;&nbsp;&nbsp; 
      Doc files with combined resolution curves for each defocus group.</li>
d1342 47
a1388 4
   <li>
      <code class="output">resolutions</code>: &nbsp;&nbsp;&nbsp; 
      Doc file containing resolution for each iteration.</li>
   </ul>
d1390 1
a1390 1
</p>
a1391 1
<p>
a1392 2
   <a class="project" href="./newprogs/plotref.spi">plotref.spi</a> 
      creates two text files of gnuplot commands.
d1394 2
a1395 9
   <ul> 
   <li>
      <code class="output">plot_refi</code>: &nbsp;&nbsp;&nbsp; 
      Plots  combined resolution curve for each iteration of refinement.</li>

   <li>
      <code class="output">plot_refd</code>: &nbsp;&nbsp;&nbsp; 
      Plots  resolution curve for each defocus group for the last iteration.</li>
   </ul>
d1397 9
d1413 18
a1430 10
   <a class="project" href="./newprogs/angdisp.spi">angdisp.spi</a> creates
   angular distribution images. 
   <ul> 
   <li>
      <code class="output">disp_<i>ii</i>_***</code>: &nbsp;&nbsp;&nbsp;
      A set of images showing angular positions from the  
      <code class="output">align_<i>ii</i>_***</code> refined alignment 
      parameter output files.
   </li> 
   </ul>
a1431 7
   <a class="project" href="./newprogs/angdiff.spi">angdiff.spi</a> creates: 
   <ul> <li>
      <code class="output">diff_<i>ii</i>_***</code>: &nbsp;&nbsp;&nbsp;
      Image showing changes in angular positions from iteration <i>n-1</i> to 
     iteration <i>n</i>.
   </li>
   </ul>
d1525 1
a1525 1
Page updated: 09/22/06 &nbsp;&nbsp;&nbsp;
@


1.74
log
@cosmetic
@
text
@d13 1
a13 1
<table class="top" width = 100% border=8 bordercolor="#99ccff">
d21 2
a22 1
   Three Dimensional Reconstruction of Single Particle Specimens using Reference Projections</h2>
d89 1
d93 1
d98 4
a101 2
  <li> Frank, J. (1996) <i>Three-dimensional Electron Microscopy of Macromolecular Assemblies</i>
    Academic Press, San Diego.
d103 1
d126 6
a131 6
<a href="./newprogs">batch files</a> are links,<br />
<code class="output">output files</code> created by that batch file 
are marked in green.
<br />
Sometimes more than one approach is available. 
Lists starting with lowercase letters indicate that you should choose
d133 10
a142 7
<ol class="choice">
   <li>one approach, or</li>
   <li>the other approach,</li>
</ol>
but not both (unless you want to compare the two techniques!)
<br />
<font class="guitool"> Graphical tools </font> : some results can be analyzed with  <a href="../../spire/guitools/index.html">graphical interfaces</a>, if they have been installed. 
d145 1
d153 1
a153 1
   <h3 class="heading">Running SPIDER batch files</h3>
d156 1
a156 1
   directory has to be set up with the proper subdirectories and batch files.
d162 1
d164 1
d167 2
a168 1
If you are running SPIDER at the Unix prompt, then read below to learn how to execute SPIDER batch files.
d171 1
d173 3
a175 1
If you are using  <a href="../../spire/index.html">SPIRE</a>, then skip this section and read <a href="mrspire.html">how to run SPIDER batch files in SPIRE</a>.
d180 1
a180 1
<p>Processing steps are carried out by batch and procedure files,
d182 1
a182 1
in this document, click the batch filename and copy the procedure
d188 1
a188 1
following format to run a SPIDER batch procedure:</p>
d201 4
a204 3
   subdirectories and batch files</p> 
   The batch files below are packed into the zipped tar file 
   <a href= "./spiproject.tar.gz">spiproject.tar.gz</a> (for the <b>archive </b>of<b> older </b>batch files,
d209 1
a209 1
It will create a directory called <i>myproject</i>, containing the batch files 
d218 1
a218 1
that are used by many batch files. The following files should be
d226 2
a227 2
   Many batch files read project
   parameters from this doc file. Run the interactive batch file<br />
d237 2
a238 2
   of the filenames are entered as templates in the top level batch
   files - see below). Run the interactive batch file <br />
d272 1
a272 1
   This batch file should
d280 1
a280 1
<p><h4>After running each batch file, check the output files to make
d289 1
d291 3
a293 5
<h3 class="heading">Contrast Transfer Function estimation</h3>

<p class="explain">Estimate the defocus of each micrograph by calculating its 
  power spectrum. Then group the micrographs into groups of similar defocus.
</p>
d295 2
a296 3
<p>These procedures should be run in the <i>Power_Spectra</i> directory.<br />
The micrographs should be in the <i>Micrographs</i> directory.</p>

d305 3
a307 1
<a href="../../spire/guitools/ctfdemo.html"><font class="guitool">ctfdemo</font></a>, a program that demonstrates the effects of various parameters on the CTF, and
d313 7
a319 7
<li>
<p class="action">Calculate the power spectrum for each micrograph</p>
<p>
<a class="project" href="./newprogs/power.spi">power.spi</a>, at its procedure 
<a class="project" href="./newprogs/power_p1.spi">power_p1.spi</a>, read each micrograph 
and compute an averaged power spectrum for it. Each micrograph has 2 
corresponding output files:</p>
d321 14
a334 13
<ul>
    <li style="list-style: none">
    <code class="output">pw_avg***</code> : 2D power spectra, each is an 
    average of many smaller
    power spectra calculated over the surface of the micrograph.
    </li> 
    <li style="list-style: none">
    <code class="output">roo***</code> : doc files of 1D profiles of 
    the rotationally averaged power spectra.  These doc files can be 
    plotted with <b>gnuplot</b> or 
    <a href="../../spire/guitools/pyplot.html"><font class="guitool">pyplot</font></a>
    </li>
</ul>
d336 1
a336 1
</li>
d338 3
a340 10
<p>
<li>
<p class="action">Check the rings in the power spectrum images.</p>
<p>
Make a montage using <a href=
"../../../../web/docs/web.html">WEB</a> (reduction factor 4) to
look at these power spectra. They are equivalent to diffraction
patterns obtained in the optical diffractometer. It is absolutely
important that you screen these spectra before proceeding any
further. Things to look out for: 
d342 7
a348 2
<ul>
    <li style="list-style: none">Are the Thon rings round?</li>
d350 4
a353 2
    <li style="list-style: none">Do they extend to high resolution?</li>
</ul>
d355 2
a356 3
<br />
 You can discard micrographs that show one of the following
artifacts: 
d358 4
a361 3
<ul>
    <li style="list-style: none">Rings that are cut off unidirectionally 
    (evidence of drift)</li>
d363 1
a363 3
    <li style="list-style: none">Rings that are elliptical, or even 
    hyperbolic (evidence of astigmatism).</li>
</ul>
d365 2
a366 1
See this example:
a367 3
<p><a href="pics/power.jpg"><img width="182" height="243" src=
"pics/power.jpg"></a></p>
</li>
d369 1
d371 3
a373 1
<li style="list-style: none"><a name="DEF"></a></li>
d375 15
a389 3
<li><p class="action">Determine defocus</p>
<p>
 Use one of the following methods to estimate defocus for each micrograph: 
d391 3
a393 14
<ol class="choice">
   <li><a class="project" href="./newprogs/defocus.spi">defocus.spi</a> : 
   estimates defocus with SPIDER operation <a href="../../man/tfed.html"><b>TF
   ED</b></a>, creating: <br />
   <code class="output">defocus</code>, a document file of defocus and
   astigmatism values, and<br />
   <code class="output">ctf***</code> doc files of the background-subtracted
   1D power spectra.<br />
   It uses the procedure 
   <a class="project" href="./newprogs/calcparms.spi">calcparms.spi</a>, which checks values in
   the <a href="./params.html">parameter file</a>.<br />
   The <code class="output">ctf***</code> files can be analyzed with 
   <a href="../../spire/guitools/ctfmatch/ctfmatch.html"><font class="guitool">ctfmatch.py</font></a>
   </li>
d395 11
a405 12
   <li><a href="../../../../web/docs/ctf.html">CTF from doc file</a>
   in <b>WEB</b>. Manual fitting a CTF model to the 1D profiles.
   </li>

   <li><a class="project" href="./newprogs/mrc.spi">mrc.spi</a> a batch file 
   that calls the MRC program <b>ctffind2</b>. It estimates both the defocus
   and astigmatism, and writes the output file 
   <code class="output">defocus</code>. It calls 
   <a class="project" href="./newprogs/ctffind">ctffind</a>, a shell script, and 
   <a class="project" href="./newprogs/readmrc.py">readmrc.py</a>, a python script. 
   See the <a href="defmrc.html">defmrc manual page</a> for more
   information.
a406 3
</ol>
 
</li>
a407 3
<p>
<li>
<p class="action">Assign defocus groups according to the power spectrum.</p>
d409 12
a420 9
   <a class="project" href="./newprogs/defsort.spi">defsort.spi</a>: reads 
   the "defocus"
   doc file generated by one of the above methods, and writes out<br />
   <code class="output">def_sort</code>, a doc file with the same information 
    sorted by defocus.
   It also tentatively assigns each micrograph to a defocus group. <b>
   These automated defocus group assignments are only a starting point,
   however. You must manually inspect the defocus groupings to see
   which micrographs belong together, ensuring that they are "in phase".</b>
d422 14
a435 22
   <p>
   Spectral profiles (that is, the roo*** or ctf*** files) from the same defocus
   group should be plotted together, to ensure that their zeroes (minima)
   line up, and do not cancel out. Plot the power spectrum for each
   micrograph and assign them to defocus groups such that the curves are in phase.
   Use either:
<ol class="choice">
  <li>
      <a href="../../spire/guitools/ctfgroup.html"><font     class="guitool">ctfgroup.py</font></a>
  </li>
  <li>
   <a href="../../spire/guitools/pyplot.html"><font     class="guitool">pyplot</font></a>
  </li>
  <li>
    <b>gnuplot</b><br />
   Gnuplot commands can be saved in a
   text file, such as <a href="./newprogs/plotpower">plotpower</a>,
   then run in <i>gnuplot</i> using the <i>load</i> command:<br />
   <code>gnuplot&gt; load 'plotpower'</code>
   <p><a href="pics/plotpower1.gif"><img width="200" height="150" src=
   "pics/plotpower1.gif"></a></p>
 </li>
d437 10
a446 1
</ol>
d472 1
d474 7
a480 9
<h3 class="heading">Particle Picking and Selection</h3>

<p class="explain">A particle picking batch file analyzes each micrograph, 
cutting out small windows of likely particle candidates. This is followed 
by a manual selection process that identifies the good particle images and 
rejects the bad ones. Particles automatically output by the batch file are 
said to be <i>picked</i>; the subset that are manually chosen are said to 
be <i>selected</i>.
</p>
d482 1
a482 2
<p>These procedures should be run in the <i>Particles</i>
directory.</p>
d495 1
a495 1
      way). The window sizes do not need to match.
d500 14
a513 14
      <a class="project" href="./newprogs/noise.spi">noise.spi</a> creates 
      a noise image, <code class="output">noise.ext</code>. This is selected at
      random from a set of regions in the micrograph that appear not to
      contain any particles (the files 
      <code class="output">tmpnoise/noi***</code>). View the selected noise file;
      if it has any structure (particle, junk), then select one of the other
      candidates and copy it to <code class="output">noise.ext</code>. This 
      batch file
      requires a micrograph in SPIDER format. If your micrographs are <b>tif</b>
      and/or <b>gzipped</b> files, use
      <a class="project" href="./newprogs/convert.spi">convert.spi</a> and 
      its procedure 
      <a class="project" href="./newprogs/convert_p.spi">
      convert_p.spi</a> to convert one to SPIDER format.
d528 15
a542 15
    <a class="project" href="./newprogs/pick.spi">pick.spi</a> and its procedure 
    <a class="project" href="./newprogs/pick_p.spi">pick_p.spi</a>, 
    Apply correlation with a Gaussian blob.
    <br />
    The micrographs are decimated by 1/4,
    Fourier filtered with a Gaussian low pass filter, and searched for
    peaks over regions corresponding to particle dimensions. Particles
    are windowed out and centered, then peak locations are corrected, and
    particles are windowed again. This procedure uses histogram
    equalization. Output files:<br />
    <code class="output">win/ser*****</code> : Particle images <br />
    <code class="output">coords/ndc***</code> : Peak coordinates
    from 1/4 decimated image <br />
    <code class="output">coords/sndc***</code> : Top left pixel
    coordinates for particle images. <br />
d547 13
a559 13
    (and procedure 
    <a class="project" href="./newprogs/pickparticle.spi">pickparticle.spi</a>) 
    use the Local Fast Correlation algorithm.<br />
    This procedure uses <a href="../../partpick.html#LFC">local
    cross-correlation</a> calculated using Fourier methods outlined by
    <a href="#AR03">Roseman (2003)</a>. This implementation is described in 
    <a href="#BR04">Rath and Frank (2004)</a>. A 3D reference volume is required
    to generate projections at desired Eulerian angles for 
    searching different orientations of the search image in the micrograph.<br />
    Output files:<br />
    <code class="output">win/ser*****</code> : Particle images <br />
    <code class="output">coords/sndc***</code> : Pixel
    coordinates for <i>center</i> of particle images. <br />
d569 1
a569 1
   doc file<br />
d572 1
a572 1
   </li>
d574 1
a574 1
   <li style="list-style: none"><a name="PFILT"></a></li>
d581 3
a583 3
     <a class="project" href="./newprogs/pfilt.spi">pfilt.spi</a> Filters a 
     set of images,
     adjusting filter settings for each micrograph, based on its defocus.
d587 2
a588 2
   <a class="project" href="./newprogs/pfilt2.spi">pfilt2.spi</a> is a 
    simpler version.
d591 2
a592 1
   Both batch files create:<br />
d626 2
a627 2
   will delete the appropriate lines from the file. Run this batch file, 
   even you you don't think you made any mistakes - subsequent batch files 
a648 1

d666 1
a666 1
<b>Reference projections</b> <br />
d668 9
a676 8
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Reference projections (images) are views of the object at known angles.
   In what follows, angular accuracy is set to 15 degrees, which
   results in 83 reference projections. A reference volume
   is needed in the top level project directory to create the projections. 
   The row and column dimensions of the reference volume must match the 
   dimensions of the particle windows. (see <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>)
 </p>
d686 1
a686 1
   <li style="list-style: none"><code class="output">projlist</code>: &nbsp;&nbsp;&nbsp;
d688 2
a689 1
   <li style="list-style: none"><code class="output">refangles</code>: &nbsp;&nbsp;&nbsp;
d693 2
a694 1
   <li style="list-style: none"><code class="output">prj_****</code>: &nbsp;&nbsp;&nbsp;
d708 1
d710 3
a712 3
     Generate more realistic references by multiplying them by the CTF (the 
     default). There will be a stack of reference projections for each defocus 
     group
d724 2
a725 2
   <li style="list-style: none">
   <code class="output">part_by_group_***</code>: &nbsp;&nbsp;&nbsp;
d729 2
a730 2
   <li style="list-style: none">
   <code class="output">order_defocus</code>: &nbsp;&nbsp;&nbsp; 
d732 1
a732 1
     Cumulative number of particles, and Average defocus for each group.</li>
d740 4
a743 4
   <a class="project" href="./newprogs/apsh.spi">apsh.spi</a> uses 
   <a href="../../man/apsh.html"><b>AP SH</b></a>, to create a single document file: <br />
   <code class="output">align_01_001</code>: &nbsp;&nbsp;&nbsp; 
   Contains shift and rotation parameters for the best matched projection.</p>
d747 4
a750 4
   <a class="project" href="./newprogs/apshgrp.spi">apshgrp.spi</a> uses 
   <a href="../../man/apsh.html"><b>AP SH</b></a>,  to create a set of 
   document files.<br />
   <code class="output">align_01_***</code>: &nbsp;&nbsp;&nbsp;
d752 3
a754 3
   <br />
   If you are using <a href="../../../pubsub/pubsub.html">Publish and Subscribe</a>
   on a Cluster, activate PubSub within <i>apshgrp.spi</i> procedure heading.</p>
d765 1
a765 1
       aligned versions of the particle images.<br />
a776 1

d796 1
a796 1
   <li style="list-style: none">
d798 2
a799 2
          Lists number of particles associated with each reference view for 
          each group. </li>
d801 1
a801 1
   <li style="list-style: none">
d803 2
a804 2
         Lists the particles associated with each reference view for
         each group. </li>
d806 1
a806 1
   <li style="list-style: none">
d808 2
a809 2
         Summary file listing total number of particles associated with each 
         reference view.</li>
d818 1
a818 1
     creates the following files for a selected defocus group.
d820 1
a820 1
   <li style="list-style: none">
d822 2
a823 2
         Average images for each projection group.</li>
   <li style="list-style: none">
d825 1
a825 1
          Variance images for each projection group.</li>
d862 1
a862 1
      histograms. 
d864 1
a864 1
   <li style="list-style: none">
d866 2
a867 2
         The set of histograms by defocus group.</li>
   <li style="list-style: none">
d869 1
a869 1
         The overall histogram.</li>
d872 1
a872 1
<p></p>
d876 4
a879 4
      Text file of gnuplot commands for displaying the histogram. To view this file, 
      start gnuplot with the <code>'gnuplot'</code> command, and load the file:<br />
      <code>gnuplot&gt; load 'plot_hist.ext'</code><br />
      (<code>'ex'</code> exits gnuplot)
d972 1
a972 1
<h3 class="heading">3D Reconstruction</h3>
d974 4
a977 4
<p class="explain">Use the aligned particles to create an initial 3D volume. 
To estimate the resolution of the resulting structure, the data are split 
into two equal sets, and the two resulting volumes are compared. 
</p>
d979 1
a979 2
<p>These procedures should be run in the <i>Reconstruction</i> directory.</p>

d985 2
a986 1
<li><p class="action">Split the data, create paired reconstructions, and compute resolution for each defocus group</p>
d992 1
a992 1
      <li style="list-style: none">
d995 1
a995 1
      <li style="list-style: none"><code class="output">df***/selodd</code>: &nbsp;&nbsp;&nbsp; 
d1001 1
a1001 1
      <li style="list-style: none"> <code class="output">df***/vol001_odd</code>: &nbsp;&nbsp;&nbsp;
d1003 1
a1003 1
      <li style="list-style: none"> <code class="output">df***/vol001_even</code>: &nbsp;&nbsp;&nbsp;
d1010 1
a1010 1
      <li style="list-style: none"><code class="output">df***/doccmp001</code>: &nbsp;&nbsp;&nbsp;
d1024 1
a1024 1
    <ul> <li style="list-style: none">    
d1027 8
a1034 7
    </li></ul>    
   Use the <b>Montage</b> operation in <a href="../../../../web/docs/web.html">WEB</a> 
   to view the slices. Ideally, each 
   image should show a particle isolated from its surroundings, exhibiting 
   some internal structure - somewhat like the reference images. If any 
   images are blank or otherwise unusual, go back and check the processing of 
   that defocus group.
d1050 1
a1050 1
   <li style="list-style: none">
d1053 1
a1053 1
   <li style="list-style: none">
d1055 1
a1055 1
          3D structure from the entire set of particles.</li>
d1071 1
a1071 1
   <ul> <li style="list-style: none">    
d1082 1
a1082 1
   <ul> <li style="list-style: none">    
d1099 6
a1104 4
   <ul> <li style="list-style: none">    
   <code class="output">volfq001</code>: &nbsp;&nbsp;&nbsp;
     Filtered volume.
   </li></ul>    
d1116 1
a1116 1
<h3 class="heading">Refinement</h3>
d1118 6
a1123 6
<p class="explain">Refinement essentially performs the above steps repeatedly, 
decreasing the angular resolution of reference projections with each iteration, 
thereby giving the data particles a chance to find a better approximating 
reference match each time. Thus the data particles are allowed to "settle in" 
and find better fitting angles, than the initial 83 choices. 
</p>
d1125 1
a1125 1
<p>These procedures should be run in the <i>Refinement</i> directory.</p>
d1133 4
a1136 4
<b>Refinement is a computationally expensive operation.</b>
Before running the refinement batch files, check the results of the
above reconstructions, to ensure that <u>all</u> defocus groups
have reasonable particle volumes.
d1147 1
a1147 1
   <ul> <li style="list-style: none">    
d1159 1
a1159 1
      <li style="list-style: none">
d1164 1
a1164 1
      <li style="list-style: none">
d1168 1
a1168 1
      <li style="list-style: none">
d1180 9
a1188 9
Refinment is a complex and time-consuming process, with many parameters.<br /> 
First, set the parameters in 
<a class="project" href="./newprogs/refine_settings.pam">refine_settings.pam</a>. <br />
Then run <a class="project" href="./newprogs/refine.pam">refine.pam</a> (or 
<a class="project" href="./newprogs/pub_refine.pam">pub_refine.pam</a> if running on 
the cluster with PubSub).<br />
There are several sub-procedures used in refinement, see the 
<a href="./refine.html">refinement page</a> for details.<br />
Among the outputs of refinement are image and document files.</p>
d1192 3
a1194 3
   <li style="list-style: none">
   <code class="output">bpr**</code>: &nbsp;&nbsp;&nbsp;
   the final volume.</li>
d1199 2
a1200 2
   <li style="list-style: none">
   <code class="output">align_<i>ii</i>_***</code>: &nbsp;&nbsp;&nbsp; 
d1203 2
a1204 2
   <li style="list-style: none">
   <code class="output">dres<i>ii</i></code>: &nbsp;&nbsp;&nbsp; 
d1207 2
a1208 2
   <li style="list-style: none">
   <code class="output">dbpr***</code>: &nbsp;&nbsp;&nbsp; 
d1211 2
a1212 2
   <li style="list-style: none">
   <code class="output">resolutions</code>: &nbsp;&nbsp;&nbsp; 
d1224 2
a1225 2
   <li style="list-style: none">
   <code class="output">plot_refi</code>: &nbsp;&nbsp;&nbsp; 
d1228 2
a1229 2
   <li style="list-style: none">
   <code class="output">plot_refd</code>: &nbsp;&nbsp;&nbsp; 
d1238 1
a1238 1
   batch files</p>
d1243 2
a1244 2
   <li style="list-style: none">
   <code class="output">disp_<i>ii</i>_***</code>: &nbsp;&nbsp;&nbsp;
d1248 2
a1249 1
   </li> </ul>
d1252 2
a1253 2
   <ul> <li style="list-style: none">
   <code class="output">diff_<i>ii</i>_***</code>: &nbsp;&nbsp;&nbsp;
d1256 2
a1257 2

</li>
a1259 1
</ul>
d1265 4
a1268 2
<table class="heading" width="100%"><tr><td> <br />
<h3> Other Useful Methods </h3>
d1282 2
a1283 2
<p><dt>
<a href="../diffmaps/index.html">Difference Maps</a></dt>
d1287 3
a1289 3
<p><dt>
<a href="../xray/xray.html">Frequency amplitude correction with X-ray
scattering data</a></dt>
d1294 1
a1294 2
<p><dt>
<a href="../classification/index.html">Classification of Particles</a></dt>
d1298 1
a1298 2
<p><dt>
See more approaches at the <a href="../../techniques.html">techniques page</a></dt>
d1351 1
a1351 1
Page updated: 10/22/05 &nbsp;&nbsp;&nbsp;
d1354 1
d1358 1
@


1.73
log
@cosmetic
@
text
@d1316 1
a1316 1
   B.K. Rath and J. Frank (2004) 
d1322 1
a1322 1
   Alan Roseman (2003) 
@


1.72
log
@added link to mrspire.html; fixed numerous typos.
@
text
@d187 1
a187 1
   <a href= "./spiproject.tar.gz">spiproject.tar.gz</a> (for the <b>archive</b>,
@


1.71
log
@corrected typo
@
text
@d115 1
a115 1
In the sections below:
d120 1
a120 1
<a href="">batch files</a> are links,<br />
d122 4
a125 2
are marked in green. Sometimes more than one approach is available. 
Lists starting with lowercase letters indicate thate you should choose
d132 2
d152 11
d176 1
a176 1
<br/>
d286 6
a291 6
 For more information, see also <br/>&nbsp;&nbsp;&nbsp;&nbsp;
<a href="../ctf/ctf.html">contrast transfer function correction</a> tutorial, 
<br/>&nbsp;&nbsp;&nbsp;&nbsp;
 <a href="../../guitools/ctfdemo.html">ctfdemo</a>, a program that demonstrates 
the effects of various parameters on the CTF, and
<br/>&nbsp;&nbsp;&nbsp;&nbsp;
d313 2
a314 2
    plotted with gnuplot or 
    <a href="../../spire/guitools/pyplot.html">pyplot</a>
d337 1
a337 1
<br/>
d365 1
a365 1
   ED</b></a>, creating: <br/>
d367 1
a367 1
   astigmatism values, and<br/>
d369 1
a369 1
   1D power spectra.<br/>
d372 1
a372 1
   the <a href="./params.html">parameter file</a>.<br/>
d374 1
a374 1
   <a href="../../spire/guitools/ctfmatch/ctfmatch.html">ctfmatch</a>
d400 1
a400 1
   doc file generated by one of the above methods, and writes out<br/>
d405 1
a405 1
   however. You should manually inspect the defocus groupings to see
d412 12
a423 4
   micrograph in either <i>gnuplot</i> or 
   <a href="../../spire/guitools/pyplot.html">pyplot</a>, 
   and assign the defocus groups
   such that the curves are in phase. Gnuplot commands can be saved in a
d425 1
a425 1
   then run in <i>gnuplot</i> using the <i>load</i> command:<br/>
d429 4
a434 2


d442 1
a442 1
   averages for each defocus group:<br/>
d524 1
a524 1
    equalization. Output files:<br/>
d536 1
a536 1
    use the Local Fast Correlation algorithm.<br/>
d542 2
a543 2
    searching different orientations of the search image in the micrograph.<br/>
    Output files:<br/>
d551 2
d556 1
a556 1
   doc file<br/>
d578 1
a578 1
   Both batch files create:<br/>
d580 1
a580 1
   particle images. <br/>
d621 1
a621 1
   <a class="project" href="./newprogs/snums.spi">snums.spi</a> creates<br/>
d623 1
a623 1
   particles for each micrograph, and<br/>
d661 1
a661 1
   dimensions of the particle windows.
d670 1
a670 1
   three sets of files.<br/>
d683 16
a698 5

   By default, a stack of reference projections is created for each defocus 
   group. If only asingle set of reference projections is desired 
  (by setting register x90 = 0), they will be in file: 
   <code class="output">prj_001</code>
d705 1
a705 1
   creates  selection document files and a group summary file.<br/>
d722 1
a722 1
   <li> If you have a single defocus group <br/>
d724 1
a724 1
   <a href="../../man/apsh.html"><b>AP SH</b></a>, to create a single document file: <br/>
d729 1
a729 1
   <li> If you have a multiple defocus groups. <br/>
d732 1
a732 1
   document files.<br/>
d735 1
a735 1
   <br/>
d746 3
a748 3
   alignment parameter files to the raw particle images. <br/>
   <code class="output">ali/sa******</code>: &nbsp;&nbsp;&nbsp;
       aligned versions of the particle images.<br/>
d858 1
a858 1
   <a class="project" href="./newprogs/plothist.spi">plothist.spi</a> creates: <br/>
d861 2
a862 2
      start gnuplot with the <code>'gnuplot'</code> command, and load the file:<br/>
      <code>gnuplot&gt; load 'plot_hist.ext'</code><br/>
d884 1
a884 1
   level, this procedure creates the doc file: <br/>
d900 1
a900 1
   particle selection files: <br/>
d909 1
a909 1
    text file of gnuplot commands: <br/>
d913 1
a913 1
   <p>
d916 3
a918 2
   create SPIDER image files showing distribution of the sample images among the
   various reference projections used. <br/></p>
a919 1
   <p>
d921 3
a923 3
      Shows the 83 angular reference groups represented by small circles. 
      The radii of these circles are proportional to the number of particles in 
      each group.<br/></p>
d931 1
a931 1
   <p class="action">Limit strongly over-represented angular projections</p>
d935 1
a935 1
   group: <br \>
d939 5
a943 4
   angular projections which may cause a shape error in the reconstruction.<br\>
   After renaming this file to: <code class="output">df***/seltotal</code> 
   continue with: <i><a href="./newprogs/select.spi">select.spi</a></i> to repeat the
   reconstruction with limited particles.
d970 1
a970 1
<li><p class="action">Compute resolution for each defocus group</p>
d1006 1
a1006 1
    central slice from a volume in each defocus group: <br/>
d1185 1
a1185 1
   <code class="output">dres<i>ii</i>/code>: &nbsp;&nbsp;&nbsp; 
d1332 1
a1332 1
Page updated: 07/07/05 &nbsp;&nbsp;&nbsp;
@


1.70
log
@cosmetic
@
text
@d172 1
a172 1
   <a href= "./spiproject.tar.gz">spiproject.tar.gz</a> (for the <b>archieve</b>,
@


1.69
log
@added download for archieved batch files
@
text
@d172 1
a172 1
   <a href= "./spiproject.tar.gz">spiproject.tar.gz</a> (for <b>older versions</b>,
@


1.68
log
@added bestim.spi for limiting views (replaces old b19)
@
text
@d172 2
a173 1
   <a href= "./spiproject.tar.gz">spiproject.tar.gz</a>. Download this file to your 
@


1.67
log
@added missing bracket to line 1151, which prevented plotref.spi link from appearing
@
text
@d462 1
a462 2
      a noise
      image, <code class="output">noise.ext</code>. This is selected at
d843 3
a845 2
   <a class="project" href="./newprogs/ccthresh.spi">ccthresh.spi</a> Given a percent cutoff 
   level, this procedure creates the doc file,<br/>
d869 2
a870 2
   <a class="project" href="./newprogs/plotview.spi">plotview.spi</a> creates the 
    text file of gnuplot commands,<br/>
d872 1
a872 1
    showing the number of particles vs projection view.
d874 1
a874 2
<p></p>

d878 1
a878 1
   various reference projections used. <br/>
d880 1
d882 1
a882 1
      Showing the 83 angular reference groups represented by small circles. 
d884 1
a884 1
      each group.<br/>
d886 1
d888 17
a904 1
   to display the plots.
a908 10
<!--
Limit strongly over-represented angular projections.<br/>
 In case of strong over-representation of some of the angular
directions, use: <i><a class="project" href="./newprogs/b19.eqp">b19.eqp</a></i> to
limit the numbers of images per direction to a certain number.<br/>
 Alternatively to keep half of the best per direction, but no more
than specified number, use: <i><a href=
"./newprogs/b19.eqs">b19.eqs</a></i>
-->

d920 1
a920 1
 into two equal sets, and the two resulting volumes are compared. 
d923 2
a924 2
<p>These procedures should be run in the <i>Reconstruction</i>
directory.</p>
d932 3
a934 3
<a class="project" href="./newprogs/deffsc.spi">deffsc.spi</a>
    creates  selection doc files of odd and even numbered particles 
       by splitting the data into two equal sets: 
d937 1
a937 1
      <code class="output">df***/seleven</code>: &nbsp;&nbsp;&nbsp; 
d942 1
d950 1
d969 1
a969 1
    <code class="output">slices/slice***</code>: &nbsp;&nbsp;&nbsp; 
d989 2
a990 2
    Finally it calculates the FSC resolution curve for the combined data set 
    (see <a href="../../man/rf3.html">RF 3</a> operation) creating the following files.
d994 2
a995 2
      <code class="output">combires</code>: &nbsp;&nbsp;&nbsp;
         Combined resolution doc file.</li>
d1292 1
a1292 1
Page updated: 04/04/05 &nbsp;&nbsp;&nbsp;
@


1.66
log
@tested & updated some procedures
@
text
@d1151 1
a1151 1
<li><p class="action">Plot the refinement resolution curves</p
@


1.65
log
@apsh stuff
@
text
@d49 1
a49 1
<dd>identifies likely  ribosome particles from the micrographs, 
d161 1
a161 1
<br>
d197 2
a198 2
   <code class="output">params</code>. <a href="./params.html">The parameters are described
   here</a>.</li>
d238 4
a241 3
   <a class="project" href="./newprogs/resizevol.spi">resizevol.spi</a>. This batch file should
be run in the top-level project directory, creating an output 
<code class="output">reference_volume</code>.
d248 2
a249 2
sure the results are sensible. If you are not sure what is
"sensible", ask an expert.</h4></p>
d252 1
d260 1
a260 1
power spectrum. Then group the micrographs into groups of similar defocus.
d263 1
a263 2
<p>These procedures should be run in the <i>Power_Spectra</i>
directory.<br />
d270 1
a270 1
 For more information, see also <br>&nbsp;&nbsp;&nbsp;&nbsp;
d272 1
a272 1
<br>&nbsp;&nbsp;&nbsp;&nbsp;
d275 1
a275 1
<br>&nbsp;&nbsp;&nbsp;&nbsp;
d321 1
a321 1
<br>
d326 2
a327 2
    <li style="list-style: none">Rings that are cut off unidirectionally (evidence of
    drift)</li>
d329 2
a330 2
    <li style="list-style: none">Rings that are elliptical, or even hyperbolic (evidence of
    astigmatism).</li>
d347 3
a349 3
   <li><a class="project" href="./newprogs/defocus.spi">defocus.spi</a> : estimates defocus
   with SPIDER operation <a href="../../man/tfed.html"><b>TF
   ED</b></a>, creating: <br>
d351 1
a351 1
   astigmatism values, and<br>
d353 1
a353 1
   1D power spectra.<br>
d356 1
a356 1
   the <a href="./params.html">parameter file</a>.<br>
d365 2
a366 2
   <li><a class="project" href="./newprogs/mrc.spi">mrc.spi</a> a batch file that calls the MRC
   program <b>ctffind2</b>. It estimates both the defocus
d370 2
a371 2
   <a class="project" href="./newprogs/readmrc.py">readmrc.py</a>, a python script. See the <a
   href="defmrc.html">defmrc manual page</a> for more
d382 5
a386 3
   <a class="project" href="./newprogs/defsort.spi">defsort.spi</a>: reads the "defocus"
   doc file generated by one of the above methods, and writes out<br>
   <code class="output">def_sort</code>, a doc file with the same information sorted by defocus.
d401 1
a401 1
   then run in <i>gnuplot</i> using the <i>load</i> command:<br>
d416 3
a418 2
   averages for each defocus group:<br>
   <a class="project" href="./newprogs/defavg.spi">defavg.spi</a> creates 2 doc files
d427 1
d461 2
a462 1
      <a class="project" href="./newprogs/noise.spi">noise.spi</a> creates a noise
d472 2
a473 1
      <a class="project" href="./newprogs/convert.spi">convert.spi</a> and its procedure 
d499 1
a499 1
    equalization. Output files:<br>
d511 1
a511 1
    use the Local Fast Correlation algorithm.<br>
d517 2
a518 2
    searching different orientations of the search image in the micrograph.<br>
    Output files:<br>
d526 1
a526 1
<li><p class="action">Determine the particle numbers corresponding to each micrograph</p>
d528 2
a529 1
   <a class="project" href="./newprogs/pnums.spi">pnums.spi</a> Creates the doc file<br>
d536 1
a536 1
<li><p class="action">[<b>Optional</b>] Low-pass filter the particle images before
d541 2
a542 1
     <a class="project" href="./newprogs/pfilt.spi">pfilt.spi</a> Filters a set of images,
d547 2
a548 1
   <a class="project" href="./newprogs/pfilt2.spi">pfilt2.spi</a> is a simpler version.
d551 3
a553 2
   Both batch files create:<br>
   <code class="output">flt/ser*****</code>, a set of low-pass filtered particle images. <br>
d594 1
a594 1
   <a class="project" href="./newprogs/snums.spi">snums.spi</a> creates<br>
d596 1
a596 1
   particles for each micrograph, and<br>
d605 1
d629 1
a629 1
 Reference projections (images) are views of the ribosome at known angles.
a634 1

a636 10
<p>
<b>Running SPIDER on the Linux Cluster</b>
 <br />
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 If you decide to use the Linux Cluster with 
 <a href="../../techniques.html#CLUSTER">Publish and Subscribe</a>, 
 activate PubSub within the alignment procedure heading.

<hr>

d642 19
a660 12
   <a class="project" href="./newprogs/refproj.spi">refproj.spi</a> creates:<br>
   <code class="output">projlist</code>, a list of 83 projection numbers,<br>
   <code class="output">refangles</code>, a doc file with 3 Euler angles 
   for each of the 83 projections,<br>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    generated by the Spider
   operation <a href="../../man/voea.html"><b>VO EA</b></a><br>
   <code class="output">prj001/prj****</code>, the reference images produced 
   by the operation <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> using the above       2 files.<br>
   By default, a set of reference projections is created for each defocus 
   group, corresponding to the <b>prj<i>***</i></b>/ directories. If only a 
   single set of reference projections is desired (by setting register x90 = 0), 
   they will be in directory <b>prj001</b>. 
d665 14
a678 5
<li><p class="action">Create lists of all images in each defocus group</p>
   <a class="project" href="./newprogs/sel_by_group.spi">sel_by_group.spi</a> writes the 
   selection document files:<br>
   <code class="output">part_by_group_***</code>, one for each defocus group, 
   listing all the particles in that group.
d682 1
a682 1
<li><p class="action">Align the particles to the reference projections</p>
d684 1
a684 1
   <li> If you have a single defocus group <br>
d686 3
a688 4
   <a href="../../man/apsh.html"><b>AP SH</b></a>, to create a single document file:        <br>
   <code class="output">align_01_001</code>  
   containing the shift and rotation parameters for the best matched 
   projection.</p>
d691 1
a691 1
   <li> If you have a multiple defocus groups. <br>
d693 7
a699 4
   <a href="../../man/apsh.html"><b>AP SH</b></a>,  to create a set of document files:<br>
   <code class="output">align_01_***</code>  
   containing the shift and rotation parameters for the best matched 
   projections.</p>
a701 11

<p></p>

<li><p class="action">Combine all alignment parameter files into a single 
   summary file (if necessary)</p>
   <a class="project" href="./newprogs/combine.spi">combine.spi</a> creates:<br />
   <code class="output">align_01_all</code>, containing merged alignment
   parameters from  all defocus groups. (Not necessary if only a single
   group is used).
</li>

d705 6
a710 10
   <p class="action">Rotate and shift particles according to alignment
   parameters</p>
   <a class="project" href="./newprogs/alignsh.spi">alignsh.spi</a> applies the shifts 
   and rotations in the <code class="output">align_01_***</code> files to 
   the raw particle images, creating<br>
   <code class="output">ali/sar*****</code>, the aligned versions of 
   the particle images.<br>
   (If the particles are mirrored in the alignment document file from 
   <a href="../../man/apsh.html"><b>AP SH</b></a>, they have been mirrored 
   after they are rotated and shifted.)
d718 1
d726 3
a728 1
   given reference view are averaged together. Further particle selection is made by selecting a cutoff threshold to reject some particles. The distribution of projections can be displayed.
d731 1
a731 2
   <p>These procedures should be run in the <i>Reconstruction</i>
   directory.</p>
a737 12

<li><p class="action">Determine the number of particles in each defocus group</p>

   <a class="project" href="./newprogs/ordefocus.spi">ordefocus.spi</a> 
   Creates a doc file, 
   <code class="output">order_defocus</code> with 3 columns:<br>
   <i>Number of particles</i>, <i>Cumulative number of  
   particles</i>, and <i>Average defocus</i> for each group.
</li>

<p></p>

d740 1
a740 1
   Creates the following files:
d743 3
a745 3
      <code class="output">df***/how_many</code> : Lists total number of particles 
      associated with each reference view.
   </li>
d748 3
a750 3
      <code class="output">df***/select/sel???</code> Lists the particular particles 
      associated with each reference view.
   </li>
d753 3
a755 3
      <code class="output">how_many</code> : Summary file listing sums of all 
      the <code class="output">df***/how_many</code> files.
   </li>
d762 1
d764 1
a764 2
    For a selected defocus group, the following are created:<br /> 

d767 2
a768 2
      <code class="output">avg/avg***</code> : Average images for each
      projection group.</li>
d770 2
a771 2
      <code class="output">avg/var***</code> : Variance images for each
      projection group.</li>
d793 10
d807 2
a808 1
   <a class="project" href="./newprogs/cchistogram.spi">cchistogram.spi</a> Creates: 
d811 2
a812 2
      <code class="output">hist/cchist_***</code> : The set of histograms by 
      group.</li>
d814 2
a815 1
      <code class="output">hist/cchist_all</code> : The overall histogram.</li>
d820 6
a825 6
   <a class="project" href="./newprogs/plothist.spi">plothist.spi</a> creates: <br>
   <code class="output">plot_hist</code> : Text file of gnuplot commands 
   for displaying the histogram. To view this file, start gnuplot with the  
    <code>'gnuplot'</code> command, and load the file:<br>
   <code>gnuplot&gt; load 'plot_hist.ext'</code><br>
   (<code>'ex'</code> exits gnuplot)
d843 1
d845 1
a845 1
   level, this procedure creates the doc file,<br>
d861 1
a861 1
   particle selection files: <br>
d870 3
a872 3
    text file of gnuplot commands,<br>
    <code class="output">plot_view</code>, whichs plots the file <b>how_many.ext</b>,  showing the 
    number of particles vs projection view.
d877 11
a887 8
   <a class="project" href="./newprogs/display_p.spi">display_p.spi</a> create the image files,<br>
   <code class="output">display/cndis***</code>, in which the 83 angular 
   groups are represented by small circles. The radii of these circles are 
   proportional to the number of particles in each group.

   <br>
    Use the <b>Montage</b> operation in <a href=
    "../../../../web/docs/web.html">WEB</a> to display the plots.
d893 1
a893 1
Limit strongly over-represented angular projections.<br>
d896 1
a896 1
limit the numbers of images per direction to a certain number.<br>
d905 1
d923 5
a927 4
<li>
   <p class="action">Make selection files that split the data into two equal sets</p>
   <a class="project" href="./newprogs/oddeven.spi">oddeven.spi</a> 
    creates selection doc files of odd and even numbered particles,
d930 18
a947 3
      <code class="output">df***/seleven</code></li>
      <li style="list-style: none">
      <code class="output">df***/selodd</code></li>
d953 2
a954 13
<li>
   <p class="action">Compute two half-reconstructions for each defocus group</p>
   <a class="project" href="./newprogs/bpoddeven.spi">bpoddeven.spi</a> uses a back projection 
    operation to compute two reconstructions, each using half of the 
    available particles. This procedure creates two sets of image volumes in 
    each defocus group: 
   <ul>
      <li style="list-style: none">
      <code class="output">df***/vol001_odd</code></li>
      <li style="list-style: none">
      <code class="output">df***/vol001_even</code></li>
   </ul>
</li>
d956 2
a957 1
<p></p>
d959 6
a964 6
<li><p class="action">Check the defocus volumes by viewing a central slice from each</p>
   <a class="project" href="./newprogs/slices.spi">slices.spi</a> extracts a central slice 
   from a volume in each defocus group:<br>
   <code class="output">slices/slice***</code>, where the file number reflects 
   the defocus group. Use the <b>Montage</b> operation in <a href=
   "../../../../web/docs/web.html">WEB</a> to view the slices. Ideally, each 
d973 2
a974 7
<li><p class="action">Compute the resolution of each defocus group by 
   comparing the two half volumes</p>
   <a class="project" href="./newprogs/fsc.spi">fsc.spi</a> creates a set of document files 
   containing the <a href="../../glossary.html#Fourier">FSC curves</a> for 
   each defocus group:<br />
   <code class="output">df***/doccmp001</code>
</li>
d976 6
a981 1
<p></p>
a982 8
<li><p class="action">Apply CTF correction, construct an initial volume, 
   compute the combined resolution</p>
   <a class="project" href="./newprogs/ctf.spi">ctf.spi</a> applies CTF correction to all the 
   defocus group odd/even volumes (see the <a href="../../man/tfcts.html"><b>
   TF CTS</b></a> operation), then adds together the odd and even volumes to 
   make a volume for the entire data set. Finally, the FSC resolution curve 
   for the combined data set is calculated (see <a href="../../man/rf3.html"><b>RF 3</b></a> 
   operation).
d985 2
a986 2
      <code class="output">combires</code> : the combined resolution doc 
      file.</li>
d988 2
a989 2
      <code class="output">vol001</code> : the 3D structure from the entire set 
      of particles.</li>
d997 1
a997 1
<li><p class="action">Determine the resolution of the initial volume</p>
d1002 8
a1009 3
   <a class="project" href="./newprogs/res.spi">res.spi</a> creates the doc file:<br />
   <code class="output">resolution</code>, which contains the cutoff, the 
   corresponding normalized frequency, and the resolution (in Angstroms).
d1013 2
a1014 4
   <a class="project" href="./newprogs/plotres.spi">plotres.spi</a> creates 
   the text file of gnuplot commands,<br />
   <code class="output">plot_res</code>, which plots the resolution curve 
   of each defocus group, along with the combined resolution curve.
d1016 5
d1030 7
a1036 3
   <a class="project" href="./newprogs/filt.spi">filt.spi</a> filters the initial volume at 
   the cutoff frequency, creating the filtered volume,<br />
   <code class="output">volfq001</code><br />
d1044 1
d1075 9
a1083 5
   <a class="project" href="./newprogs/ordselect.spi">ordselect.spi</a> creates<br /> 
   <code class="output">order_select</code>, a doc file similar to 
   <code class="output">../Reconstruction/order_defocus</code>, containing 
   the number of particles in each group remaining after applying the cross 
   correlation cutoff, and the CTF value for each group.
d1092 3
a1094 3
      <code class="output">input/data***</code> : a set of 
      <a href="../../user_doc.html#file_stack">image stack files</a> that 
      contain all the selected original particles.</li>
d1097 2
a1098 2
      <code class="output">input/dala***</code> : a set of image stack files 
      that contain all the selected aligned particles.</li>
d1101 3
a1103 2
      <code class="output">input/align_01_***</code>, a set of doc files that 
       contain alignment parameters for all the selected particles.</li>
d1109 2
a1110 1
<p><li><a href="./refine.html">SPIDER Refinement</a>
d1120 3
a1122 1
   Among the outputs of refinement:
d1125 2
a1126 1
   <code class="output">bpr**</code>, the final volume,</li>
d1132 2
a1133 1
   <code class="output">align_<i>ii</i>_<i>ddd</i></code>, alignment parameters for iteration <i>ii</i>, defocus group <i>ddd</i>,</li>
d1136 2
a1137 1
   <code class="output">dres**</code>, resolution curves for each iteration,</li>
d1140 2
a1141 1
   <code class="output">dbpr**</code>, combined resolution curves for each defocus group,</li>
d1144 2
a1145 1
   <code class="output">resolutions</code>, resolution for each iteration.</li>
a1146 1
</p>
d1151 14
a1164 7
<li><p class="action">Plot the refinement resolution curves</p>
   <a class="project" href="./newprogs/plotref.spi">plotref.spi</a> Creates two text files 
   of gnuplot commands,<br />
   <code class="output">plot_refi</code>, Plots the combined resolution 
   curve for each iteration of refinement,<br />
   <code class="output">plot_refd</code>, Plots the resolution 
   curve for each defocus group for the last iteration.
d1171 11
a1181 7
   <p>
   <a class="project" href="./newprogs/angdisp.spi">angdisp.spi</a> creates: 
   <code class="output">disp_<i>ii</i>_<i>ddd</i></code>, images showing 
   angular positions from the: <code class="output">align_<i>ii</i>_<i>ddd</i></code>
   refined alignment 
   parameter output files.</p>
   <p>
d1183 7
a1189 4
   <code class="output">diff_<i>ii</i>_<i>ddd</i></code>, image showing 
   changes in angular positions from iteration <i>n-1</i> to iteration <i>n</i>.
   </p>
</li></p>
d1280 1
d1282 2
a1283 2
Source: mr.html   &nbsp;&nbsp;&nbsp; 
Page updated: 02/10/05 &nbsp;&nbsp;&nbsp;
@


1.64
log
@fixed broken link to ctfmatch.html
@
text
@d15 8
a22 1
<tr>
d24 3
a26 11
<td  align="left">
<img width="108" height="103" src="pics/new11.jpg" align="left"></td>

<td>
<h2 class="top">
Three Dimensional Reconstruction of Single Particle Specimens using Reference Projections</h2>
</td>

<td  align="right">
<img width="108" height="104" src="pics/new22.jpg" align="right"></td>
</tr>
d30 1
d210 1
a210 1
   lines, then use the 'DOC REN' command in SPIDER to renumber lines
d556 1
a556 1
   using the <b>Categorize from sequential montage</b> command. When
d646 1
a646 1
   command <a href="../../man/voea.html"><b>VO EA</b></a><br>
d648 1
a648 1
   by the command <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> using the above       2 files.<br>
d666 2
d669 2
a670 4
   <a href="../../man/apsh.html"><b>AP SH</b></a>, the main 
   <a href="../../align.html#reference">alignment</a> program.
   to create a set of document files:<br>
   <code class="output">align_01_***</code> numbered by defocus group, 
d673 10
a682 1
</li>
d914 2
a915 2
   <a class="project" href="./newprogs/oddeven.spi">oddeven.spi</a> creates selection doc 
   files of odd and even numbered particles,
d970 1
a970 1
   TF CTS</b></a> command), then adds together the odd and even volumes to 
d973 1
a973 1
   command).
d1062 1
a1062 1
<li> <p class="action">Prepare the data file stacks</p>
d1069 1
d1073 4
a1081 6
<li><p class="action">Prepare the alignment parameter files</p>
   <a class="project" href="./newprogs/sel_align.spi">sel_align.spi</a> creates: <br />
   <code class="output">input/align_01_***</code>, a set of doc files that 
   contain all the selected alignment parameters.
</li>

d1090 1
a1090 1
There are many other sub-procedures used in refinement, see the 
d1102 1
d1105 1
d1108 1
d1192 3
a1194 2
<h3 > References</h3>
</td></tr></table>
d1234 1
a1234 1
Updated: 12/30/04 &nbsp;&nbsp;&nbsp;
@


1.63
log
@new average.spi & select.spi explana
@
text
@d357 1
a357 1
   <a href="../../guitools/ctfmatch/ctfmatch.html">ctfmatch</a>
@


1.62
log
@fixed a typo re "plotpower"
@
text
@d3 1
a4 1
<meta name="generator" content="HTML Tidy, see www.w3.org">
d341 1
a341 2
<li>
<p class="action">Determine defocus</p>
d350 1
a350 1
    astigmatism values, and<br>
d353 2
a354 2
    It uses the procedure 
    <a class="project" href="./newprogs/calcparms.spi">calcparms.spi</a>, which checks values in
d357 1
a357 1
<a href="../../guitools/ctfmatch/ctfmatch.html">ctfmatch</a>
d364 6
a369 6
    <li><a class="project" href="./newprogs/mrc.spi">mrc.spi</a> a batch file that calls the MRC
    program <b>ctffind2</b>. It estimates both the defocus
    and astigmatism, and writes the output file 
    <code class="output">defocus</code>. It calls 
    <a class="project" href="./newprogs/ctffind">ctffind</a>, a shell script, and 
    <a class="project" href="./newprogs/readmrc.py">readmrc.py</a>, a python script. See the <a
d393 3
a395 2
   micrograph in either <i>gnuplot</i> or <a href="../../spire/guitools/pyplot.html">pyplot</a>, 
and assign the defocus groups
d410 1
a410 2
<li>
<p class="action">Compute averages for each defocus group</p>
d421 1
d423 1
d445 11
a455 9
<li>
<p class="action">Select a background noise file</p>
A noise image is required to normalize the backgrounds of the
particle images. Do one of the following:
<ol class="choice">
    <li>Use a noise image from a previous project (this is the easier
    way). The window sizes do not need to match.
    </li>
    <li>
d459 2
a460 2
      contain any particles (the files <code
      class="output">tmpnoise/noi***</code>). View the selected noise file;
d464 9
a472 7
     requires a micrograph in SPIDER format. If your micrographs are <b>tif</b>
     and/or <b>gzipped</b> files, use
     <a class="project" href="./newprogs/convert.spi">convert.spi</a> and its procedure 
     <a class="project" href="./newprogs/convert_p.spi">
     convert_p.spi</a> to convert one to SPIDER format.
</li>
</ol>
d474 1
a474 3
<p></p>
<li>
<p class="action">Run automatic phase of particle selection.</p>
d479 1
d481 2
a482 3
<ol class="choice">
<p></p>
<li>
d484 2
a485 1
    <a class="project" href="./newprogs/pick_p.spi">pick_p.spi</a>, apply correlation with a Gaussian blob.
a486 1

d492 8
a499 8
    equalization. Outputs of these batch files:<br>
    <code class="output">win/ser*****</code> : particle images <br />
    <code class="output">coords/ndc***</code> : peak coordinates
   from 1/4 decimated image <br />
    <code class="output">coords/sndc***</code> : top left pixel
   coordinates for particle images. <br />
</li>
<p></p>
d501 3
a503 2
<li><a class="project" href="./newprogs/lfc_pick.spi">lfc_pick.spi</a> 
    (and procedure <a class="project" href="./newprogs/pickparticle.spi">pickparticle.spi</a>) 
d512 2
a513 2
    <code class="output">win/ser*****</code> : particle images <br />
    <code class="output">coords/sndc***</code> : pixel
d515 2
a517 1
</ol>
d519 1
a519 2
  <br>
</li>
d521 4
a524 2
<li>
<p class="action">Determine the particle numbers corresponding to each micrograph</p>
d526 1
a526 4
<a class="project" href="./newprogs/pnums.spi">pnums.spi</a> creates the doc file<br>
<code class="output">order_picked</code>, which lists the range of particle 
numbers associated with each micrograph.
</li>
d528 2
a529 1
<li style="list-style: none"><a name="PFILT"></a></li>
d531 5
a535 3
<li>
<p class="action">[<b>Optional</b>] Low-pass filter the particle images before
particle selection</p>
d537 6
a542 11
<ol class="choice">
<li>
<a class="project" href="./newprogs/pfilt.spi">pfilt.spi</a> filters a set of images,
adjusting filter settings for each micrograph, based on its defocus.
</li>
<li>
<a class="project" href="./newprogs/pfilt2.spi">pfilt2.spi</a> is a simpler version.
</li>
</ol>
 Both batch files create:<br>
<code class="output">flt/ser*****</code>, a set of low-pass filtered particle images. <br>
d544 4
a547 4
Manual selection of good particles (the next step) is easier if
the particles have been low-pass filtered beforehand. Use the 
filtered particles, not the raw particles, during selection in <a href=
"../../../../web/docs/web.html">WEB</a>. 
d552 1
a552 2
<li>
<p class="action">Verify the automatically selected particles</p>
d554 10
a563 10
Sort through the output files to eliminate any non-particles. This
is accomplished in <a href="../../../../web/docs/web.html">WEB</a>
using the <b>Categorize from sequential montage</b> command. When
the particle image files are displayed on the screen, use the mouse
to click on each good particle. For each micrograph, save your 
selections to a file called <code class="output">good/good***</code>. (More
details at the <a href="../../faq.html#pick">SPIDER FAQ</a> and 
<a href="../../partpick.html">partpick.html</a>). The output of this
procedure should be a set of <code class="output">good/good***</code> 
document files, one for each micrograph.
d568 1
a568 2
<li>
<p class="action">Remove any duplicated particles</p>
d570 7
a576 7
<a class="project" href="./newprogs/renumber.spi">renumber.spi</a> creates
<code class="output">good/ngood***</code> doc files. When manually 
selecting particles in <a href="../../../../web/docs/web.html">WEB</a>,
 sometimes a particle is accidently double clicked. This procedure 
will delete the appropriate lines from the file. Run this batch file, 
even you you don't think you made any mistakes - subsequent batch files 
will require the <code class="output">ngood***</code> files as input.
d580 2
a581 2
<li>
<p class="action">List percentages of selected particles</p>
d583 5
a587 5
<a class="project" href="./newprogs/snums.spi">snums.spi</a> creates<br>
<code class="output">order_selected</code>, a doc file listing selected 
particles for each micrograph, and<br>
<code class="output">percent_selected</code>, lists percentages of 
automatically picked vs manually selected particles.
d589 1
d593 1
d638 1
a638 2
<li>
<p class="action">Create reference projections for alignment from a reference
d642 12
a653 7
       <code class="output">projlist</code>, a list of 83 projection numbers,<br>
       <code class="output">refangles</code>, a doc file with 3 Euler angles 
          for each of the 83 projections,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    generated by the Spider
          command <a href="../../man/voea.html"><b>VO EA</b></a><br>
       <code class="output">prj001/prj****</code>, the reference images produced by the command <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> using the above       2 files.<br>
   By default, a set of reference projections is created for each defocus group, corresponding to the <b>prj<i>***</i></b>/ directories. If only a single set of reference projections is desired (by setting register x90 = 0), they will be in directory <b>prj001</b>. 
a654 1
</li>
d657 1
a657 2
<li>
   <p class="action">Create lists of all images in each defocus group</p>
d659 3
a661 3
      selection document files:<br>
      <code class="output">part_by_group_***</code>, one for each defocus group, 
      listing all the particles in that group.
d665 1
a665 2
<li>
   <p class="action">Align the particles to the reference projections</p>
d674 1
d677 1
a677 2
<li>
   <p class="action">Combine all alignment parameter files into a single 
d681 2
a682 2
    parameters from  all defocus groups. (Not necessary if only a single
    group is used).
d684 1
d695 1
a695 1
    (If the particles are mirrored in the alignment document file from 
d699 1
d701 1
d724 7
a730 6
<li>
   <p class="action">Determine the number of particles in each defocus group</p>
    <a class="project" href="./newprogs/ordefocus.spi">ordefocus.spi</a> creates a doc file, 
    <code class="output">order_defocus</code> with 3 columns:<br>
    <i>Number of particles</i>, <i>Cumulative number of  
    particles</i>, and <i>Average defocus</i> for each group.
d732 16
a747 1
   <p></p>
d749 5
a753 19
<li><p class="action">
    Make selection document files list the number of particles for each
    projection</p>
    <a class="project" href="./newprogs/select.spi">select.spi</a></i> creates the following
    files:
    <ul>
        <li style="list-style: none">
        <code class="output">df***/how_many</code> : lists numbers of particles 
        associated with each reference view.
        </li>
        <li style="list-style: none">
        <code class="output">df***/select/sel???</code> lists numbers of particles 
        associated with each reference view.
        </li>
        <li style="list-style: none">
        <code class="output">how_many</code> : a summary file listing sums of all 
        the <code class="output">df***/how_many</code> files.
        </li>
    </ul>
d758 3
a760 4
<li>
   <p class="action">Create average images for all 83 projection groups</p>
   <a class="project" href="./newprogs/average.spi">average.spi</a> For a selected defocus group, 
   the following are created:<br /> 
d763 2
a764 2
      <li style="list-style: none">
      <code class="output">avg/avg***</code> : average images for each
d766 2
a767 2
      <li style="list-style: none">
      <code class="output">avg/var***</code> : variance images for each
d771 1
a771 2
   Use the <b>Montage</b> operation in 
   <a href= "../../../../web/docs/web.html">WEB</a> 
a779 1
</li>
d781 2
a782 2
<p>The next several operations help to identify a threshold
   correlation coefficient that describes true particles as opposed to
d790 1
a790 2
<li>
   <p class="action">Identify a threshold correlation coefficient for 
d794 1
a794 1
   <a class="project" href="./newprogs/cchistogram.spi">cchistogram.spi</a> creates: 
d796 1
a796 1
      <li style="list-style: none">
d799 1
a799 1
      <li style="list-style: none">
d806 1
a806 1
   <code class="output">plot_hist</code> : a text file of gnuplot commands 
d815 2
a816 2
    Use the <b>Montage from doc file</b> operation in <a href=
   "../../../../web/docs/web.html">WEB</a> to display the aligned
d826 1
a826 2
<li>
   <p class="action">Compute correlation thresholds for discarding 
d884 1
d886 1
d933 1
a933 2
<li>
   <p class="action">Check the defocus volumes by viewing a central slice from each</p>
d936 7
a942 7
    <code class="output">slices/slice***</code>, where the file number reflects 
    the defocus group. Use the <b>Montage</b> operation in <a href=
    "../../../../web/docs/web.html">WEB</a> to view the slices. Ideally, each 
    image should show a particle isolated from its surroundings, exhibiting 
    some internal structure - somewhat like the reference images. If any 
    images are blank or otherwise unusual, go back and check the processing of 
    that defocus group.
d947 1
a947 2
<li>
   <p class="action">Compute the resolution of each defocus group by 
d954 2
a955 1
   <p></p>
d957 1
a957 2
<li>
   <p class="action">Apply CTF correction, construct an initial volume, 
d966 1
a966 1
      <li style="list-style: none">
d969 1
a969 1
      <li style="list-style: none">
d979 1
a979 2
<li>
   <p class="action">Determine the resolution of the initial volume</p>
d988 1
a988 1
<p></p>
d990 2
a991 2
   <a class="project" href="./newprogs/plotres.spi">plotres.spi</a> creates the text file 
   of gnuplot commands,<br />
d996 1
a996 3
   <a href="pics/plotres2.gif"><img width="200" height="150" src=
"./pics/plotres2.gif"></a></p>

a998 1
<li style="list-style: none">
a999 1
</li>
d1001 1
a1001 2
<li>
   <p class="action">Filter the initial volume</p>
d1006 3
a1008 4
    <code class="output">volfq001</code><br />
   Use the <b>Surface</b> operation in <a href=
"../../../../web/docs/web.html">WEB</a> to view the filtered
volume.
d1014 1
d1026 1
a1026 2
<p>These procedures should be run in the <i>Refinement</i>
directory.</p>
d1042 1
a1042 2
<li>
   <p class="action">Create a document file summarizing the selected 
d1053 1
a1053 2
<li>
   <p class="action">Prepare the data file stacks</p>
d1068 1
a1068 2
<li>
   <p class="action">Prepare the alignment parameter files</p>
d1074 1
a1074 3
<p>

<li><a href="./refine.html">SPIDER Refinement</a>
d1082 4
a1085 4
 There are many other sub-procedures used in refinement, see the 
  <a href="./refine.html">refinement page</a> for details.<br />
Among the outputs of refinement:
<ul>
d1088 2
a1089 2
   
</ul>
d1091 1
a1091 1
<ul>
d1100 3
a1102 1
</ul>
a1103 1
</li></p>
d1106 2
a1107 4
<li>
   <p class="action">Plot the refinement resolution curves</p>

   <a class="project" href="./newprogs/plotref.spi">plotref.spi</a> creates two text files 
d1109 1
a1109 1
   <code class="output">plot_refi</code>, which plots the combined resolution 
d1111 1
a1111 1
   <code class="output">plot_refd</code>, which plots the resolution 
d1113 2
a1114 1
</li></p> 
d1117 2
a1118 3
<li>
   <p class="action">[Optional] View angular data output from Refinement
batch files</p>
d1123 1
a1123 1
    refined alignment 
d1135 1
a1136 2

<hr>
d1145 6
a1150 5
program files into tar files, which can be backed up on tape. Save the 
shell script, make it executable:
<pre>chmod 775 backup</pre>
and run it in the project directory. It creates 2 tar files 
<code class="output">order.tar</code>, and <code class="output">project.tar</code>
d1155 2
a1156 1
<dd>Differences between volumes can be assessed by subtracting one volume from the other.</dd>
d1162 1
a1162 2
closely resemble those of
experimental low-angle X-ray scattering data. </dd>
d1167 1
a1167 2
<dd>This method can be used to investigate differences between
particles.</dd>
d1178 1
d1185 5
a1189 5
<a name="PP92">
<li>
Penczek, P., M. Rademacher, and J. Frank (1992) Three-dimensional reconstruction of single particles embedded in ice.
  <i>Ultramicroscopy</i> 40:33-53.
</li>
d1191 6
a1196 4
<a name="PP94">
<li>
Penczek, P., Grassucci, R.A. and Frank, J. (1994) The ribosome at improved resolution: New techniques for merging and orientation refinement in 3D cryo-electron microscopy of biological particles <i>Ultramicroscopy</i> 53, 251-270.
</li>
d1198 7
a1204 5
<a name="PP97">
<li>
P.A. Penczek, J. Zhu, R. Schrder, J. Frank (1997) <a href="../ctf/pfefferkorn.pdf">Three Dimensional Reconstruction with Contrast Transfer Compensation from Defocus Series</a> Special Issue on Signal and Image Processing, <i>Scanning Microscopy</i> Volume 11,
1997, page 147.
</li>
d1206 5
a1210 4
<a name="BR04">
<li>
B.K. Rath and J. Frank (2004) <i>Journal of Structural Biology</i>, Volume 145, Issues 1-2, January 2004, Pages 84-90.
</li>
d1212 4
a1215 4
<a name="AR03">
<li> 
Alan Roseman (2003) <i>Ultramicroscopy</i>, Vol 94 (3-4), pp. 225-236
</li>
d1221 2
a1222 2
Source: mr.html &nbsp;&nbsp;&nbsp; 
Updated: 11/08/04 &nbsp;&nbsp;&nbsp;
d1225 3
a1227 3
<address>&copy; <a href="../../copyright.html">Copyright
notice</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Enquiries: <a href=
"mailto:spider@@wadsworth.org">spider@@wadsworth.org</a></address>
d1229 1
@


1.61
log
@combined refproj.spi and refprojctf.spi into refproj.spi
@
text
@d238 1
a238 1
   <a class="project" href="newprogs/resizevol.spi">resizevol.spi</a>. This batch file should
d397 1
a397 1
   text file, such as <a class="project" href="./newprogs/plotpower">plotpower</a>,
@


1.60
log
@added class="project" to <a> tags for newprogs/batchfiles
@
text
@a622 12
 <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 It is simpler to compare the experimental particles to a single set 
 of reference projections. In that case, use the batch files  
 <a href="./newprogs/refproj.spi">refproj.spi</a> and 
 <a href="./newprogs/apsh.spi">apsh.spi</a>.

 <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 However, more accurate results may be obtained with more realistic 
 reference images, by creating a set of references for each defocus 
 group. In that case, use the batch files 
 <a href="./newprogs/refprojctf.spi">refproj<b>ctf</b>.spi</a> and 
 <a href="./newprogs/apsh.spi">apsh.spi</a>.
d641 1
a641 2
   <ol class="choice">
   <li><a class="project" href="./newprogs/refproj.spi">refproj.spi</a> creates:<br>
d647 2
a648 3
          <code class="output">prj/prj****</code>, the reference images produced by
            the command <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> using the above       2 files.
   </li>
a649 6
   <li>
       <a class="project" href="./newprogs/refprojctf.spi">refprojctf.spi</a> does the same thing, 
       but makes a separate set of <code class="output">prj/prj****</code> images for 
       each defocus group.
   </li>
   </ol>
@


1.59
log
@fixed gnuplot links
@
text
@d195 1
a195 1
   <a href="./newprogs/makeparams.spi">makeparams.spi</a> in the top 
d206 1
a206 1
   <a href="./newprogs/makefilelist.spi">makefilelist.spi</a> to 
d238 1
a238 1
   <a href="newprogs/resizevol.spi">resizevol.spi</a>. This batch file should
d282 2
a283 2
<a href="./newprogs/power.spi">power.spi</a>, at its procedure 
<a href="./newprogs/power_p1.spi">power_p1.spi</a>, read each micrograph 
d297 1
a297 1
    <a href="../../guitools/pyplot.html">pyplot</a>
d347 1
a347 1
   <li><a href="./newprogs/defocus.spi">defocus.spi</a> : estimates defocus
d355 1
a355 1
    <a href="./newprogs/calcparms.spi">calcparms.spi</a>, which checks values in
d365 1
a365 1
    <li><a href="./newprogs/mrc.spi">mrc.spi</a> a batch file that calls the MRC
d369 2
a370 2
    <a href="./newprogs/ctffind">ctffind</a>, a shell script, and 
    <a href="./newprogs/readmrc.py">readmrc.py</a>, a python script. See the <a
d382 1
a382 1
   <a href="./newprogs/defsort.spi">defsort.spi</a>: reads the "defocus"
d394 1
a394 1
   micrograph in either <i>gnuplot</i> or <a href="../../guitools/pyplot.html">pyplot</a>, 
d397 1
a397 1
   text file, such as <a href="./newprogs/plotpower">plotpower</a>,
d415 1
a415 1
   <a href="./newprogs/defavg.spi">defavg.spi</a> creates 2 doc files
d453 1
a453 1
      <a href="./newprogs/noise.spi">noise.spi</a> creates a noise
d463 2
a464 2
     <a href="./newprogs/convert.spi">convert.spi</a> and its procedure 
     <a href="./newprogs/convert_p.spi">
d480 2
a481 2
    <a href="./newprogs/pick.spi">pick.spi</a> and its procedure 
    <a href="./newprogs/pick_p.spi">pick_p.spi</a>, apply correlation with a Gaussian blob.
d498 2
a499 2
<li><a href="./newprogs/lfc_pick.spi">lfc_pick.spi</a> 
    (and procedure <a href="./newprogs/pickparticle.spi">pickparticle.spi</a>) 
d520 1
a520 1
<a href="./newprogs/pnums.spi">pnums.spi</a> creates the doc file<br>
d533 1
a533 1
<a href="./newprogs/pfilt.spi">pfilt.spi</a> filters a set of images,
d537 1
a537 1
<a href="./newprogs/pfilt2.spi">pfilt2.spi</a> is a simpler version.
d571 1
a571 1
<a href="./newprogs/renumber.spi">renumber.spi</a> creates
d584 1
a584 1
<a href="./newprogs/snums.spi">snums.spi</a> creates<br>
d654 1
a654 1
   <li><a href="./newprogs/refproj.spi">refproj.spi</a> creates:<br>
d665 1
a665 1
       <a href="./newprogs/refprojctf.spi">refprojctf.spi</a> does the same thing, 
d675 1
a675 1
   <a href="./newprogs/sel_by_group.spi">sel_by_group.spi</a> writes the 
d684 1
a684 1
   <a href="./newprogs/apsh.spi">apsh.spi</a> uses 
d697 1
a697 1
   <a href="./newprogs/combine.spi">combine.spi</a> creates:<br />
d707 1
a707 1
   <a href="./newprogs/alignsh.spi">alignsh.spi</a> applies the shifts 
d741 1
a741 1
    <a href="./newprogs/ordefocus.spi">ordefocus.spi</a> creates a doc file, 
d751 1
a751 1
    <a href="./newprogs/select.spi">select.spi</a></i> creates the following
d773 1
a773 1
   <a href="./newprogs/average.spi">average.spi</a> For a selected defocus group, 
d811 1
a811 1
   <a href="./newprogs/cchistogram.spi">cchistogram.spi</a> creates: 
d822 1
a822 1
   <a href= "./newprogs/plothist.spi">plothist.spi</a> creates: <br>
d846 1
a846 1
   <a href= "./newprogs/ccthresh.spi">ccthresh.spi</a> Given a percent cutoff 
d862 1
a862 1
   <a href="./newprogs/dftotals.spi">dftotals.spi</a> creates a set of
d871 1
a871 1
   <a href= "./newprogs/plotview.spi">plotview.spi</a> creates the 
d878 2
a879 2
   <a href="./newprogs/display.spi">display.spi</a> and its procedure 
   <a href="./newprogs/display_p.spi">display_p.spi</a> create the image files,<br>
d894 1
a894 1
directions, use: <i><a href="./newprogs/b19.eqp">b19.eqp</a></i> to
d921 1
a921 1
   <a href="./newprogs/oddeven.spi">oddeven.spi</a> creates selection doc 
d935 1
a935 1
   <a href="./newprogs/bpoddeven.spi">bpoddeven.spi</a> uses a back projection 
d951 1
a951 1
   <a href="./newprogs/slices.spi">slices.spi</a> extracts a central slice 
d967 1
a967 1
   <a href="./newprogs/fsc.spi">fsc.spi</a> creates a set of document files 
d977 1
a977 1
   <a href="./newprogs/ctf.spi">ctf.spi</a> applies CTF correction to all the 
d1003 1
a1003 1
   <a href="./newprogs/res.spi">res.spi</a> creates the doc file:<br />
d1009 1
a1009 1
   <a href="./newprogs/plotres.spi">plotres.spi</a> creates the text file 
d1028 1
a1028 1
   <a href="./newprogs/filt.spi">filt.spi</a> filters the initial volume at 
d1070 1
a1070 1
   <a href="./newprogs/ordselect.spi">ordselect.spi</a> creates<br /> 
d1081 1
a1081 1
   <a href="./newprogs/stack.spi">stack.spi</a> creates: 
d1097 1
a1097 1
   <a href="./newprogs/sel_align.spi">sel_align.spi</a> creates: <br />
d1108 3
a1110 3
<a href="./newprogs/refine_settings.pam">refine_settings.pam</a>. <br />
Then run <a href="./newprogs/refine.pam">refine.pam</a> (or 
<a href="./newprogs/pub_refine.pam">pub_refine.pam</a> if running on 
d1138 1
a1138 1
   <a href="./newprogs/plotref.spi">plotref.spi</a> creates two text files 
d1151 1
a1151 1
   <a href="./newprogs/angdisp.spi">angdisp.spi</a> creates: 
d1157 1
a1157 1
   <a href="./newprogs/angdiff.spi">angdiff.spi</a> creates: 
@


1.58
log
@changed sndc output of lfc_pick -> center of window, not upper left corner
@
text
@d110 1
a110 1
<a href="http://www.ucc.ie/gnuplot/gnuplot.html">online manual</a>
@


1.57
log
@used new merged apsh.spi procedure
@
text
@d509 2
a510 2
    <code class="output">coords/sndc***</code> : top left pixel
    coordinates for particle images. <br />
@


1.56
log
@added backup shell script
@
text
@d8 1
a10 2


d13 1
a14 1
<table class="top" width = 100% border=8 bordercolor="#99ccff">
d16 1
d19 1
d24 1
d27 2
a28 1
</tr></table>
d39 2
a40 1
procedures are described in greater detail below.</p>
a42 9
<dt>
<a href="#CTF">Contrast Transfer Function</a></dt>
<dd> (CTF) is estimated for each micrograph, and the micrographs are placed in defocus groups.</dd>

<dt>
<a href="#AUTO">Particle Picking and Selection</a></dt>
<dd> identifies likely 
ribosome particles from the micrographs, and extracts small images of individual
particles.</dd>
d44 11
a54 5
<dt>
<a href="#SH">Alignment</a></dt>
<dd>
The particle images are aligned to reference
projections through shifts and rotations.</dd>
d56 1
a56 2
<dt>
<a href="#CA">Averages</a></dt>
d58 1
a58 1
are computed, to assess the distribution of projection views.</dd>
d60 1
a60 2
<dt>
<a href="#3D">3D Reconstruction</a></dt>
d62 1
a62 1
along with an estimate of resolution.</dd>
d64 1
a64 2
<dt>
<a href="#REF">Refinement</a></dt>
d66 10
a75 9
chance "to find a better home" in terms of its orientation and phase
origin, thus improving the resolution of the initial
reconstruction.</dd>

<dt>
<a href="#OTHER">Additional methods</a></dt>
<dd> Other useful methods, such as classification, difference maps, and frequency correction by X-ray scattering.
Additional details about these methods may be found at the <a href=
"../../techniques.html">techniques</a> page.</dd>
d80 1
a80 1
operations</a></p>
d85 2
a86 1
  <li> See the <a href="../../strategies.html">reconstruction strategies</a> page and the <a href="../../glossary.html">glossary</a>.
d95 2
a96 1
  <li> Frank, J. (1996) <i>Three-dimensional Electron Microscopy of Macromolecular Assemblies</i> Academic Press, San Diego.
d102 1
a102 1
scanner</a></b></li>
d104 2
a105 2
   <li>Batch files for circular images from <b><a href=
"quantifoil.html">Quantifoil grids</a></b> .</li>
d116 1
d118 1
d121 4
a124 1
<code class="output">output files</code> created by that batch file are marked in green. Sometimes more than one approach is available. Lists starting with lowercase letters indicate thate you should choose
d135 1
d138 2
a139 2
<tr><td> <br />
<h3 class="heading">Running SPIDER batch files</h3>
d141 7
a147 4
<p class="explain">At the start of a reconstruction project, a project directory has to be set up with the proper subdirectories and batch files.
</p>
<br />
</td></tr></table>
a148 1

a162 1

d164 2
a165 2
the project data file extension, and <b><code>proc.spi</code></b> is the
procedure file. </p>
d169 11
a179 6
   <li><p class="action">Create a project directory with the required subdirectories and batch files</p> 
The batch files below are packed into the zipped tar file <a href=
"./spiproject.tar.gz">spiproject.tar.gz</a>. Download this file to your working directory and unpack it:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><code>gunzip spiproject.tar.gz; tar xvf spiproject.tar</code></b><br />
It will create a directory called <i>myproject</i>, containing the batch files and subdirectories for a reconstruction project. Rename <i>myproject</i> to the
 name of your project directory, usually the same three letters as the data extension, e.g.:<br />
d239 2
a240 1
be run in the top-level project directory, creating an output <code class="output">reference_volume</code>.
d257 2
a258 1
<p class="explain">Estimate the defocus of each micrograph by calculating its power spectrum. Then group the micrographs into groups of similar defocus.
d272 2
a273 1
 <a href="../../guitools/ctfdemo.html">ctfdemo</a>, a program that demonstrates the effects of various parameters on the CTF, and
d284 2
a285 1
and compute an averaged power spectrum for it. Each micrograph has 2 corresponding output files:</p>
d357 2
a358 1
   The <code class="output">ctf***</code> files can be analyzed with <a       href="../../guitools/ctfmatch/ctfmatch.html">ctfmatch</a>
d394 2
a395 1
   micrograph in either <i>gnuplot</i> or <a href="../../guitools/pyplot.html">pyplot</a>, and assign the defocus groups
d416 2
a417 1
   of defocus group averages: <code class="output">def_avg</code> and <code class="output">order_defgrps</code>.
d428 6
a433 1
<p class="explain">A particle picking batch file analyzes each micrograph, cutting out small windows of likely particle candidates. This is followed by a manual selection process that identifies the good particle images and rejects the bad ones. Particles automatically output by the batch file are said to be <i>picked</i>; the subset that are manually chosen are said to be <i>selected</i>.
d544 2
a545 1
the particles have been low-pass filtered beforehand. Use the filtered particles, not the raw particles, during selection in <a href=
d558 6
a563 3
to click on each good particle. For each micrograph, save your selections to a file called <code class="output">good/good***</code>. (More
details at the <a href="../../faq.html#pick">SPIDER FAQ</a> and <a href="../../partpick.html">partpick.html</a>). The output of this
procedure should be a set of <code class="output">good/good***</code> document files, one for each micrograph.
d572 6
a577 2
<code class="output">good/ngood***</code> doc files. When manually selecting particles in <a href="../../../../web/docs/web.html">WEB</a>,
 sometimes a particle is accidently double clicked. This procedure will delete the appropriate lines from the file. Run this batch file, even you you don't think you made any mistakes - subsequent batch files will require the <code class="output">ngood***</code> files as input.
d585 4
a588 2
<code class="output">order_selected</code>, a doc file listing selected particles for each micrograph, and<br>
<code class="output">percent_selected</code>, lists percentages of automatically picked vs manually selected particles.
d596 1
a596 1
<h3 class="heading">Alignment</h3>
d598 7
a604 3
<p class="explain">
Reference images are generated from the reference volume. Data particles are compared to each reference to find the best match, and the corresponding transformations (shifts and rotations) are written to a doc file. Finally, the transformations are applied to the data images, aligning them to the references.
</p>
d606 3
a608 3
<p>These procedures should be run in the <i>Alignment</i>
directory.</p
</td></tr></table>
d611 1
d613 3
a615 2
<b>Reference projections</b>
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
d620 17
a636 12
   The row and column dimensions
   of the reference volume must match the dimensions of the particle
   windows.
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 It is simpler to compare the experimental particles to a single set of reference projections. In that case, use the batch files  <a href="./newprogs/refproj.spi">refproj.spi</a> and <a href="./newprogs/apsh.spi">apsh.spi</a> 
(or <a href="./newprogs/pub_apsh.spi">pub_apsh.spi</a>) below.
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
However, more accurate results may be obtained with more realistic reference images, by creating a set of references for each defocus group. In that case, use the batch files 
<a href="./newprogs/refprojctf.spi">refproj<b>ctf</b>.spi</a> and 
<a href="./newprogs/apshctf.spi">apsh<b>ctf</b>.spi</a> (or 
<a href="./newprogs/pub_apshctf.spi">pub_apsh<b>ctf</b>.spi</a>).
</p>
d639 6
a644 2
<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
If you decide to use the Linux Cluster with <a href="../../techniques.html#CLUSTER">Publish and Subscribe</a>, use the batch files below with the <b><font color="blue">pub_</font></b> prefix.
d646 1
d648 1
d650 1
a650 1
   <p class="action">Create reference projections for alignment from a reference
d653 1
a653 1
 <ol class="choice">
d656 14
a669 10
       <code class="output">refangles</code>, a doc file with 3 Euler angles for each of the 83 projections,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    generated by the Spider
      command <a href="../../man/voea.html"><b>VO EA</b></a><br>
     <code class="output">prj/prj****</code>, the reference images produced by
     the command <a href="../../man/pj3q.html"><b>PJ 3Q</b></a> using the above       2 files.
    </li>
    <li>
    <a href="./newprogs/refprojctf.spi">refprojctf.spi</a> does the same thing, but makes a separate set of <code class="output">prj/prj****</code> images for each defocus group.
    </li>
  </ol>
d671 1
a672 1
<p></p>
d675 4
a678 2
   <a href="./newprogs/sel_by_group.spi">sel_by_group.spi</a> writes the selection document files:<br>
   <code class="output">part_by_group_***</code>, one for each defocus group, listing all the particles in that group.
d680 1
a681 1
<p></p>
d684 7
a690 20
    Use one of the following alignment batch files :
    <ol class="choice">
      <li>
        <a href="./newprogs/apsh.spi">apsh.spi</a> uses <a href="../../man/apsh.html"><b>AP SH</b></a>, the main <a href="../../align.html#reference">alignment</a> program.
     </li>
     <li>
      <a href="./newprogs/apshctf.spi">apshctf.spi</a> if you made references for each defocus group.
     </li>

      <li>
      <a href="./newprogs/pub_apsh.spi">pub_apsh.spi</a> runs <a href="../../man/apsh.html"><b>AP SH</b></a> on the cluster, using PubSub.
      </li>
      <li>
      <a href="./newprogs/pub_apshctf.spi">pub_apshctf.spi</a> for multiple defocus
      groups on the cluster.
      </li>
   </ol>
 
   <p>All of these alignment procedures create a set of document files:<br>
   <code class="output">align_01_***</code> numbered by defocus group, containing the shift and rotation parameters for the best matched projection.</p>
a691 1

d695 2
a696 2
   <p class="action">Combine all alignment parameter files into a single summary
   file</p>
d698 3
a700 2
   <code class="output">align_01_all</code>,  containing merged alignment
    parameters from  all defocus groups.
a701 1

d705 1
a705 1
<p class="action">Rotate and shift particles according to alignment
d707 8
a714 3
    <a href="./newprogs/alignsh.spi">alignsh.spi</a> applies the shifts and rotations in the <code class="output">align_01_***</code> files to the raw particle images, creating<br>
   <code class="output">ali/sar*****</code>, the aligned versions of the particle images.<br>
    (If the particles are mirrored in the alignment document file from <a href="../../man/apsh.html"><b>AP SH</b></a>, they have been mirrored after they are rotated and    shifted.)
d716 1
d719 1
a719 3
 <p></p>

<a href="oldapmq.html">Alternative obsolete alignment routines</a> for use with <a href="../../man/apmq.html">AP MQ</a> 
a720 2

<hr>
d724 1
a724 1
<h3 class="heading">Compute Averages</h3>
d726 3
a728 2
<p class="explain">For all projections, all aligned particles of a given reference view are averaged together. Further particle selection is made by selecting a cutoff threshold to reject some particles. The distribution of projections can be displayed.
</p>
d730 4
a733 3
<p>These procedures should be run in the <i>Reconstruction</i>
directory.</p>
</td></tr></table>
d755 2
a756 1
        <code class="output">df***/how_many</code> : lists numbers of particles associated with each reference view.
d759 2
a760 1
        <code class="output">df***/select/sel???</code> lists numbers of particles associated with each reference view.
d763 2
a764 1
        <code class="output">how_many</code> : a summary file listing sums of all the <code class="output">df***/how_many</code> files.
d773 2
a774 1
   <a href="./newprogs/average.spi">average.spi</a> For a selected defocus group, the following are created:<br /> 
d824 2
a825 1
   for displaying the histogram. To view this file, start gnuplot with the  <code>'gnuplot'</code> command, and load the file:<br>
d908 2
a909 1
To estimate the resolution of the resulting structure, the data are split into two equal sets, and the two resulting volumes are compared. 
d951 2
a952 1
   <a href="./newprogs/slices.spi">slices.spi</a> extracts a central slice from a volume in each defocus group:<br>
d1044 3
a1046 1
decreasing the angular resolution of reference projections with each iteration, thereby giving the data particles a chance to find a better approximating reference match each time. Thus the data particles are allowed to "settle in" 
d1110 4
a1113 2
<a href="./newprogs/pub_refine.pam">pub_refine.pam</a> if running on the cluster with PubSub).<br />
 There are many other sub-procedures used in refinement, see the <a href="./refine.html">refinement page</a> for details.<br />
d1153 2
a1154 1
   angular positions from the: <code class="output">align_<i>ii</i>_<i>ddd</i></code> refined alignment 
d1176 3
a1178 1
<dd><a href="backup">backup</a> a shell script, puts a number of vital program files into tar files, which can be backed up on tape. Save the shell script, make it executable:
d1180 2
a1181 1
and run it in the project directory. It creates 2 tar files <code class="output">order.tar</code>, and <code class="output">project.tar</code>
d1191 2
a1192 1
<dd>Enhance the Fourier amplitudes of a reconstructed cryo-EM volume so they more closely resemble those of
d1219 1
a1219 1
<i>Ultramicroscopy</i> 40:33-53.
d1221 1
d1226 1
d1232 1
d1237 1
d1239 1
a1239 1
<li>
d1246 4
a1249 4
<p>Source: mr.html &nbsp;&nbsp;&nbsp; Updated: 8/02/04
&nbsp;&nbsp;&nbsp;</p>

<p></p>
@


1.55
log
@added <a name="RunningSPIDER"> link
@
text
@d1106 2
d1115 6
a1124 1

@


1.54
log
@deleted reference to def.spi, since there are many better CTF approaches
@
text
@d129 1
@


1.53
log
@fixed many <a href.. links that had newlines inside them
@
text
@a345 6
    <li><a href="./newprogs/def.spi">def.spi</a>:
    Estimates defocus, creates a <code class="output">defocus</code> document
    file. See the <a
    href="defdoc.html">def manual page</a> for more information.
    </li>

@


1.52
log
@various typo changes
@
text
@d192 3
a194 3
   <a href=
   "./newprogs/makefilelist.spi">makefilelist.spi</a> to create the
   doc file <code class="output">filenums</code>, which is also in the top-level project directory. If you need to exclude
d265 3
a267 1
<a href="./newprogs/power.spi">power.spi</a>, at its procedure <a href="./newprogs/power_p1.spi">power_p1.spi</a>, read each micrograph and compute an averaged power spectrum for it. Each micrograph has 2 corresponding output files:</p>
d336 2
a337 2
    It uses the procedure <a href=
   "./newprogs/calcparms.spi">calcparms.spi</a>, which checks values in
d355 3
a357 3
    <code class="output">defocus</code>. It calls <a href=
   "./newprogs/ctffind">ctffind</a>, a shell script, and <a href=
   "./newprogs/readmrc.py">readmrc.py</a>, a python script. See the <a
d432 2
a433 2
    <li><a href=
      "./newprogs/noise.spi">noise.spi</a> creates a noise
d454 2
a455 2
   require the converting procedure <a href=
   "./newprogs/convert_p.spi">convert_p.spi</a> 
d478 3
a480 1
<li><a href="./newprogs/lfc_pick.spi">lfc_pick.spi</a> (and procedure <a href="./newprogs/pickparticle.spi">pickparticle.spi</a>) use the Local Fast Correlation algorithm.<br>
d588 2
a589 1
 It is simpler to compare the experimental particles to a single set of reference projections. In that case, use the batch files  <a href="./newprogs/refproj.spi">refproj.spi</a> and <a href="./newprogs/apsh.spi">apsh.spi</a> (or <a href="./newprogs/pub_apsh.spi">pub_apsh.spi</a>) below.
d591 4
a594 1
However, more accurate results may be obtained with more realistic reference images, by creating a set of references for each defocus group. In that case, use the batch files <a href="./newprogs/refprojctf.spi">refproj<b>ctf</b>.spi</a> and <a href="./newprogs/apshctf.spi">apsh<b>ctf</b>.spi</a> (or <a href="./newprogs/pub_apshctf.spi">pub_apsh<b>ctf</b>.spi</a>).
d727 1
a727 1
   <a href= "./newprogs/average.spi">average.spi</a> For a selected defocus group, the following are created:<br /> 
d764 1
a764 1
   <a href= "./newprogs/cchistogram.spi">cchistogram.spi</a> creates: 
d1055 4
a1058 2
First, set the parameters in <a href="./newprogs/refine_settings.pam">refine_settings.pam</a>. <br />
Then run <a href="./newprogs/refine.pam">refine.pam</a> (or <a href="./newprogs/pub_refine.pam">pub_refine.pam</a> if running on the cluster with PubSub).<br />
@


1.51
log
@some changes near the top, replaced mkdirs.py with a tar file
@
text
@d118 7
a124 1
<code class="output">output files</code> created by that batch file are marked in green
d268 3
a270 1
    <li><code class="output">pw_avg***</code> : 2D power spectra, each is an average of many smaller
d273 4
a276 2
    <li><code class="output">roo***</code> : doc files of 1D profiles of the rotationally averaged
    power spectra.  These doc files can be plotted with gnuplot or 
d280 1
d295 1
a295 1
    <li>Are the Thon rings round?</li>
d297 1
a297 1
    <li>Do they extend to high resolution?</li>
d305 1
a305 1
    <li>Rings that are cut off unidirectionally (evidence of
d308 1
a308 1
    <li>Rings that are elliptical, or even hyperbolic (evidence of
@


1.50
log
@some additions around Refinement, added plotref.spi, angdiff.spi
@
text
@d113 9
d143 1
a143 1
<center><i>spider spi/dat @@proc</i></center>
d148 2
a149 2
<p>where <b>spi</b> is the procedure file extension, <b>dat</b> is
the project data file extension, and <b>proc.spi</b> is the
d152 1
a152 2
<p></p>

d154 7
a160 15
<li>The batch files below expect a specific directory structure.
These directories can be created using the python script: <a href=
"./newprogs/mkdirs.py">mkdirs.py</a>. ALBANY USERS CAN JUST RUN THE
SCRIPT WITHOUT DOWNLOADING IT:<br>
 Run the script at the unix prompt:<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>mkdirs.py pdr</code><br>
 where pdr is the three-letter name of your project directory.</li>

<li style="list-style: none">
<p>If you don't already have it, save the script using <b>Save Link
As...</b> (DO NOT cut and paste from the Web page - indentation
matters in python). Then make it executable with the unix
command:<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>chmod 775 mkdirs.py</code></p>
</li>
d162 1
d172 6
a177 6
<li>Create a parameter document file. Batch files read project
   parameters from a doc file, created by the interactive procedure
   file <a href="./newprogs/makeparams.spi">makeparams.spi</a>. Run
   this procedure file in the top directory of your project and name
   the output file "params.dat", where <b>dat</b> is the project
   extension. <a href="./params.html">The parameters are described
d181 2
a182 1
<li>Create a file specification document file. This file contains
d185 2
a186 1
   files - see below). Use the interactive batch file <a href=
d188 1
a188 1
   doc file, called <b>"filenums.dat"</b>. If you need to exclude
d199 23
a221 10
   <p>
   <li>Files of the digitized micrographs should be in the
   <i>Micrographs</i> directory.</li></p>
  
   <p>
<li>A reference volume is required. If the dimensions of your
reference volume do not match the window size (key 17 in the
parameter file), then you must resize the volume with <a href=
"newprogs/resizevol.spi">resizevol.spi</a>. This batch file should
be run in the top-level project directory.</li></p>
d1088 1
@


1.49
log
@much rewriting, mostly .bat --> .spi extansion, moved "other method" links to the techniques page.
@
text
@d8 1
a8 1
<body  link="#0000ee" vlink="#0000ee" alink="#ff0000" bgcolor="#bbbbbb">
d28 1
a28 1
<br /><br /><br />
d74 1
a74 1
<dd> useful methods, such as classification, difference maps, and frequency correction by X-ray scattering.
d170 1
d178 2
a179 2
   <p></p>

d189 1
a189 5
   <p></p>

<li>Create a <a href="#DEFGRPDOC">defocus group document file</a>.
   This step comes after you have segregated micrographs into various
   defocus groups.</li>
d191 1
d193 1
a193 1
<p>Input files needed for a reconstruction project:</p>
d196 5
a200 11
<li style="list-style: none">
<p></p>
</li>

<li>Files of the digitized micrographs should be in the
<i>Micrographs</i> directory.</li>

<li style="list-style: none">
<p></p>
</li>

d205 2
a206 1
be run in the top-level project directory.</li>
a207 2
<li style="list-style: none">
<p></p>
d209 1
a209 1
<h4>After running each batch file, check the output files to make
d211 1
a211 6
"sensible", ask an expert.</h4>

<br>
<br>
</li>
</ul>
d223 3
a225 3
These procedures should be run in the <i>Power_Spectra</i>
directory.<br>
The micrographs should be in the <i>Micrographs</i> directory.
d387 2
a388 2
These procedures should be run in the <i>Particles</i>
directory.<br>
d541 2
a542 2
These procedures should be run in the <i>Alignment</i>
directory.<br>
d653 2
a654 2
These procedures should be run in the <i>Reconstruction</i>
directory.<br>
d828 2
a829 2
These procedures should be run in the <i>Reconstruction</i>
directory.<br>
d963 2
a964 2
These procedures should be run in the <i>Refinement</i>
directory.<br>
d1015 27
a1041 1
<p></p>
d1043 3
a1045 1
<li><a href="./refine.html">SPIDER Refinement</a></li>
d1047 7
a1053 1
<p></p>
d1055 1
d1058 2
a1059 1
batch files<p>
d1061 9
a1069 4
   <code class="output">disp001</code>, an image showing angular positions 
   from the: <code class="output">align_**_***</code> refined alignment 
   parameter output files.
</li>
@


1.48
log
@Much rewriting of the text, changed extension sfrom .bat to .spi
@
text
@d8 1
a8 1
<body  link="#0000ee" vlink="#0000ee" alink="#ff0000" >
d398 1
a398 1
<p class="explain">A particle picking batch file analyzes each micrograph, cutting out small windows of likely particle candidates. This is followed by a manual selection process that identifies the good particle images and rejects the bad ones. Particles automatically output by the batch file are said to be <i>picked</i>; the subset of those that are subsequently chosen are said to be <i>selected</i>.
d412 1
a412 1
particle images. Either
d415 1
a415 1
    way). The window sizes do not need to match. Or,
d417 1
a417 1
    <li>Use <a href=
d468 1
a468 1
    as input to generate projections at desired Eulerian angles for 
d504 1
a504 1
<code class="output">flt/ser*****</code> a set of low-pass filtered particle images. <br>
d521 1
a521 2
details at <a href="../../partpick.html">partpick.html</a> and the
<a href="../../faq.html#pick">SPIDER FAQ</a>). The output of this
d541 1
a541 1
<code class="output">percent_selected</code>, a doc file percentages of automatically picked vs manually selected particles.
d564 1
a564 1
   In what follows angular accuracy is set to 15 degrees, which
d603 1
a603 1
   <a href="./newprogs/sel_by_group.spi">sel_by_group.spi</a> writes the document files<br>
d610 1
a610 1
    Use one of these alignment batch files :
d676 1
a676 1
   <p class="action">Determine number of particles in each defocus group</p>
d847 12
d861 1
a861 6
<li>Split selection file.<br>
 Use: <i><a href="./newprogs/oddeven.spi">oddeven.spi</a></i> to
split the selection file to be used in reconstruction into two
separate selection files to be used in the following two 3D
reconstructions for comparative purposes.<br>
 This procedure creates two sets of selection doc. files: 
d863 12
a874 5
<ol>
<li><b>df***/seleven</b></li>

<li><b>df***/selodd</b></li>
</ol>
a876 1
<li style="list-style: none">
d878 11
d891 1
a891 5
<li>Compute two half-reconstructions for each defocus group.<br>
 Use: <i><a href="./newprogs/bpoddeven.spi">bpoddeven.spi</a></i>
to compute two half reconstructions, each using half of the
available particles.<br>
 This procedure creates two sets of image volumes: 
d893 7
a899 5
<ol>
<li><b>df***/vol001_odd</b></li>

<li><b>df***/vol001_even</b></li>
</ol>
d901 1
d903 19
a921 2
<li style="list-style: none">
<p></p>
a923 6
<li>[<b>Optional</b>] Compute the overall 3D reconstruction for
each defocus group.<br>
 Use: <i><a href="./newprogs/bpall.spi">bpall.spi</a></i> to create
a set of image volumes: <b>df***/vol001</b>.</li>

<li style="list-style: none">
a924 1
</li>
d926 9
a934 4
<li>Compare the two half volumes.<br>
 Use: <i><a href="./newprogs/fsc.spi">fsc.spi</a></i> to create a
set of document files: <b>df***/doccmp001</b> containing the FSC
curves.</li>
a935 1
<li style="list-style: none">
a936 1
</li>
d938 4
a941 2
<li>Compute the combined resolution of all defocus groups.<br>
 Use: <i><a href="./newprogs/ctf.spi">ctf.spi</a></i> to create: 
d943 3
a945 9
<ol>
<li><b>combires</b> combined resolution doc file</li>

<li><b>vol001</b> the 3D structure from the entire set of
particles.</li>
</ol>

This structure is known as the <i>initial volume</i> and will be
used as the input for the Refinement step.</li>
a946 2
<li style="list-style: none">
<p></p>
a948 10
<li>Determine resolution<br>
 Determine where the Fourier shell correlation drops below
threshold (either 0.5 or 0.15), and at this point, identify the
corresponding spatial frequency. Then, resolution = pixel
size/spatial frequency.<br>
 Use: <i><a href="./newprogs/res.spi">res.spi</a></i> to create the
doc file: <b>resolution</b>, which contains the cutoff, the
corresponding normalized frequency, and the resolution (in
Angstroms).</li>

d953 10
a962 10
<li>Plot the resolutions.<br>
 Plot the combined resolution together with the resolution of each
defocus group.<br>
 Use: <a href="./newprogs/plotres.spi">plotres.spi</a> to view the
resolution curves in gnuplot. Gnuplot commands are written to the
file <i>plot_res</i>, which can be viewed with the command <i>load
'plot_res'</i> in gnuplot. 

<p><a href="pics/plotres2.gif"><img width="200" height="150" src=
"./pics/plotres2.gif"></a></p>
d965 1
a965 12
<li style="list-style: none">
<p></p>
</li>

<li>Filter the initial volume.<br>
 Information at spatial frequencies above the cut-off value are
considered to be uncorrelated noise, and must be filtered out.<br>
 Use: <i><a href="./newprogs/filt.spi">filt.spi</a></i> to filter
the initial volume, <b>volfq001</b>.<br>
 Use the <b>Surface</b> operation in <i><a href=
"../../../../web/docs/web.html">WEB</a></i> to view the filtered
volume.</li>
a966 1
<li style="list-style: none">
d969 7
a975 1
<h3 align="center">Refinement</h3>
d979 1
a979 1
Subdirectories: <i>input, final</i> 
d983 4
a986 1
<p><b>Refinement is a computationally expensive operation.</b>
d989 2
a990 2
have reasonable particle volumes.</p>
</li>
d992 1
a992 10
<li>Create a document file summarizing the selected particles.<br>
 Use: <i><a href="./newprogs/ordselect.spi">ordselect.spi</a></i>
to create: <b>order_select</b>, a doc file similar to
<b>order_defocus</b> containing the number of particles in each
group remaining after applying the cross correlation cut-off, and
the ctf value for each group.</li>

<li>Prepare the data file stacks.<br>
 Use: <i><a href="./newprogs/stack.spi">stack.spi</a></i> to
create: 
d994 9
a1002 3
<ol>
<li><b>input/data***</b> a set of image stack files that contain
all the selected original particles.</li>
d1004 1
a1004 4
<li><b>input/dala***</b> a set of image stack files that contain
all the selected aligned particles.</li>
</ol>
</li>
d1006 12
a1017 5
<li>Prepare the alignment parameter files.<br>
 Use: <i><a href="./newprogs/sel_align.spi">sel_align.spi</a></i>
to create: <b>input/align_01_***</b> a set of doc files that
contain all the selected alignment parameters. <br>
<br>
d1020 1
a1020 1
<li><a href="./refine.html">Refinement</a></li>
d1022 5
a1026 7
<li>[<b>Optional</b>] View angular data output from Refinement
batch files.<br>
 Use: <i><a href="./newprogs/angdisp.spi">angdisp.spi</a></i> to
create: <b>disp001</b>, an image showing angular positions from
the: <b>align_**_***</b> refined alignment parameter output files.
<br>
<br>
d1029 1
a1029 4
<li style="list-style: none">
<hr>
<hr>
<a name="OTHER"></a> 
d1031 1
a1031 1
<h2 align="center"><u>Other Useful Methods</u></h2>
d1033 1
a1033 2
<a name="DIF"></a>
<h3 align="center">Difference Maps</h3>
d1035 7
a1041 4
<p>Differences between volumes can be assessed by subtracting one
volume from the other; the result is a <i>difference map</i>.
Before subtracting volumes, make sure they are properly
aligned.</p>
d1044 1
a1044 8
<li>Check alignment of two volumes. <a href=
"./newprogs/shiftvol.spi">shiftvol.spi</a> uses <a href=
"../../man/cc.html">CC</a> and <a href="../../man/pk3.html">PK
3</a> to determine if volumes are shifted relative to each
other.</li>

<li>Ligands can be isolated by creating a difference map. <a href=
"./newprogs/diffmap.spi">diffmap.spi</a></li>
a1045 4
<li>There are alternative methods for identifying <a href=
"../isolate.html">differences between volumes</a>.</li>

<li style="list-style: none">
d1047 4
a1050 1
<a name="Class"></a> 
d1052 5
a1056 1
<h3 align="center">Classification of Particles</h3>
d1058 6
a1063 5
<p>This method can be used to investigate differences between
particles. Aligned particles are grouped according to associated
view and then subdivided into classes within each view based on
similiarity.</p>
</li>
d1065 5
a1069 2
<li>Copy each particle into its associated view subdirectory
(1-83): <a href="./newprogs/b50.grp">b50.grp</a></li>
d1071 4
a1074 2
<li>Run correspondence analysis for each of the 83 views: <a href=
"./newprogs/b51.csi">b51.csi</a></li>
d1076 1
a1076 1
<li>Classification: <a href="./newprogs/b53.clk">b53.clk</a></li>
a1077 1
<li style="list-style: none">
d1079 4
a1082 5
<p><a name="XRAY"></a></p>

<h3 align="center">Frequency amplitude correction with X-ray
scattering data</h3>
</li>
a1083 9
<li><a href="./xray/xray.html">Amplitude correction documentation
and batch files</a></li>

<li><a href="./xray/old/enh.html">Older batch files</a></li>
</ul>

<hr>
<small>
<b>References</b>
d1109 2
@


1.47
log
@Some rewriting, reorganization. Renaming *.bat files to *.spi, adding links to graphical tools.
@
text
@d5 2
a6 1
<title>Single Particle Reconstruction Techniques</title>
d8 3
a10 4
<body background="pics/grey-parchment.jpg">
<img width="108" height="103" src="pics/new11.jpg" align="left">
<img width="108" height="104" src="pics/new22.jpg" align="right"><br>
 
d12 1
a12 1
<h2 align="center">Three Dimensional Reconstruction</h2>
a13 1
<h2 align="center">of Single Particle Specimens using</h2>
d15 11
a25 1
<h2 align="center">Reference Projections</h2>
d27 2
a28 1
<hr>
a30 4
<br>
<br>
 

d38 31
a68 23
<ol>
<li>For each micrograph the <a href="#CTF">Contrast Transfer
Function</a> (CTF) is estimated and the micrographs are placed in
defocus groups.</li>

<li>Next, an <a href="#AUTO">automated particle selection</a>
process identifies ribosome particles from the digitized electron
micrographs, and extracts small images of individual
particles.</li>

<li>The particle image series is then aligned relative to reference
projections through shifts and rotations using the <a href=
"#SH">'AP SH'</a> command.</li>

<li><a href="#CA">Averages</a> of particles for each reference view
are computed, to assess how evenly the projection views are
distributed.</li>

<li>The initial <a href="#3D">3D reconstruction</a> is calculated,
along with an estimate of resolution.</li>

<li>Angular <a href="#REF">refinement</a> gives each projection a
chance "to find a better home"in terms of its orientation and phase
d70 1
a70 1
reconstruction.</li>
d72 3
a74 2
<li>Some <a href="#OTHER">other</a> useful methods, such as
classification and difference maps, are described as well.
d76 2
a77 5
"../../techniques.html">techniques</a> page.</li>
</ol>

<br>
<br>
d86 13
a98 1
<li><a href="../../ref.html">General references</a></li>
d100 1
a100 1
<li>Information about images from the <b><a href="zi/zidoc.html">ZI
d103 1
a103 1
<li>Batch files for circular images from <b><a href=
d107 2
a108 3
<br>
<br>
 The data below is sometimes shown plotted with <i>gnuplot</i>. An
d111 1
a111 1
at <a href="http://www.gnuplot.info">Gnuplot Central</a> 
d114 3
a116 1
<h3 align="center">Running SPIDER batch files</h3>
d118 4
a121 2
<br>
<br>
a136 1
<br>
d140 1
a140 1
the project data file extension, and <b>proc.bat</b> is the
d172 1
a172 1
   file <a href="./newprogs/makeparams.bat">makeparams.bat</a>. Run
d183 1
a183 1
   "./newprogs/makefilelist.bat">makefilelist.bat</a> to create the
d212 1
a212 1
"newprogs/resizevol.bat">resizevol.bat</a>. This batch file should
d230 1
a230 1
<h3 align="center">Contrast Transfer Function estimation</h3>
d232 4
a235 1
<!-- SPIRE directory=Power_Spectra subdirectories=power -->
d237 1
a237 1
<p>These procedures should be run in the <i>Power_Spectra</i>
d239 3
d243 1
a243 1
 The micrographs should be in the <i>Micrographs</i> directory.
d250 1
a250 1
<a href="../ctf/pfefferkorn.pdf"><i>Three Dimensional Reconstruction with Contrast Transfer Compensation from Defocus Series</i></a> for a fuller discussion.
d255 3
a257 4
<p>Generate the CTF estimate of the power spectrum.<br>
 Use SPIDER procedure: <a href="./newprogs/power.spi">power.spi</a>
which calls: <a href="./newprogs/power_p1.spi">power_p1.spi</a> and
creates:</p>
d259 10
a268 3
<ol>
<li><b>roo***</b> doc files, a series of 1D profiles of the averaged power spectra. <br>
These doc files can be plotted with gnuplot or <a href="../../guitools/pyplot.html">pyplot</a></li>
d270 5
a274 2
<li><b>pw_avg***</b> power spectra, a series of averaged power
spectra, one for each micrograph. Make a montage using <a href=
d282 1
a282 1
<li>Are the Thon rings round?</li>
d284 1
a284 1
<li>Do they extend to high resolution?</li>
d292 2
a293 2
<li>Rings that are cut off unidirectionally (evidence of
drift)</li>
d295 2
a296 2
<li>Rings that are elliptical, or even hyperbolic (evidence of
astigmatism).</li>
d304 1
a304 2
</ol>
</li>
d308 3
a310 1
<li>Determine defocus<br>
d313 2
a314 2
<ul>
<li><a href="./newprogs/defocus.spi">defocus.spi</a> : Estimates defocus
d316 5
a320 3
   ED</b></a>, creating <br>
   <b>defocus</b>: a document file of defocus and astigmatism values, and<br>
   <b>ctf***</b>: doc files of the background-subtracted 1D power spectra.<br>
d324 2
a325 1
   The ctf*** files can be analyzed with <a       href="../../guitools/ctfmatch/ctfmatch.html">ctfmatch</a></li>
d327 3
a329 2
<li><a href="../../../../web/docs/ctf.html">CTF from doc file</a>
   in <b>WEB</b>. Manual fitting a CTF model to the 1D profiles.</li>
d331 12
a342 10
<li><a href="defdoc.html"><b>def</b></a> : a procedure for
   estimating defocus. <a href="./newprogs/def.spi">def.spi</a>:
   Estimate defocus. Creates <b>defocus</b> document file. See the <a
   href="defdoc.html">def manual page</a> for more information.</li>

<li>The MRC program <b>ctffind2</b> : estimates both the defocus
   and astigmatism. <a href="./newprogs/mrc.spi">mrc.spi</a>: SPIDER
   batch file. Also creates <b>defocus</b> file. It calls: <a href=
   "./newprogs/ctffind">ctffind</a>: a shell script, and <a href=
   "./newprogs/readmrc.py">readmrc.py</a>: a python script. See the <a
d344 1
a344 2
   information.</li>
   </ul>
d346 3
a348 1
   <p></p>
d350 4
a353 2

<li>Assign defocus groups according to the power spectrum.<br>
d356 1
a356 1
   <b>def_sort</b>, a doc file with the same information sorted by defocus.
d361 1
d373 6
d380 3
a382 2
   <p></p>
   </li>
d384 1
a384 2
<li>Compute averages for each defocus group.<br>
    When you have finalized the values in def_sort.ext, compute the
d387 1
a387 1
   of defocus group averages: <b>def_avg</b> and <b>order_defgrps</b>.
d389 1
a389 8

<p><!--
<a name="DEFGRPDOC"></a>
Create a defocus group document file. Once you have determined the defocus groups for all 
the micrographs, put this information into a doc file with 
<a href="makedfgroups.bat">makedfgroups.bat</a>. Each row contains the micrograph 
number, the defocus group number, and the defocus value.
-->
d391 1
a391 1

d394 3
d398 2
a399 1
<h3 align="center">Automated Particle Selection</h3>
d401 1
a401 1
<p>These procedures should be run in the <i>Particles</i>
d403 1
d407 24
a430 1
 Subdirectories: <i>coords, good, win, flt</i></p>
d432 5
d438 3
a440 2
<li>Select a background noise file.<br>
 There are 2 alternative methods: 
d442 18
a459 4
<ol>
<li>Use a noise image from a previous project (this is the easier
way). The window sizes do not need to match. <br>
<br>
d461 1
d463 11
a473 5
<li>Convert a scanned micrograph file to a SPIDER image file: <a
href="./newprogs/convert.bat">convert.bat</a> <a href=
"./newprogs/convert_p1.bat">convert_p1.bat</a> Works for
micrographs scanned using Perkin Elmer, HiScan or ZI scanners.<br>
<br>
d477 1
a477 2
<br>
<br>
d480 2
a481 16
<li>Create or obtain a noise image.<br>
 A noise image is required to normalize the backgrounds of the
particle images. Either 

<ol>
   <li>Obtain a noise image from from a previous project.<br>
      <br>
      </li>

   <li>Create one with the batch file: <a href=
      "./newprogs/noise.bat">noise.bat</a> which creates a set of noise
      images: <b>tmpnoise/noi***</b>. You can view them in <b>Web</b> to
      select one as a background noise image.<br>
      <br>
      </li>
</ol>
d483 3
a485 1
<br>
d488 1
a488 4
<li>Run automatic phase of particle selection.<br>
    Either of the following two approaches can be used. They both
   require the converting procedure <a href=
   "./newprogs/convert_p1.bat">convert_p1.bat</a> 
d490 3
a492 2
<ol>
<li>Correlation with a Gaussian blob</li>
d494 8
a501 33
<li style="list-style: none">The micrographs are decimated by 1/4,
   Fourier filtered with a Gaussian low pass filter, and searched for
   peaks over regions corresponding to particle dimensions. Particles
   are windowed out, centered, peak locations are corrected, and
   particles are windowed again. This procedure uses histogram
   equalization. <a href="./newprogs/pick.bat">pick.bat</a> : The top
   level batch file. <a href="./newprogs/pick_p1.bat">pick_p1.bat</a>
   : procedure called by pick.bat. These procedures output a set of
   particle images and 2 sets of doc files: <b>win/ser*****</b> serial
   files of windowed particles,, <b>coords/ndc***</b> peak coordinates
   from 1/4 decimated image, <b>coords/sndc***</b> top left pixel
   coordinates for particle images.<br>
   <br>
   </li>

<li>Local Fast Correlation Function</li>

<li style="list-style: none">(B.K. Rath and J. Frank, Journal of
   Structural Biology, Volume 145, Issues 1-2, January 2004, Pages
   84-90). This procedure uses <a href="../../partpick.html#LFC">local
   cross-correlation</a> calculated using Fourier methods outlined by
   Alan Roseman (<i>Ultramicroscopy</i>, Vol 94 (3-4), (2003),
   225-236). A 3D reference volume is required as input to generate
   projections at desired Eulerian angles for searching different
   orientations of the search image in the micrograph. <a href=
   "./newprogs/lfc_pick.bat">lfc_pick.bat</a> : The top level batch
   file. <a href="../../../proc/pickparticle.spi">pickparticle.bat</a>
   : procedure called by lfc_pick.bat. These procedures output a set
   of particle images and a set of doc files: <b>win/ser*****</b>
   serial files of windowed particles,, <b>coords/sndc***</b> top left
   pixel coordinates for particle images.<br>
   <br>
   </li>
d503 2
d506 3
a508 1
  <br>
d511 1
a511 9
<li>Determine the particle numbers corresponding to each
micrograph.<br>
 This reports the range of particle numbers associated with each
micrograph so that verification of particles can be carried out for
each individual micrograph. <a href=
"./newprogs/pnums.bat">pnums.bat</a> creates doc file
<b>order</b><br>
<br>
</li>
d513 2
a514 1
<li style="list-style: none"><a name="PFILT"></a></li>
d516 1
a516 17
<li>[<b>Optional</b>] Low-pass filter the particle images before
particle selection.<br>
 Manual selection of good particles (the next step) is easier if
the particles have been filtered beforehand. This creates a second
set of particle images. Use the filtered particles, not the raw
particles, during selection in <a href=
"../../../../web/docs/web.html">WEB</a>. <a href=
"./newprogs/pfilt.bat">pfilt.bat</a> : Filter a set of images,
adjusting filter settings for each micrograph. output: filtered
particles <b>flt/ser*****</b>. <a href=
"./newprogs/pfilt2.bat">pfilt2.bat</a> a simpler version to filter
a set of particles.<br>
<br>
</li>

<li>Verify automatically selected particles.<br>
 Sort through the output files to eliminate any non-particles. This
d520 1
a520 3
to click on each good particle. The particle numbers are saved to a
file. For a project with multiple defocus settings, save the good
particle numbers from each micrograph in individual files (more
d523 11
a533 3
procedure should be a set of <b>good/good***</b> document files,
one for each micrograph.<br>
<br>
d536 7
a542 10
<li>Remove any duplicated particles.<br>
 When manually selecting particles in <a href=
"../../../../web/docs/web.html">WEB</a>, sometimes a particle is
accidently double clicked. This procedure will delete the
appropriate lines from the file. The doc file then needs to be
adjusted so that the image numbers are in ascending order with
sequential key numbers. <a href=
"./newprogs/renumber.bat">renumber.bat</a> creates
<b>good/ngood***</b> doc files.<br>
<br>
d548 3
d552 3
a554 1
<h3 align="center">Alignment</h3>
d556 1
a556 1
<p>These procedures should be run in the <i>Alignment</i>
d558 1
a558 1
Subdirectories: <i>ali, prj</i></p>
d561 20
a580 1

d583 2
a584 15
   <p>Create reference projections for alignment from a <u>reference
   volume</u>.<br>
   Reference projections are views of the ribosome at known angles.
   In what follows angular accuracy is set to 15 degrees, which
   results in 83 reference projections. A preexisting reference volume
   is needed to create the projections. The row and column dimensions
   of the reference volume must match the dimensions of the particle
   windows.</p>

   <p>If you are reconstructing from multiple defocus groups, use:
   <i><a href="./newprogs/refprojctf.bat">refprojctf.bat</a></i>.<br>
   Otherwise, if there is only a single group use: <i><a href=
   "./newprogs/refproj.bat">refproj.bat</a></i></p>

<p>These procedures will create the following files:
d586 13
a598 10
   <ol>
      <li><b>prj/prj****</b> images of the 2D projections</li>

      <li><b>refangles</b> doc file with 3 Euler angles for each of the
      83 projections.</li>

      <li><b>projlist</b> list of 83 projection numbers,</li>
   </ol>   

<br>
d601 1
d603 4
a606 6
   <p>Create lists of all images in each defocus group.<br>
   SPIDER procedure: <i><a href=
   "./newprogs/sel_by_group.bat">sel_by_group.bat</a></i> creates
   lists of all original sample images by defocus group in:
   <b>part_by_group_***</b></p>
   </li>
d608 1
d610 9
a618 4
   <p>Align the particles to the reference projections.<br>
    If you have multiple defocus groups and you used
   <i>refprojctf.bat</i> above, edit and run one of the following
   procedures.
d620 12
a631 3
   <ul>
      <li><i><a href="./newprogs/apshctf.bat">apshctf.bat</a></i> (not
      using PubSub)</li>
d633 1
a633 7
      <li><i><a href="./newprogs/pub_apshctf.bat">pub_apshctf.bat</a></i>
      (using PubSub).</li>
   </ul></p>

   <p>If you have a single defocus group and you used
   <i>refproj.bat</i> above, edit and run one of the following
   procedures.
d635 7
a641 3
   <ul>
      <li><i><a href="./newprogs/apsh.bat">apsh.bat</a></i> (not using
      PubSub)</li>
d643 1
a643 10
      <li><i><a href="./newprogs/pub_apsh.bat">pub_apsh.bat</a></i>
      (using PubSub).</li>
   </ul>
   </p>
 
   <p>These procedures create a set of document files:
   <b>align_01_***</b> containing the shift and rotation parameters
   for the best matched projection.</p>
   </li>
   <p></p>
d645 8
a652 10
<li>Rotate and shift particles according to alignment
   parameters.<br>
    Use: <i><a href="./newprogs/alignsh.bat">alignsh.bat</a></i> to
   create: <b>ali/sar*****</b>, aligned versions of the particle
   images.<br>
    (If the particles are mirrored in the <b>align_01_***</b>
   alignment document file from <a href="../../man/apsh.html"><b>AP
   SH</b></a>, they have been mirrored after they are rotated &amp;
   shifted.)</li>
   <p></p>
d654 1
a654 2
<li>Alternative obsolete alignment routines for use with: <a href=
   "../../man/apmq.html">AP MQ</a> 
d656 1
a656 9
   <ul>
      <li><a href="./newprogs/docmq2sh.bat">docmq2sh.bat</a><br>
       (converts <a href="../../man/apmq.html">AP MQ</a> alignment output
      files which are listed by defocus group to 'AP SH' format)</li>

      <li><a href=
      "./newprogs/docmq_old_2sh.bat">docmq_old_2sh.bat</a><br>
       (converts <a href="../../man/apmq.html">AP MQ</a> alignment output
      which are listed by micrograph to 'AP SH' format)</li>
a657 6
      <li><a href="./newprogs/apmq.bat">apmq.bat</a><br>
       <a href="./newprogs/apmqctf.bat">apmqctf.bat</a><br>
      </li>
   </ul>
   </li>
</ul>
d661 1
d663 4
a666 1
<h3 align="center">Compute Averages</h3>
d668 1
a668 1
<p>These procedures should be run in the <i>Reconstruction</i>
d670 1
a670 1
Subdirectories: <i>select, hist, avg, display</i></p>
d674 9
a682 8
<ul> 
<li>Convert alignment parameter files (if necessary).<br>
    If you have used the obsolete alignment operation: <i><a href=
   "../../man/apmq.html">AP MQ</a></i> use : <i><a href=
   "./newprogs/docmq2sh.bat">docmq2sh.bat</a></i> or <i><a href=
   "./newprogs/docmq_old_2sh.bat">docmq_old_2sh.bat</a></i> to convert
   the alignment output files to 'AP SH' format before
   continuing.</li>
d685 17
a701 7
<li>Combine all alignment parameter files into a single summary
   file.<br>
    Use SPIDER procedure: <i><a href=
   "./newprogs/combine.bat">combine.bat</a></i> to create:
   <b>align_01_all</b> containing: merged alignment parameters from
   all defocus groups.</li>
   <p></p>
d703 1
a703 7
<li>Determine number of particles in each defocus group.<br>
    Use SPIDER procedure: <i><a href=
   "./newprogs/ordefocus.bat">ordefocus.bat</a></i>: to create a doc.
   file: <b>order_defocus</b> containing:<br>
    Number of particles, Cumulative number of particles, and Average
   defocus value for each group.</li>
   <p></p>
d705 3
a707 11
<li>Compare aligned particles to reference projections.<br>
    After editing the correlation coefficient (CC) threshold to select
   the desired similarity threshold, use SPIDER procedure: <i><a href=
   "./newprogs/select.bat">select.bat</a></i> to create the following
   files:<br>

   <ol>
      <li>A set of doc. files: <b>df***/how_many</b> (one for each
      reference view for that defocus group) listing number of particles
      associated with that view.<br>
      </li>
d709 8
a716 3
      <li>A set of doc. files: <b>df***/select/sel???</b> (one for each
      view), listing particles which are associated with each of the
      reference views and their CC values.</li>
d718 11
a728 5
      <li>An overall summary file: <b>how_many</b> listing sum of all the
      <i>df***/how_many</i> files.</li>
   </ol>
   </li>
   <p></p>
d730 1
a730 3
<li>Identify a threshold correlation coefficient for selecting true
   particles.<br>
   The next several operations help to identify a threshold
d737 1
a737 4
   between two such peaks.<br>
   Use: 
   <i><a href= "./newprogs/cchistogram.bat">cchistogram.bat</a></i>: 
   to create: 
d739 13
a751 2
   <ol>
      <li><b>hist/cchist_***</b> Set of histograms by group</li>
d753 1
a753 2
      <li><b>hist/cchist_all</b> Overall histogram</li>
   </ol>
d755 6
a760 6
   <br>
   <p>View histograms with a <i>gnuplot</i>, e.g.: <i>gnuplot &gt;
   load '<a href="./newprogs/plothist">plothist</a>'</i><br>
   <a href="pics/cchist.gif"><img width="200" height="150" src=
   "pics/cchist.gif"></a></p>
   </li>
d762 2
a763 1
<li>View the particles corresponding to each reference view.<br>
d772 2
a773 2
   displayed.</li>
   <p></p>
d775 15
a789 8
<li>Compute correlation thresholds for discarding particles.<br>
   Use SPIDER procedure: 
   <i><a href= "./newprogs/ccthresh.bat">ccthresh.bat</a></i> 
   to create a doc. file: <b>thresh</b>. This doc. file contains:<br>
   'CC thresholds' for particles listed by defocus group.<br>
   A percent cutoff must be chosen. If a threshold of 0.40 is
  selected, then the 40% of all particles havng the lowest
  correlations will be eliminated</li>
d792 7
a798 7
<li>Select particles above the correlation thresholds.<br>
   Use SPIDER procedure: 
   <i><a href="./newprogs/dftotals.bat">dftotals.bat</a></i> 
   to create a set of
   particle selection files: <b>df***/seltotal</b>, which list the
   particles with CC values greater than CC threshold which will be
   used in the 3D reconstruction.</li>
d801 6
a806 1
<li>Check the distribution of reference views (angular directions).<br>
a807 7
    Use SPIDER procedure: 
    <i><a href= "./newprogs/plotview.bat">plotview.bat</a></i> 
    to to plot the file (<b>how_many.ext</b>) and create plot of 
    number of particles vs projection view using <i>gnuplot</i>.<br>
    This creates file: <b>jnkplot_how</b> which contains
    <i>gnuplot</i> commands.</li>
</li>
d810 5
d816 3
a818 15
<li>Create average images for all 83 projection groups.<br>
   Use SPIDER procedure:  
   <i><a href= "./newprogs/average.bat">average.bat</a></i> to create: 

   <ol>
      <li><b>avg/avg***</b> images containing average images for this
      projection group.</li>

      <li><b>avg/var***</b> images containing variance images for this
      projection group.</li>
   </ol>

   Use the <b>Montage</b> operation in 
   <i><a href= "../../../../web/docs/web.html">WEB</a></i> 
   to view the set of average images.
a819 1
<p></p>
d821 1
a821 9
<li>Create an image showing the distribution of angular projection
directions.<br>
 Use: <i><a href="./newprogs/display.bat">display.bat</a></i>,
<i><a href="./newprogs/display_p.bat">display_p.bat</a></i> to
create a plot in which the 83 angular groups are represented by
small circles: <b>display/cndis***</b>. The radii of these circles
are proportional to the number of particles in each group.<br>
 Use the <b>Montage</b> operation in <a href=
"../../../../web/docs/web.html">WEB</a> to display the plots.</li>
d823 2
a824 1
<li>Limit strongly over-represented angular projections.<br>
d830 2
a831 1
"./newprogs/b19.eqs">b19.eqs</a></i></li>
d833 1
a833 5
<li style="list-style: none">
<hr>
<p><i>To further investigate particle classification go to</i>
<b><a href="#OTHER">Other Useful Methods</a></b></p>

d836 2
d839 3
a841 1
<h3 align="center">3D Reconstruction</h3>
d843 3
a845 2
<p>These procedures should also be run in the <i>Reconstruction</i>
directory.</p>
d851 1
a851 1
 Use: <i><a href="./newprogs/oddeven.bat">oddeven.bat</a></i> to
d869 1
a869 1
 Use: <i><a href="./newprogs/bpoddeven.bat">bpoddeven.bat</a></i>
d887 1
a887 1
 Use: <i><a href="./newprogs/bpall.bat">bpall.bat</a></i> to create
d895 1
a895 1
 Use: <i><a href="./newprogs/fsc.bat">fsc.bat</a></i> to create a
d904 1
a904 1
 Use: <i><a href="./newprogs/ctf.bat">ctf.bat</a></i> to create: 
d925 1
a925 1
 Use: <i><a href="./newprogs/res.bat">res.bat</a></i> to create the
d937 1
a937 1
 Use: <a href="./newprogs/plotres.bat">plotres.bat</a> to view the
d953 1
a953 1
 Use: <i><a href="./newprogs/filt.bat">filt.bat</a></i> to filter
d961 2
a962 1
<h3 name="REF" align="center">Refinement</h3>
d977 1
a977 1
 Use: <i><a href="./newprogs/ordselect.bat">ordselect.bat</a></i>
d984 1
a984 1
 Use: <i><a href="./newprogs/stack.bat">stack.bat</a></i> to
d997 1
a997 1
 Use: <i><a href="./newprogs/sel_align.bat">sel_align.bat</a></i>
d1007 1
a1007 1
 Use: <i><a href="./newprogs/angdisp.bat">angdisp.bat</a></i> to
d1031 1
a1031 1
"./newprogs/shiftvol.bat">shiftvol.bat</a> uses <a href=
d1037 1
a1037 1
"./newprogs/diffmap.bat">diffmap.bat</a></li>
d1077 29
a1105 2
<p><small>Source: mr.html &nbsp;&nbsp;&nbsp; Updated: 6/02/04
&nbsp;&nbsp;&nbsp;</small></p>
d1109 1
a1109 1
<address><small>&copy; <a href="../../copyright.html">Copyright
d1111 2
a1112 1
"mailto:spider@@wadsworth.org">spider@@wadsworth.org</a></small></address>
@


1.46
log
@cosmetic
@
text
@d107 1
a107 1
<center><i>spider bat/dat @@proc</i></center>
d113 1
a113 1
<p>where <b>bat</b> is the procedure file extension, <b>dat</b> is
d115 1
a115 1
procedure file.</p>
a209 4
 Subdirectory: <i>power</i><br>
 The micrographs should be in the <i>Micrographs</i> directory.<br>
 More information on the contrast transfer function may be found <a
href="../ctf/ctf.html">here</a>.</p>
d211 10
d224 2
a225 2
 Use SPIDER procedure: <a href="./newprogs/power.bat">power.bat</a>
which calls: <a href="./newprogs/power_p1.bat">power_p1.bat</a> and
d229 2
a230 4
<li><b>roo***</b> doc files.</li>

<li>A series of 1D profiles of the averaged power spectra named;
<b>pw_ro***</b>.</li>
a246 1
<br>
d268 2
a269 3
<li>Determine defocus and amplitude contrast.<br>
 Use one of the following methods to determine defocus and
amplitude contrast: 
d272 1
a272 1
<li><a href="./newprogs/tfed.bat">tfed.bat</a> Estimate defocus
d274 7
a280 4
   ED</b></a> which creates a <b>defocus</b> document file.<br>
    Uses procedure: <a href=
   "./newprogs/calcparms.bat">calcparms.bat</a> that checks values in
   the <a href="./params.html">parameter file</a>.</li>
d283 1
a283 1
   in <b>WEB</b>.</li>
d286 1
a286 1
   estimating defocus. <a href="./newprogs/def.bat">def.bat</a>:
d291 1
a291 1
   and astigmatism. <a href="./newprogs/mrc.bat">mrc.bat</a>: SPIDER
d303 5
a307 6
    Both <a href="./newprogs/def.bat">def.bat</a> and <a href=
   "./def/mrc.bat">mrc.bat</a> create a document file called
   defocus.ext, which has the defocus listed for each micrograph. You
   can assign micrographs to defocus groups with <a href=
   "./newprogs/defsort.bat">defsort.bat</a>: create defocus groups.
   Output in <b>def_sort</b> doc file. This is only a starting point,
d309 7
a315 3
   which micrographs belong together. Plot the power spectrum for each
   micrograph in <i>gnuplot</i> and assign the defocus groups such
   that the curves are in phase. Gnuplot commands can be saved in a
d317 2
a318 2
   then run in <i>gnuplot</i> using the <i>load</i> command:
   <i>gnuplot gnuplot ;&gt; load 'plotpower'</i>
d328 1
a328 1
   <a href="./newprogs/defavg.bat">defavg.bat</a> creates 2 doc files
@


1.45
log
@added "<!-- SPIRE" comments to mark directories
@
text
@d9 1
a9 2
<img width="108" height="104" src="pics/new22.jpg" align=
"right"><br>
d145 7
a151 6
parameters from a doc file, created by the interactive procedure
file <a href="./newprogs/makeparams.bat">makeparams.bat</a>. Run
this procedure file in the top directory of your project and name
the output file "params.dat", where <b>dat</b> is the project
extension. <a href="./params.html">The parameters are described
here</a>.</li>
d154 9
a162 8
the numbers of the files to be processed in DO loops (the text part
of the filenames are entered as templates in the top level batch
files - see below). Use the interactive batch file <a href=
"./newprogs/makefilelist.bat">makefilelist.bat</a> to create the
doc file, called <b>"filenums.dat"</b>. If you need to exclude
files from this list, use a text editor to delete the appropriate
lines, then use the 'DOC REN' command in SPIDER to renumber lines
in the doc file.</li>
d165 2
a166 2
This step comes after you have segregated micrographs into various
defocus groups.</li>
d271 5
a275 5
with SPIDER operation <a href="../../man/tfed.html"><b>TF
ED</b></a> which creates a <b>defocus</b> document file.<br>
 Uses procedure: <a href=
"./newprogs/calcparms.bat">calcparms.bat</a> that checks values in
the <a href="./params.html">parameter file</a>.</li>
d278 1
a278 1
in <b>WEB</b>.</li>
d281 3
a283 3
estimating defocus. <a href="./newprogs/def.bat">def.bat</a>:
Estimate defocus. Creates <b>defocus</b> document file. See the <a
href="defdoc.html">def manual page</a> for more information.</li>
d286 10
a295 8
and astigmatism. <a href="./newprogs/mrc.bat">mrc.bat</a>: SPIDER
batch file. Also creates <b>defocus</b> file. It calls: <a href=
"./newprogs/ctffind">ctffind</a>: a shell script, and <a href=
"./newprogs/readmrc.py">readmrc.py</a>: a python script. See the <a
href="defmrc.html">defmrc manual page</a> for more
information.</li>
</ul>
</li>
d298 15
a312 15
 Both <a href="./newprogs/def.bat">def.bat</a> and <a href=
"./def/mrc.bat">mrc.bat</a> create a document file called
defocus.ext, which has the defocus listed for each micrograph. You
can assign micrographs to defocus groups with <a href=
"./newprogs/defsort.bat">defsort.bat</a>: create defocus groups.
Output in <b>def_sort</b> doc file. This is only a starting point,
however. You should manually inspect the defocus groupings to see
which micrographs belong together. Plot the power spectrum for each
micrograph in <i>gnuplot</i> and assign the defocus groups such
that the curves are in phase. Gnuplot commands can be saved in a
text file, such as <a href="./newprogs/plotpower">plotpower</a>,
then run in <i>gnuplot</i> using the <i>load</i> command:
<i>gnuplot gnuplot ;&gt; load 'plotpower'</i>
<p><a href="pics/plotpower1.gif"><img width="200" height="150" src=
"pics/plotpower1.gif"></a></p>
d314 2
a315 2
<p></p>
</li>
d318 4
a321 4
 When you have finalized the values in def_sort.ext, compute the
averages for each defocus group:<br>
 <a href="./newprogs/defavg.bat">defavg.bat</a> creates 2 doc files
of defocus group averages: <b>def_avg</b> and <b>order_defgrps</b>.
d372 10
a381 10
<li>Obtain a noise image from from a previous project.<br>
<br>
</li>

<li>Create one with the batch file: <a href=
"./newprogs/noise.bat">noise.bat</a> which creates a set of noise
images: <b>tmpnoise/noi***</b>. You can view them in <b>Web</b> to
select one as a background noise image.<br>
<br>
</li>
a384 1
<br>
d388 3
a390 3
 Either of the following two approaches can be used. They both
require the converting procedure <a href=
"./newprogs/convert_p1.bat">convert_p1.bat</a> 
d396 13
a408 13
Fourier filtered with a Gaussian low pass filter, and searched for
peaks over regions corresponding to particle dimensions. Particles
are windowed out, centered, peak locations are corrected, and
particles are windowed again. This procedure uses histogram
equalization. <a href="./newprogs/pick.bat">pick.bat</a> : The top
level batch file. <a href="./newprogs/pick_p1.bat">pick_p1.bat</a>
: procedure called by pick.bat. These procedures output a set of
particle images and 2 sets of doc files: <b>win/ser*****</b> serial
files of windowed particles,, <b>coords/ndc***</b> peak coordinates
from 1/4 decimated image, <b>coords/sndc***</b> top left pixel
coordinates for particle images.<br>
<br>
</li>
d413 15
a427 15
Structural Biology, Volume 145, Issues 1-2, January 2004, Pages
84-90). This procedure uses <a href="../../partpick.html#LFC">local
cross-correlation</a> calculated using Fourier methods outlined by
Alan Roseman (<i>Ultramicroscopy</i>, Vol 94 (3-4), (2003),
225-236). A 3D reference volume is required as input to generate
projections at desired Eulerian angles for searching different
orientations of the search image in the micrograph. <a href=
"./newprogs/lfc_pick.bat">lfc_pick.bat</a> : The top level batch
file. <a href="../../../proc/pickparticle.spi">pickparticle.bat</a>
: procedure called by lfc_pick.bat. These procedures output a set
of particle images and a set of doc files: <b>win/ser*****</b>
serial files of windowed particles,, <b>coords/sndc***</b> top left
pixel coordinates for particle images.<br>
<br>
</li>
d430 1
a430 2
<br>
<br>
d501 15
a515 15
<p>Create reference projections for alignment from a <u>reference
volume</u>.<br>
 Reference projections are views of the ribosome at known angles.
In what follows angular accuracy is set to 15 degrees, which
results in 83 reference projections. A preexisting reference volume
is needed to create the projections. The row and column dimensions
of the reference volume must match the dimensions of the particle
windows.</p>

<p>If you are reconstructing from multiple defocus groups, use:
<i><a href="./newprogs/refprojctf.bat">refprojctf.bat</a></i>.<br>
 Otherwise, if there is only a single group use: <i><a href=
"./newprogs/refproj.bat">refproj.bat</a></i></p>

<p>These procedures will create the following files:</p>
d517 2
a518 2
<ol>
<li><b>prj/prj****</b> images of the 2D projections</li>
d520 2
a521 2
<li><b>refangles</b> doc file with 3 Euler angles for each of the
83 projections.</li>
d523 2
a524 2
<li><b>projlist</b> list of 83 projection numbers,</li>
</ol>
a526 1
<br>
d530 6
a535 6
<p>Create lists of all images in each defocus group.<br>
 SPIDER procedure: <i><a href=
"./newprogs/sel_by_group.bat">sel_by_group.bat</a></i> creates
lists of all original sample images by defocus group in:
<b>part_by_group_***</b></p>
</li>
d538 25
a562 31
<p>Align the particles to the reference projections.<br>
 If you have multiple defocus groups and you used
<i>refprojctf.bat</i> above, edit and run one of the following
procedures.</p>

<ul>
<li><i><a href="./newprogs/apshctf.bat">apshctf.bat</a></i> (not
using PubSub)</li>

<li><i><a href="./newprogs/pub_apshctf.bat">pub_apshctf.bat</a></i>
(using PubSub).</li>
</ul>

<br>
<br>
 

<p>If you have a single defocus group and you used
<i>refproj.bat</i> above, edit and run one of the following
procedures.</p>

<ul>
<li><i><a href="./newprogs/apsh.bat">apsh.bat</a></i> (not using
PubSub)</li>

<li><i><a href="./newprogs/pub_apsh.bat">pub_apsh.bat</a></i>
(using PubSub).</li>
</ul>

<br>
<br>
d564 5
a569 11
<p>These procedures create a set of document files:
<b>align_01_***</b> containing the shift and rotation parameters
for the best matched projection.</p>
</li>

<li style="list-style: none">
<p></p>

<p></p>
</li>

d571 9
a579 14
parameters.<br>
 Use: <i><a href="./newprogs/alignsh.bat">alignsh.bat</a></i> to
create: <b>ali/sar*****</b>, aligned versions of the particle
images.<br>
 (If the particles are mirrored in the <b>align_01_***</b>
alignment document file from <a href="../../man/apsh.html"><b>AP
SH</b></a>, they have been mirrored after they are rotated &amp;
shifted.)</li>

<li style="list-style: none">
<p></p>

<p></p>
</li>
d582 1
a582 17
"../../man/apmq.html">AP MQ</a> 

<ul>
<li><a href="./newprogs/docmq2sh.bat">docmq2sh.bat</a><br>
 (converts <a href="../../man/apmq.html">AP MQ</a> alignment output
files which are listed by defocus group to 'AP SH' format)</li>

<li><a href=
"./newprogs/docmq_old_2sh.bat">docmq_old_2sh.bat</a><br>
 (converts <a href="../../man/apmq.html">AP MQ</a> alignment output
which are listed by micrograph to 'AP SH' format)</li>

<li><a href="./newprogs/apmq.bat">apmq.bat</a><br>
 <a href="./newprogs/apmqctf.bat">apmqctf.bat</a><br>
</li>
</ul>
</li>
d584 15
a598 3
<li style="list-style: none">
<p></p>
</li>
a610 4
<ul>
<li style="list-style: none">
<p></p>
</li>
d612 1
d614 7
a620 10
 If you have used the obsolete alignment operation: <i><a href=
"../../man/apmq.html">AP MQ</a></i> use : <i><a href=
"./newprogs/docmq2sh.bat">docmq2sh.bat</a></i> or <i><a href=
"./newprogs/docmq_old_2sh.bat">docmq_old_2sh.bat</a></i> to convert
the alignment output files to 'AP SH' format before
continuing.</li>

<li style="list-style: none">
<p></p>
</li>
d623 6
a628 5
file.<br>
 Use SPIDER procedure: <i><a href=
"./newprogs/combine.bat">combine.bat</a></i> to create:
<b>align_01_all</b> containing: merged alignment parameters from
all defocus groups.</li>
d631 6
a636 5
 Use SPIDER procedure: <i><a href=
"./newprogs/ordefocus.bat">ordefocus.bat</a></i>: to create a doc.
file: <b>order_defocus</b> containing:<br>
 Number of particles, Cumulative number of particles, and Average
defocus value for each group.</li>
d639 20
a658 20
 After editing the correlation coefficient (CC) threshold to select
the desired similarity threshold, use SPIDER procedure: <i><a href=
"./newprogs/select.bat">select.bat</a></i> to create the following
files:<br>
 

<ol>
<li>A set of doc. files: <b>df***/how_many</b> (one for each
reference view for that defocus group) listing number of particles
associated with that view.<br>
</li>

<li>A set of doc. files: <b>df***/select/sel???</b> (one for each
view), listing particles which are associated with each of the
reference views and their CC values.</li>

<li>An overall summary file: <b>how_many</b> listing sum of all the
<i>df***/how_many</i> files.</li>
</ol>
</li>
d661 25
a685 25
particles.<br>
 The next several operations help to identify a threshold
correlation coefficient that describes true particles as opposed to
erroneously selected particles. Create histograms of each defocus
group that plots the number of particles vs. the cross correlation
value. For example, if the histograms display a bimodal
distribution, the higher peak may correspond to actual particles,
while the lower peak may show noise. The threshold should be chosen
between two such peaks.<br>
 Use: <i><a href=
"./newprogs/cchistogram.bat">cchistogram.bat</a></i>: to create: 

<ol>
<li><b>hist/cchist_***</b> Set of histograms by group</li>

<li><b>hist/cchist_all</b> Overall histogram</li>
</ol>

<br>
<br>
<p>View histograms with a <i>gnuplot</i>, e.g.: <i>gnuplot &gt;
load '<a href="./newprogs/plothist">plothist</a>'</i><br>
 <a href="pics/cchist.gif"><img width="200" height="150" src=
"pics/cchist.gif"></a></p>
</li>
d688 10
a697 9
 Use the <b>Montage from doc file</b> operation in <a href=
"../../../../web/docs/web.html">WEB</a> to display the aligned
particles identified in the selection doc file (sel001.ext for
example). The greater the correlation coefficient value, the more
similiar the particle will look to the reference projection.
Identify a minimum correlation coefficient that describes true
particles as opposed to erroneously selected particles. Select
<b>Compute Average</b> to view an average of the particles
displayed.</li>
d700 8
a707 7
 Use SPIDER procedure: <i><a href=
"./newprogs/ccthresh.bat">ccthresh.bat</a></i> to create a doc.
file: <b>thresh</b>. This doc. file contains:<br>
 'CC thresholds' for particles listed by defocus group.<br>
 A percent cutoff must be chosen. If a threshold of 0.40 is
selected, then the 40% of all particles havng the lowest
correlations will be eliminated</li>
d710 16
a725 23
 Use SPIDER procedure: <i><a href=
"./newprogs/dftotals.bat">dftotals.bat</a></i> to create a set of
particle selection files: <b>df***/seltotal</b>, which list the
particles with CC values greater than CC threshold which will be
used in the 3D reconstruction.</li>

<li>Check the distribution of reference views (angular
directions).<br>
 Use SPIDER procedure: <i><a href=
"./newprogs/plotview.bat">plotview.bat</a></i> to to plot the file
(<b>how_many.ext</b>) and create plot of number of particles vs
projection view using <i>gnuplot</i>.<br>
 This creates file: <b>jnkplot_how</b> which contains
<i>gnuplot</i> commands.</li>

<li style="list-style: none">
<p>Use SPIDER procedure: <i><a href=
"./newprogs/plotviews.bat">plotview.bat</a></i> to to plot the
files (<b>df***/how_many.ext</b>) and create plots of number of
particles vs projection view for each defocus group using
<i>gnuplot</i>.<br>
 This creates files: <b>jnkplot_how_***</b> which contain
<i>gnuplot</i> commands.</p>
d727 1
a728 3
<li style="list-style: none">
<p></p>
</li>
d731 2
a732 14
 Use SPIDER procedure: <i><a href=
"./newprogs/average.bat">average.bat</a></i> to create: 

<ol>
<li><b>avg/avg***</b> images containing average images for this
projection group.</li>

<li><b>avg/var***</b> images containing variance images for this
projection group.</li>
</ol>

<br>
<br>
 
d734 11
a744 3
<p>Use the <b>Montage</b> operation in <i><a href=
"../../../../web/docs/web.html">WEB</a></i> to view the set of
average images.</p>
d746 1
@


1.44
log
@xhtml
@
text
@d142 2
d205 2
d337 3
d496 2
d631 1
d933 2
@


1.43
log
@changed Particle directory to Particles
@
text
@d1 1
d3 4
a6 2
<head> <title>Single Particle Reconstruction Techniques</title> </head>

d8 4
d13 1
a13 2
<img width="108" height="103" src="pics/new11.jpg" align=left>
<img width="108" height="104" src="pics/new22.jpg" align=right><br>
a14 1
<h2 align="center">Three Dimensional Reconstruction</h2>
d16 1
a18 1
<p>
d21 4
a24 1
</p>
d26 6
a31 6
<p>
This page describes methods for creating a 3D reconstruction of a ribosome from 
electron micrographs. Once a set of particle images has been obtained, an initial 3D 
reconstruction is calculated using coarse projection angles. This is followed by 
refinement, which iteratively adjusts the angles for finer resolution. The following 
procedures are described in greater detail below.
d34 49
a82 2
<li> For each micrograph the <a href="#CTF">Contrast Transfer Function</a> (CTF) is 
estimated and the micrographs are placed in defocus groups.</li>
d84 6
a89 3
<li> Next, an <a href="#AUTO">automated particle selection</a> process identifies 
ribosome particles from the digitized electron micrographs, and extracts small 
images of individual particles.</li>
d91 2
a92 2
<li> The particle image series is then aligned relative to reference projections 
through shifts and rotations using the <a href="#SH">'AP SH'</a> command.</li>
d94 3
a96 2
<li>  <a href="#CA">Averages</a> of particles for each reference view are computed, 
to assess how evenly the projection views are distributed.</li>
d98 9
a106 2
<li> The initial <a href="#3D">3D reconstruction</a> is calculated, along with an 
estimate of resolution.</li>
d108 1
a108 3
<li> Angular <a href="#REF">refinement</a> gives each projection a chance 
"to find a better home"in terms of its orientation and phase origin, thus improving the 
resolution of the initial reconstruction.</li>
d110 3
a112 5
<li> Some <a href="#OTHER">other</a> useful methods, such as classification and 
difference maps, are described as well. Additional details about these methods may be 
found at the <a href="../../techniques.html">techniques</a> page.</li>
</ol>
</p>
d114 3
a116 3
<p>
<a href="./flowchart/flowchart.html">A flowchart of operations</a>
</p>
d118 1
a118 2
<p>
For further information:
d121 20
a140 1
<li><a href="../../ref.html">General references</a></li>
d142 23
a164 1
<li>Information about images from the <b><a href="zi/zidoc.html">ZI scanner</a></b></li>
d166 1
a166 2
<li>Batch files for circular images from <b><a href="quantifoil.html">Quantifoil grids</a>
</b>.</li>
d168 28
a196 4
</p>
The data below is sometimes shown plotted with <i>gnuplot</i>. An 
<a href="http://www.ucc.ie/gnuplot/gnuplot.html">online manual</a> for <i>gnuplot</i> is available. 
Much more about <i>gnuplot</i> is at <a href="http://www.gnuplot.info">Gnuplot Central</a>
a197 1
<p>
d199 17
d217 32
a248 2
<h3 align="center">Running SPIDER batch files</h3> 
</p>
d250 1
a250 7
<p> Processing steps are carried out by batch and procedure files, which run many SPIDER 
operations automatically. To use a procedure in this document, click the batch filename 
and copy the procedure to your current working directory. At the beginning of each procedure, 
there is a list of parameters that can be adjusted according to the particular project. 
Some of the procedures will call a corresponding procedure (listed below the procedure filename). 
You need not change anything in the procedures. Use the following format to run a SPIDER 
batch procedure:</p>
d252 5
a256 1
<p><center> <i>spider bat/dat @@proc</i> </center></p>
d258 1
a258 2
<p>where <b>bat</b> is the procedure file extension, <b>dat</b> is the project data file 
extension, and <b>proc.bat</b> is the procedure file. </p>
d260 3
a262 1
<p>
d265 24
d290 16
a305 22
   <li> The batch files below expect a specific directory structure. 
   These directories 
   can be created using the python script: 
   <a href="./newprogs/mkdirs.py">mkdirs.py</a>. 
 
   ALBANY USERS CAN JUST RUN THE SCRIPT WITHOUT DOWNLOADING IT:<br>
   Run the script at the unix prompt:<br>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>mkdirs.py pdr</code><br>
   where pdr is the three-letter name of your project directory.
   </li>

   <p> If you don't already have it, save the script using <b>Save Link As...</b> 
   (DO NOT cut and paste from the Web page - indentation matters in python). Then make 
   it executable with the unix command: <br>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>chmod 775 mkdirs.py</code>
</ul> 

<p> Some information may be stored in project-wide document files
that are used by many batch files. 
The following files should be run in the top-level project directory:</p>
 
<ul> 
d307 2
a308 134
   <p><li> Create a parameter document file. Batch files read
   project parameters from a doc file, created by the interactive
   procedure file <a href="./newprogs/makeparams.bat">makeparams.bat</a>.
   Run this procedure file in the top directory of your project and name
   the output file "params.dat", where <b>dat</b> is the project
   extension. <a href="./params.html"> The parameters are described
   here</a>.</li></p> 

   <p><li> Create a file specification document file. This file contains
   the numbers of the files to be processed in DO loops (the text part of
   the filenames are entered as templates in the top level batch files -
   see below). Use the interactive batch file 
   <a href="./newprogs/makefilelist.bat">makefilelist.bat</a> to create the
   doc file, called <b>"filenums.dat"</b>. If you need to exclude files from this
   list, use a text editor to delete the appropriate lines, then use the
   'DOC REN' command in SPIDER to renumber lines in the doc file.</li></p>

   <p><li> Create a <a href="#DEFGRPDOC">defocus group document file</a>.
   This step comes after you have segregated  micrographs into various
   defocus groups.</li></p>
</ul>

<p> Input files needed for a reconstruction project:</p>

<ul>
<p> <li> Files of the digitized micrographs should be in the <i>Micrographs</i> 
     directory.</li></p>

<p> <li> A reference volume is required. If the dimensions of your
     reference volume do not
     match the window size (key 17 in the parameter file), then you
     must resize the volume with <a
     href="newprogs/resizevol.bat">resizevol.bat</a>. This batch file
     should be run in the top-level project directory.</li></p>

   <p>
   <h4>After running each batch file, check the output files to make sure the results are 
   sensible. If you are not sure what is "sensible", ask an expert.</h4>
   </p>
</ul>

<hr>

<a name="CTF"></a> <h3 align="center">Contrast Transfer Function estimation</h3>

<p> These procedures should be run in the <i>Power_Spectra</i> directory.<br>
    Subdirectory: <i>power</i><br>
    The  micrographs should be in the <i>Micrographs</i> directory. <br>
    More information on the contrast transfer function may be found 
    <a href="../ctf/ctf.html">here</a>.</p> 

<ul>
   <p><li><p>Generate the CTF estimate of the power spectrum.<br>
   Use SPIDER procedure: <a href="./newprogs/power.bat">power.bat</a> 
   which calls: 
   <a href="./newprogs/power_p1.bat">power_p1.bat</a> and creates:

   <ol>
      <p><li><b>roo***</b> doc files.</li></p>

      <p><li>A series of 1D profiles of the 
            averaged power spectra named; <b>pw_ro***</b>.</li></p>

      <p><li><b>pw_avg***</b> power spectra, a series of averaged power spectra, 
            one for each micrograph.  Make a montage using 
            <a href="../../../../web/docs/web.html">WEB</a> 
            (reduction factor 4) to look at these power spectra.  They are 	
            equivalent to diffraction patterns obtained in the optical 
            diffractometer.  It is absolutely important that you screen these
            spectra before proceeding any further.  Things to look out for:
      <ul>
         <li>Are the Thon rings round?</li>
         <li>Do they extend to high resolution?</li>
      </ul>
      </p>

      You can discard micrographs that show one of the following artifacts:
      <ul> 
         <li>Rings that are cut off unidirectionally (evidence of drift)</li>
         <li>Rings that are elliptical, or even hyperbolic (evidence of astigmatism).</li>
      </ul>

      See this example:<p>
      <a href="pics/power.jpg"><img width=182 height=243  SRC="pics/power.jpg"></a></p>
   </ol>

</li></p>

<a name="DEF"></a>
<p><li>Determine defocus and amplitude contrast.<br>
   Use one of the following methods to determine defocus and 
   amplitude contrast:

   <ul>
   <p><li> <a href="./newprogs/tfed.bat">tfed.bat</a> Estimate defocus with SPIDER operation 
   <a href="../../man/tfed.html"><b>TF ED</b></a> which creates a <b>defocus</b> document file. <br>
   Uses procedure: <a href="./newprogs/calcparms.bat">calcparms.bat</a> that 
   checks values in the <a href="./params.html">parameter file</a>.</li></p>

   <p><li> <a href="../../../../web/docs/ctf.html">CTF from doc file</a> in <b>WEB</b>.</li></p>

   <p><li> <a href="defdoc.html"><b>def</b></a> : a procedure for estimating defocus. 
   <a href="./newprogs/def.bat">def.bat</a>: Estimate defocus. Creates <b>defocus</b> document file.
   See the <a href="defdoc.html">def manual page</a> for more information.</li></p>

   <p><li> The MRC program <b>ctffind2</b> : estimates both the defocus and astigmatism.
   <a href="./newprogs/mrc.bat">mrc.bat</a>: SPIDER batch file. Also creates 
   <b>defocus</b> file. It calls:
   <a href="./newprogs/ctffind">ctffind</a>: a shell script, and 
   <a href="./newprogs/readmrc.py">readmrc.py</a>: a python script. 
   See the <a href="defmrc.html">defmrc manual page</a> for more information.</li></p>
   </ul>
</li></p>

<p><li>Assign defocus groups according to the power spectrum.<br>
   Both <a href="./newprogs/def.bat">def.bat</a> and <a href="./def/mrc.bat">mrc.bat</a> 
   create a document file called defocus.ext,
   which has the defocus listed for each micrograph. You can assign
   micrographs to defocus groups with
   <a href="./newprogs/defsort.bat">defsort.bat</a>: create defocus groups. 
   Output in <b>def_sort</b> doc file.

   This is only a starting point, however. You should manually inspect
   the defocus groupings to see which micrographs belong together.
   Plot the power spectrum for each micrograph in <i>gnuplot</i> and
   assign the defocus groups such that the curves are in phase.
	
   Gnuplot commands can be saved in a text file, such as 
   <a href="./newprogs/plotpower">plotpower</a>,
   then run in <i>gnuplot</i> using the <i>load</i> command:
		
   <i>gnuplot gnuplot ;&gt; load 'plotpower'</i><p>
   <a href="pics/plotpower1.gif"><img width="200" height="150" src="pics/plotpower1.gif"></a>
<p>
d311 5
a315 6
   When you have finalized the values in def_sort.ext, compute the 
   averages for each defocus group:<br>
   <a href="./newprogs/defavg.bat">defavg.bat</a> creates 2 doc files of defocus group 
   averages: 
   <b>def_avg</b> and <b>order_defgrps</b>.
<p>
d317 1
a317 1
<!--
d324 1
d327 1
a328 1
<a name="AUTO"></a>
d331 5
a335 3
<p> These procedures should be run in the <i>Particles</i> directory.</br>
Subdirectories: <i>coords, good, win, flt</i>
<p>
d337 83
a419 106
   There are 2 alternative methods:
   <ol>
   <p><li>Use a noise image from a previous project (this is the easier way).
   The window sizes do not need to match. </p></li>

   <p><li>Convert a scanned micrograph file to a SPIDER image file:
   <a href="./newprogs/convert.bat">convert.bat</a>
   <a href="./newprogs/convert_p1.bat">convert_p1.bat</a>
   Works for micrographs scanned using Perkin Elmer, HiScan or ZI scanners.</p></li>
   </ol>
</p></li>

<p><li>Create or obtain a noise image.<br>
   A noise image is required to normalize the backgrounds of the particle 
   images. Either
   <ol>
   <p><li>Obtain a noise image from from a previous project.</p></li>
 
   <p><li>Create one with the batch file: 
         <a href="./newprogs/noise.bat">noise.bat</a> which creates a set of noise
        images:  <b>tmpnoise/noi***</b>.  You can view them in <b>Web</b> to select 
        one as a background noise image.</p></li>
   </ol>
</p></li>

<p><li>Run automatic phase of particle selection.<br>
    Either of the following two
   approaches can be used. They both require the converting procedure 
   <a href="./newprogs/convert_p1.bat">convert_p1.bat</a>

   <ol>
   <p><li>Correlation with a Gaussian blob</li>

    The micrographs are decimated by 1/4, Fourier filtered with a
    Gaussian low pass filter, and searched for peaks over regions
    corresponding to particle dimensions. Particles are windowed out,
    centered, peak locations are corrected, and particles are windowed
    again. This procedure uses histogram equalization.

    <a href="./newprogs/pick.bat">pick.bat</a> : The top level batch file.
    <a href="./newprogs/pick_p1.bat">pick_p1.bat</a> : procedure called by pick.bat. 
    These procedures output a 
    set of particle images and 2 sets of doc files:
        <b>win/ser*****</b> serial files of windowed particles,,
        <b>coords/ndc***</b> peak coordinates from 1/4 decimated image,
        <b>coords/sndc***</b> top left pixel coordinates for particle images.</p></li>

    <p><li>Local Fast Correlation Function</li>(B.K. Rath and J. Frank, Journal of Structural Biology, Volume 145, 
    Issues 1-2, January 2004, Pages 84-90).
    This procedure uses <a href="../../partpick.html#LFC">local cross-correlation</a> 
        calculated using Fourier 
    methods outlined by Alan Roseman (<i>Ultramicroscopy</i>, Vol 94 (3-4), (2003),
    225-236). A 3D reference volume is required as input to generate 
    projections at desired Eulerian angles for searching different 
    orientations of the search image in the micrograph. 

    <a href="./newprogs/lfc_pick.bat">lfc_pick.bat</a> : The top level batch file.
    <a href="../../../proc/pickparticle.spi">pickparticle.bat</a> : procedure called 
    by lfc_pick.bat. These procedures 
    output a set of particle images and a set of doc files:
        <b>win/ser*****</b> serial files of windowed particles,,
        <b>coords/sndc***</b> top left pixel coordinates for particle images.</p></li>
    </ol>
</p></li>

<p><li>Determine the particle numbers corresponding to each micrograph.<br>
	This reports the range of particle numbers associated with
	each micrograph so that verification of particles can be 
	carried out for each individual micrograph. 
	<a href="./newprogs/pnums.bat">pnums.bat</a> creates doc file <b>order</b></p></li>

<a name="PFILT"></a>
<p><li>[<b>Optional</b>] Low-pass filter the particle images before 
        particle selection.<br>
	Manual selection of good particles (the next step) is easier
	if the particles have been filtered beforehand. This creates a second
	set of particle images. Use the filtered particles, not the raw 
	particles, during selection in <a href="../../../../web/docs/web.html">WEB</a>.
	<a href="./newprogs/pfilt.bat">pfilt.bat</a> : Filter a set of images, adjusting 
         filter settings for 
	each micrograph. output: filtered particles <b>flt/ser*****</b>.
	<a href="./newprogs/pfilt2.bat">pfilt2.bat</a> a simpler version to filter a set 
         of particles.</p></li>

<p><li>Verify automatically selected particles.<br>
	Sort through the output files to eliminate any non-particles.  
	This is accomplished in <a href="../../../../web/docs/web.html">WEB</a> using the 
        <b>Categorize from sequential montage</b> command.  When the particle image files are
	displayed on the screen, use the mouse to click on each good particle.
	The particle numbers are saved to a file. For a project with multiple
	defocus settings, save the good particle numbers from each micrograph
	in individual files (more details at <a href="../../partpick.html">partpick.html</a> 
        and the <a href="../../faq.html#pick">SPIDER FAQ</a>).

	The output of this procedure should be a set of <b>good/good***</b> document
	files, one for each micrograph.</p></li>
	
<p><li>Remove any duplicated particles.<br>
	When manually selecting particles in <a href="../../../../web/docs/web.html">WEB</a>, 
        sometimes a particle is
	accidently double clicked. This procedure will delete the appropriate
	lines from the file. The doc file then needs to be adjusted so 
	that the image numbers are in ascending order with sequential 
	key numbers.
	<a href="./newprogs/renumber.bat">renumber.bat</a> creates <b>good/ngood***</b> 
         doc files.</p></li>
d421 57
d481 1
a482 1
<a name="SH"></a> 
d485 64
a548 3
<p>These procedures should be run in the <i>Alignment</i> directory.<br>
Subdirectories: <i>ali, prj</i>
</p>
d551 6
d558 2
a559 7
<p><li><p>Create reference projections for alignment from a <u>reference volume</u>.<br>
        Reference projections are views of the ribosome at known angles.
        In what follows angular accuracy is set to 15 degrees, which results in 83 
	reference projections.
        A preexisting reference volume is needed to create the projections. The row and column 
        dimensions 
	of the reference volume must match the dimensions of the particle windows.</p>
a560 63
       <p>If you are reconstructing from multiple defocus groups, use:
           <i><a href="./newprogs/refprojctf.bat">refprojctf.bat</a></i>. <br>   
        Otherwise, if there is only a single group use: 
           <i><a href="./newprogs/refproj.bat">refproj.bat</a></i> </p> 

        <p>These procedures will create the following files:
        <ol>
           <li><b>prj/prj****</b> images of the 2D projections</li>
           <li><b>refangles</b> doc file with 3 Euler angles for each of the 
                  83 projections.</li>
	   <li><b>projlist</b>  list of 83 projection numbers,</li>
        </ol></p>

</li></p>

<p><li><p>Create lists of all images in each defocus group. <br>
          SPIDER procedure: 
          <i><a href="./newprogs/sel_by_group.bat">sel_by_group.bat</a></i> 
          creates lists of all original sample images by defocus group in:  
          <b>part_by_group_***</b> 
</li></p>

<p><li><p>Align the particles to the reference projections.<br> 

        If you have multiple defocus groups and you used <i>refprojctf.bat</i> above,
        edit and run one of the following procedures.
        <ul>
	   <li> <i><a href="./newprogs/apshctf.bat">apshctf.bat</a></i> (not using PubSub)</li>
           <li> <i><a href="./newprogs/pub_apshctf.bat">pub_apshctf.bat</a></i> (using PubSub).</li>
        </ul> </p> 

        <p>If you have a single defocus group and you used <i>refproj.bat</i> above, 
        edit and run one of the following procedures.
        <ul>
           <li> <i><a href="./newprogs/apsh.bat">apsh.bat</a></i>  (not using PubSub)</li> 
           <li>  <i><a href="./newprogs/pub_apsh.bat">pub_apsh.bat</a></i> (using PubSub).</li>
        </ul> </p> 

        <p>These procedures create a set of document files: <b>align_01_***</b> containing
         the shift and rotation parameters for the best matched projection. 
 </p></li><p>

<p> <li>Rotate and shift particles according to alignment parameters.<br>
       Use: <i><a href="./newprogs/alignsh.bat">alignsh.bat</a></i> to create: 
          <b>ali/sar*****</b>, 
         aligned versions of the particle images.<br>
         (If the particles are mirrored in the <b>align_01_***</b> alignment document file from
         <a href="../../man/apsh.html"><b>AP SH</b></a>, they have been mirrored after 
          they are rotated & shifted.)</li><p>

<p> <li> Alternative obsolete alignment routines for use with:
      <a href="../../man/apmq.html">AP MQ</a>
      <ul> 
      <li><a href="./newprogs/docmq2sh.bat">docmq2sh.bat</a><br>
                   (converts <a href="../../man/apmq.html">AP MQ</a> alignment
                    output files which are listed by defocus group to 'AP SH' format)</li>
      <li><a href="./newprogs/docmq_old_2sh.bat">docmq_old_2sh.bat</a><br>
                   (converts <a href="../../man/apmq.html">AP MQ</a> alignment
                    output which are listed by micrograph to 'AP SH' format)</li>
      <li><a href="./newprogs/apmq.bat">apmq.bat</a> <br>
          <a href="./newprogs/apmqctf.bat">apmqctf.bat</a> <br>
      </ul></b>
</li><p>
d562 43
d606 1
d608 5
d614 1
a615 1
<a name="CA"></a> 
d618 75
a692 2
<p>These procedures should be run in the <i>Reconstruction</i> directory.<br>
Subdirectories: <i>select, hist, avg, display</i>
d694 61
d756 3
a758 2
<p>
<ul>
d760 3
a762 7
<p> <li>Convert alignment parameter files (if necessary).<br>
     If you have used the obsolete alignment operation:
    <i><a href="../../man/apmq.html">AP MQ</a></i> use :
    <i><a href="./newprogs/docmq2sh.bat">docmq2sh.bat</a></i> or
    <i><a href="./newprogs/docmq_old_2sh.bat">docmq_old_2sh.bat</a></i>
     to convert the alignment output files to 'AP SH' format 
     before continuing. </li><p>
d764 2
a765 4
<p><li>Combine all alignment parameter files into a single summary file.<br>
     Use SPIDER procedure: <i><a href="./newprogs/combine.bat">combine.bat</a></i> to 
       create: <b>align_01_all</b> containing: merged alignment parameters from all
       defocus groups. </li></p>
d767 23
a789 116
<p><li>Determine number of particles in each defocus group.<br>
    Use SPIDER procedure: <i><a href="./newprogs/ordefocus.bat">ordefocus.bat</a></i>: 
    to create a doc. file: <b>order_defocus</b> containing: <br>
    Number of particles, Cumulative number of particles, and 
    Average defocus value for each group. </li></p>
  
<p><li>Compare aligned particles to reference projections.<br>
    After editing the correlation coefficient (CC) threshold to select the desired similarity
    threshold, use SPIDER procedure: <i><a href="./newprogs/select.bat">select.bat</a></i>
    to create the following files:<br>
     <ol>
    <p><li>A set of doc. files: <b>df***/how_many</b> (one for each reference view for that
               defocus group) 
              listing  number of particles associated with that view.<br>
             </li></p>
    
     <li>A set of doc. files: <b>df***/select/sel???</b> (one for each view), 
              listing particles which are associated with each of the 
              reference views and their CC values.</li></p>

    <p><li>An overall summary file: <b>how_many</b> listing sum of all the 
             <i>df***/how_many</i> files.</li></p>
    </ol>
    </li></p>

	
<p><li>Identify a threshold correlation coefficient for selecting true particles.<br>
        The next several operations help to identify a threshold correlation
	coefficient that describes true particles as opposed to erroneously
	selected particles. Create histograms of each defocus group that
	plots the number of particles vs. the cross correlation value. For 
	example, if the histograms display a bimodal distribution, the higher 
	peak may correspond to actual particles, while the lower peak may show
	noise. The threshold should be chosen between two such peaks.<br>
	Use: <i><a href="./newprogs/cchistogram.bat">cchistogram.bat</a></i>: 
        to create:
            <ol>
            <li> <b>hist/cchist_***</b> Set of histograms by group</li>
            <li> <b>hist/cchist_all</b> Overall histogram</li>
            </ol>
        </p><p>
	View histograms with a <i>gnuplot</i>, e.g.:
	<i> gnuplot &gt; load '<a href="./newprogs/plothist">plothist</a>'</i><br>
	<a href="pics/cchist.gif"><img width="200" height="150" src="pics/cchist.gif"></a>
        </li></p>

	
<p><li>View the particles corresponding to each reference view.<br>
	Use the <b>Montage from doc file</b> operation in 
        <a href="../../../../web/docs/web.html">WEB</a> to
	display the aligned particles identified in the selection 
	doc file (sel001.ext for example). The greater the correlation 
	coefficient value, the more similiar the particle will look to 
	the reference projection. Identify a minimum correlation 
	coefficient that describes true particles as opposed to 
	erroneously selected particles. Select <b>Compute Average</b> 
	to view an average of the particles displayed.</li></p>
	
<p><li>Compute correlation thresholds for discarding particles. <br>
       Use SPIDER procedure: <i><a href="./newprogs/ccthresh.bat">ccthresh.bat</a></i>  
       to create a doc. file: <b>thresh</b>.  This doc. file contains: <br>
       'CC thresholds' for particles listed by defocus group.<br>

	A percent cutoff must be chosen. If a threshold of 0.40 is selected, 
	then the 40% of all particles havng the lowest correlations will be eliminated</li></p>

<p><li>Select particles above the correlation thresholds. <br>
       Use SPIDER procedure: <i><a href="./newprogs/dftotals.bat">dftotals.bat</a></i> to
       create a set of particle selection files: <b>df***/seltotal</b>, which list the particles 
       with CC values greater than CC threshold which will be used in the 3D reconstruction.</li></p>

<p><li>Check the distribution of reference views (angular directions).<br> 
        Use SPIDER procedure: <i><a href="./newprogs/plotview.bat">plotview.bat</a></i> to
       	to plot the file (<b>how_many.ext</b>) and create plot of number of  
	particles vs projection view using <i>gnuplot</i>.<br>
        This creates file: 
        <b>jnkplot_how</b> which contains <i>gnuplot</i> commands.</li>
         </p> <p>


        Use SPIDER procedure: <i><a href="./newprogs/plotviews.bat">plotview.bat</a></i> to
       	to plot the files (<b>df***/how_many.ext</b>) and create plots of number of  
	particles vs projection view for each defocus group using <i>gnuplot</i>.<br>
        This creates files: <b>jnkplot_how_***</b> which contain <i>gnuplot</i> commands.</li>
         </p> <p>

<p><li>Create average images for all 83 projection groups.<br>
        Use SPIDER procedure: <i><a href="./newprogs/average.bat">average.bat</a></i> to
        create: 
        <ol>
        <li><b>avg/avg***</b> images containing average  images for this projection group.</li>
        <li><b>avg/var***</b> images containing variance images for this projection group.</li>
        </ol></p> <p>

	Use the <b>Montage</b> operation in 
        <i><a href="../../../../web/docs/web.html">WEB</a></i> 
        to view the set of average images.</li></p>

<p><li>Create an image showing the distribution of angular projection directions.<br>
	Use: <i><a href="./newprogs/display.bat">display.bat</a></i>, <i><a href="./newprogs/display_p.bat">display_p.bat</a></i> to create
        a plot in which the 83 angular groups are represented by small circles: 
        <b>display/cndis***</b>.  The radii of these circles are
	proportional to the number of particles in each group.<br>

	Use the <b>Montage</b> operation in 
        <a href="../../../../web/docs/web.html">WEB</a> to
	display the plots.</li></p>

<p><li>Limit strongly over-represented angular projections.<br>
        In case of strong over-representation of some of the angular
	directions, use:
	<i><a href="./newprogs/b19.eqp">b19.eqp</a></a></i> to limit the
        numbers of images per direction to a certain number. <br>
        Alternatively to keep half of the best per direction, but no more
        than specified number, use:
	<i><a href="./newprogs/b19.eqs">b19.eqs</a></i></li></p>
d791 1
d793 2
a795 3
<p><i>To further investigate particle classification go to 
       </i><b><a href="#OTHER">Other Useful Methods</a></b></p>

d797 1
a798 1
<a name="3D"></a> 
d801 68
a868 1
<p>These procedures should also be run in the <i>Reconstruction</i> directory.</p>
d870 2
d873 42
a914 63
<p> <li>Split selection file.<br>
        Use: <i><a href="./newprogs/oddeven.bat">oddeven.bat</a></i> 
        to split the selection file to be used in reconstruction into two separate selection
	files to be used in the following two 3D reconstructions for 
	comparative purposes.<br>
        This procedure creates two sets of selection doc. files:
        <ol>
        <li> <b>df***/seleven</b> </li>
        <li> <b>df***/selodd </b> </li>
        </ol></li></p>

<p> <li>Compute two half-reconstructions for each defocus group.<br>
        Use: <i><a href="./newprogs/bpoddeven.bat">bpoddeven.bat</a></i> to
        compute two half reconstructions, each using half of the available particles.<br>

        This procedure creates two sets of image volumes:
        <ol>
        <li> <b>df***/vol001_odd</b> </li>
        <li> <b>df***/vol001_even</b> </li>
        </ol></li></p>

<p> <li>[<b>Optional</b>] Compute the overall 3D reconstruction for each defocus group.<br>
	Use: <i><a href="./newprogs/bpall.bat">bpall.bat</a></i> to create a set of image volumes: 
        <b>df***/vol001</b>.</li></p>

<p> <li>Compare the two half volumes.<br>
	Use: <i><a href="./newprogs/fsc.bat">fsc.bat</a></i> to create a set of
        document files: <b>df***/doccmp001</b> containing the FSC curves.</li></p>

<p> <li>Compute the combined resolution of all defocus groups.<br>  
	Use: <i><a href="./newprogs/ctf.bat">ctf.bat</a></i> to create:
        <ol>
           <li> <b>combires</b> combined resolution doc file</li>
           <li><b>vol001</b> the 3D structure from the entire set of particles. </li>
        </ol>
        This structure is known as the 
	<i>initial volume</i> and will be used as the input for the Refinement step.</li></p>

<p> <li>Determine resolution<br>
        Determine where the Fourier shell correlation drops below threshold
	(either 0.5 or 0.15), and at this point, identify the corresponding 
	spatial frequency. Then, resolution = pixel size/spatial frequency.<br>
	Use: <i><a href="./newprogs/res.bat">res.bat</a></i> 
        to create the doc file:
        <b>resolution</b>, which contains the cutoff, the
	corresponding normalized frequency, and the resolution (in Angstroms).</li></p>

<p> <li>Plot the resolutions.<br>
        Plot the combined resolution together with the resolution of 
	each defocus group.<br>	
	Use: <a href="./newprogs/plotres.bat">plotres.bat</a> to view the resolution curves in gnuplot. Gnuplot commands are written to the file <i>plot_res</i>, which can be viewed with the command <i>load 'plot_res'</i> in gnuplot.
	<p>
        <a href="pics/plotres2.gif"><img width=200 height=150  SRC="./pics/plotres2.gif"></a></li></p>	

<p> <li>Filter the initial volume.<br>
        Information at spatial frequencies 
	above the cut-off value are considered to be uncorrelated noise, and 
	must be filtered out. <br>        
        Use: <i><a href="./newprogs/filt.bat">filt.bat</a></i> to filter the initial volume, 
        <b>volfq001</b>.<br> 
        Use the <b>Surface</b> operation in
        <i><a href="../../../../web/docs/web.html">WEB</a></i> 
         to view the filtered volume.</li></p>
d916 1
a917 1
<p>
d920 24
a943 7
These procedures should be run in the <i>Refinement</i> directory.<br>
Subdirectories: <i>input, final</i>
<p> 
<b>Refinement is a computationally expensive operation.</b> Before running the 
refinement batch files, check the results of the above reconstructions, to ensure that 
<u>all</u> defocus groups have reasonable particle volumes.
</p>
d945 4
a948 31
<p><li>Create a document file summarizing the selected particles.<br>
	Use: <i><a href="./newprogs/ordselect.bat">ordselect.bat</a></i> 
        to create: <b>order_select</b>,  a doc file similar to 
            <b>order_defocus</b>
            containing the number of particles in each group remaining after applying
            the cross correlation cut-off, and the ctf value for each group.</li>
        </li></p>

<p><li>Prepare the data file stacks.<br>
        Use: <i><a href="./newprogs/stack.bat">stack.bat</a></i> to create:
        <ol>
        <li> <b>input/data***</b> a set of image stack files that contain all the 
             selected original particles.</li>
        <li> <b>input/dala***</b> a set of image stack files that contain all the 
             selected aligned particles.</li>
        </ol> </li></p>

<p><li>Prepare the alignment parameter files.<br>
        Use: <i><a href="./newprogs/sel_align.bat">sel_align.bat</a></i> 
             to create:
         <b>input/align_01_***</b> a set of doc files that contain all the 
            selected alignment parameters.
          </p>

<p><li><a href="./refine.html">Refinement</a></li></p>

<p><li>[<b>Optional</b>] View angular data output from Refinement batch files.<br>
	Use: <i><a href="./newprogs/angdisp.bat">angdisp.bat</a></i> to create:
       <b>disp001</b>, an image showing angular positions from the:
       <b>align_**_***</b> refined alignment parameter output files.
       </p></li></p>
d950 17
d968 1
d971 1
a972 1
<a name="OTHER"></a>
d975 2
a976 1
<a name="DIF"></a><h3 align="center">Difference Maps</h3>
d978 11
a988 3
<p>Differences between volumes can be assessed by subtracting one volume from the other; 
the result is a <i>difference map</i>. Before subtracting volumes, make sure they are 
properly aligned.</p>
d990 2
a991 5
<p><li>Check alignment of two volumes.
	<a href="./newprogs/shiftvol.bat">shiftvol.bat</a> uses 
        <a href="../../man/cc.html">CC</a> and 
        <a href="../../man/pk3.html">PK 3</a> to determine
	if volumes are shifted relative to each other. </li></p>
d993 2
a994 2
<p><li>Ligands can be isolated by creating a difference map.
	<a href="./newprogs/diffmap.bat">diffmap.bat</a> </li></p>
d996 1
a996 4
<p><li>There are alternative methods for identifying 
    <a href="../isolate.html">differences between volumes</a>. </li></p>


d998 1
a999 1
<a name="Class"></a>
d1002 5
a1006 6
<p>This method can be used to investigate differences between particles.
Aligned particles are grouped according to associated view and then 
subdivided into classes within each view based on similiarity. </p> 
                                                             
<p><li>Copy each particle into its associated view subdirectory (1-83): 
	<a href="./newprogs/b50.grp">b50.grp</a></li></p>
d1008 2
a1009 2
<p><li>Run correspondence analysis for each of the 83 views: 
	<a href="./newprogs/b51.csi">b51.csi</a></li></p>
d1011 2
a1012 2
<p><li>Classification: 
	<a href="./newprogs/b53.clk">b53.clk</a></li></p>
d1014 3
d1018 1
a1018 4
                                                            
<p>
<a name="XRAY"></a>
<h3 align="center">Frequency amplitude correction with X-ray scattering data</h3>
d1020 3
a1022 2
<p><li><a href="./xray/xray.html">Amplitude correction documentation and batch 
        files</a></li></p>
d1024 2
a1025 1
<p><li><a href="./xray/old/enh.html">Older batch files</a></li></p>
d1027 1
d1031 2
a1032 6

<p><small>
Source: mr.html   &nbsp;&nbsp;&nbsp;
Updated: 6/02/04  &nbsp;&nbsp;&nbsp;
</small>
<p>
d1034 1
a1034 3
<small><address>&copy; <a href="../../copyright.html"> 
Copyright notice</a>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a> </address></small></a>
d1036 3
@


1.42
log
@added Subdirectories under each Directory heading
@
text
@d275 1
a275 1
<p> These procedures should be run in the <i>Particle</i> directory.</br>
@


1.41
log
@added automated pick particle reference
@
text
@d165 1
d275 3
a277 2
<p> These procedures should be run in the <i>Particle</i> directory.</p>

d393 3
a395 1
<p>These procedures should be run in the <i>Alignment</i> directory.</p>
d478 2
a479 1
<p>These procedures should be run in the <i>Reconstruction</i> directory.</p>
d481 1
d696 2
a697 2
These procedures should be run in the <i>Refinement</i> directory.

@


1.40
log
@moved res.bat ahead of plotres.bat
@
text
@d324 2
a325 1
    <p><li>Local Fast Correlation Function</li>
@


1.39
log
@changed plotres2 to plotres.bat
@
text
@a658 7
<p> <li>Plot the resolutions.<br>
        Plot the combined resolution together with the resolution of 
	each defocus group.<br>	
	Use: <a href="./newprogs/plotres.bat">plotres.bat</a> to view the resolution curves in gnuplot. Gnuplot commands are written to the file <i>plot_res</i>, which can be viewed with the command <i>load 'plot_res'</i> in gnuplot.
	<p>
        <a href="pics/plotres2.gif"><img width=200 height=150  SRC="./pics/plotres2.gif"></a></li></p>	

d667 7
@


1.38
log
@alignsh.pam changed
@
text
@d660 1
a660 1
        Use <i>gnuplot</i> to plot the combined resolution together with the resolution of 
d662 1
a662 1
	<i>gnuplot load '<a href="./newprogs/plotres2">plotres2</a>'</i></p>
@


1.37
log
@added link to display_p.bat
@
text
@d559 1
a559 1
       create a set of selection files: <b>df***/seltotal</b>, which list the particles 
d567 1
a567 1
        <b>jnkplot_how</b> Containing <i>gnuplot</i> plot instructions.</li>
d574 1
a574 1
        This creates files: <b>jnkplot_how_***</b> Containing <i>gnuplot</i> plot instructions.</li>
d634 1
a634 1
        compute two half reconstructions , each using half of the available particles.<br>
@


1.36
log
@plotview
@
text
@d590 1
a590 1
	Use: <i><a href="./newprogs/display.bat">display.bat</a></i> to create:
@


1.35
log
@minor text changes
@
text
@d69 3
a71 3
The data below is sometimes shown plotted with gnuplot. An 
<a href="http://www.ucc.ie/gnuplot/gnuplot.html">online manual</a> for gnuplot is available. 
Much more about gnuplot is at <a href="http://www.gnuplot.info">Gnuplot Central</a>
d242 1
a242 1
   Plot the power spectrum for each micrograph in gnuplot and
d247 1
a247 1
   then run in gnuplot using the <i>load</i> command:
d532 1
a532 1
	View histograms with a gnuplot, e.g.:
d563 13
a575 4
	Use <i>gnuplot</i> to plot the output file containing the number of views vs associated 
	particles. There is a combined data set (<b>how_many.ext</b>), as well as
	individual files for each defocus group (<b>df***/how_many.ext</b>).<br>
	<i>gnuplot plot 'how_many.ext' using 1:3 with boxes</i></li></p>
@


1.34
log
@*** empty log message ***
@
text
@d114 2
a115 1
that are used by many batch files:</p>
@


1.33
log
@stack.bat changed
@
text
@d206 3
a208 2
<p><li>Determine defocus and amplitude contrast, using one of the following 
       methods:
d231 1
a231 1
<p><li>Assign defocus groups according to the power spectrum.
d252 2
a253 1
<li>When you have finalized the values in def_sort.ext, compute the 
d275 2
a276 1
<li>Select a background noise file. There are 2 alternative methods:
d288 2
a289 1
<p><li>A noise image is required to normalize the backgrounds of the particle 
d301 2
a302 1
<p><li>Run automatic phase of particle selection. Either of the following two
d325 1
a325 1
calculated using Fourier 
d340 1
a340 1
<p><li>Determine the particle numbers corresponding to each micrograph.
d347 2
a348 1
<p><li>[<b>Optional</b>] Low-pass filter the particle images before particle selection.
d359 1
a359 1
<p><li>Verify automatically selected particles.
d372 1
a372 1
<p><li>Remove any duplicated particles.
d780 1
a780 1
Updated: 6/01/04  &nbsp;&nbsp;&nbsp;
@


1.32
log
@stack.bat changed
@
text
@d653 3
a655 2
	spatial frequency. Then resolution = pixel size/spatial frequency.<br>
	Use: <i><a href="./newprogs/res.bat">res.bat</a></i> to create the doc file:
d681 7
a687 7
<p><li>Create a document file of the selected particles.<br>
	Use: <i><a href="./newprogs/ordselect.bat">ordselect.bat</a></i> to create:
        <ol>
        <li><b>order_select</b>,  a doc file similar to <b>order_defocus</b>
            containing only the particles selected with the cross correlation cut-off.</li>
        <li> <b>ctfs</b> a doc file with defocus group averages.</li>
        </ol> </li></p>
d689 1
a689 1
<p><li>Prepare the data files.<br>
d692 1
a692 1
        <li> <b>input/data***</b> set of stack files that contain all the 
d694 1
a694 1
        <li> <b>input/dala***</b> set of stack files that contain all the 
d698 1
a698 1
<p><li>Prepare the alignment paramater files.<br>
d701 2
a702 2
         <b>input/align_01_***</b> set of stack files that contain all the 
            selected alignment paramaters.
d774 1
a774 1
Updated: 4/19/04  &nbsp;&nbsp;&nbsp;
@


1.31
log
@changes for 'ap sh'
@
text
@a604 5
<p> <li>Create new limited selection file of particles.<br> 
        If the number of particles in a view was limited, use
	<i><a href="./newprogs/b21.new">b21.new</a></i>
        to create a new selection file for particles. </li></p>

d613 1
a613 1
        <li> <b>df***/selodd</b> </li>
d691 4
a694 2
        <li> <b>data***</b> set of stack files that contain all the original particles.</li>
        <li> <b>dala***</b> set of stack files that contain all the aligned particles.</li>
d697 7
d709 2
a710 1
       <b>align_**_***</b> refined alignment parameter output files.</p></li></p>
@


1.30
log
@	bprp.bat
@
text
@d391 1
a391 1
        A preexisting reference volume is needed to create the projections. The NSAM and NROW 
d395 4
a398 6
        <p>If you are reconstructing from multiple defocus groups, reference 
        projections can be generated for each defocus group with the 
        following procedure file: 
        <i><a href="./newprogs/refprojctf.bat">refprojctf.bat</a></i>.    
        Otherwise if there is only a single group use: 
        <i><a href="./newprogs/refproj.bat">refproj.bat</a></i> </p> 
d402 4
a405 4
        <li><b>prj/prj****</b> images of the 2D projections</li>
        <li><b>refangles</b> doc file with 3 Euler angles for each of the 
               83 projections.</li>
	<li><b>projlist</b>  list of 83 projection numbers,</li>
d410 26
a435 18
<p><li><p>
Align the particles to the reference projections.<br> 
     This is a multireference alignment of an image series.
        If you used <i>refproj.bat</i> above, edit
             <i><a href="./newprogs/apsh.bat">apsh.bat</a></i>  (or 
             <i><a href="./newprogs/pub_apsh.bat">pub_apsh.bat</a></i> if you are 
             using PubSub) to specify the various input parameters. <br>

	Alternatively, if you used <i>refprojctf.bat</i> above, for multiple 
        defocus settings, edit and run one of the following procedures instead.
	<i><a href="./newprogs/apshctf.bat">apshctf.bat</a></i> (or 
        <i><a href="./newprogs/pub_apshctf.bat">pub_apshctf.bat</a></i> if you 
        are using PubSub). <br>  

        These procedures create <b>align01_***</b> doc files with alignment data.
        The output document files describe the shift and rotation parameters for the
	best matched projection.  You should not need to alter the 
        file-names.</p></li><p>
d441 1
a441 1
         (If the particles are mirrored in the <b>align01_***</b> alignment document file from
d450 4
a453 1
                    output files to 'AP SH' format)</li>
d471 7
a477 4
<p> <li> If you have used the obsolete alignment operation:
      <a href="../../man/apmq.html">AP MQ</a> use :
    <a href="./newprogs/docmq2sh.bat">docmq2sh.bat</a> to convert the alignment
                    output files to 'AP SH' format before continuing. </li><p>
d480 3
a482 3
     Use: <i><a href="./newprogs/combine.bat">combine.bat</a></i> to 
       create: <b>docapsh</b> containing: merged alignment parameters with
       image numbers as the keys. </li></p>
d487 2
a488 2
    Total particles in each group, Cumulative total of particles, and 
    avg. defocus value for each group. </li></p>
d491 3
a493 2
    SPIDER procedure: <i><a href="./newprogs/select.bat">select.bat</a></i>
    creates:<br>
d495 1
a495 5
     <li>A set of doc.  files: <b>df***/select/sel</b> (one for each defocus group), 
              listing particles which are 
              associated with each of the reference views.</li></p>

    <p><li>A set of doc.  files: <b>df***/how_many</b> (one for each reference view for that
d498 1
a498 3
              The correlation coefficient describes the relative similiarity 
              of the particle to the reference projection. Use 0 for the 
              correlation coefficient threshold to include all particles.</li></p>
d500 4
d510 2
a511 1
<p><li>The next several operations help to identify a threshold correlation
d517 10
a526 6
	noise. The threshold should be chosen between two such peaks.
	Use: <a href="./newprogs/cchistogram.bat">cchistogram.bat</a>: 
        to create histogram files <b>hist/cchist</b>.<br>

	View histograms with a gnuplot file:
	<i>gnuplot gnuplot &gt; load '<a href="./newprogs/plothist">plothist</a>'</i><br>
d531 3
a533 3
<p><li>View the particles corresponding to each reference view.
	In <a href="../../../../web/docs/web.html">WEB</a>, use the 
         <b>Montage from doc file</b> operation to
d542 5
a546 1
<p><li>Thresholds may be computed automatically. 
d548 6
a553 11
	then 40% of all particles will be eliminated, using particles with 
	the lowest correlations. A correlation threshold is determined for 
	each defocus group.
	<a href="./newprogs/ccthresh.bat">ccthresh.bat</a> creates <b>thresh</b>, 
        a doc file with CC thresholds
	<a href="./newprogs/ccthresh_p.bat">ccthresh_p.bat</a></li></p>

<p><li>After deciding on a correlation coefficient threshold, use:
       <a href="./newprogs/dftotals.bat">dftotals.bat</a> to
       create a selection file: <b>df***/seltotal</b>, which lists the particles 
       with CC values greater than threshold to be used in the 3D reconstruction.</li></p>
d555 2
a556 2
<p><li>Check the distribution of reference views (angular directions). 
	Plot the output file containing the number of views vs associated 
d558 2
a559 23
	individual files for each defocus group (<b>df***/how_many.ext</b>).
	<i>gnuplot
	gnuplot> plot 'how_many.ext' using 1:3 with boxes</i></li></p>

<p><li>Create average images for all 83 projection groups.
	It is sometimes convenient to view all averages together by
	montaging them in <a href="../../../../web/docs/web.html">WEB</a>.	
	<a href="./newprogs/average.bat">average.bat</a> creates <b>avg/avg</b> images.</li></p>

<p><li>Generate an image with 2D distribution of angular directions.
	This procedure creates a plot in which the 83 angular groups are 
	represented by small circles. The radius of these 83 circles are
	proportional to the number of particles in each group.	
	<a href="./newprogs/display.bat">display.bat</a> creates <b>display/cndis</b> images.
	<a href="./newprogs/display_p.bat">display_p.bat</a></li></p>

<p><li>In case of strong over-representation of some of the angular
	directions the numbers of images per direction can be limited
	to a certain number.
	<a href="./newprogs/b19.eqp">b19.eqp</a>
	Or keep half of the best per direction, but no more
        than specified number.
	<a href="./newprogs/b19.eqs">b19.eqs</a></li></p>
d561 31
d602 2
a603 3
<p> <li>If the number of particles in a view was limited, create a new 
	file of particles. 
	<a href="./newprogs/b21.new">b21.new</a> </li></p>
d605 8
a612 1
<p> <li>Split select file to be used in reconstruction into two separate select
d614 40
a653 33
	comparative purposes.
	<a href="./newprogs/oddeven.bat">oddeven.bat</a> creates selection doc files 
        <b>df***/selecteven</b> and <b>df***/selectodd</b> files.</li></p>

<p> <li>Compute the 3D reconstruction of half of the available particles.
	<a href="./newprogs/bpeven.bat">bpeven.bat</a> calls: 
	<a href="./newprogs/bprp.bat">bprp.bat</a> to create: <b>df***/volume1even</b> files.
	</li></p>

<p> <li>Compute the 3D reconstruction of the other half of the available
	particles.
	<a href="./newprogs/bpodd.bat">bpodd.bat</a> calls: 
	<a href="./newprogs/bprp.bat">bprp.bat</a> to create: <b>df***/volume1odd</b> files. </li></p>

<p> <li>[<b>Optional</b>] Compute the overall 3D reconstruction.
	<a href="./newprogs/bpall.bat">bpall.bat</a> calls: 
	<a href="./newprogs/bprp.bat">bprp.bat</a> to create: <b>df***/volume1</b> files.</li></p>

<p> <li>Compare the two half volumes.
	<a href="./newprogs/fsc.bat">fsc.bat</a> creates <b>df***/doccmp001</b> files, 
          containing the FSC curves.</li></p>

<p> <li>Compute the combined resolution of all defocus groups.  
	<a href="./newprogs/ctf.bat">ctf.bat</a> creates <b>combires</b> doc file and <b>vol001</b>, the 3D structure 
	from the entire set of particles. This structure is known as the 
	<i>initial volume</i> and will be used as the input to Refinment.</li></p>

<p> <li>Plot the combined resolution together with the resolution of 
	each defocus group.	
	<a href="./newprogs/plotres2">plotres2</a><br>	
	<i>gnuplot
	   load 'plotres2'</i><p>
	<a href="pics/plotres2.gif"><img width=200 height=150  SRC="./pics/plotres2.gif"></a></li></p>	
d655 2
a656 1
<p> <li>Determine where the Fourier shell correlation drops below threshold
d658 3
a660 3
	spatial frequency. Then resolution = pixel size/spatial frequency.
	<a href="./newprogs/res.bat">res.bat</a> makes the doc file, <b>resolution</b>, 
        which contains the cutoff, the
d663 2
a664 2
<p> <li>Filter the initial volume to the resolution determined by the Fourier
	shell correlation test above. Information at spatial frequencies 
d666 6
a671 4
	must be filtered out. The filtered volume may be viewed in 
        <a href="../../../../web/docs/web.html">WEB</a> with the <b>Surface</b> command.
	<a href="./newprogs/filt.bat">filt.bat</a> makes the filtered volume, 
        <b>volfq001</b>.</li></p>
d685 7
a691 2
<p>The next two procedures create files in the <i>Refinement/input/</i> directory
in preparation for the Refinement.</p>
d693 6
a698 13

<p><li>Create a document file of the selected particles.
	<a href="./newprogs/ordselect.bat">ordselect.bat</a> creates 
        <b>order_select</b>, a doc file similar to order_defocus,
	but only using particles selected with the cross correlation cut-off
	criterion. It also makes a <b>ctfs</b> doc file with defocus group
	averages.</li></p>

<p><li>Prepare the data files (stack files that contain all the aligned particles).
	<a href="./newprogs/stack.bat">stack.bat</a> creates a pair of stack files 
        for each defocus group: 
	<b>data***</b> files of particle images, and 
	<b>dala***</b> files of aligned particle images.</li></p>
d702 4
a705 4
<p><li>[<b>Optional</b>] View angular data output from Refinement batch files.
        Input: one of the <b>align_***</b> files from refinement.
        Output: <b>disp001</b>, an image showing angular positions.
	<a href="./newprogs/angdisp.bat">angdisp.bat</a> </li></p>
d708 2
a709 1
<hr><hr>
@


1.29
log
@*** empty log message ***
@
text
@a76 2

<a href="./pre72403/mr.html">Reconstruction batch files prior to July, 2003</a><br>
d79 1
a79 2
<p>
Processing steps are carried out by batch and procedure files, which run many SPIDER 
d89 2
a90 3
where <b>bat</b> is the procedure file extension, <b>dat</b> is the project data file 
extension, and <b>proc.bat</b> is the procedure file.
</p>
d96 4
a99 4
<li> The batch files below expect a specific directory structure. 
These directories 
can be created using the python script: 
<a href="./newprogs/mkdirs.py">mkdirs.py</a>. 
d101 10
a110 8
ALBANY USERS CAN JUST RUN THE SCRIPT WITHOUT DOWNLOADING IT:<br>
Run the script at the unix prompt:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>mkdirs.py pdr</code><br>
where pdr is the three-letter name of your project directory.</li>
<p> If you don't already have it, save the script using <b>Save Link As...</b> 
(DO NOT cut and paste from the web page - indentation matters in python). Then make it executable 
with the unix command: <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>chmod 775 mkdirs.py</code><br>
d118 20
a137 20
<p><li> Create a parameter document file. Batch files read
project parameters from a doc file, created by the interactive
procedure file <a href="./newprogs/makeparams.bat">makeparams.bat</a>.
 Run this procedure file in the top directory of your project and name
 the output file "params.dat", where <b>dat</b> is the project
extension. <a href="./params.html"> The parameters are described
here</a>.</li></p> 

<p><li> Create a file specification document file. This file contains
the numbers of the files to be processed in DO loops (the text part of
the filenames are entered as templates in the top level batch files -
see below). Use the interactive batch file 
<a href="./newprogs/makefilelist.bat">makefilelist.bat</a> to create the
doc file, called <b>"filenums.dat"</b>. If you need to exclude files from this
list, use a text editor to delete the appropriate lines, then use the
'DOC REN' command in SPIDER to renumber lines in the doc file.</li></p>

<p> <li> Create a <a href="#DEFGRPDOC">defocus group document file</a>.
This step comes after you have segregated  micrographs into various
defocus groups.</li></p>
a142 1

d153 4
a156 5
<p>
<h4>After running each batch file, check the output files to make sure the results are 
sensible. If you are not sure what is "sensible", ask an expert.</h4>
</p>
 
d163 1
a163 1
<p> These procedurs should be run in the <i>Power_Spectra</i> directory.<br>
d169 23
a191 4
<p><li><p>Generate the CTF estimate of the power spectrum.<br>
	Use SPIDER procedure: <a href="./newprogs/power.bat">power.bat</a> 
        which calls: 
        <a href="./newprogs/power_p1.bat">power_p1.bat</a> and creates:
d193 9
a201 5
        <ol>
        <p><li><b>roo***</b> doc files.</li></p>

        <p><li>A series of 1D profiles of the 
	averaged power spectra named; <b>pw_ro***</b>.</li></p>
a202 22
        <p><li><b>pw_avg***</b> power spectra, a series of averaged power spectra, 
        one for each micrograph.  Make a montage using 
        <a href="../../../../web/docs/web.html">WEB</a> 
        (reduction factor 4) to look at these power spectra.  They are 	
        equivalent to diffraction patterns obtained in the optical 
        diffractometer.  It is absolutely important that you screen these
        spectra before proceeding any further.  Things to look out for:
        <ul>
        <li>Are the Thon rings round?</li>
        <li>Do they extend to high resolution?</li>
        </ul>
        </p>

        You can discard micrographs that show one of the following artifacts:
        <ul> 
        <li>Rings that are cut off unidirectionally (evidence of drift)</li>
        <li>Rings that are elliptical, or even hyperbolic (evidence of astigmatism).</li>
        </ul>

        See this example:<p>
        <a href="pics/power.jpg"><img width=182 height=243  SRC="pics/power.jpg"></a></p>
        </ol>
d207 1
a207 1
              methods:
d209 19
a227 19
        <ul>
        <p><li> <a href="./newprogs/tfed.bat">tfed.bat</a> Estimate defocus with SPIDER operation 
        <a href="../../man/tfed.html"><b>TF ED</b></a> which creates a <b>defocus</b> document file. <br>
           Uses procedure: <a href="./newprogs/calcparms.bat">calcparms.bat</a> that 
           checks values in the <a href="./params.html">parameter file</a>.</li></p>

        <p><li> <a href="../../../../web/docs/ctf.html">CTF from doc file</a> in <b>WEB</b>.</li></p>

        <p><li> <a href="defdoc.html"><b>def</b></a> : a procedure for estimating defocus. 
           <a href="./newprogs/def.bat">def.bat</a>: Estimate defocus. Creates <b>defocus</b> document file.
	See the <a href="defdoc.html">def manual page</a> for more information.</li></p>

        <p><li> The MRC program <b>ctffind2</b> : estimates both the defocus and astigmatism.
		<a href="./newprogs/mrc.bat">mrc.bat</a>: SPIDER batch file. Also creates 
                <b>defocus</b> file. It calls:
		    <a href="./newprogs/ctffind">ctffind</a>: a shell script, and 
		    <a href="./newprogs/readmrc.py">readmrc.py</a>: a python script. 
		See the <a href="defmrc.html">defmrc manual page</a> for more information.</li></p>
        </ul>
d231 11
a241 11
	Both <a href="./newprogs/def.bat">def.bat</a> and <a href="./def/mrc.bat">mrc.bat</a> 
        create a document file called defocus.ext,
	which has the defocus listed for each micrograph. You can assign
	micrographs to defocus groups with
	<a href="./newprogs/defsort.bat">defsort.bat</a>: create defocus groups. 
         Output in <b>def_sort</b> doc file.

	This is only a starting point, however. You should manually inspect
	the defocus groupings to see which micrographs belong together.
	Plot the power spectrum for each micrograph in gnuplot and
	assign the defocus groups such that the curves are in phase.
d243 3
a245 3
	Gnuplot commands can be saved in a text file, such as 
        <a href="./newprogs/plotpower">plotpower</a>,
	then run in gnuplot using the <i>load</i> command:
d247 2
a248 2
	<i>gnuplot gnuplot ;&gt; load 'plotpower'</i><p>
	<a href="pics/plotpower1.gif"><img width="200" height="150" src="pics/plotpower1.gif"></a>
d252 4
a255 4
	averages for each defocus group:<br>
	<a href="./newprogs/defavg.bat">defavg.bat</a> creates 2 doc files of defocus group 
        averages: 
        <b>def_avg</b> and <b>order_defgrps</b>.
d274 9
a282 9
        <ol>
        <p><li>Use a noise image from a previous project (this is the easier way).
	The window sizes do not need to match. </p></li>

	<p><li>Convert a scanned micrograph file to a SPIDER image file:
	<a href="./newprogs/convert.bat">convert.bat</a>
	<a href="./newprogs/convert_p1.bat">convert_p1.bat</a>
	Works for micrographs scanned using Perkin Elmer, HiScan or ZI scanners.</p></li>
        </ol>
d286 9
a294 8
	images. Either
        <ol>
        <p><li>Obtain a noise image from from a previous project.</p></li> 
	<p><li>Create one with the batch file: 
           <a href="./newprogs/noise.bat">noise.bat</a> which creates a set of noise
           images:  <b>tmpnoise/noi***</b>.  You can view them in <b>Web</b> to select 
           one as a background noise image.</p></li>
        </ol>
d298 5
a302 2
	approaches can be used. They both require the converting procedure 
	<a href="./newprogs/convert_p1.bat">convert_p1.bat</a>
a303 2
	<ol>
        <p><li>Correlation with a Gaussian blob</li>
d469 2
a470 1
     create: <b>docapsh</b> containing: merged alignment parameters. </li></p>
d559 1
a559 1
<p><li>In case of strong overrepresentation of some of the angular
d588 3
a590 3
	<a href="./newprogs/bpeven.bat">bpeven.bat</a> creates <b>df***/volume1even</b> files.
	<a href="./newprogs/bprp.bat">bprp.bat</a> This procedure is also used by the 
         next 2 batch files.</li></p>
d594 2
a595 1
	<a href="./newprogs/bpodd.bat">bpodd.bat</a> creates <b>df***/volume1odd</b> files. </li></p>
d598 2
a599 1
	<a href="./newprogs/bpall.bat">bpall.bat</a> creates <b>df***/volume1</b> files.</li></p>
@


1.28
log
@more 'ap sh' changes
@
text
@d99 6
a104 2
<li> The batch files below expect a specific directory structure. These directories 
can be created using the python script <a href="./newprogs/mkdirs.py">mkdirs.py</a>.  
d113 1
d115 4
a118 10
</ul>
<p>
Some information may be stored in project-wide document files that are used by many batch files:
<p>
<ul>
<li> Create a parameter document file. Batch files read project parameters from a doc file, 
created by the interactive procedure file <a href="./newprogs/makeparams.bat">makeparams.bat</a>.
 Run this procedure file in the top directory of your project and name the output file 
"params.dat", where <b>dat</b> is the project extension. <a href="./params.html">
The parameters are described here</a>.</li>
d120 20
a139 12
<p>
<li> Create a file specification document file. This file contains the numbers of the files to 
be processed in DO loops (the text part of the filenames are entered as templates in the top 
level batch files - see below). Use the interactive batch file 
<a href="./newprogs/makefilelist.bat">makefilelist.bat</a> to create the doc file, 
called "filenums.dat". If you need to exclude files from this list, use a text editor to 
delete the appropriate lines, then use the DOC REN command in SPIDER to renumber lines in 
the doc file.</li>

<p>
<li> Create a <a href="#DEFGRPDOC">defocus group document file</a>. This step comes after 
you have segregated  micrographs into various defocus groups.</li>
d142 1
a142 2
<p>
Input files needed for a reconstruction project:
d145 3
a147 1
<li> Files of the digitized micrographs should be in the <i>Micrographs</i> directory.</li></p>
d149 5
a153 3
<p> <li> A reference volume is required. If the dimensions of your reference volume do not 
     match the window size (key 17 in the parameter file), then you must resize the 
     volume with <a href="newprogs/resizevol.bat">resizevol.bat</a>. This batch file 
d157 4
a160 2
<h3>After running each batch file, check the output files to make sure the results are 
sensible. If you are not sure what is "sensible", ask an expert.</h3>
d167 1
a167 1
<p> These procedure files should be run in the <i>Power_Spectra</i> directory.<br>
d174 2
a175 1
	<a href="./newprogs/power.bat">power.bat</a> calls: 
d195 1
d274 1
a274 1
<p> These procedure files should be run in the <i>Particle</i> directory.</p>
d384 1
a384 1
<p>These procedure files should be run in the <i>Alignment</i> directory.</p>
d634 1
a634 1
These procedure files should be run in the <i>Refinement</i> directory.
@


1.27
log
@"improvement"
@
text
@a433 2
      <li><a href="./newprogs/combine.bat">combine.bat</a></li>
      <li><a href="./newprogs/align.bat">align.bat</a> </li>
d449 9
d459 2
a460 2
    SPIDER procedure: <i><a href="./newprogs/ordefocus_1.bat">ordefocus_1.bat</a></i>: 
    creates <b>order_defocus</b> containing: <br>
d462 1
a462 2
    avg. defocus value for each group.
</li></p>
d465 1
a465 1
    SPIDER procedure: <i><a href="./newprogs/select_1.bat">select_1.bat</a></i>
d488 1
a488 1
	plot the number of particles vs. the cross correlation value. For 
d492 2
a493 2
	<a href="./newprogs/cchistogram.bat">cchistogram.bat</a>: 
         create histogram files <b>hist/cchist</b>.
d521 4
a524 6
<p><li>After deciding on a correlation coefficient threshold, create a 
	file which refers to the particles to be used in the 3D 
	reconstruction.
	<a href="./newprogs/dftotals.bat">dftotals.bat</a> creates <b>df***/seltotal</b>, 
         selection files listing 
	particles with CC values greater than threshold. </li></p>
@


1.26
log
@html used in most places now.
@
text
@d418 2
a419 2
<p> <li>Rotate and shift particles according to alignment parameters.</dt>
       <dd>Use: <i><a href="./newprogs/alignsh.bat">alignsh.bat</a></i> to create: 
a435 1
      <li><a href="./newprogs/align.bat">align.bat</a> </li>
d624 1
a624 1
<p>The next 3 batch files create files in the <i>Refinement/input/</i> directory
d682 1
a682 1
<p><li>Copy each particle into its associated view subdirectory (1-83).
d685 1
a685 1
<p><li>Run correspondence analysis for each of the 83 views.
d688 1
a688 4
<p><li>Run second part of correspondence analysis.
	<a href="./newprogs/b52.cas">b52.cas</a></li></p>

<p><li>Classification
@


1.25
log
@removed link to old
@
text
@d2 1
a2 3
<head>
<title>Single Particle Reconstruction Techniques</title>
</head>
d7 2
a8 2
<img width="108" height="104" src="pics/new22.jpg" align=right>
<br>
d69 3
a71 1
The data below is sometimes shown plotted with gnuplot. An <a href="http://www.ucc.ie/gnuplot/gnuplot.html">online manual</a> for gnuplot is available. Much more about gnuplot is at <a href="http://www.gnuplot.info">Gnuplot Central</a>
d80 1
a81 1

d83 2
a84 2
operations automatically. To use a program in this document, click the batch filename 
and copy the program to your current working directory. At the beginning of each program, 
d86 1
a86 1
Some of the programs will call a corresponding procedure (listed below the program filename). 
d88 1
a88 1
batch program:<br><br>
d90 2
a91 4
<center>
<i>spider bat/dat @@proc</i>
</center>
<br>
d95 1
d97 1
d134 1
d137 1
d139 6
a144 3
<li> Files of the digitized micrographs should be in the <i>Micrographs</i> directory.
<p>
<li> A reference volume is required. If the dimensions of your reference volume do not match the window size (key 17 in the parameter file), then you must resize the volume with <a href="newprogs/resizevol.bat">resizevol.bat</a>. This batch file should be run in the top-level project directory.
d149 1
a151 1
<br>
d155 4
a158 24
<br> These program files should be run in the <i>Power_Spectra</i> directory. The 
micrographs should be in the <i>Micrographs</i> directory. More information on the 
contrast transfer function may be found <a href="../ctf/ctf.html">here</a>. 

<pre>
<li>Generate the CTF estimate of the power spectrum.
	<a href="./newprogs/power.bat">power.bat</a> : creates
		<b>pw_avg***</b> power spectra,
		<b>roo***</b> doc files. All output files in the <b>power</b> subdirectory.
	<a href="./newprogs/power_p1.bat">power_p1.bat</a> : procedure called by power.bat
        
	One output of this program is a series of averaged power spectra, 
	named pw_avg***, one for each micrograph.  Make a montage in WEB 
	(reduction factor 4) to look at these power spectra.  They are 	
	equivalent to diffraction patterns obtained in the optical 
	diffractometer.  It is absolutely important that you screen these
	spectra before proceeding any further.  Things to look out for:
	--Are the Thon rings round?
	--Do they extend to high resolution?
	You can discard micrographs that show one of the following artifacts:
	--rings are cut off unidirectionally (evidence of drift)
	--rings are elliptical, or even hyperbolic (evidence of astigmatism).<br>
	See this example:<br>
	<a href="pics/power.jpg"><img width=182 height=243  SRC="pics/power.jpg"></a>
d160 34
d195 18
a212 14
	
	Another output of the program is a series of 1D profiles of the 
	averaged power spectra named "pw_ro***". To determine defocus and 
	amplitude contrast, use one of the following:<br>
        <b>a)</b> <a href="./newprogs/tfed.bat">tfed.bat</a> Estimate defocus with SPIDER command 
        <a href="../../man/tfed.html"><b>TF ED</b></a>.
	       It creates a <b>defocus</b> document file. It also uses a procedure,
	       <a href="./newprogs/calcparms.bat">calcparms.bat</a>: that checks values in the <a href="./params.html">parameter file</a>.
        <b>b)</b> Option <a href="../../../../web/docs/ctf.html">CTF from doc file</a> in <b>WEB</b>.
        <b>c)</b> <a href="defdoc.html"><b>def</b></a> : a program for estimating defocus. 
		<a href="./newprogs/def.bat">def.bat</a>: Estimate defocus. Creates <b>defocus</b> document file.
		See the <a href="defdoc.html">def manual page</a> for more information.
        <b>d)</b> The MRC program <b>ctffind2</b> : estimates both the defocus and astigmatism.
		<a href="./newprogs/mrc.bat">mrc.bat</a>: SPIDER batch file. Also creates <b>defocus</b> file. It calls:
d215 7
a221 4
		See the <a href="defmrc.html">defmrc manual page</a> for more information.

<li>Assign defocus groups according to the power spectrum.
	Both <a href="./newprogs/def.bat">def.bat</a> and <a href="./def/mrc.bat">mrc.bat</a> create a document file called defocus.ext,
d224 2
a225 1
	<a href="./newprogs/defsort.bat">defsort.bat</a>: create defocus groups. Output in <b>def_sort</b> doc file.
d232 2
a233 1
	Gnuplot commands can be saved in a text file, such as <a href="./newprogs/plotpower">plotpower</a>,
d236 1
a236 2
	<i>gnuplot
	gnuplot> load 'plotpower'</i><br>
d238 2
a239 1
<br>
d241 5
a245 3
	averages for each defocus group:
	<a href="./newprogs/defavg.bat">defavg.bat</a>: creates 2 doc files of defocus group averages: 
	   <b>def_avg</b> and <b>order_defgrps</b>.
a246 2
</pre>
<p>
d259 2
a260 1
<br> These program files should be run in the <i>Particle</i> directory.
a261 1
<pre>
d263 3
a265 2
	(1) Use a noise image from a previous project (this is the easier way).
	The window sizes do not need to match. Or,
d267 1
a267 1
	(2) Convert a scanned micrograph file to a SPIDER image file:
d270 3
a272 1
	Works for micrographs scanned using Perkin Elmer, HiScan or ZI scanners.
d274 1
a274 1
	A noise image is required to normalize the backgrounds of the particle 
d276 8
a283 4
	1) obtain a noise image from your advisor, or 
	2) create one with the batch file below. It creates a set of candidate 
	noise images - you can view them in <b>Web</b> to select one.
	<a href="./newprogs/noise.bat">noise.bat</a> Creates <b>tmpnoise/noi***</b> images. Select one of these as a background noise image.
d285 1
a285 1
<li>Run automatic phase of particle selection. Either of the following two
d288 3
a290 1
	<ol><li>Correlation with a Gaussian blob</li>
d295 1
a295 1
    again. This program uses histogram equalization.
d298 2
a299 1
    <a href="./newprogs/pick_p1.bat">pick_p1.bat</a> : procedure called by pick.bat. These programs output a 
d303 5
a307 3
        <b>coords/sndc***</b> top left pixel coordinates for particle images.
    <li>Local Fast Correlation Function</li>
    This procedure uses <a href="../../partpick.html#LFC">local cross-correlation</a> calculated using Fourier 
d314 2
a315 1
    <a href="../../../proc/pickparticle.spi">pickparticle.bat</a> : procedure called by lfc_pick.bat. These programs 
d318 1
a318 1
        <b>coords/sndc***</b> top left pixel coordinates for particle images.
d320 3
a322 1
<li>Determine the particle numbers corresponding to each micrograph.
d326 1
a326 1
	<a href="./newprogs/pnums.bat">pnums.bat</a> creates doc file <b>order</b>
d329 1
a329 1
<li>[<b>Optional</b>] Low-pass filter the particle images before particle selection.
d333 3
a335 2
	particles, during selection in WEB.
	<a href="./newprogs/pfilt.bat">pfilt.bat</a> : Filter a set of images, adjusting filter settings for 
d337 2
a338 1
	<a href="./newprogs/pfilt2.bat">pfilt2.bat</a> a simpler version to filter a set of particles.
d340 1
a340 1
<li>Verify automatically selected particles.
d342 2
a343 2
	This is accomplished in WEB using the <b>Categorize from
	sequential montage</b> command.  When the particle image files are
d347 2
a348 1
	in individual files (more details at <a href="../../partpick.html">partpick.html</a> and the <a href="../../faq.html#pick">SPIDER FAQ</a>).
d351 1
a351 1
	files, one for each micrograph.
d353 3
a355 2
<li>Remove any duplicated particles.
	When manually selecting particles in WEB, sometimes a particle is
d360 4
a363 2
	<a href="./newprogs/renumber.bat">renumber.bat</a> creates <b>good/ngood***</b> doc files.
</pre>
a365 1
</ul>
d367 2
a368 1
<a name="SH"></a> <h3 align="center">Alignment</h3>
d370 1
a370 2
<p>
These program files should be run in the <i>Alignment</i> directory.</p>
d374 2
a375 3
<li> <dl> <p>
<dt>Create reference projections for alignment from a <u>reference volume</u>.</dt>
     <dd>Reference projections are views of the ribosome at known angles.
d378 3
a380 2
        A preexisting reference volume is needed to create the projections. The NSAM and NROW dimensions 
	of the reference volume must match the dimensions of the particle windows.
d382 1
a382 1
        If you are reconstructing from multiple defocus groups, reference 
d385 1
a385 1
        <a href="./newprogs/refprojctf.bat">refprojctf.bat</a>.    
d387 1
a387 1
        <a href="./newprogs/refproj.bat">refproj.bat</a> </p> 
d395 3
a397 2
        </ol>
</dd></p></dl></li>
d399 3
a401 3
<li> <dl> <p>
<dt>Align the particles to the reference projections.</dt> 
    <dd>This is a multireference alignment of an image series.
d403 2
a404 2
             <a href="./newprogs/apsh.bat">apsh.bat</a>  (or 
             <a href="./newprogs/pub_apsh.bat">pub_apsh.bat</a> if you are 
d409 2
a410 2
	<a href="./newprogs/apshctf.bat">apshctf.bat</a> (or 
        <a href="./newprogs/pub_apshctf.bat">pub_apshctf.bat</a> if you 
d416 1
a416 2
        file-names.
</dd></p></dl></li>
d418 3
a420 3
<li> <dl> <p>
<dt>Rotate and shift particles according to alignment parameters.
       <dd>Use: <a href="./newprogs/alignsh.bat">alignsh.bat</a> to create: <b>ali/sar*****</b>, 
d424 17
a440 2
          they are rotated & shifted.)
</dd></p></dl></li>
d444 35
a478 24
<a name="CA"></a> <h3 align="center">Compute Averages</h3>
<br> These procedures should be run in the <i>Reconstruction</i> directory.
<pre>

<li>Segregate alignment file according to defocus groups.
	<a href="./newprogs/dfdocapmq.bat">dfdocapmq.bat</a>: creates <b>df***/docapmq</b> files, 
        with alignment parameters for each defocus group.

<li>Determine how many particles there are per defocus group.
    	<a href="./newprogs/ordefocus.bat">ordefocus.bat</a>: creates <b>order_defocus</b>

<li>Compare aligned particles to reference projections.
	Create a file that reports the number of particles in each
	reference view.  Create a set of files (one for each 
	reference view) that reports associated particle numbers
	and correlation coefficients. The correlation coefficient 
	describes the relative similiarity of the particle to the 
	reference projection. Use 0 for the correlation coefficient
	threshold to include all particles. This is carried out for
	each defocus group.
	<a href="./newprogs/select.bat">select.bat</a>: creates
	   <b>df***/select/sel</b> files, listing particles in the 83 reference views,
	   <b>df***/how_many</b>, number of particles each of the 83 views,
	   <b>how_many</b>, sum of all the df/how_many files.
d480 1
a480 1
<li>The next several operations help to identify a threshold correlation
d487 2
a488 1
	<a href="./newprogs/cchistogram.bat">cchistogram.bat</a>: create histogram files <b>hist/cchist</b>.
d491 1
a491 2
	<i>gnuplot
	gnuplot> load '<a href="./newprogs/plothist">plothist</a>'</i><br>
d493 1
d496 3
a498 2
<li>View the particles corresponding to each reference view.
	In WEB, use the <b>Montage from doc file</b> selection to
d505 1
a505 1
	to view an average of the particles displayed.
d507 1
a507 1
<li>Thresholds may be computed automatically. 
d512 3
a514 2
	<a href="./newprogs/ccthresh.bat">ccthresh.bat</a> creates <b>thresh</b>, a doc file with CC thresholds
	<a href="./newprogs/ccthresh_p.bat">ccthresh_p.bat</a>
d516 1
a516 1
<li>After deciding on a correlation coefficient threshold, create a 
d519 3
a521 2
	<a href="./newprogs/dftotals.bat">dftotals.bat</a> creates <b>df***/seltotal</b>, selection files listing 
	particles with CC values greater than threshold. 
d523 1
a523 1
<li>Check the distribution of reference views (angular directions). 
d528 1
a528 1
	gnuplot> plot 'how_many.ext' using 1:3 with boxes</i>
d530 1
a530 1
<li>Create average images for all 83 projection groups.
d532 2
a533 2
	montaging them in WEB.	
	<a href="./newprogs/average.bat">average.bat</a> creates <b>avg/avg</b> images.
d535 2
a536 2
<li>Generate an image with 2D distribution of angular directions.
	This program creates a plot in which the 83 angular groups are 
d540 1
a540 1
	<a href="./newprogs/display_p.bat">display_p.bat</a>
d542 1
a542 1
<li>In case of strong overrepresentation of some of the angular
d545 1
a545 1
	<a href="./programs/b19.eqp">b19.eqp</a>
d548 2
a549 3
	<a href="./programs/b19.eqs">b19.eqs</a>
<br>
</pre>
d551 4
a554 3
<p>
<i>To further investigate particle classification go to </i><b><a href="#OTHER">Other Methods</a></b>
<p>
d556 2
a557 2
<br>
<a name="3D"></a>
d559 2
a560 2
<pre>	
<li>If the number of particles in a view was limited, create a new 
d562 1
a562 1
	<a href="./programs/b21.new">b21.new</a>
d564 1
a564 1
<li>Split select file to be used in reconstruction into two separate select
d567 2
a568 2
	<a href="./newprogs/oddeven.bat">oddeven.bat</a> creates selection doc files <b>df***/selecteven</b> and 
	<b>df***/selectodd</b> files.
d570 1
a570 1
<li>Compute the 3D reconstruction of half of the available particles.
d572 2
a573 1
	<a href="./newprogs/bprp.bat">bprp.bat</a> This procedure is also used by the next 2 batch files.
d575 1
a575 1
<li>Compute the 3D reconstruction of the other half of the available
d577 1
a577 1
	<a href="./newprogs/bpodd.bat">bpodd.bat</a> creates <b>df***/volume1odd</b> files. 
d579 2
a580 2
<li>[<b>Optional</b>] Compute the overall 3D reconstruction.
	<a href="./newprogs/bpall.bat">bpall.bat</a> creates <b>df***/volume1</b> files.
d582 3
a584 2
<li>Compare the two half volumes.
	<a href="./newprogs/fsc.bat">fsc.bat</a> creates <b>df***/doccmp001</b> files, containing the FSC curves.
d586 1
a586 1
<li>Compute the combined resolution of all defocus groups.  
d589 1
a589 1
	<i>initial volume</i> and will be used as the input to Refinment.
d591 1
a591 1
<li>Plot the combined resolution together with the resolution of 
d593 1
a593 1
	<a href="./programs/plotres2">plotres2</a><br>	
d595 2
a596 2
	   load 'plotres2'</i><br>
	<a href="pics/plotres2.gif"><img width=200 height=150  SRC="./pics/plotres2.gif"></a>	
d598 1
a598 1
<li>Determine where the Fourier shell correlation drops below threshold
d601 3
a603 2
	<a href="./newprogs/res.bat">res.bat</a> makes the doc file, <b>resolution</b>, which contains the cutoff, the
	corresponding normalized frequency, and the resolution (in Angstroms).
d605 1
a605 1
<li>Filter the initial volume to the resolution determined by the Fourier
d608 4
a611 4
	must be filtered out. The filtered volume may be viewed in WEB with 
	the <b>Surface</b> command.
	<a href="./newprogs/filt.bat">filt.bat</a> makes the filtered volume, <b>volfq001</b>.
</pre>
d617 2
a618 2
<a name="1999"></a>
<br> These program files should be run in the <i>Refinement</i> directory.
d624 3
a626 1
<pre>
a627 2
The next 3 batch files create files in the <i>Refinement/input/</i> directory
in preparation for the Refinement program.
d629 3
a631 2
<li>Create a document file of the selected particles.
	<a href="./newprogs/ordselect.bat">ordselect.bat</a> creates <b>order_select</b>, a doc file similar to order_defocus,
d634 1
a634 1
	averages.
d636 3
a638 2
<li>Prepare the data files (stack files that contain all the aligned particles).
	<a href="./newprogs/stack.bat">stack.bat</a> creates a pair of stack files for each defocus group: 
d640 3
a642 1
	<b>dala***</b> files of aligned particle images.
d644 1
a644 6
</pre>
<p>
<li><a href="./refine.html">Refinement</a></li>
</p>
<pre>
<li>[<b>Optional</b>] View angular data output from Refinement batch files.
d647 2
a648 5
	<a href="./newprogs/angdisp.bat">angdisp.bat</a> 
</pre>
<p>
</p>
 
d652 1
d655 1
a655 1
<a name="OTHER"></a>
d657 1
a657 5
<br><br>
<a name="DIF"></a>
<h3 align="center">Difference Maps</h3>
<p>
Differences between volumes can be assessed by subtracting one volume from the other; 
d659 14
a672 12
properly aligned.
<pre>
<li> Check alignment of two volumes.
	<a href="./newprogs/shiftvol.bat">shiftvol.bat</a> uses <a href="../../man/cc.html">CC</a> and <a href="../../man/pk3.html">PK 3</a> to determine
	if volumes are shifted relative to each other.

<li> Ligands can be isolated by creating a difference map.
	<a href="./newprogs/diffmap.bat">diffmap.bat</a>

<li> There are alternative methods for identifying 
    <a href="../isolate.html">differences between volumes</a>.
<br>
d674 3
a676 2
<a name="OTHER"></a>
<HR>
d679 1
a679 1
This method can be used to investigate differences between particles.
d681 1
a681 1
subdivided into classes within each view based on similiarity.  
d683 2
a684 2
<li>Copy each particle into its associated view subdirectory (1-83).
	<a href="./programs/b50.grp">b50.grp</a>
d686 2
a687 2
<li>Run correspondence analysis for each of the 83 views.
	<a href="./programs/b51.csi">b51.csi</a>
d689 2
a690 2
<li>Run second part of correspondence analysis.
	<a href="./programs/b52.cas">b52.cas</a>
d692 5
a696 4
<li>Classification
	<a href="./programs/b53.clk">b53.clk</a>
</pre> 
<hr>                                                            
d700 5
a704 3
<a href="./xray/xray.html">Amplitude correction documentation and batch files</a>
<p>
<a href="./xray/old/enh.html">Older batch files</a>
d706 1
d709 1
d712 1
a712 1
Updated: 3/25/04  &nbsp;&nbsp;&nbsp;
@


1.24
log
@update for 'AP REF'
@
text
@a78 1
<a href="./old/mr.html">Reconstruction batch files prior to 1999</a>
@


1.23
log
@added info about resizevol.bat
@
text
@d6 1
a6 1
<body background="pics/grey-parchment.jpg" >
d21 1
a21 1
This page describes a procedure for creating a 3D reconstruction of a ribosome from 
d36 1
a36 1
through shifts and rotations using the <a href="#MQ">'AP MQ'</a> command.</li>
d100 3
a102 1
<li> The batch files below expect a specific directory structure. These directories can be created using the python script <a href="./newprogs/mkdirs.py">mkdirs.py</a>.  ALBANY USERS CAN JUST RUN THE SCRIPT WITHOUT DOWNLOADING IT:<br>
d106 3
a108 1
<p> If you don't already have it, save the script using <b>Save Link As...</b> (DO NOT cut and paste from the web page - indentation matters in python). Then make it executable with the unix command: <br>
d144 1
a144 1
sensible. If you are not sure what is "sensible", ask your advisor.</h3>
d149 2
a150 2
<a name="CTF"></a>
<h3 align="center">Contrast Transfer Function estimation</h3>
d154 1
d181 2
a182 1
        <b>a)</b> <a href="./newprogs/tfed.bat">tfed.bat</a> Estimate defocus with SPIDER command <a href="../../man/tfed.html"><b>TF ED</b></a>.
d318 8
a325 5
<br>
<a name="MQ"></a>
<h3 align="center">Alignment</h3>
<br> These program files should be run in the <i>Alignment</i> directory.
<pre>
d327 41
a367 29
<li>In what follows angular accuracy is set to 15 degrees, which results in 83 
	reference projections. 
	Use either <a href="./newprogs/refproj.bat">refproj.bat</a> or <a href="./newprogs/refprojctf.bat">refprojctf.bat</a> to create reference 
	projections for alignment. These batch files require a preexisting 
	reference volume to create the projections. The NSAM and NROW dimensions 
	of the volume must match the dimensions of the particle windows.

<li>Obtain reference projections from a <u>reference volume</u>. Reference
	projections are views of the ribosome at known angles. 
	<a href="./newprogs/refproj.bat">refproj.bat</a> creates:
	   <b>refangles</b> doc file with 3 Euler angles for each of the 83 projections.
	   <b>projlist</b> list of 83 projection numbers,
	   <b>prj/prj****</b> images of the 2D projections,
	Use <i>apmq.bat</i> with this batch file (see below).

	Alternatively, reference projections can be generated 
	for each defocus group with the following batch file:
	<a href="./newprogs/refprojctf.bat">refprojctf.bat</a> makes the same files as above, but each defocus group 
	has its own projection images in <b>df***/prj****</b>.
	Be sure to use <i>apmqctf.bat</i>, not apmq.bat (see below).

</li>
<li>Align the particles to the reference projections. 
	This is a multireference alignment of an image series. The output
	document files describe the shift and rotation parameters for the
	best matched projection. (Use with results of refproj.bat)
        Edit <a href="./newprogs/apmq.bat">apmq.bat</a>  (or 
             <a href="./newprogs/apmq_pub.bat">apmq_pub.bat</a> if you are using PubSub) 
        specify the various input parameters.  You should not need to alter the 
d369 1
a369 1
	These files output <b>apmq/apmq***</b> doc files with alignment data.
d371 9
a379 18
	If you used <i>refprojctf.bat</i> above, for multiple defocus settings,
	run the following program instead.
	<a href="./newprogs/apmqctf.bat">apmqctf.bat</a> output same as above.
</li>

<li>Combine all resulting alignment files into one file.
	<a href="./newprogs/combine.bat">combine.bat</a>  output combined alignment file <b>docapmq</b>.

<li>Create a file containing particle numbers and reference angles for
	each particle to be used to compute the 3D reconstruction.
	<a href="./newprogs/angles.bat">angles.bat</a> creates <b>angles</b>, a doc file of particle angles.

<li>Rotate and shift particles according to alignment parameters.
	If the particles have negative projection numbers in the apmq
	document file, they are mirrored after they are rotated & shifted.
	<a href="./newprogs/align.bat">align.bat</a> creates <b>ali/sar*****</b>, aligned versions of the particle images.
<br>
</pre>
d381 3
a383 4
<br>
<a name="CA"></a>
<h3 align="center">Compute Averages</h3>
<br> These program files should be run in the <i>Reconstruction</i> directory.
d387 2
a388 2
	<a href="./newprogs/dfdocapmq.bat">dfdocapmq.bat</a>: creates <b>df***/docapmq</b> files, with alignment parameters 
	for each defocus group.
a559 3
<li>Prepare the transformation document files (with rotation & shift parameters).
	<a href="./newprogs/trans.bat">trans.bat</a> creates <b>trans</b> files for each defocus group.

d566 2
a567 2
        Input: one of the <b>angles00N</b> files from refinement.
        Output: disp001, an image showing angular positions.
a570 1
<li> <a href="old/old_refine.html">Older refinement procedures</a> (not recommended).</li>
d631 1
a631 1
Updated: 7/24/03  &nbsp;&nbsp;&nbsp;
@


1.22
log
@changed 'either' to 'one of the following'
@
text
@d106 1
a129 1

d131 6
@


1.21
log
@*** empty log message ***
@
text
@d169 1
a169 1
	amplitude contrast, use either:<br>
@


1.20
log
@*** empty log message ***
@
text
@d263 1
a263 1
    <a href="./newprogs/pickparticle.bat">pickparticle.bat</a> : procedure called by lfc_pick.bat. These programs 
@


1.19
log
@changed pickparticle reference
@
text
@d263 1
a263 1
    <a href="../../../proc/pickparticle.spi">pickparticle.spi</a> : procedure called by lfc_pick.bat. These programs 
@


1.18
log
@added TFED.bat to defocus section
@
text
@d247 1
a247 1
    again. This program uses uses histogram equalization.
d263 1
a263 1
    <a href="./newprogs/pickparticle.bat">pickparticle.bat</a> : procedure called by lfc_pick.bat. These programs 
@


1.17
log
@updated to reflect changes made to power.bat
@
text
@d170 3
a172 4
        <b>a)</b> SPIDER command: <a href="../../man/tfddf.html"> <b>TF DDF</b></a> 
	  [When you choose only one point of minimum, you will input 
	  amplitude contrast (usually 0.09 or 0.1). Otherwise, the 
	  amplitude contrast will be calculated.]
@


1.16
log
@added link to pre-7-24-03 files
@
text
@a147 1
		<b>pw_ro***</b> rotationally averaged spectra,
@


1.15
log
@added mkdirs.py
@
text
@d78 2
a79 2
NB: <a href="./old/mr.html">Reconstruction batch files written prior to 1999</a> are 
still available.
@


1.14
log
@added angdisp.bat
@
text
@d98 9
a106 1

a129 3
<p>
<li> The batch files below expect a specific directory structure. These directories can 
be created using the <a href="./makedirs">makedirs shell script</a>.</li>
@


1.13
log
@added lfc_pick.bat
@
text
@d547 6
a552 1

@


1.12
log
@newprogs for pubsub stuff
@
text
@d236 9
a244 6
<li>Run automatic phase of particle selection.
	The micrographs are decimated by 1/4, Fourier filtered with a
	Gaussian low pass filter, and searched for peaks over regions
	corresponding to particle dimensions. Particles are windowed out,
	centered, peak locations are corrected, and particles are windowed
	again. This program uses uses histogram equalization.
d246 12
a257 6
	<a href="./newprogs/pick.bat">pick.bat</a> : The top level batch file.
	<a href="./newprogs/pick_p1.bat">pick_p1.bat</a> : procedure called by pick.bat. These programs output a 
	set of particle images and 2 sets of doc files:
	   <b>win/ser*****</b> serial files of windowed particles,,
	   <b>coords/ndc***</b> peak coordinates from 1/4 decimated image,
	   <b>coords/sndc***</b> top left pixel coordinates for particle images.
d259 6
@


1.11
log
@updated for new batch files
@
text
@d320 2
a321 2
        Edit <a href="./programs/apmq.bat">apmq.bat</a>  (or 
             <a href="./programs/apmq_pub.bat">apmq_pub.bat</a> if you are using PubSub) 
d595 1
a595 1
Updated: 4/2/03  &nbsp;&nbsp;&nbsp;
@


1.10
log
@new batch files by Bill 7/24/03
@
text
@d3 1
a3 1
<title>SYLT: Single Particle Reconstruction Techniques</title>
@


1.9
log
@apmq
@
text
@d3 1
a3 1
<title>Single Particle Reconstruction Techniques</title>
d71 1
d141 5
a145 3
	<a href="./newprogs/power.bat">power.bat</a> : the top level batch file
	<a href="./newprogs/power_p1.bat">power_p1.bat</a> : Procedures called by the top 
	<a href="./newprogs/power_p2.bat">power_p2.bat</a> : level file; don't edit these!
d170 1
a170 2
        <b>b)</b> Option <a href="../../../../web/docs/ctf.html">CTF from doc file</a> in 
                 <b>WEB</b>.
d172 2
a173 8
                 This approach makes use of the following batch files:
		<a href="./newprogs/makectf.bat">makectf.bat</a>: Create a 2D model transfer 
                  function.
		<a href="./newprogs/def.bat">def.bat</a>: Estimate defocus. 
		<a href="./newprogs/defgrp.bat">defgrp.bat</a>: Assign micrographs to 
                          defocus groups.
		<a href="./newprogs/defavg.bat">defavg.bat</a>: Determine defocus group averages. 
	See the <a href="defdoc.html">def manual page</a> for instructions about these batch files.
d175 4
a178 4
		<a href="./def/mrc.bat">mrc.bat</a>: SPIDER batch file. It calls:
		<a href="./def/ctffind">ctffind</a>: a shell script, and 
		<a href="./def/readmrc.py">readmrc.py</a>: a python script. 
	See the <a href="defmrc.html">manual page</a> for more information.
d181 7
d191 2
a192 4
	For micrographs scanned using Perkin Elmer:
	<a href="./programs/plotpower1">plotpower1</a><br>
	For micrographs scanned using Hi-Scan:
	<a href="./programs/plotpower2">plotpower2</a><br>
d195 1
a195 1
	   load 'plotpower1'</i><br>
d197 5
a201 4


	an online manual for gnuplot:
	http://www.cs.dartmouth.edu/gnuplot_info.html
d205 1
d211 1
a212 1
<br>
d229 6
a234 7
	Then open the micrograph in WEB and use the <b>Pixel</b> utility to
	identify coordinates for a window containing background noise (no 
	particles). Window this region from the micrograph. Or, run the 
	following program a few times (using different upper left coordinates
	each time) until a suitable noise file is retrieved. 
	<a href="./newprogs/noise.bat">noise.bat</a>
	<a href="./newprogs/noise_p1.bat">noise_p1.bat</a>
d236 1
a236 1
<li>Run automatic particle selection.
d244 5
a248 5
	<a href="./newprogs/pick_p1.bat">pick_p1.bat</a> : Procedures called by
	<a href="./newprogs/pick_p2.bat">pick_p2.bat</a> : the top level file.

	The outputs are a set of serial files of windowed particles, and document
	files with results from the peak search and particle coordinates.
d254 1
a254 2
	<a href="./newprogs/pnums.bat">pnums.bat</a> : The top level batch file.
	<a href="./newprogs/pnums_p1.bat">pnums_p1.bat</a> : Procedure called by top level file.
d257 1
a257 1
<li>[<b>Optional</b>] Low-pass filter the particle images.
d262 3
a264 1
	<a href="./newprogs/pfilt.bat">pfilt.bat</a> : Filter a set of images.
d273 4
a276 2
	in individual files (more details <a href="../../partpick.html">here</a> and 
        <a href="../../faq.html#pick">here</a>).   
d284 2
a285 2
	<a href="./newprogs/renumber.bat">renumber.bat</a> 
	<a href="./newprogs/renumber_p1.bat">renumber_p1.bat</a> 	
a288 7
<i>Go to <a href="#MQ"><b>Multireference Alignment using AP MQ</b></a> 
Old programs- <a href="old_apmr.html"><b>Multireference Alignment using 'AP MR'</b></a>  
</i>

<hr>

<br>
d291 2
a292 2
<br> These program files should be run in the <i>APMQ</i> directory.
<p>
d294 6
a299 2
<li>In what follows angular accuracy is set to 15 degrees, which
    results in 83 reference projections. 
d301 1
a301 1
<li>Obtain reference projections from a reference volume. Reference
d303 5
a307 3
	<a href="./newprogs/refproj.bat">refproj.bat</a>
	<a href="./newprogs/refproj_p1.bat">refproj_p1.bat</a>
	Use <i>apmq.bat</i> with these batch files (see below).
d310 4
a313 10
	for each defocus group with the following two batch files:
	<a href="./newprogs/refprojctf.bat">refprojctf.bat</a>
	<a href="./newprogs/refprojctf_p1.bat">refprojctf_p1.bat</a>
	Be sure to use <i>apmqctf.bat</i> (see below).

	All of the above batch files require a preexisting reference volume to
	create the projections. The NSAM and NROW dimensions of the volume
	must match the dimensions of the particles picked in the above section.

	Here is <a href="./reference_volume.dat">an example volume</a>. 
a314 2
	The file: <a href="./newprogs/refangles.dat">refangles.dat</a> contains angles 
         generated with delta(theta) = 15.
d324 1
a324 2
        Now run <a href="./programs/apmq.bat">apmq.bat</a>  (or 
             <a href="./programs/apmq_pub.bat">apmq_pub.bat</a> if you are using PubSub).
d327 2
a328 2
	run the following program.
	<a href="./newprogs/apmqctf.bat">apmqctf.bat</a> 
d332 1
a332 2
	<a href="./newprogs/combine.bat">combine.bat</a> 
	<a href="./newprogs/combine_p1.bat">combine_p1.bat</a>
d336 1
a336 2
	<a href="./newprogs/angles.bat">angles.bat</a>
	<a href="./newprogs/angles_p1.bat">angles_p1.bat</a>
d341 1
a341 10
	<a href="./newprogs/align.bat">align.bat</a> 
	<a href="./newprogs/align_p1.bat">align_p1.bat</a> 

<li>Segregate alignment file according to defocus groups.
	<a href="./newprogs/dfgroups.bat">dfgroups.bat</a>
	<a href="./newprogs/dfgroups_p1.bat">dfgroups_p1.bat</a>

<li>Determine how many particles there are per defocus group.
    	<a href="./newprogs/dfcount.bat">dfcount.bat</a>
    	<a href="./newprogs/dfcount_p1.bat">dfcount_p1.bat</a>
d343 1
a343 3
<hr>
<a href="#CA"><b>Go to Compute Averages</b></a> or<br>
<a href="#3D"><b>Go to 3D reconstruction</b></a>
d348 2
d351 7
d367 4
a370 1
	<a href="./programs/b16.cla">b16.cla</a>
d372 14
d397 18
a414 3
<li>Check for an overrepresentation of one reference view. 
	Plot the output file containing the number of views vs 
	associated particles.  
d416 1
a416 1
		plot 'how_many.ext' using 1:3 with boxes</i><br>
d418 1
a418 1
<li>Compute averages for all projection groups.
d421 1
a421 2
	<a href="./programs/b17.avg">b17.avg</a> 
        <a href="./programs/p_average.avg">p average.avg</a>
d424 5
a428 5
	This program creates a large circular plot in which smaller 
	circles that represent the 83 angular groups are placed. The
	radius of these 83 circles are proportional to the number of 
	particles in each group.	
	<a href="./newprogs/b18.dis">b18.dis</a>
d438 1
d440 3
a442 4
<i>To further investigate particle classification go to</i> 
        <a href="#OTHER"> <b>Other Methods</b></a>	
<br>
<a href="#3D"><b>Go to 3D reconstruction</b></a>
d446 2
a447 7
<h3 align="center">3D Reconstruction</h3>	
<li>After deciding on a correlation coefficient threshold, create a 
	file which refers to the particles to be used in the 3D 
	reconstruction.
	<a href="./programs/b20.tot">b20.tot</a> 
        <a href="./programs/p_seltotal.tot">p seltotal.tot</a>

d452 5
a456 5
<li>Split select file used in 3D into two separate select files to be
	used in the following two 3D reconstructions for comparative 
	purposes.
	<a href="./programs/b22.ode">b22.ode</a> and
        <a href="./programs/p_oddeven.ode">p oddeven.ode</a>
d459 2
a460 1
	<a href="./programs/b23.bpe">b23.bpe</a> 
d464 1
a464 1
	<a href="./programs/b24.bpo">b24.bpo</a> 
d466 3
d470 1
a470 4
	<a href="./programs/b25.res">b25.res</a> 
	
<li>Compute the 3D reconstruction.
	<a href="./programs/b26.bpr">b26.bpr</a> 
d472 4
a475 5
<li>Compute the combined resolution of all defocus groups.  Determine
	where the Fourier shell correlation drops below 0.5, and at
	this point, identify the corresponding spatial frequency. 
	<center>resolution = pixel size/spatial frequency</center>
	<a href="./programs/b28.ctf">b28.ctf</a> 
d484 12
a495 23
<li>Filter the 3D reconstruction to the resolution determined by
        the Fourier Shell Correlation test above.
        We use a 0.5 cut-off level for the FSC curves.  Thus,
        find the intersection with 0.5 threshold on the FSC plot
        and use the corresponding normalized frequency, say 0.23.
        (The corresponding frequency in &Aring ngstroms = (pixel size in &Aring)/0.23).
        Perform the filtration by using Butterworth filter and
        setting the lower frequency limit to the "cut-off" - 0.05,
        and the upper frequency limit to the "cut-off" +0.05 :
        FQ
        INPUT_VOLUME
        OUTPUT_VOLUME
        7
        0.18,0.28

<li>Create a document file of the selected particles (order_select)
	<a href="./programs/b20.ord">b20.ord</a>

<li>Prepare the data files (stack files that contain all the aligned particles).
	<a href="./programs/b29.stk">b29.stk</a>

<li>Prepare the transformation document files.
	<a href="./programs/b30.trs">b30.trs</a>
d503 1
a503 1

d505 1
a505 1
<b>Refinement is a computationally expensive operation. </b>Before running the 
d509 18
d528 1
d595 1
a595 1
Updated: 6/16/03  &nbsp;&nbsp;&nbsp;
@


1.8
log
@apmq location pubsub wrong
@
text
@d329 1
a329 1
             <a href="./programs/apmq_pub.bat">apmq_pub.bat</a>if you are using PubSub).
d570 1
a570 1
Updated: 4/24/03  &nbsp;&nbsp;&nbsp;
@


1.7
log
@apmq
@
text
@d324 2
a325 2
        Edit <a href=".apmq.bat">apmq.bat</a>  (or 
             <a href=".apmq_pub.bat">apmq_pub.bat</a> if you are using PubSub) 
d328 2
a329 2
        Now run <a href=".apmq.bat">apmq.bat</a>  (or 
             <a href=".apmq_pub.bat">apmq_pub.bat</a>if you are using PubSub).
d570 1
a570 1
Updated: 4/16/03  &nbsp;&nbsp;&nbsp;
@


1.6
log
@changed FP NQ to FP (after plotres2)
@
text
@d324 6
a329 4
        Edit <a href=".apmq_settings.bat">apmq_settings.bat</a> and specify the
        various input parameters.  You will not need to alter the file-names.
        Now run the following procedure: 
	<a href=".apmq.bat">apmq.bat</a>.  This procedure can be used with PubSub. 
d570 1
a570 1
Updated: 4/2/03  &nbsp;&nbsp;&nbsp;
@


1.5
log
@apmq.bat
@
text
@d474 1
a474 1
        FQ NP
@


1.4
log
@refinement
@
text
@d287 1
d289 1
d294 2
a295 1
<P>
d303 1
a303 1
	Use apmq.bat with these batch files (see below).
d309 1
a309 1
	Be sure to use apmqctf.bat (see below).
d317 3
a319 3
	<a href="./newprogs/refangles.dat">refangles.dat</a> contains angles 
           generated with delta(theta) = 15.

d323 5
a327 3
	best matched projection.
	<a href="./newprogs/apmq.bat">apmq.bat</a> (Use with results of refproj.bat)
	<a href="./newprogs/apmq_p1.bat">apmq_p1.bat</a>  
d329 1
a329 1
	If you used refprojctf.bat above, for multiple defocus settings,
d332 1
d568 1
a568 1
Updated: 3/26/03  &nbsp;&nbsp;&nbsp;
d573 2
a574 2
 Copyright notice</a>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
 Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a> </address></small></a>
@


1.3
log
@fixed Alignment header
@
text
@a500 4
<li> <a href="../../../pubsub/pubsub.html">Refinement in parallel using PubSub</a>.</li>
</p>

<p>
d562 1
a562 1
Updated: 3/7/03  &nbsp;&nbsp;&nbsp;
@


1.2
log
@*** empty log message ***
@
text
@d290 1
a290 1
/h3>
@


1.1
log
@Initial revision
@
text
@d5 1
d7 1
d21 6
a26 1
This page describes a procedure for creating a 3D reconstruction of a ribosome from electron micrographs. Once a set of particle images has been obtained, an initial 3D reconstruction is calculated using coarse projection angles. This is followed by refinement, which iteratively adjusts the angles for finer resolution. The following procedures are described in greater detail below.
d28 23
a50 7
<li> For each micrograph the <a href="#CTF">Contrast Transfer Function</a> (CTF) is estimated and the micrographs are placed in defocus groups.
<li> Next, an <a href="#AUTO">automated particle selection</a> process identifies ribosome particles from the digitized electron micrographs, and extracts small images of individual particles.
<li> The particle image series is then aligned relative to reference projections through shifts and rotations using the <a href="#MQ">AP MQ</a> command.
<li>  <a href="#CA">Averages</a> of particles for each reference view are computed, to assess how evenly the projection views are distributed.
<li> The initial <a href="#3D">3D reconstruction</a> is calculated, along with an estimate of resolution.
<li> Angular <a href="#DIF">refinement</a> gives each projection a chance "to find a better home"in terms of its orientation and phase origin, thus improving the resolution of the initial reconstruction.
<li> Some <a href="#OTHER">other</a> useful methods, such as classification and difference maps, are described as well. Additional details about these methods may be found at the <a href="../../techniques.html">techniques</a> page.
d53 1
a53 1
</p>
a54 1

d57 1
d59 4
d64 1
a64 4
For further information: <br>
<li><A href="../../ref.html">General references</A><br>
<li>Information about images from the <b><A href="zi/zidoc.html">ZI scanner</A></b>
<li>Batch files for circular images from <b><A href="quantifoil.html">Quantifoil grids</A></b>.
d66 4
d71 1
a72 1

d91 1
a91 1
<pre>spider bat/dat @@proc</pre>
d97 1
a98 1

d101 7
a107 1
<li> Create a parameter document file. Batch files read project parameters from a doc file, created by the interactive procedure file <a href="./newprogs/makeparams.bat">makeparams.bat</a>. Run this procedure file in the top directory of your project and name the output file "params.dat", where <b>dat</b> is the project extension. <a href="./params.html">The parameters are described here</a>.
d109 8
a116 1
<li> Create a file specification document file. This file contains the numbers of the files to be processed in DO loops (the text part of the filenames are entered as templates in the top level batch files - see below). Use the interactive batch file <a href="./newprogs/makefilelist.bat">makefilelist.bat</a> to create the doc file, called "filenums.dat". If you need to exclude files from this list, use a text editor to delete the appropriate lines, then use the DOC REN command in SPIDER to renumber lines in the doc file.
d118 3
a120 1
<li> Create a <a href="#DEFGRPDOC">defocus group document file</A>. This step comes after you have segregated  micrographs into various defocus groups.
d122 3
a124 1
<li> The batch files below expect a specific directory structure. These directories can be created using the <a href="./makedirs">makedirs shell script</a>.
d127 3
a129 1
<h3>After running each batch file, check the output files to make sure the results are sensible. If you are not sure what is "sensible", ask your advisor.</h3><br>
a131 1
<br>
d133 1
a133 1
<A name="CTF"></A>
d135 3
a137 1
<br> These program files should be run in the <i>Power_Spectra</i> directory. The micrographs should be in the <i>Micrographs</i> directory. More information on the contrast transfer function may be found <a href="../ctf/ctf.html">here</a>. 
d158 1
a158 1
<A name="DEF"></A>
d163 1
a163 1
        <b>a)</b> SPIDER command: <A href="../../man/tfddf.html"> <b>TF DDF</b></a> 
d167 6
a172 4
        <b>b)</b> Option <A href="../../../../web/docs/ctf.html">CTF from doc file</A> in <b>WEB</b>.
        <b>c)</b> <A href="defdoc.html"><b>def</b></a> : a program for estimating defocus. This approach makes
	 	 use of the following batch files:
		<a href="./newprogs/makectf.bat">makectf.bat</a>: Create a 2D model transfer function.
d174 2
a175 1
		<a href="./newprogs/defgrp.bat">defgrp.bat</a>: Assign micrographs to defocus groups.
d177 1
a177 1
	See the <A href="defdoc.html">def manual page</a> for instructions about these batch files.
d182 1
a182 1
	See the <A href="defmrc.html">manual page</a> for more information.
d195 1
a195 1
	<a href="pics/plotpower1.gif"><img width=200 height=150 SRC="pics/plotpower1.gif"></a>
d203 5
a207 2
<A name="DEFGRPDOC"></A>
Create a defocus group document file. Once you have determined the defocus groups for all the micrographs, put this information into a doc file with <A href="makedfgroups.bat">makedfgroups.bat</A>. Each row contains the micrograph number, the defocus group number, and the defocus value.
d212 1
a212 1
<A name="AUTO"></A>
d222 2
a223 2
	<A href="./newprogs/convert.bat">convert.bat</A>
	<A href="./newprogs/convert_p1.bat">convert_p1.bat</A>
d255 1
a255 1
<A name="PFILT"></A>
d270 2
a271 1
	in individual files (more details <a href="../../partpick.html">here</a> and <a href="../../faq.html#pick">here</a>).   
d285 1
a285 1
Old programs- <a href="old_apmr.html"><b>Multireference Alignment using AP MR</b></a>  
d290 1
a290 1
<h3 align="center">Multireference Alignment using AP MQ</h3>
d314 2
a315 1
	<a href="./newprogs/refangles.dat">refangles.dat</a> contains angles generated with delta(theta) = 15.
d409 2
a410 1
<i>To further investigate particle classification go to</i> <a href="#OTHER"><b>Other Methods</b></a>	
d483 1
d485 2
a486 1
<p><h3 align="center">Refinement</h3>
d488 1
a488 1
<a name="b96"></a>
d493 6
a498 1
<u>all</u> defocus groups have reasonable particle volumes.</p>
a499 15
<li> Compute a projection of the final volume<br>
    The following procedures should be run in the <i>Refinement</i> directory. 
       <dl><dd>	
	<a href="./programs/refine.pam">refine.pam</a><br>
	Uses procedures:<br>
	<a href="./programs/refine_settings.pam">refine_settings.pam</a><br>
	<a href="./programs/sort.pam">sort.pam</a><br>
	<a href="./programs/prepare.pam">prepare.pam</a><br>
	<a href="./programs/makeselect.pam">makeselect.pam</a><br>
	<a href="./programs/grploop.pam">grploop.pam</a><br>
	<a href="./programs/mergegroups.pam">mergegroups.pam</a><br>
	<a href="./programs/saveres.pam">saveres.pam</a><br>
	<a href="./programs/endmerge.pam">endmerge.pam</a><br>
	<a href="./programs/endrefine.pam">endrefine.pam</a><br>
       </dd></dl>
d501 1
a501 1
<li> Refinement using <a href="../../../pubsub/pubsub.html">PubSub</a>.<br>
d503 1
a503 1
 
d505 1
a505 1
<li> Some <a href="old/old_refine.html">older refinement procedures</a>.<br>
d511 1
a511 1
<h3 align="center"><u>Other Useful Methods</u></h3>
d519 3
a521 1
Differences between volumes can be assessed by subtracting one volume from the other; the result is a <i>difference map</i>. Before subtracting volumes, make sure they are properly aligned.
d524 1
a524 1
	<a href="./newprogs/shiftvol.bat">shiftvol.bat</a> uses <A href="../../man/cc.html">CC</a> and <A href="../../man/pk3.html">PK 3</A> to determine
d530 2
a531 1
<li> There are alternative methods for identifying <a href="../isolate.html">differences between volumes</a>.
d566 1
a566 1
Updated: 11/11/02  &nbsp;&nbsp;&nbsp;
@
