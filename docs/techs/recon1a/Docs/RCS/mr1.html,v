head	1.58;
access;
symbols;
locks; strict;
comment	@# @;


1.58
date	2017.01.12.16.42.09;	author leith;	state Exp;
branches;
next	1.57;

1.57
date	2016.08.25.17.38.10;	author leith;	state Exp;
branches;
next	1.56;

1.56
date	2016.08.24.16.15.08;	author leith;	state Exp;
branches;
next	1.55;

1.55
date	2016.07.11.14.50.19;	author leith;	state Exp;
branches;
next	1.54;

1.54
date	2016.07.07.17.45.17;	author leith;	state Exp;
branches;
next	1.53;

1.53
date	2016.07.05.15.02.25;	author leith;	state Exp;
branches;
next	1.52;

1.52
date	2016.06.22.14.43.14;	author leith;	state Exp;
branches;
next	1.51;

1.51
date	2016.06.22.14.13.28;	author leith;	state Exp;
branches;
next	1.50;

1.50
date	2016.06.20.17.08.56;	author leith;	state Exp;
branches;
next	1.49;

1.49
date	2016.06.02.17.19.10;	author leith;	state Exp;
branches;
next	1.48;

1.48
date	2016.05.09.14.13.36;	author leith;	state Exp;
branches;
next	1.47;

1.47
date	2016.04.25.18.51.23;	author leith;	state Exp;
branches;
next	1.46;

1.46
date	2016.03.29.19.57.49;	author leith;	state Exp;
branches;
next	1.45;

1.45
date	2016.03.25.18.23.38;	author leith;	state Exp;
branches;
next	1.44;

1.44
date	2016.02.12.14.48.08;	author leith;	state Exp;
branches;
next	1.43;

1.43
date	2015.12.11.16.37.49;	author leith;	state Exp;
branches;
next	1.42;

1.42
date	2015.11.18.19.27.20;	author leith;	state Exp;
branches;
next	1.41;

1.41
date	2015.10.09.15.38.55;	author leith;	state Exp;
branches;
next	1.40;

1.40
date	2014.10.07.14.51.50;	author leith;	state Exp;
branches;
next	1.39;

1.39
date	2014.09.03.15.40.22;	author leith;	state Exp;
branches;
next	1.38;

1.38
date	2014.08.21.10.17.50;	author tapu;	state Exp;
branches;
next	1.37;

1.37
date	2014.08.14.17.00.39;	author leith;	state Exp;
branches;
next	1.36;

1.36
date	2014.08.14.14.59.17;	author leith;	state Exp;
branches;
next	1.35;

1.35
date	2014.08.14.14.49.50;	author leith;	state Exp;
branches;
next	1.34;

1.34
date	2014.08.10.07.08.38;	author tapu;	state Exp;
branches;
next	1.33;

1.33
date	2014.08.05.14.42.13;	author leith;	state Exp;
branches;
next	1.32;

1.32
date	2014.05.14.17.56.39;	author leith;	state Exp;
branches;
next	1.31;

1.31
date	2014.04.30.16.03.38;	author leith;	state Exp;
branches;
next	1.30;

1.30
date	2014.04.29.18.31.36;	author leith;	state Exp;
branches;
next	1.29;

1.29
date	2014.04.15.15.39.47;	author leith;	state Exp;
branches;
next	1.28;

1.28
date	2014.04.15.15.16.52;	author leith;	state Exp;
branches;
next	1.27;

1.27
date	2014.04.05.10.32.34;	author tapu;	state Exp;
branches;
next	1.26;

1.26
date	2013.11.26.15.30.47;	author leith;	state Exp;
branches;
next	1.25;

1.25
date	2013.11.25.17.29.53;	author leith;	state Exp;
branches;
next	1.24;

1.24
date	2013.11.25.17.29.44;	author leith;	state Exp;
branches;
next	1.23;

1.23
date	2013.11.25.17.20.02;	author leith;	state Exp;
branches;
next	1.22;

1.22
date	2013.11.25.16.56.20;	author leith;	state Exp;
branches;
next	1.21;

1.21
date	2013.11.22.16.52.26;	author leith;	state Exp;
branches;
next	1.20;

1.20
date	2013.11.21.19.14.53;	author leith;	state Exp;
branches;
next	1.19;

1.19
date	2013.11.21.17.35.45;	author leith;	state Exp;
branches;
next	1.18;

1.18
date	2013.11.20.19.11.28;	author leith;	state Exp;
branches;
next	1.17;

1.17
date	2013.11.20.14.46.06;	author leith;	state Exp;
branches;
next	1.16;

1.16
date	2013.11.19.16.20.53;	author leith;	state Exp;
branches;
next	1.15;

1.15
date	2013.10.31.18.28.54;	author leith;	state Exp;
branches;
next	1.14;

1.14
date	2013.08.27.17.54.55;	author leith;	state Exp;
branches;
next	1.13;

1.13
date	2013.07.31.13.06.34;	author tapu;	state Exp;
branches;
next	1.12;

1.12
date	2012.08.02.03.01.32;	author tapu;	state Exp;
branches;
next	1.11;

1.11
date	2012.08.01.02.13.15;	author tapu;	state Exp;
branches;
next	1.10;

1.10
date	2012.07.19.18.31.48;	author tapu;	state Exp;
branches;
next	1.9;

1.9
date	2012.07.19.18.30.48;	author tapu;	state Exp;
branches;
next	1.8;

1.8
date	2012.06.22.18.00.05;	author tapu;	state Exp;
branches;
next	1.7;

1.7
date	2012.06.22.17.47.40;	author tapu;	state Exp;
branches;
next	1.6;

1.6
date	2012.06.14.20.14.20;	author tapu;	state Exp;
branches;
next	1.5;

1.5
date	2012.06.08.19.49.49;	author tapu;	state Exp;
branches;
next	1.4;

1.4
date	2012.06.08.19.35.31;	author tapu;	state Exp;
branches;
next	1.3;

1.3
date	2012.06.06.00.45.48;	author tapu;	state Exp;
branches;
next	1.2;

1.2
date	2012.05.24.04.06.57;	author tapu;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.23.04.13.01;	author tapu;	state Exp;
branches;
next	;


desc
@new file -- rewrite for 2dctf protocol
added mini-sitemap, changelog, quick-start guide, etc.
@


1.58
log
@project files missing
@
text
@<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>

<head>
  <title>Single Particle Reconstruction with SPIDER</title> 
  <link rel='stylesheet' href='mrstyle2.css' type='text/css' />
</head>

<body link="#0000ee" vlink="#0000ee" alink="#ff0000" bgcolor="#cccccc">

<br />

<table class="top" width = "100%" border="8" bordercolor="#99ccff">
   <tr>
   <td  align="left">
   <img width="108" height="103" src="pics/new11.jpg" align="left"></td>

   <td>
   <h2 class="top">Three Dimensional Reconstruction of Single Particle 
       Specimens using Reference Projections Without Defocus Groups</h2>
   </td>

   <td  align="right">
   <img width="108" height="104" src="pics/new22.jpg" align="right"></td>
   </tr>
</table>
<p />


<!-- --------------------- Introduction ------------------------------------ -->

<table class="heading" width="100%" >
   <tr> <td>  
   <p />
   <h3 class="heading">Introduction</h3>
   <p />
   </td> </tr>
</table>

<p>
 This document contains a protocol for creating a 3D reconstruction utilizing 'gold standard
 resolution workflow' from 
 electron micrographs without sorting the images into defocus groups. This method is an
 alternative to the legacy SPIDER method of 
 <a href="../../recon/mr.html"> creating a 3D reconstruction using defocus grouping</a>. 
 In both methods, once a set of particle images has been obtained, 
 an initial 3D reconstruction is calculated using coarse projection angles. 
 This is followed by refinement, which iteratively adjusts the angles for finer 
 resolution. </p>

<p>In the traditional method, ensembles of particles with similar defocus values 
 are grouped together.  A separate 3D reconstruction is computed for each 
 "defocus group."  CTF-correction is performed when these reconstructions 
 are merged into a final reconstruction.  
</p>

<p>
 In this alternative method, the CTF-correction is applied at the level of 
 windowed particle images.  This method presents certain advantages.  First, 
 it circumvents one of the approximations when using defocus groups, namely that 
 all particles in a defocus group follow the same CTF profile.  At high resolution,
 where the CTF oscillates more rapidly, this assumption may not hold.  
 Second, parallelization can be more efficient, since groups can be of identical 
 size, independent of the number of particles at each defocus.  Third, particles 
 from what would be sparsely populated defocus groups need not be thrown out.  
 In principle, though not yet implemented, astigmatic images can be corrected for 
 with this method, as can tilted-specimen images.  Lastly, interoperability with
 other software packages, which also correct for the CTF at the level of particle
 images, will be more straightforward.
</p>

<p>
 However the strategy of using defocus groups may have some advantages.  
 First is that it can readily account for the non-uniform distribution of 
 signal-to-noise in projection data (<a href="#PP12">Penczek, 2012</a>).  
 Second, we find that reconstructions using particle-level CTF-correction 
 sometimes show artifacts when using iterative backprojection methods, such as 
 <a href="../../../man/bprp.html"> <b>'BP RP'</b></a> or
 <a href="../../../man/bpcg.html"> <b>'BP CG'</b></a>, 
 whereas the use of defocus groups does not present such limitations.   
</p>

<p />

<hr />
<p  />

<!-- --------------------- Contents ------------------------------------ -->

<table class="heading" width="100%" >
   <tr> <td>  
   <p />
   <h3 class="heading">Contents</h3>
   <p />
   </td> </tr>
</table>


<ul>
<li> <a href="#Links">Links</a> -- For further information.</li>

<li> <a href="#RunningSPIDER">Running  SPIDER procedure files</a> -- 
    Getting started, and conventions used in this documentation.</li>

<li> <a href="#Quick">Quick-start guide</a> -- A simplified list of steps.</li>

<p />

<li> <b>Protocol:</b></li>
   <ul class="circles">
    <li> <a href="#CreatingProject">Creating new reconstruction project</a> --  
       Set up project directory with the proper subdirectories and procedure files.</li>

    <li> <a href="#Micrographs">Selecting micrographs</a> -- 
       Generate a list of micrographs and a preliminary screening.</li>  

    <li> <a href="#CTF">Contrast Transfer Function (CTF) Parameter Estimation</a> -- 
       Estimate the CTF parameters for each micrograph.</li>

    <li> <a href="#AUTO">Particle Windowing and Verification</a> -- 
       Identify likely particles from the micrographs, 
       and extract windowed images of individual particles from the micrographs.</li>

    <li> <a href="#SH">Alignment</a> -- 
       Align  the particle images to reference projections using shifts 
       and rotations.</li>

    <li> <a href="#CA">Averaging and Verification</a> -- 
       Compute averages of each reference view to assess the distribution 
       of projection views.</li>

    <li> <a href="#3D">3D Reconstruction</a> -- 
       Calculate a initial volume by back projection and estimate its resolution.</li>

    <li> <a href="#REF">Refinement</a> -- 
      Improve the resolution of the reconstruction by iteratively improving the 
      alignments. Each projection is given a
      chance "to find a better home" in terms of its translation and orientation 
      parameters.</li>
   </ul>

<li> <a href="#OTHER">Additional methods</a> -- 
    Other useful methods, such as classification, difference maps, and 
    frequency correction by X-ray scattering.  More details about these 
    methods may be found on the <a href="../../../techniques.html"> techniques</a> page.</li>

<li> <a href="#Refs">References</a> -- Citations to additional background information.</li>

<li> <a href="#Mods">Modifications log</a> -- Recent changes to the protocol.</li>

</ul>

<hr />
<p />

<a name="Links"></a>
<table class="heading" width="100%" >
   <tr> <td> 
   <p />
   <h3 class="heading">Links to further information</h3> 
   <p />
   </td> </tr>
</table>
<p />

<ul>
  <li> <a href="../../../glossary.html"> Glossary</a>. </li>

  <li> <a href="../../../strategies.html"> Reconstruction strategies</a>.  </li>

  <li> <a href="flowchart/flowchart.html">Flowchart of operations</a>.</li>
  
  <li> <a href= "mr1_verify.html">Classification-based particle verification</a>.</li>
  
  <li> <a href="docfiles.html">Format information for doc files</a>. </li>
  
  <li> <a href="params.html">Description of reconstruction parameters</a>.</li>
  
  <li> <a href="../../zi/zidoc.html">Using images from a ZI scanner</a>. </li>

  <li> <a href="../../recon/quantifoil.html">Handling circular images from Quantifoil grids</a>.</li>
  
  <li> <a href="#Refs">References</a>.</li>

</ul>

<p />
<hr />

<!-- ------------------- Running  SPIDER procedure files ------------------- -->

<a name="RunningSPIDER"></a>
<table class="heading" width="100%" >
   <tr> <td>  
   <p />
   <h3 class="heading">Running SPIDER procedure files</h3>
   <p />
   </td> </tr>
</table>

<p />
In the sections below, various file types are denoted by different fonts:

<ul>
<li><b>Each step in the process is bold and marked  by a bullet</b>.               <br />
   <a href="../">Procedure files</a> are links to the procedure script,            <br />
   <font class="input">Input files  </font> for that procedure are marked in pink, <br />
   <font class="output">Output files</font> from that procedure are marked in green.                                                                <br />
   Sometimes more than one approach is available. 
   Lists starting with lowercase letters indicate that you should choose:

   <ol class="choice">
      <li>one approach, or   </li>
      <li>the other approach,</li>
   </ol>
   but not both (unless you want to compare the two techniques).
   <p />
      
   <a href="../../../../tools/docs/tools.html"> SPIDER's Python Tools</a>   
   <font class="guitool"> (marked in brown)</font>  
   are usefull for analyzing some results. 
</li>

<p />

<li>The processing steps are 
     carried out by procedure files, which run many SPIDER operations automatically. 
     To use a procedure referred to in this document, copy the procedure to your 
     current working directory. Near the beginning 
     of each procedure, there is a list of parameters that can be adjusted
     according to your particular project. Some of the procedures may
     call additional procedure(s) listed below the procedure
     filename. You need not change anything inside these additional
     procedures. Use the following format to run a SPIDER procedure: <br />
   
     <code class="snippet">spider spi/dat @@proc</code>              <br />
   
     where 
     <code class="snippet">spi</code> is the procedure file extension, 
     <code class="snippet">dat</code> is the project data file extension, and 
     <code class="snippet">proc.spi </code> is the procedure file.
</li>

</ul>


<p />
   The data below are sometimes shown plotted with <i>gnuplot</i>; see the
   <a href="http://www.gnuplot.info/">Gnuplot manual</a> for details. 
<p />

<h4>After each step check the output files to make sure the results are 
    sensible. If you are not sure what is "sensible," ask an expert. </h4> 
</p>


<!-- ************************ Quick-start guide ******************** -->

<hr /> 

<a name="Quick"></a>
<table class="heading" width="100%" >
   <tr> <td>    
   <p />  
   <h3 class="heading">Quick-start guide</h3>

   <p class="explain">This is a brief listing of steps in this protocol. 
   For simplicity, options have been limited. For further information, see below.
   A <a href="../Procs/test_recon1.spi">procedure for testing a complete reconstruction</a>
   using the <a href="#SH08"> Nature Protocols paper</a> data set is provided.</p>
   
   <p>Data extension is assumed to be: <code class="snippet">dat</code></p>
   
   </td> </tr>
</table>
</a>

<p><a href="#CreatingProject"> In your working directory (<i>e.g.</i><b>user</b>):</a></p>

<ol><code class="snippet">
    <li>cp $SPIDER_DIR/docs/techs/recon1/spiproject.tar.gz <b>.</b> </li>
    <li>tar -xvf spiproject.tar.gz                                  </li>
    <li>cd myproject                                                </li></code></ol>

<p><a href="#CreatingProject"> In your project directory (<b>myproject</b>):</a></p>

<ol start=4 ><code class="snippet">
    <li>cp &nbsp;  `which spider`  &nbsp; ./spider </li> 
    <li> Data loading choices:
    <ol type='A'>
        <li>mv &nbsp; /actual-location-of-your/micrographs/raw* &nbsp;&nbsp; Micrographs/ <br />
             spider spi/dat @@make-params                                                  <br />
             spider spi/dat @@resizevol                                                </li>
        <li> tar -xvf $SPIDER_DIR/docs/techs/recon1/natproc_data_mics.tar.gz <br />   </li>
      </ol>                                                                           </li>
</code></ol>

<p><a href="#Micrographs"> In <b>Micrographs/</b></a>: </p>
<ol start=6><code class="snippet">
    <li>spider spi/dat @@make-mic-list                                        </li>
    <li>spider spi/dat @@shrink-mic                                           </li>
    <li>montagefromdoc &nbsp; ../sel_micrograph.dat &nbsp; sm_mic_* &amp; </li>
</code></ol>

<p><a href="#Micrographs"> In <b>Power_Spectra/</b></a>: </p>
<ol start=9><code class="snippet">
    <li>spider spi/dat @@ctffind                                          </li>
    <li>montagefromdoc &nbsp; ../sel_micrograph.dat &nbsp; power/pw_avg* </li>

    <li>ctfmatch.py    &nbsp; power/ctf* &amp;                           </li>
    <li>spider spi/dat @@make-ctf-cor                                     </li>
</code></ol>

<p><a href="#AUTO"> In <b>Particles/</b></a>: </p>
<ol start=13><code class="snippet">
    <li>spider spi/dat @@make-noise-img  </li>

    <li> Particle picking choices
      <ol class="choice"  type='A'>
        <li>spider spi/dat @@pick-at </li>
        <li>spider spi/dat @@pick-lfc </li>
      </ol>
    </li>
    <li>montagefromdoc &nbsp; win/sel_part_0001.dat win/winser_0001.dat &amp </li>
    <li>[<b>Optional</b>] Initial verification
      <ol>
        <li>spider spi/dat @@denoise-imgs            </li>
        <li>Use <b>Montage</b> operation in <a href="../../../../../web/docs/web.html">
          <font class="guitool">WEB</font></a>.     </li>
      </ol>                                         </li>

    <li>spider spi/dat @@number-parts                </li>
</code></ol>

<p><a href="#SH"> In <b>Reconstruction/</b></a>: </p>
<ol start=20><code class="snippet">
    <li>  spider spi/dat  @@restack-n-ctf            </li>
    <li>  spider spi/dat  @@make-ref-views           </li>
    <li> Alignment choices
      <ol class="choice" type='A'>
        <li>./spider spi/dat @@align                 </li>
        <li>./spider spi/dat @@pub-align             </li>
      </ol></li>
</code></ol>

<p><a href="#CA"> In <b>Averages/</b></a>: </p>
<ol start=23><code class="snippet">
    <li>spider spi/dat  @@select-byview              </li>
    <li>spider spi/dat  @@avg-filter-byview          </li>
    <li>spider spi/dat  @@plot-cc-vs-view            </li>
    <li>spider spi/dat  @@show-ref-views             </li>

    <li>[<b>Optional</b>] Classification-based verification
    <ol>
        <li>spider spi/dat  @@verify-class-byview    </li>
        <li>verifybyview.py views/prj001            </li> <!--  spil spi/dat @@make-good-classes   -->
        <li>spider spi/dat  @@verify-combine-classes </li>
        <li>spider spi/dat  @@plot-cc-vs-view        </li>
        <li>spider spi/dat  @@show-ref-views         </li>
        <li>spider spi/dat  @@plot-ref-views         </li>
        <li>spider spi/dat  @@parts-vs-defocus       </li>
    </ol></li>
    <li>spider spi/dat @@best-imgs</li>
</code></ol>
    
<p><a href="#3D"> In <b>Reconstruction/</b></a>: </p>
<ol start=29><code class="snippet">      
    <li>  spider spi/dat @@recon-regroup             </li>

    <li> Reconstruction choices
      <ol class="choice" type='A'>
        <li>./spider spi/dat @@recon                 </li>
        <li>./spider spi/dat @@pub-recon             </li>
      </ol>                                         </li>
    <li>  spider spi/dat @@plot-fsc-curve            </li>
</code></ol>


<p><a href="#REF"> In <b>Refinement/</b></a>: </p>
<ol start=32><code class="snippet">
    <li> Refinement choices
      <ol class="choice" type='A'>
        <li>./spider spi/dat @@refine                 </li>
        <li>./spider spi/dat @@pub-refine             </li>
      </ol>                                          </li>
    <li>  spider spi/dat @@plot-fsc-curves            </li>
</code></ol>

<hr />

<!-- ************************ Creating new reconstruction project ******************** -->

<a name="CreatingProject"></a>

<table class="heading" width="100%" >
   <tr> <td>      
   <p />
   <h3 class="heading">Creating a new reconstruction project</h3>

   <p class="explain">At the start of a reconstruction project, a project 
   directory has to be set up with the proper subdirectories and procedure files. </p>

   <p>Run these procedures  in the <i>project/</i> directory.   </p>
   </td> </tr>
</table>

<!-- SPIRE directory=_top_level_project -->

 <p />

 <ul>

   <li><p class="action">Create a project directory containing the required 
     subdirectories and procedure files </li> 

   <ol class="choice">

   <li> If using SPIDER reconstruction procedures, the procedure files below are pre-packed 
     into a tar archive: <a href="../spiproject.tar.gz">spiproject.tar.gz</a>  
     Unpack this tar archive inside your working directory:               <br />
     <span class="nobreak"><code class="snippet">tar zxvf $SPIDER_DIR/docs/techs/recon1/spiproject.tar.gz </code></span> <br />
     This will create a sub-directory called <i>myproject/</i>, containing 
     the procedure files and subdirectories for the whole  reconstruction project. Rename 
     <i>myproject</i> to any desired name, for example:<br />
     <code class="snippet">mv myproject ribosome</code> 
   </li>
   <p />

   A procedure for testing a complete reconstruction
   <a class="project" href="../Procs/test_recon1.spi">test_recon1.spi</a> will be available in
  your project directory.
</li>
</ol>

<p />




<li><p class="action">Create a parameter document file</p>

   Some processing information is stored in a project-wide document file that is used 
   by many procedure files. Run the interactive procedure: 
   <a class="project" href="../Procs/make-params.spi">make-params.spi</a> 
   in the top directory of your project. It creates a document file: <br />
   <table class="outs">
      <tr valign="top">  <td>&curren;                                                      </td>
          <td><span class="nobreak"><font class="output">params</font>:</span>             </td>
          <td>SPIDER document file containing the 
             <a href="./params.html">reconstruction parameters.                             </td></tr>
   </table>
</li>
<p />


<p>
   <li><p class="action">[Optional] Resize reference volume</p>
   
   A reference volume, named: <font class="output">ref_vol</font>, is required in 
   the <i>myproject</i> directory.
   If the pixel size of your reference 
   volume  (key 5 in the <font class="input">params</font> file) and/or the 
   dimensions (key 17 in <font class="input">params</font>) do not match 
   the data that you will be processing, then run: 
   <a class="project" href="../Procs/resizevol.spi">resizevol.spi</a> which reads:
   <font class="input">orig_reference_volume</font>,  

   from the top-level project directory to resize the volume. This creates:   <br />

   <table class="outs">
      <tr valign="top"><td>&curren;                                             </td>
         <td> <span class="nobreak"><font class="output">ref_vol</font>:</span> </td>
         <td>&nbsp; Resized reference volume.                                   </td></tr>
   </table>
   
   The reported interpolated pixel size may not exactly match the target 
   pixel size due to rounding errors, but the values should be close.
   </li>
</p>

<p>
   <li><p class="action"> Copy your current spider executable into your project</p>

   <!--<a class="project" href="../Procs/clean.sh">clean.sh</a> -->

   <code class="snippet">cp `which spider`  ./spider</code> <br />
 
   This will ensure that the same spider executable is available for the whole
   project and can be used to repeat the same output at any future time.
   </li>
</p>

</ul>


<hr />
<!-- ****************************** Prepare micrographs *********************** -->

<a name="PrepMicrographs"></a>
<table class="heading" width="100%" >
   <tr> <td>    <br />
   <h3 class="heading">Preparing micrographs</h3>

   <p class="explain">Place digitized micrographs in the <i>Micrographs/</i> directory.</p>
 
   <p>Run these procedures  in the <i>Micrographs/</i> directory.     </p>
   </td> </tr>
</table>

   <ol class="choice">
 
   <li>If you have successive frames from a K2 Direct Electron Capture Camera in MRC format
       <a class="project" href="../../framealign/framealign.html">align the frames </a> using   
       <a href="../Procs/framealign.spi">'framealign.spi'</a> which implements methodology from:
       X Li, P Mooney, S Zheng, C R Booth, M B Braunfeld, S Gubbens, D A Agard & Y Cheng.  <br />
       This is a global alignment over the whole image area and does not
       consider any movement of individual particles within the ice.                    <br />

    <p>  
    It reads 
    <span class="input"><font class="output">filenames</font></span> and 
    <span class="input"><font class="output">###.frames.mrc</font></span> 
    (Where  <i>###</i> denotes stem name of input set). 
    It creates:

    <table class="outs">
    <tr valign="top">
        <td>&curren;                                                                    </td>
        <td><span class="nobreak"><font class="output">###</font>:</span>               </td>
        <td>SPIDER micrograph stacks.                                                   </td> </tr>
    <tr valign="top"><td>&curren;                                                       </td>
        <td><span class="nobreak"><font class="output">filtstk_###</font>:</span>       </td>
        <td>Filtered micrograph stacks.                                                 </td> </tr>
    <tr valign="top"><td>&curren;                                                       </td>
        <td><span class="nobreak"><font class="output">shift_doc_###</font>:</span>     </td>
        <td>Raw alignment shift doc file.                                               </td> </tr>
     <tr valign="top"><td>&curren;                                                      </td>
        <td><span class="nobreak"><font class="output">mlr_shift_doc_###</font>:</span> </td>
        <td>Refined alignment shift doc file.                                           </td> </tr>
    <tr valign="top"><td>&curren;                                                       </td>
        <td><span class="nobreak"><font class="output">shstk_###</font>:</span>         </td>
        <td>Aligned frame image stacks.                                                 </td> </tr>
    <tr valign="top"><td>&curren;                                                       </td>
        <td><span class="nobreak"><font class="output">ali_###</font>:</span>           </td>
        <td>Summed aligned image.                                                       </td> </tr>
    </table>
    </li>

    <li>If you are using SPIDER, Hiscan TIFF, PerkinElmer, ZI, or Nikon Coolscan micrograph data:  <br />
        <span class="nobreak"><code class="snippet">mv /actual-location-of-micrographs/*###* &nbsp;  Micrographs/</code></span></p>
   
        <p>The procedures below can accept SPIDER, Hiscan TIFF, PerkinElmer, 
        <a href="../../zi/zidoc.html">ZI</a>, and Nikon Coolscan data.  
        These files may have been compressed with <i>gzip</i>, if so  
        be sure to indicate  compression in the <a href="params.html">params file</a>.  
        </p>
     </li>


     <a name="PROTOCOLS"></a>

     <li><small>
     If using the test data provided in the SPIDER distribution from the Nature Protocols paper
     load the data set and unpack it in your project directory:                                  <br />

     <span class="nobreak"><code class="snippet">tar -xvf $SPIDER_DIR/docs/techs/recon1/natproc_data_mics.tar.gz </code></span> <br />
     This creates:                                                                               <br />

     <table class="outs">
       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">sel_micrograph</font>:</span>            </td>
         <td>Micrograph selection doc file listing 4 micrographs 
             used later in the protocol.                                                         </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">Micrographs/raw****</font>:</span>       </td>
         <td>Four micrograph images.                                                             </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">orig_reference_volume.dat</font>:</span> </td>
         <td>Reference volume.                                                                   </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">reference_volume.dat</font>:</span>      </td>
         <td>Reference volume.                                                                   </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">params</font>:</span>                    </td>
         <td>Reconstruction parameter file.                                                      </td></tr>
     </table>

     If you are using this data you can skip the next two steps.   
     </small>
     </li>
  </ol>






<hr />
<!-- ****************************** Selecting micrographs ********************* -->

<a name="Micrographs"></a>
<table class="heading" width="100%" >
   <tr> <td>    <br />
   <h3 class="heading">Selecting micrographs</h3>

   <p class="explain">Generate a list of micrographs and screen the micrographs.</p>
 
   <p>Run these procedures  in the <i>Micrographs/</i> directory.     </p>
   </td> </tr>
</table>

<!-- SPIRE directory=Micrographs  -->

   <ul>
   
   <li><p class="action">Create a selection file for micrograph file numbers</p>

   <ol class="choice">
   
   <li> <a class="project" href="../Procs/make-mic-list.spi">make-mic-list.spi</a>  
   creates a micrograph selection doc file containing non-consecutive file numbers in 
   the top-level project directory: <br/>

   <table class="outs">
      <tr valign="top"><td>&curren;                                                   </td>
          <td><span class="nobreak"><font class="output">sel_micrograph</font>:</span></td>
          <td>Micrograph selection doc file listing the numbers of 
             the micrograph files to be processed.                                    </td> </tr>
   </table>
   The  text part of the filenames are entered as templates in the top 
   level procedure files - see below).  If you need to add/exclude
   files from this list , use a text editor to edit the appropriate
   lines, then use the 
   <a href="../../../man/docren.html">
   <b>'DOC REN'</b></a> operation in SPIDER to renumber lines in the selection doc file.</li>
   <br />
   <li>
   The Python script <a  class="project" href="../Procs/mkfilenums.py">mkfilenums.py</a> creates 
   a file containing possibly non-consecutive file numbers. 
   The syntax, not including the proper data extension. is: <br />
       <code class="snippet">mkfilenums.py ../sel_micrograph.dat Micrographs/raw*</code> </li>
   </ol>

   <p>
   <li><p class="action">[Optional] Shrink micrographs</p>
   
   Before screening the micrographs for quality, it may be 
   helpful to shrink the micrographs in order to quickly scan through them.    <br />  
   <a class="project" href="../Procs/shrink-mic.spi">shrink-mic.spi</a>, reads:
   <font class="input">../sel_micrograph</font>, and 
   <font class="input">raw****</font>.                                         <br />
   
   Set a reduction factor:  <i>[reduction]</i>  that will allow for placing a 
   reasonable number of micrographs on your computer screen (say, 2 to 8) at a 
   sufficient level of detail to evaluate them.
 
   The procedure creates:                              <br />
      <table class="outs">
      <tr valign="top"><td>&curren;                                                 </td>
          <td> <span class="nobreak"><font class="output">sm-mic****</font>:</span> </td>
          <td>&nbsp; Reduced size micrographs.                                      </td></tr>
   </table>
   </li>
   </p>

   <li><p class="action">[Optional] Screen micrographs</p>

   Screen the micrographs using the Python script:  
   <a href="../../../../tools/bin/montagefromdoc.py">
   <font class="guitool">montagefromdoc.py</font></a>.  The syntax, not including the 
   proper data extension is:                                                             <br />
   <span class="nobreak">  <code class="snippet">montagefromdoc ../sel_micrograph.dat sm-mic*</code> </span><br />
   Screening creates:
   <table class="outs">
      <tr valign="top"><td>&curren;                                                      </td>
        <td> <span class="nobreak"><font class="output">../sel_micrograph</font>:</span> </td>
        <td>&nbsp; An updated micrograph selection file.                                 </td></tr>
   </table>
   </li>

</li>
<p />

</ul>


<hr />

<!-- ******************************* CTF  estimation *********************** --> 
<a name="CTF"></a> 

<table class="heading" width="100%"><tr><td>              <br />
   <h3 class="heading">Contrast Transfer Function Parameter Estimation</h3>

   <p class="explain">Estimate defocus of each micrograph by calculating its 
    power spectrum. </p> 

   <div class="explain">For more information, see:
   <ol >
     <li> <a href="../../ctf/ctf.html">
          Contrast transfer function correction</a> tutorial.               </li>

     <li> <a href="../../../../tools/docs/ctfdemo.html">
          <font class="guitool">ctfdemo</font></a>, a program that 
          demonstrates effects of various parameters on the CTF.            </li>

     <li> <a href="#PP97">Penczek et al., 1997</a> for a fuller discussion. </li>
  </ol>
  </div>

  <p>Run these procedures  in the <i>Power_Spectra/</i> directory.  <br />
</td></tr></table>

<!-- SPIRE directory=Power_Spectra subdirectories=power -->
 <p>

 <ul>
 <a name="DEF"></a>

<li><p class="action"> Calculate the power spectrum for each micrograph and
    determine CTF defocus values: </p> 

    <a class="project" href="../Procs/ctffind.spi">ctffind.spi</a> 
      (which calls SPIDER procedure 
      <a class="project" href="../Procs/load-mic.spi">load-mic.spi</a>)
      reads each micrograph, computes an averaged power spectrum, and estimates defocus, 
      astigmatism, and cut-off frequency using SPIDER operation:  
      <a href="../../../man/ctffind.html"><b>'CTF FIND'</b></a>.
      This operation invokes the functionality from the MRC 
      <a href="http://grigoriefflab.janelia.org/software">ctffind3</a> software. 
    <p />

   This operation reads:
   <font class="input">../params</font>, 
   <font class="input">../sel_micrograph</font>, and 
   <font class="input">../Micrographs/raw****</font>.  

   It creates:

   <table class="outs">
      <tr valign="top"><td>&curren;                                                       </td>
          <td><span class="nobreak"><font class="output">power/pw_avg_****</font>:</span> </td>
          <td>2D power spectra, each is an average of many smaller
              power spectra calculated over the surface of the micrograph.                </td> </tr>

      <tr valign="top"><td>&curren;                                                       </td>
          <td><span class="nobreak"><font class="output">power/diag_pw_avg_****</font>:</span> </td>
          <td>2D diagnostic power spectra, which likewise is an average of smaller
              power spectra calculated over the surface of the micrograph.                </td> </tr>

      <tr valign="top"><td>&curren;                                                       </td>
          <td><span class="nobreak"><font class="output">power/roo_****</font>:</span>    </td>
          <td>Rotationally averaged power spectra.                                        </td>  </tr>

      <tr valign="top"><td>&curren;                                                       </td>
          <td><span class="nobreak"><font class="output">power/roo_doc_****</font>:</span>    </td>
          <td>Doc files containing 1D profiles of the rotationally averaged power spectra.  
          These doc files can be plotted with <b>gnuplot</b> or 
          <a href="../../../../tools/docs/pyplot.html">
          <font class="guitool">pyplot</font></a>                                         </td>  </tr>

      <tr valign="top"> <td>&curren;                                                     </td>
          <td><span class="nobreak"><font class="output">defocus</font>:</span>           </td>
          <td>A doc file of CTF defocus values.</td>
   </table>


   </p>
    The defocus values can also be interactively obtained using the  
       <a href="../../../../../web/docs/ctf.html">CTF from doc file</a> operation 
       in <a href="../../../../../web/docs/web.html"><font class="guitool">WEB</font></a>
       to read the 1D power spectra profiles:
       <font class="input">power/roo_doc_****</font>. 
       It assists the user to manually fit a CTF model to the profiles.
    <p />
    </li>

   
<li>
   <p class="action">Check the Thon rings in the power spectrum images</p>

   The power spectra are equivalent to diffraction patterns obtained in an optical 
   diffractometer. It is absolutely important that you screen the spectra before 
   proceeding any further.
   </p>

   <p>
   <table class="outs">
      <tr valign="top">
         <td> Things to look for:                                                   <br />
              Are the Thon rings round?                                             <br /> 
              Do the rings extend to high resolution?                               <br />
                                                                                    <br />
              You can discard micrographs that show one of the following artifacts: <br />
              &nbsp;&nbsp;&nbsp; Rings that are cut off unidirectionally (evidence of drift).             <br />
              &nbsp;&nbsp;&nbsp; Rings that are elliptical, or even  hyperbolic (evidence of astigmatism).<br />
          </td>

         <td><a href="pics/power.jpg"><img width="182" height="243" src="pics/power.jpg"></a> </td> </tr>
   </table>
   </p>   


   <p> The power spectra can be examined using three methods:

   <ol class="choice">

   <li>
      <p>
      Look at the power spectra: 
      <span class="nobreak"><font class="output">power/pw_avg_****</font></span> in a  
      <a href="../../../../../web/docs/web.html"><font class="guitool">WEB</font></a> montage 
      (using size reduction). 
      </p>
   </li>

   <li>
      <p>
      More informatively, look at the diagnostic power spectra: 
      <span class="nobreak"><font class="output">power/diag_pw_avg_****</font></span>  in a  
      <a href="../../../../../web/docs/web.html"><font class="guitool">WEB</font></a> montage 
      (using size reduction). 
      </p>
   </li>


   <li>
      <p>
       The CTF for each micrograph can be examined by using 
       <a class="project" href="../Procs/ctfinfo.spi">ctfinfo.spi</a> (which uses SPIDER operation: 
       <a href="../../../man/tfed.html"><b>'TF ED'</a></b>).  
       It reads: <br />
       <font class="input">../params</font> and <font class="input">power/pw_avg_****</font>.
       It creates: 

      <table class="outs">
      <tr valign="top"><td>&curren;                                                    </td>
          <td><span class="nobreak"><font class="output">power/ctf_****</font>:</span> </td>
          <td>Doc file containing CTF curve and noise info for each micrograph.        </td> </tr>
      </table>
      The <font class="output">power/ctf_****</font> doc files can then be verified using 
      <a  class="project" href="../../../../tools/docs/ctfmatch.html"> ctfmatch.py </a> tool.
      </p>
   </li>
   </ol>

</li>


<li>
   Remove bad micrographs from the selection doc file by either:
   
   <ol class="choice">
   
   <li>Using a text editor, remove the lines corresponding to the bad micrographs  
       from <font class="input">../sel_micrograph</font> and then use the 
       <a href="../../../man/docren.html">
       <b>'DOC REN'</b></a> operation in SPIDER to renumber the lines in that 
       selection doc file. </li>
   <p />
  
   <li>Screen the power spectra using 
       <a  class="project" href="../../../../tools/bin/montagefromdoc.py"> 
             <font class="guitool">montagefromdoc.py</font></a>.
       The syntax, not including the proper data extension. is:                    <br />
       <code class="snippet">montagefromdoc ../sel_micrograph.dat power/pw_avg_*</code>.  
       Use the GUI to select/reject desired micrographs. 
   </li>
   
   </ol>
   
<li><p class="action">Generate CTF profiles and correction files for each micrograph.</p>

    <a class="project" href="../Procs/make-ctf-cor.spi">make-ctf-cor.spi</a>  
       generates sets of CTF files and 1D CTF profiles.  The CTF correction files will be 
       applied to subsequent particle images. The procedure reads:
    <font class="input">../params</font>, 
    <font class="input">defocus</font>, and optionally: 
    <font class="input">power/roo_doc_****</font>.  It creates: 
 
    <table class="outs">
      <tr valign="top"><td>&curren;                                                          </td>
         <td><span class="nobreak"><font class="output">power/flipctf_****</font>:</span>    </td>
         <td>Phase flipping CTF correction files.                                            </td></tr>

      <tr valign="top"><td>&curren;                                                          </td>
         <td><span class="nobreak"><font class="output">power/flipctf_doc_****</font>:</span></td>
         <td>Optional doc file containing 1D profiles of straight CTF, phase-flipped CTF, 
             CTF with unaffected low-resolution terms, etc.                                  </td></tr>

      <tr valign="top"><td>&curren;                                                          </td>
         <td><span class="nobreak"><font class="output">viewtrap.gnu</font>:</span>          </td>
         <td>Optional Gnuplot script for plotting the 1D profiles of the the computed 
             transfer functions.                                                             </td></tr>
   </table>
 

   <table>
      <tr valign="top">
        <td> <!-- ====================== left ============ -->
          <div class="left">

          <p>In the Gnuplot output script <font class="output">viewtrap.gnu</font>
          one micrograph is chosen to plot the corresponding 1D transfer-function profiles. 
          By default, the micrograph with the highest defocus is chosen.  
          To plot a different micrograph's profiles, 
          set the parameter <i>[mic2plot]</i> to a different micrograph number in 
          <a class="project" href="../Procs/make-ctf-cor.spi">make-ctf-cor.spi</a>, 
          or simply edit the Gnuplot script.  The  plot should be displayed 
          automatically, if not  <a href="gnuplot.html?file=viewtrap.gnu">click here</a>.</p>
  
          The 1D profile outputs are interchangeable for CTF correction in the later procedures, but 
          by default the <font class="output">power/flipctf_****</font> files will be used. </p>
        </td>
        <td><!-- ====================== right ============ -->
          <div class="right">

          <a href="pics/viewtrap.jpg"
             <img src="pics/small_viewtrap.jpg"></img></a>.
        </td>
      </tr > 
   </table>

<!-- FUTURE ADDITION
<li>
   <p class="action">OPTIONAL: CTF correct micrographs. </p>

   <a class="project" href="../Procs/apply-ctfcor-mic.spi">apply-ctfcor-mic.spi</a> 
   applies CTF correction using phase flipping to the micrograph images. 
   In principle, a 2D CTF can be used, which could correct for astigmatism.
   It reads: 
   <font class="input">../sel_micrograph        </font>, 
   <font class="input">../Micrographs/raw****   </font>, and
   <font class="input">power/flipctf_****      </font>. 
   It creates:        

   <table class="outs">
      <tr valign="top"><td>&curren;                                                               </td>
          <td><span class="nobreak"><font class="output">flipd_mic_****</font>:</span> </td>
          <td>New CTF corrected micrographs.                                     </td></tr>
   </table>
    
</li>
 -->


</li>
<p />


</ul>

<hr />
<!-- *********************** Particles - Windowing and Verification ******************* -->

<a name="AUTO"></a> 
<table class="heading" width="100%"><tr><td>      
   <p />
   <h3 class="heading">Particle Windowing and Initial Verification</h3>

   <p class="explain">A particle picking procedure file analyzes each micrograph, 
      cutting out small windows of likely particle candidates. This is followed 
      by a manual selection process that identifies the good particle images and 
      rejects the bad ones. Particles automatically output by the procedure file are 
      said to be <i>windowed</i>; the subset that are manually chosen are said to 
      be <i>verified</i>.
   </p>

   <p>Run these procedures  in the <i>Particles/</i> directory.</p>
   </td></tr>
</table>

<!-- SPIRE directory=Particles subdirectories=coords, good, win, filt    -->

<ul>

<li><p class="action">Select a background noise file</p>
   A noise image is required to normalize the backgrounds of the
   particle images during automatic particle picking. Do one of the following:
   <p />
   <ol class="choice">
      <li>Use a noise image from a previous project (this is the easier
         way). The window sizes do not need to match.
      </li>
      <p />

      <li>
         <a class="project" href="../Procs/make-noise-img.spi">make-noise-img.spi</a> calls 
         <a class="project" href="../Procs/convert-p.spi">convert-p.spi</a> and reads: 
         <font class="input">../Micrographs/raw0001</font>.  It  creates: <br />
 
         <table class="outs">
            <tr valign="top"><td>&curren;              </td>
                <td><font class="output">noise</font>: </td>
                <td> &nbsp; A noise image.             </td></tr>
         </table>

      <table>
      <tr valign="top">
        <td> <!-- ====================== left ============ -->
          <div class="left">
          <p>This noise file has been randomly selected from a set of files 
          (<font class="output">tmpnoise/noi***</font>) that are windowed from regions 
          in the micrograph that appear not to contain any particles.   
          View the selected noise file. If the image contains any structure such 
          as a particle or junk then select one of the other
          candidates and copy it to <font class="output">noise.dat</font>. </p>
          </div>
        </td>
        <td> <!-- ====================== right ============ -->
          <div class="right">
          <img src="pics/noise.jpg"></img></a><br />
          Noise image
          </div>
        </td>
      </tr > 
      </table>

      </li>
  </ol>

  <p />

  <li> <p class="action">Run automatic phase of particle selection</p>

   Any of the following three approaches can be used.
   <p />

   <ol class="choice">
    <li>
       <a class="project" href="../Procs/pick-at.spi">pick-at.spi</a> 
       (which calls:  
       <a class="project" href="../Procs/convert-p.spi">convert-p.spi</a> and 
       <a class="project" href="../Procs/pick-at-p.spi">pick-at-p.spi</a>)
       applys correlation with a Gaussian blob to window particles.
       The micrographs are decimated by 1/4,
       Fourier filtered with a Gaussian low pass filter, and searched for
       peaks over regions corresponding to particle dimensions. Particles
       are windowed out and centered, then peak locations are corrected, and
       particles are windowed again. This procedure uses histogram
       equalization and reads: 
         <font class="input">../params             </font>, 
         <font class="input">sel_micrograph        </font>,  
         <font class="input">noise                 </font>, and  
         <font class="input">../Micrographs/raw****</font>. 

       It creates:                                 <br />

       <table class="outs">
         <tr valign="top"><td>&curren;                                                          </td>
              <td><span class="nobreak"><font class="output">win/sel_part_****</font>:</span>   </td>
              <td>Particle selection doc file for each micrograph.                              </td></tr>

          <tr valign="top"><td>&curren;                                                         </td>
              <td><span class="nobreak"><font class="output">win/data_bymic_****</font>:</span> </td>
              <td>Stacked particle images.                                                      </td></tr>

           <tr valign="top"><td>&curren;                                                        </td>
              <td><span class="nobreak"><font class="output">coords/pkcoor****</font>:</span>   </td>
              <td>Peak coordinates for particles.                                               </td></tr>

          <tr valign="top"><td>&curren;                                                         </td>
              <td><span class="nobreak"><font class="output">coords/ulcoor****</font>:</span>   </td>
              <td>Upper-left corner coordinates for particle windows.                           </td></tr>
       </table>
    </li>
    <p />

    <li> <a class="project" href="../Procs/pick-lfc.spi">pick-lfc.spi</a> 
       (which calls  
       <a class="project" href="../Procs/convert-p.spi">  convert-p.spi</a> and
       <a class="project" href="../Procs/pick-lfc-p.spi">pick-lfc-p.spi</a>)  
       uses 'Local Fast Correlation' to window particles.              <br />
       This algorithm uses 
       <a href="../../../partpick.html#LFC">local cross-correlation</a> 
       calculated using Fourier methods developed by
       <a href="#AR03">Roseman (2003)</a>. The implementation is described in 
       <a href="#BR04">Rath and Frank (2004)</a>. A reference volume is required
       to generate projections at desired Eulerian angles for 
       searching different orientations of the search image in the micrograph. 
       <a  href="../Procs/pick-lfc.spi">pick-lfc.spi</a>
       also performs a histogram-fitting normalization on the picked images.
       It reads: 
         <font class="input">../params             </font>, 
         <font class="input">sel_micrograph        </font>, 
         <font class="input">noise                 </font>, 
         <font class="input">../Micrographs/raw****</font>, and
         <font class="input">../reference_volume   </font>.

        It creates:                                <br />

        <table class="outs">

          <tr valign="top"><td>&curren;                                                         </td>
              <td><span class="nobreak"><font class="output">win/sel_part_****</font>:</span>   </td>
              <td>Particle selection doc file for each micrograph.                              </td></tr>

          <tr valign="top"><td>&curren;                                                         </td>
              <td><span class="nobreak"><font class="output">win/data_bymic_****</font>:</span> </td>
              <td>Stacks of particle images for each micrograph.                                </td></tr>

           <tr valign="top"><td>&curren;                                                        </td>
              <td><span class="nobreak"><font class="output">coords/pkcoor****</font>:</span>   </td>
              <td>Peak coordinates for particles.                                               </td></tr>

        </table>
    </li><p />
    
    <li>
       Window particles using <a href="http://blake.bcm.edu/emanwiki/EMAN2/Programs/e2boxer">
       <font class="guitool">e2boxer.py</font></a> from 
       <a href="http://blake.bcm.edu/emanwiki/EMAN2">EMAN2</a>, 
       saving the coordinates. Then run:
       
       <ol>
           <li><a class="project" href="../Procs/eman2spider.spi">eman2spider.spi</a>, 
           (which calls Python procedure 
           <a  class="project" href="../Procs/emancoords2spiderdoc.py">emancoords2spiderdoc.py</a> and 
           requires the SPIRE libraries). It creates:                           <br />
            <table class="outs">
              <tr valign="top"><td>&curren;                                                        </td>
                  <td><span class="nobreak"><font class="output">win/sel_part_****</font>:</span>  </td>
                  <td> Particle selection doc file for each micrograph.                            </td></tr>

              <tr valign="top"><td>&curren;                                                        </td>
                  <td><span class="nobreak"><font class="output">coords/pkcoor_****</font>:</span> </td>
                  <td>Pixel coordinates for <i>center</i> of particle images.                      </td></tr>
            </table></li>
            
           <li><a class="project" href="../Procs/rewindow.spi">rewindow.spi</a>, 
           windows out the particle images. It creates:             <br />
            <table class="outs">
              <tr valign="top"><td>&curren;                                                        </td>
                  <td><span class="nobreak"><font class="output">win/data_bymic_****</font>:</span></td>
                  <td>Stacks of particle images for each micrograph.                               </td></tr>
            </table></li>
       </ol>
    </li>
    
  </ol>
</li>
<p />

<a name="PFILT"></a>
<li><p class="action">[Optional] Low-pass filter particle images before particle verification.</p>

    <p> Visual selection of good particles (the optional next step) is easier if
    the particles have been low-pass filtered beforehand. 

    <a class="project" href="../Procs/denoise-imgs.spi">denoise-imgs.spi</a> 
       filters a set of images, adjusting filter settings for each micrograph, 
       based on its defocus.  It reads:
       <font class="input">../sel_micrograph   </font> and 
       <font class="input">win/data_bymic_**** </font>. 
       It creates:                   <br />
   <table class="outs">

      <tr valign="top"><td>&curren;                                                              </td>
         <td><span class="nobreak"><font class="output">filt/data_bymic_****</font>:</span> </td>
         <td>Stacks of low-pass filtered particle images.                                        </td></tr>
   </table>

   <table>
      <tr valign="top">
        <td><!-- ====================== left ============ -->
          <div class="left">
          <p> Use the filtered particles, not the raw particles, during visual selection. </p>
          </div>
        </td>

        <td><!-- ====================== right ============ -->
          <div class="right">
          <img src="pics/data_bymic_0001_5.jpg"></img></a> <br />
          Unfiltered
          </div>
        </td>
        
        <td>
          <div class="right">
          <img src="pics/data_filt_bymic0001_5.jpg"></img></a> <br />
          Filtered
          </div>
        </td>
      </tr > 
   </table>


</li>
<p />

<li><p class="action">[Optional] Verify the windowed particles</p>

   <p>This step is optional if using 
   <a href="mr1_verify.html">classification-based verification</a> 
   later on.    Sort through the windowed particle files to eliminate 
   any non-particles using one of these methods:
 
   <ol class="choice">

   <li>Screen the particles  using 
   <a  class="project" href="../../../../tools/bin/montagefromdoc.py"> 
   <font class="guitool">montagefromdoc.py</font></a>  
   E.g. to screen particles from micrograph #1234:                         <br />
   <span class="nobreak">
     <code class="snippet">montagefromdoc win/sel_part_1234.dat  filt/data_bymic_1234.dat</code></span>   <br />
   Set the "Output doc file" to: <font class="output">win/sel_good_1234</font>.
   You can switch to a new micrograph's particles with the <i>Open Selections</i> option.
   </li>
   <p />

   <li>Alternatively, you can screen the particles with  
   <a href="../../../../../web/docs/web.html"><font class="guitool"> WEB</font></a> using the 
   <a href="../../../../../web/docs/categorize.html"> Categorize from doc file</a> operation. 
   If, for example, you would like to verify the particles for micrograph #1234, 
   navigate to the <i>win/</i> directory and select 
   <font class="input">win/sel_part_1234.dat</font>, and when asked for the image template, 
   enter: <font class="input">../filt/data_filt_bymic_1234</font>       <br />
   When the filtered particle image files are displayed on the screen, use the mouse
   to click on each good particle. For each micrograph, save your 
   selections to a file called, for the example above, 
   <font class="output">win/sel_good_1234</font>. (More details in the 
   <a href="../../../faq.html#pick">SPIDER FAQ</a> and 
   <a href="../../../partpick.html">partpick.html</a>). Web creates:

   <table class="outs">
      <tr valign="top"><td>&curren;                                                 </td>
         <td><span class="nobreak"><font class="output">win/sel_good_****</font>:</span></td>
         <td>Particle selection doc files, one for each micrograph.                 </td>
      </tr>
   </table>

   If there are too many particles to fit on the screen comfortably, run
   <a class="project" href="../Procs/micmontagedocs.spi">micmontagedocs.spi</a>, 
   which will break each <font class="input">sel_part_****</font> file into smaller files 
   of the form: 
   <span class="nobreak"><font class="output">win/docmontage****_##</font></span>
  (by default with 200 particles each), and select these files using 
   <i>Categorize from doc file</i> in <font class="guitool">WEB</font> instead. 
</li>                                                                      <br />
</ol>

</li>

<p />

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
<li><small>If using the Nature Protocols data set, only four micrographs are available
    in the data set.  If you wish to switch and continue using all 14 micrographs's
    verified particles then you will have to load the complete set of data at this step!

    Rename the following files:</small>
        <br /><code><b>mv sel_micrograph_14mics.dat sel_micrograph.dat
        <br />mv Power_Spectra/defocus_14mics.dat Power_Spectra/defocus.dat</b>
        </code>
</li>
!!!!!! -->


<li><p class="action">Remove duplicate particles, and assign a unique global particle 
                      number for each image</p>

   <p><a class="project" href="../Procs/number-parts.spi">number-parts.spi</a> 
   will assign a global particle number that will help track particles later as they are 
   grouped and regrouped.  This number will optionally be placed in the particle image file's
   header for future reference. Also created new selection files for unduplicated 'good' 
   images.      </p>

    It reads: 
    <font class="input">sel_micrograph</font>, and <font class="input">win/data_bymic_****</font>. <br /> 
    It also reads the particle selection files:    <font class="input">win/sel_good_****</font>.  <br />
    If you did not visually verify the windowed particles, set: <i> [old_sel_part]</i> to:
     <font class="input">win/sel_part_****</font> instead of:
     <font class="input">win/sel_good_****</font>.</p>

   <p>If you know from experience that 
   <a href="../Procs/pick-lfc.spi">pick-lfc.spi</a>, for example,
   windows too many particles, you can set the register <i>[max-particles]</i> 
   to the expected number. 
   The first [max-particles] number of particles will be retained, assuming that 
   the particles are sorted 
   from best to worst, as is the case in <a href="../Procs/pick-lfc.spi">pick-lfc.spi</a>.</p>
   
   <p>If you are appending to an existing data set, set the register <i>[first-global]</i> 
   to a  number unused prior,  for example, the last particle number used plus 1.</p>
   
   <p>This procedure will optionally add the global particle number to the image header, 
   specified with the variable <i>[labelheader-yn]</i>.  
   As particle images get copied from one place to another -- 
   <i>e.g.</i>, micrograph stacks, parallelization stacks, etc. -- this identifier 
   will be retained in the copies.  
   Modification of the image stacks in this manner is somewhat slow, 
   in my test case taking several minutes instead of less than one minute. 
   However, if time is not an issue, or if you anticipate bookkeeping issues, 
   keep this header-assignment step, which is active by default.</p>
   
   The procedure creates:  <table class="outs">
      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">good/sel_part_****</font>:</span>     </td>
         <td>A set of particle selection doc files, one for each micrograph,
             listing unduplicated selected particle numbers.                                  </td></tr>
                     
      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">win/micwin2glonum_****</font>:</span> </td>
         <td>A set of look-up tables for the selected particles in each micrograph, 
             mapped to a unique global particle number.                                       </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">win/glonum2micwin</font>:</span>      </td>
         <td>A reverse look-up table for the selected particles in each micrograph, 
             mapped to a unique global particle number.                                       </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">percent_selected</font>:</span>       </td>
         <td>A doc file listing percentages of automatically picked vs 
             manually selected particles for each micrograph and overall.                     </td></tr>

   </table>
</li>

</ul>

<hr />

<!-- ********************** Alignment ****************************************** -->
<a name="SH"></a> 

<table class="heading" width="100%">
   <tr><td> 
   <p />
   <h3 class="heading">Alignment</h3>

   <p class="explain">
   Reference images are generated from the reference volume. Data particles 
   are compared to each reference to find the best match, and the corresponding 
   transformations (shifts and rotations) are written to a doc file. Finally, 
   the transformations are applied to the data images, aligning them to the 
   references.   </p>

   <p>Run these procedures  in the <i>Reconstruction/</i> directory.</p>
   </td></tr>
</table>
<!-- SPIRE directory=Reconstruction  subdirectories=work -->

<!--   Optional procedure to check defocus distribution 
   <a class="project" href="../Procs/good-parts-bymic.spi">good-parts-bymic.spi</a> 
-->

<ul>

<li>Whether you are running alignment in parallel or in series, edit (but do not run)
    <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a> <i>e.g.</i>:                                                      <br />
    &nbsp;&nbsp;<code class="snippet">nedit recon-settings.spi</code> <br />
    to set desired values for parameters and file names that will be used 
    both during alignment and subsequent reconstruction steps.        <br />
 
    Some notable parameters in
    <a  href="../Procs/recon-settings.spi">recon-settings.spi</a> are :

    <table class="outs">
      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[num-grps]</i></b>:                              </td>
          <td> Number of computational groups.</td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[shrange]</i></b>:                               </td>
          <td> Translation search range.</td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[step]</i></b>:                                  </td>
          <td>Translation step size.  The operation 
              <a href="../../../man/apsh.html">'AP SHC'</a>
              tries different combinations of shifts in increments of <i>[step]</i> 
              up to <i>[shrange]</i>,  performs an orientational alignment, 
              and chooses the best one. (See notes in the
              <a href="../../../man/apsh.html">'AP SHC' documentation</a>.) <br /> 
              For example, with a <i>[step]</i> and <i>[shrange]</i> both of 2, 
              'AP SHC' will try shifts of (-2,2),(0,2),(2,2),(-2,0),(0,0),
                                          (2,0),(-2,-2),(0,-2), and (2,-2).
           </td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[r2]</i></b>:                                    </td>
          <td>Outer alignment radius (pixels). The sum of 
              <i>[shrange]</i> and <i>[r2]</i> must be less than 
              half the image dimension.
           </td></tr> 

      <tr valign="top"><td>&curren;                                    </td>
          <td> <b><i>[incore-yn]</i></b>:                             </td>
          <td> Will load input images into incore stack. This more efficient, 
               but if you have insufficient memory, set it to zero.   </td></tr> 
    </table>


<p> In the following file names 
    <font class="input"> [win_dir]</font> denotes a directory used mainly for stacked
    windowed particle images and
    <font class="output">[rec_dir]</font> denotes a directory used mainly for alignment and
    reconstruction output.  This allows for 
    easy repetition of runs with differing parameter settings and minimizes moving/duplication of files.
    In the following we will assume that you have set: 
    <font class="input"> [win_dir]</font> = '../win_0'  and  
    <font class="output">[rec_dir]</font> = '../rec_0'.  
</p>


<li>
   <p class="action">CTF correct images and assign to groups for parallelization. </p>

   <a class="project" href="../Procs/stackwins-n-ctf.spi">stackwins-n-ctf.spi</a> 
   restacks particles listed in a set of particle selection files into the number of stacks
   specified in: <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a>. 
   If alignment is not going to be parallelized the number of new groups can be set to 1 
   (though not required).                                                                <br />

   <a class="project" href="../Procs/stackwins-n-ctf.spi">stackwins-n-ctf.spi</a> reads: 
   <font class="input">../sel_micrograph                  </font>, 
   <font class="input">../Particles/win/sel_good_****     </font>, 
   <font class="input">../Particles/win/data_bymic_****   </font>, and 
   <font class="input">../Power_Spectra/power/flipctf_****</font>. 
   and restacks particles into groups for parallelization. 
   It optionally applies CTF correction using phase flipping to the images 
   during restacking. In principle, a 2D CTF can be used, which could correct for astigmatism.
   The procedure creates:        

   <table class="outs">
      <tr valign="top"><td>&curren;                                                               </td>
          <td><span class="nobreak"><font class="output">[win_dir]/sel_group</font>:</span>       </td> 
          <td>New group selection doc file.                                                       </td></tr>

      <tr valign="top"><td>&curren;                                                               </td>
          <td><span class="nobreak"><font class="output">[win_dir]/sel_part_***</font>:</span>    </td>
          <td>New particle selection doc files.                                                   </td></tr>
      <tr valign="top"><td>&curren;                                                               </td>
          <td><span class="nobreak"><font class="output">[win_dir]/data_***</font>:</span>        </td>
          <td>New particle image stacks.                                                          </td></tr>

      <tr valign="top"><td>&curren;                                                               </td>
          <td><span class="nobreak"><font class="output">[win_dir]/part2glonum_***</font>:</span> </td>
          <td>Lookup tables listing global number for particles.                                  </td></tr>
   </table>
    
</li>


<p />


<li><p class="action">Create reference projections for alignment from a reference volume</p>

    <p> Reference projections (images) are views of the reference volume at known angles.
    In what follows, angular sampling is set to 15 degrees, which
    results in 83 reference projections. A reference volume
    from the top level project directory is needed to create the projections. 
    The row and column dimensions of the reference volume must match the dimensions
    of the particle windows. (see <a href="../Procs/resizevol.spi">resizevol.spi</a>)
    </p>

   <a class="project" href="../Procs/make-ref-views.spi">make-ref-views.spi</a> reads:
   <font class="input">[win_dir]/ref_vol</font>. It creates three files: 

   <table class="outs">
      <tr valign="top"><td>&curren;                                                          </td>
          <td><span class="nobreak"><font class="output">[rec_dir]/sel_proj</font>:</span> </td>
          <td>List of reference views.                                                       </td></tr>

       <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">[rec_dir]/ref_angs_00</font>:</span></td>
          <td>A doc file from
             <a href="../../../man/voea.html"><b>'VO EA'</b></a>
             listing the three Euler angles for each of the projections.                     </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">[rec_dir]/ref_projs_00</font>:</span></td>
          <td>Stacked reference images created using:    
              <a href="../../../man/pj3q.html"><b>'PJ 3Q'</b></a> 
              corresponding to the angles in the preceeding file.                            </td></tr>
   </table>

   <small> Note:  The 84'th projection angle listed in: <font class="output">ref_angs_00</font>
   is ignored as it has the same direction as a previous angle.</small>
   <p />
</li>

<p />

<li><p class="action">Align particles to the reference projections</p>

    <p>Alignment is compute-intensive and benefits by parallelization. 
    The following alignment choices depend on whether using you are using 
    <a href="pbs.html">PBS</a> or 
    <a href="../../../../pubsub/pubsub.html">PubSub</a> for parallelization 
    on a compute cluster or are running the alignment serially without a cluster.  <br />

   <ol class="choice">
   <li>If running the alignment serially, run SPIDER procedure:
      <a class="project" href="../Procs/align.spi">align.spi</a> 
      which calls:  
      <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a> and
      <a class="project" href="../Procs/align-loop.spi">    align-loop.spi    </a>  
      to carry out the alignment parameter determination and inplane alignment using SPIDER operations:
      <a href="../../../man/apshc.html"><b>'AP SHC'</b></a> and  
      <a href="../../../man/rtsf.html"><b>'RT SF'</b></a>.
      Start alignment with the following command:                           <br />
        &nbsp;&nbsp;<code class="snippet">spider spi/dat @@align  </code>  <br />
   </li>
   <p />

   <li>If you are running in parallel using PBS or PubSub, run 
      <a class="project" href="../Procs/pub-align.spi">pub-align.spi</a> 
      which calls:  
      <a class="project" href="../Procs/pub-submit.spi">      pub-submit.spi    </a>,
      <a class="project" href="../Procs/pub-refine-start.spi">pub-refine-start  </a>,
      <a class="project" href="../Procs/recon-settings.spi">  recon-settings.spi</a>, and
      <a class="project" href="../Procs/align-loop.spi">      align-loop.spi    </a>. 
      Start alignment with the following command:                                    <br />
        &nbsp;&nbsp;<code class="snippet">spider spi/dat @@pub-align 1 &amp; </code>  <br />
        where <i>1</i> will be the number given to the top-level SPIDER results file.
   </li>
   </ol>
   </p>

   <p>
    Both options read:
    <font class="input">[win_dir]/ref_vol     </font>,  
    <font class="input">[rec_dir]/ref_projs_00</font>, and 
    <font class="input">[rec_dir]/ref_angs_00 </font>. 

    They create:
    <table class="outs">
    <tr valign="top"><td>&curren;                                                            </td>
       <td><span class="nobreak"><font class="output">[rec_dir]/dala_01_***</font>:</span>   </td>
       <td>Aligned stacks of particle images for each group.                            </td></tr>

    <tr valign="top"><td>&curren;                                                            </td>
       <td><span class="nobreak"><font class="output">[rec_dir]/align_01_***</font>:</span>  </td>
       <td>Shift and rotation parameters for each group.                                </td></tr>

    <tr valign="top"><td>&curren;                                                            </td>
       <td><span class="nobreak"><font class="output">[rec_dir]/align_01</font>:</span>      </td>
       <td>Consolidated shift and rotation parameters for all groups.                   </td></tr>
    </table>
 
    <p />
    <p />
</li>
</ul>

<hr />

<!-- **************************** Compute Averages and Verify Particles ************************** -->

<a name="CA"></a> 
<table class="heading" width="100%"><tr><td> <br />
   <h3 class="heading">Compute Averages and Verify Particles</h3>

   <p class="explain">For all projections, all aligned particles of a 
   given reference view are averaged together. Further particle selection is 
   made by selecting a correlation cutoff threshold to reject some particles. 
   The distribution of particles among projections can be displayed.
   </p>

   <p>Run these procedures in the <i>Averages/</i> directory.</p>

   <p> Note:  *** denotes image group,  ### denotes view,  ??? denotes class </p>
   </td></tr>
</table>

<!-- SPIRE directory=Averages subdirectories=views -->

<ul>

<li>Edit (but do not run)
    <a class="project" href="../Procs/verify-settings.spi">verify-settings.spi</a> <i>e.g.</i>:                                                      <br />
    &nbsp;&nbsp;<code class="snippet">nedit verify-settings.spi</code> <br />
    to set desired values for parameters and any non-standard file names that will be used 
    during these steps.                                                                <br />
 
<li><p class="action"> Make particle selection doc files listing 
   particles corresponding to each reference projection                                 </p>

   <a class="project" href="../Procs/select-byview.spi">select-byview.spi</a></i> 
   (which calls:  
   <a class="project" href="../Procs/verify-settings.spi">verify-settings.spi)</a> reads: 
   <font class="input">[win_dir]/sel_group      </font>,  
   <font class="input">[win_dir]/sel_part_***   </font>, 
   <font class="input">[rec_dir]/ref_angs_01_***</font>, and 
   <font class="input">[rec_dir]/align_01_***   </font>.
  
   It creates:                                                                             <br />
   <table class="outs">
     <tr valign="top"><td>&curren;                                                             </td>
        <td><span class="nobreak"><font class="output">views/prj###/sel_part_byv</font>:</span></td>
        <td>List of particles associated with each reference view                         </td></tr>

      <tr valign="top"><td>&curren;                                                       </td>
        <td><span class="nobreak"><font class="output">views/parts_vsview_all</font>:</span    </td>
        <td>Summary of number of particles associated with each reference view.           </td></tr>
   </table>
</li>

<p />

<li> <p class="action">[Optional] Create average images for all projection views and, 
     optionally, write out filtered, aligned images.   This step is required if using the
        <a href="mr1_verify.html"> classification-based verification.</a> </p>
   
   <p>To skip the output of the filtered images, set the register <i>[save-filt-yn]</i>
   in the procedure parameters to: 0.  These filtered images are required if using
   <a href="mr1_verify.html">classification-based verification</a>.  
   The setting for: <i>[reduction]</i> is to save processing time and disk space.</p>
   
   <a class="project" href="../Procs/avg-filt-byview.spi">avg-filt-byview.spi</a> reads: 
   <font class="input">[win_dir]sel_proj        </font>,
   <font class="input">[rec_dir]/dala_01_***    </font>, and
   <font class="input">views/prj###/sel_part_byv</font>.
   It creates:

   <table class="outs">
     <tr valign="top"><td>&curren;                                                       </td>
       <td><span class="nobreak"><font class="output">views/prj###/allavg</font>:</span> </td>
       <td>Stacks of average images for each set of projections.                         </td></tr>

     <tr valign="top"><td>&curren;                                                       </td>
       <td><span class="nobreak"><font class="output">views/prj###/filtavg</font>:</span></td>
       <td>Filtered, aligned image stack [<b>Optional, required for <a href="mr1_verify.html">
           classification-based verification</a></b>]                                    </td></tr>
   </table>
   
   Projection views with many particles will have averages that resemble the 
   reference projection. Projection views with few particles will be noisy. 
   To view the sets of average images, either:

   <ol class="choice">
   
     <li>Use the <b>Montage</b> operation in  <a href="../../../../../web/docs/web.html">
     <font class="guitool">WEB</font></a>. </li>
   
     <li>Use <a href="../../../../tools/bin/montagefromdoc.py">
       <font  class="guitool">montagefromdoc.py</font></a>.  
       The syntax, not including the proper data extension. is:                        <br />
       <code class="snippet">montagefromdoc sd_vsview_all.dat prj***/allavg</code>     <br /> 
       Changing the column number for the image label will display: (1) The view number, 
       (2) The number of particles, or (3) The S.D. for the variance map.</li>
   </ol>
</li>

<p>The next two steps help to identify a threshold
   correlation coefficient that describes true particles as opposed to any 
   erroneously selected particles. 

<li><p class="action">Create histograms of the number of particles 
     vs. the cross correlation value </p>

   <p>
   <a class="project" href="../Procs/plot-cc-vs-view.spi">plot-cc-vs-view.spi</a> reads:
   <font class="input">[rec_dir]/sel_proj</font> and
   <font class="input">views/prj###/sel_part_byv</font>.                               <br />
   and creates a histogram that plots the number of particles vs. the cross correlation
   value. Experiment with the parameter <i>[num-bins]</i> if
   you want finer sampling per bin, or coarser (and thus more particles per bin).
   </p>
   
   <p>The procedure creates:
   <table class="outs">
   <tr valign="top"><td>&curren;                                                            </td>
      <td><span class="nobreak"><font class="output">prj###/sel_part_combined</font>:</span></td> 
      <td>Combined doc file of the same format as 
      <font class="input">views/prj###/sel_part_byv</font>.                                 </td></tr>

   <tr valign="top"><td>&curren;                                                            </td>
      <td><span class="nobreak"><font class="output">cc_vsview_all</font>:</span>           </td>
      <td>Histogram doc file of cross correlation values.                                   </td></tr>

   <tr valign="top"><td>&curren;                                                            </td>
      <td><span class="nobreak"><font class="output">cc_vsview_all.gnu</font>:</span>       </td> 
      <td>Gnuplot script for plotting the correlation histogram.                            </td></tr>
   </table>
   </p>

   <table>
   <tr valign="top">
      <td>    <!-- ====================== left ============ -->
        <div class="left">
        <p>The output Gnuplot script <font class="output">cc_vsview_all.gnu</font>
           will overlay the correlation histogram of the particle images 
           with a Gaussian profile. If the histograms display a bimodal
           distribution, the higher peak may correspond to actual particles,
           while the lower peak may show noise. A threshold can be chosen
           between two such peaks.   The plot should be displayed automatically, if not 
           <a href="gnuplot.html?file=cc_vsview_all.gnu">click here</a>. </p>
      </td>
      <td>    <!-- ====================== right ============ -->
        <div class="right">
        <a href="pics/cc_vsview_all.jpg"
           <img src="pics/small_cc_vsview_all.jpg"></img></a>.
      </td>
   </tr> 
   </table>
</li>

<li>
   <p class="action">[<b>Optional</b>] Check the spatial distribution of views 
   (angular directions) for the reconstruction                            </p>

   <p> <a class="project" href="../Procs/plot-ref-views.spi">plot-ref-views.spi</a> reads  
   <font class="input">views/parts_vsview_all</font>.
 
   It creates script files of gnuplot commands: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"> <font class="output">parts_vsview_all.gnu</font></span></td>
          <td> Gnuplot script to plot a histogram of number of particles vs projection view.</td></tr>
   </table>
   <p />

   <table>
      <tr valign="top">
        <td> <!-- ====================== left ============ -->
          <div class="left">

          <p>The output Gnuplot script <font class="output">parts_vsview_all.gnu</font>
          will plot a histogram of number of particles vs projection view. 
          The plot should be displayed automatically, if not 
          <a href="gnuplot.html?file=parts_vsview_all.gnu">click here</a>. </p>
        </td>

        <td> <!-- ====================== right ============ -->
          <div class="right">

          <a href="pics/parts_vsview_all.jpg"
             <img src="pics/small_parts_vsview_all.jpg"></img></a>.
        </td>
      </tr > 
   </table>



   <a class="project" href="../Procs/show-ref-views.spi">show-ref-views.spi</a> reads: 
   <font class="input">../Alignment/refangles</font>, and 
   <font class="input">views/parts_vsview</font>. It creates: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;                                                     </td>
          <td> <span class="nobreak"><font class="output">show_ref_views</font>: </span></td> 
          <td>SPIDER image showing distribution of sample images 
             among the various reference projections.                              </td></tr>

   </table> 

   <table>
      <tr valign="top">
        <td> <!-- ====================== left ============ -->
          <div class="left">

          <p>This image shows the various angular reference groups represented by small 
             circles. The radii of these circles are proportional to the number of 
             particles in each group. 
             Display the image using <a href="../../../../../web/docs/web.html">
             <font class="guitool">WEB</font></a> or
             <a  class="project" href="../../../../tools/docs/qview.html">
             <font class="guitool">qview.py</font></a>.
        </td>
        <td> <!-- ====================== right ============ -->
          <div class="right">

          <a href="pics/show_ref_views_all.jpg"
             <img src="pics/small_show_ref_views_all.jpg"></img></a>.
        </td>
      </tr > 
   </table>

</li>

<li> 
   <p class="action">[Optional] Classification-based verification </p>

   <p>Further information is provided at the 
      <a href="mr1_verify.html"> classification-based verification</a> 
      page. Briefly, this sub-protocol reads:

      <font class="input">views/prj###/sel_part_byv</font> and 
      <font class="input">views/prj###/filtavg     </font> and
      classifies the particles corresponding to each reference projection. </p>
   
   <!-- <a href="../Procs/make-good-classes.spi"> Used for testing only!</a> -->

   Summary of required steps: 

   <table class="outs">
      <tr valign="top"><td>&curren;                                                                          </td>
          <td> <a class="project" href="../Procs/verify-class-byview.spi">verify-class-byview.spi</a>:</span></td>
          <td> Classifies the particles corresponding to each reference projection.                          </td></tr>

   <!-- <a class="project" href="../Procs/.verifybyview"></a> Necessary startup file -->
      <tr valign="top"><td>&curren;                                                                          </td>
          <td> <span class="nobreak"><a class="project" href="../Procs/verifybyview.py">
               <font class="guitool">../Procs/verifybyview.py</font></a>                                     </td>
          <td> <a href="verifybyview.html"> Select particles by orientation and classification</a>:</span>
                after separation. </td></tr>

      <tr valign="top"><td>&curren;                                                                          </td>
          <td> <span class="nobreak"><a class="project" href="../Procs/verify-combine-classes.spi">verify-combine-classes.spi</a>:</span> 
          <td> Collects information about selected particles.                                                </td></tr>

      <tr valign="top"><td>&curren;                                                                          </td>
          <td> <span class="nobreak"><a class="project" href="../Procs/plot-cc-vs-view.spi">plot-cc-vs-view.spi</a>:</span> </td>
          <td> Creates histogram of cross correlation values.                                                </td></tr>
 
      <tr valign="top"><td>&curren;                                                                          </td>
          <td> <span class="nobreak"><a class="project" href="../Procs/parts-vs-defocus.spi">parts-vs-defocus.spi</a>:</span> </td>
          <td> Creates histogram of particle numbers vs defocus values.                                      </td></tr>
   </table> 
   
   <p>If performing this verification step, remember to alter the input file selection in:  
   <a class="project" href="../Procs/best-imgs.spi">best-imgs.spi</a>.
   </p>
   
</p>


<li>
   <a name="best-imgs"><p class="action">Create new group and particle selection files and 
   [optionally] limit over-represented angular projections</a> </p>

   <p>Run this procedure even if you aren't limiting over-represented views as   
      downstream procedures will need the outputs.</p>

   <p>
   <a class="project" href="../Procs/best-imgs.spi">best-imgs.spi</a> 
   optionally limits the numbers of images per reference view direction as 
   specified by parameter: <i>[maxim]</i>.  This will limit over-represented 
   angular projections which may cause a shape error in the reconstruction. 
   If you do not wish to limit over-represented views, 
   set the parameter: <i>[maxim]</i> to -1 (the default).</p>
   
   <p> Set the parameter: <i>[use-particles]</i> to  indicate whether you want to
   use the particle selection files from images without  
   <a href="mr1_verify.html">classification-based verification</a>, 
   "good" images from classification-based verification, or
   "rechecked good" images from classification-based verification.      </p> 
   <p>This parameter will choose between reading: 
   <font class="input">views/prj???/sel_part_byv_good</font> , or  
   <font class="input">views/prj???/sel_part_byv_goodB</font> , (from 
   <a href="../Procs/verify-recheck.spi">verify-recheck.spi</a>) in place of: 
   <font class="input">views/prj???/sel_part_byv_sort </font>.          </p>

   <p>
   <a class="project" href="../Procs/best-imgs.spi">best-imgs.spi</a> then reads: 
   
   <font class="input">[rec_dir]/sel_proj          </font>,
   <font class="input">[rec_dir]/sel_group         </font>, and
   <font class="input">[rec_dir]/sel_part_sort_*** </font>.        
   It creates:                                                                        <br />
   <table class="outs">
     <tr valign="top"><td>&curren;                                                    </td>
        <td><span class="nobreak"><font class="output">sel_group_best</font></span>   </td>
        <td> Group selection file                                                     </td></tr>

     <tr valign="top"><td>&curren;                                                    </td>
        <td><span class="nobreak"><font class="output">sel_part_best_***</font></span></td>
        <td> List of particles selected for each new group                            </td></tr>

    <tr valign="top"><td>&curren;                                                     </td>
        <td><span class="nobreak"><font class="output">views/prj###/sel_part_byv_best </font></span></td>
        <td> List of particles retained from each reference view                      </td></tr>

    <tr valign="top"><td>&curren;                                                     </td>
        <td><span class="nobreak"><font class="output">part_vsview_best</font></span> </td>
        <td> Summary of number of images in each reference view.                     </td></tr>
  </table> 
</p>
</li>
</ul>
<p />

<hr />
<!-- *************************** 3D Reconstruction ***************************** -->

<a name="3D"></a> 
<table class="heading" width="100%"><tr><td> 
   <p />
   <h3 class="heading">3D Reconstruction</h3>

   <p class="explain">Use the selected aligned particles to create an initial 3D volume. 
   To estimate the nominal resolution of the resulting structure, the particle images are split 
   into two equal sets, and the two resulting reconstruction volumes are compared. 
   </p>

   <p>Run these procedures in the <i>Reconstruction/</i> directory.</p>
</td></tr></table>

<!-- SPIRE directory=Reconstruction subdirectories=work -->

<p />

<ul>

<li>Edit (but do not run)
    <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a> <i>e.g.</i>:                                                      <br />
    &nbsp;&nbsp;<code class="snippet">nedit recon-settings.spi</code> <br />
    to set desired values for parameters and any non-standard file names that will be used 
    during these steps.                                                                <br />

    Some notable parameters in
    <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a>:
    <table class="outs">
      <tr valign="top"><td>&curren;                                          </td>
          <td> <b><i>[bp-type]</i></b>:                                      </td>
          <td> Backprojection method. More information below.                </td></tr> 

      <tr valign="top"><td>&curren;                                          </td>
          <td> <b><i>[stk-opt]</i></b>:                                      </td>
          <td> Stack options (<i>e.g.</i>, 0 to read from original location, 
               1 to copy into RAM, or 2 to copy temporarily to disk).        </td></tr> 

    </table>
    
    <p>
    For the parameter <b><i>[bp-type]</i></b>, the Fourier-based backprojections -- 
    <a href="../../../man/bp32f.html">'BP 32F'</a> 
    (option 2 in <a href="../Procs/bp-settings.spi">bp-settings.spi</a>) or 
    <a href="../../../man/bp3n.html">'BP 3N'</a> 
    (option 4) -- are recommended.  The iterative, real-space methods --
    <a href="../../../man/bprp.html">'BP RP'</a>  (option 3) or 
    <a href="../../../man/bpcg.html">'BP CG'</a>  (option 1) -- 
    sometimes cause artifacts in the reconstruction.  
    These artifacts include a rise in the FSC at high resolution, or sometimes 
    ripples in the reconstruction when viewed as <i>Z</i>-slices. 
    The artifacts may be due to inaccuracy in the estimated defocus. 
    Feel free to experiment, but be wary of the output.
    </p>
</li>

<li>
   <p class="action">Assign particles into groups for 3D reconstruction</p>
   
   <p> <a class="project" href="../Procs/recon-regroup.spi">recon-regroup.spi</a> 
   offers the choice between grouping particles into new groups or keeping the old groups. 
   If you have no desire to regroup the particles, set the parameter <i>[num-stacks]</i> to 0, 
   which will simply create links to the existing files for downstream files to read.
   Among the reasons to regroup the particles could be that
   the number of particles may have changed since groups were first established --
   for example following classification or limiting overrepresented views or by CC value --
   or perhaps the number of compute nodes available has changed. It reads: 
   <font class="input">../Averages/sel_group_best_*** </font>,  
   <font class="input">../Averages/sel_part_best_***  </font>,  
   <font class="input">[rec_dir]/data_***             </font>,  
   <font class="input">[rec_dir]/align_01_***         </font>, and 
   <font class="input">[rec_dir]/dala_01_***          </font>. 
   To perform a dry run -- for example to see how big the groups will be -- 
   set the parameter <i>[stacks-yn]</i> to 0.</p>

   <a class="project" href="../Procs/recon-regroup.spi">recon-regroup.spi</a> creates:  
   <table class="outs">
      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">[win_dir]/sel_group</font>:</span>    </td> 
         <td>Group selection document file.                                              </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">[win_dir]/sel_part_***</font>:</span> </td>
         <td>Doc file listing the particles in each group.                               </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">[win_dir]/data_ctfd_***</font>:</span></td>
         <td>Stack files containing particle images for each group.                      </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
         <td><span class="nobreak"><font class="output">[win_dir]/dala_01_***</font>:</span>  </td>
         <td>Stack files containing particle images for each group.                      </td></tr>
   </table>
</p>
</li>

<li><p class="action">Compute 3D reconstruction</p>

    <p>Create paired reconstructions for each group, 
    merge group reconstuctions into final combined reconstruction, 
    and compute reconstruction resolution.

   The following options will depend on whether using you are using 
   a PBS or <a href="../../../../pubsub/pubsub.html"> Publish and Subscribe</a> cluster or
   are running the reconstruction serially without a cluster.

   <ol class="choice">
   <li>If running the alignment serially, run SPIDER procedure:
      <a class="project" href="../Procs/recon.spi">recon.spi</a> 
      which calls:  
      <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a>,
      <a class="project" href="../Procs/recon-loop.spi">    recon-loop.spi        </a>, and   
      <a class="project" href="../Procs/merge-fsc-filt.spi">merge-fsc-filt.spi.spi</a>  
      to carry out the reconstruction.
      Start reconstruction with the following command:                        <br />
        &nbsp;&nbsp;<code class="snippet">spider spi/dat @@recon  </code>      <br />
   </li>
   <p />

   <li>If you are running in parallel using PBS or PubSub, run 
      <a class="project" href="../Procs/pub-recon.spi">pub-recon.spi</a> 
      which calls:  
      <a class="project" href="../Procs/pub-submit.spi">      pub-submit.spi    </a>,
      <a class="project" href="../Procs/pub-refine-start.spi">pub-refine-start  </a>,
      <a class="project" href="../Procs/recon-settings.spi">  recon-settings.spi</a>, and
      <a class="project" href="../Procs/recon-loop.spi">      recon-loop.spi    </a>. 
      Start reconstruction with the following command:                               <br />
        &nbsp;&nbsp;<code class="snippet">spider spi/dat @@pub-recon 1 &amp; </code>  <br />
        where <i>1</i> will be the number given to the top-level SPIDER results file.
   </li>
   </ol>
   </p>
 
   These procedures may create two particle selection doc files for each group 
   by partitioning alternate images into two sets:
   <table class="outs">
     <tr valign="top"><td>&curren;                                               </td>
        <td><span class="nobreak"><font class="output">sel_part_01_***_s1</font>:</td> 
        <td> List of odd numbered images for each group.                         </td></tr> 
 
     <tr valign="top"><td>&curren;                                               </td>
        <td><span class="nobreak"><font class="output">sel_part_01***_s2</font>: </td> 
        <td> List of even numbered images for each group.                        </td></tr> 
   </table>
   <br />

   They then create two reconstructions for each group using back projection: 

   <table class="outs">
      <tr valign="top"><td>&curren;                                                  </td>
          <td><span class="nobreak"><font class="output">vol_01_***_s1</font>:</span></td>
          <td> Reconstructed volume from first subset of images for each group. </td></tr> 

      <tr valign="top"><td>&curren;                                                  </td>
          <td><span class="nobreak"><font class="output">vol_01_***_s2</font>:</span></td>
          <td> Reconstructed volume from second subset of images for each group.</td></tr> 

      <tr valign="top"><td>&curren;                                                  </td>
          <td><span class="nobreak"><font class="output">vol_01_***</font>:</span>   </td>
          <td> Combined reconstructed volume for each group.                    </td></tr> 
   </table>

   <br />
     Finally, they add together the subset volumes to make a complete volume for
     the entire data set, and calculate the FSC resolution curve for the 
     complete reconstruction (using <a href="../../../man/fsc.html">'FSC'</a>). 
     This creates:                                        

    <table class="outs">
      <tr valign="top"><td>&curren;                                                </td>
          <td> <span class="nobreak"><font class="output">vol_01</font>:</span>    </td>
          <td> A 3D reconstruction from entire set of particles.                   </td></tr>
 
      <tr valign="top"><td>&curren;                                                </td>
          <td> <span class="nobreak"><font class="output">fsc_doc_u</font>:</span> </td>
          <td> Doc file containing unmasked FSC curve for final reconstruction.    </td></tr>
 
      <tr valign="top"><td>&curren;                                                </td>
          <td> <span class="nobreak"><font class="output">fsc_doc_m</font>:</span> </td>
          <td> Doc file containing masked FSC curve for final reconstruction.      </td></tr>
 
      <tr valign="top"><td>&curren;                                                </td>
          <td> <span class="nobreak"><font class="output">resolution</font>:</span></td>
          <td> Doc file containing masked and unmasked resolution (in Angstroms).  </td> </tr> 
    </table>
 

 
 The following is a brief tree of procedure calls:
 <table border="1" style="background-color:eeeeee">
 <tr><td valign="top">
 <pre>
    <a class="project" href="../Procs/recon.spi"><b>recon</b></a>
    <a class="project" href="../Procs/recon-settings.spi">recon-settings</a>
    
    <a class="project" href="../Procs/recon-loop.spi">recon</a>
    <a class="project" href="../Procs/merge-fsc-filt.spi">merge-fsc-filt</a>
 </pre></td>

   <td><pre>
 <a class="project" href="../Procs/pub-recon.spi"><b>pub-recon</b></a>
    <a class="project" href="../Procs/recon-settings.spi">recon-settings</a>
        <a class="project" href="../Procs/recon-loop.spi">recon-loop</a>
    <a class="project" href="../Procs/merge-fsc-filt.spi">merge-fsc-filt</a>

 </pre></td>
 </tr></table>

 <li><p class="action">Check the FSC curve by viewing a plot.     </p>

   <a class="project" href="../Procs/plot-fsc-curve.spi">plot-fsc-curve</a> reads:
   <font class="input">fsc_doc_m              </font>.  
   It creates a text file of gnuplot commands:  
    <table class="outs">
      <tr valign="top"><td>&curren;                              </td>
          <td> <font class="output">fsc.gnu</font>:              </td>
          <td> Gnuplot script for plotting the resolution curve. </td></tr> 
    </table>   

    <table>
      <tr valign="top">
        <td> <!-- ====================== left ============ -->
          <div class="left">
          <p>The output Gnuplot script <font class="output">fsc.gnu</font>
          will plot the fsc curve and should be displayed 
          automatically, if not <a href="gnuplot.html?file=fsc.gnu">click here</a>.
          Examine this plot and see if there is an unusual curve.</p>
        </td>
        <td> <!-- ====================== right ============ -->
          <div class="right">
          <a  href="pics/fsc.jpg" <img src="pics/small_fsc_one.jpg"></img></a>.
        </td>
      </tr > 
   </table>
</li>


<p />

<li><p class="action">View the filtered volume</p>
  <p>
   This reconstruction <font class="output">vol_01</font> is known as the <i>initial volume</i>.

   View the filtered volume as a surface by using the <i>Surface</i> operation in 
   <a href="../../../../../web/docs/web.html"> <font class="guitool">WEB</font></a> 
   or by loading the volume in
   <a href="http://www.cgl.ucsf.edu/chimera/"><font class="guitool">Chimera</font></a>.</p>

     <table>
      <tr valign="top">
        <td><!-- ====================== left ============ -->
          <div class="left">

          View the volume as slices using the <i>Montage</i> operation in 
          <font class="guitool">WEB</font> or in 
          <a  class="project" href="../../../../tools/docs/montage.html">
          <font class="guitool">montage.py</font></a>.</p>

         </td>
        <td><!-- ====================== right ============ -->
          <div class="right">

          <a href="pics/vol01.jpg" <img src="pics/vol01.jpg"></img></a> <br />
          (Volume rendering)
        </td>
      </tr > 
   </table>


</li>
<br />
<br />


<hr />
<!-- ****************************** Refinement ********************************* -->

<a name="REF"></a> 
<table class="heading" width="100%"><tr><td> 
   <p />
   <h3 class="heading">Refinement</h3>

   <p class="explain">Refinement essentially performs the reconstruction steps repeatedly, 
     decreasing the angular resolution of reference projections with each iteration, 
     thereby giving the data particles a chance to find a better approximating 
     reference match each time. The data particles are allowed to "settle in" 
     and find better fitting angles, than the initial choices.  Refinement is a 
     computationally expensive operation. Before starting a refinement, check the 
     results of the above reconstructions, to ensure that the initial volume
     is reasonable to start. Refinement is currently set to re-start with the unaligned          
     images instead of the alignments from the reconstruction step, since this does not 
     take much additional time at coarse reference angles. The workflow is set up to
     create two subset reconstructions as needed for 'gold standard' resolution 
     determination.
   </p>

   <p>Run these procedures in the <i>Refinement/</i> directory.</p>
</td></tr></table>

<!-- SPIRE directory=Refinement subdirectories=work -->

<p />

<li><p class="action">Access your refinement directory, <i>e.g.</i>:<br />
       <code class="snippet">cd &nbsp;/mydir/project/Refinement</code></p>
</li>

<li><p class="action">Remove existing output files currently in refinement directory, <i>e.g.</i>:<br />
   <code class="snippet">rm -f &nbsp;results.* 
   &nbsp;LOG.* &nbsp;fort.*&nbsp;work/*  &nbsp;core* &nbsp; </code></p>                     
</li> 

<li><p class="action">Copy latest SPIDER executable into the current directory and rename it: <i>spider</i>. 
    This ensures that same SPIDER executable is used throughout whole refinement, <i>e.g.</i>:<br />
   <code class="snippet">cp /usr/local/spider/bin/spider_linux_mp_opt64.22.17 &nbsp; spider</code></p>
</li> 

<li><p class="action">Edit <a href="../Procs/refine-settings.spi">refine-settings.spi</a> to set
   necessary values for refinement parameters   and check input file names,
   <i>e.g.</i>: <br />
   <code class="snippet">nedit refine-settings.spi</code> <br />

   The following files  are needed, where 
   <font class="input"> '[win_dir]' </font> denotes input directory,  
   <font class="output">'[refi_dir]'</font> denotes refinement output directory,  
   '***' denotes group number, and 
   '##' denotes iteration number: <p />

   <table>  
   <tr><td> <span class="nobreak"><font class="input">../ref_vol</font>:</span> </td> 
       <td> Reference volume. (one)                                                        </td></tr>

   <tr><td> <span class="nobreak"><font class="input">[win_dir]/sel_group</font>:</span>        </td> 
       <td> Group selection file. (one)                                                    </td></tr>

   <tr><td> <span class="nobreak"><font class="input">[win_dir]/sel_part_***</font>:</span>     </td> 
       <td> Particle selection files. (one / group)                                        </td></tr> 

   <tr><td> <span class="nobreak"><font class="input">[win_dir]/data_***</font>:</span>         </td> 
       <td> Unaligned, CTF corrected, stacked image files.  (one / group)                   </td></tr>

   <tr><td> <span class="nobreak"><font class="input">[win_dir]/scattering</font>:</span>       </td> 
       <td> <b>Optional</b> X-ray scattering power spectrum file.  (one)                   </td></tr>

   <tr><td> <span class="nobreak"><font class="input">[win_dir]/mask</font>:</span>             </td> 
       <td> <b>Optional</b> amplitude enhancement mask file created from outer contour. (one) </td></tr>
   </table></p>
</li> 


<li> Run Serial or Parallel Refinement

   <ol class="choice" type='A'>
   <li> <b>Serial Refinement</b>

      <ol><li>Start refinement using 
          <a href= "../Procs/refine.spi">refine.spi</a>, <i>e.g.</i>: <br />
          <code class="snippet">spider spi/dat @@refine 0 &amp;</code>
      </li> </ol>
   <p />
   <li><b>Refinement on Cluster using PBS or Pubsub</b>

      <ol>
         <li>Login to master node of cluster, where PBS or   
             <a href="../../../../pubsub/pubsub_inst.html">PubSub</a> 
             is running</a>, <i>e.g.</i>:<br />
             <code class="snippet">ssh &nbsp;gyan</code>
         </li> <p />

         <li>Start master SPIDER refinement process 
             <a href= "../Procs/pub-refine.spi">pub-refine.spi</a>, <i>e.g.</i>: <br />
             <code class="snippet">./spider spi/dat &nbsp; @@pub-refine 0 &amp; </code>&nbsp;&nbsp;
              where <i>0</i> will be the number of the top-level SPIDER results file.</li>
         </li> <p />

         <li>The master SPIDER refinement process will create new SPIDER jobs as necessary using
             <a class="project" href="../Procs/qsub.pbs">qsub.pbs   </a> for PBS queing or 
             <a href= "../../../../pubsub/publish.perl">publish.perl</a> for PubSub queing.
         </li> <p />

         <li>If your PubSub refinement fails.<br />
         <ol> 
             <li>Use <code class="snippet">killspi</code> to stop any remaining parallel jobs that
                 belong to you. </li>
             <li>Use <code class="snippet">wherespi</code> to find any remaining parallel jobs. If any
                 remain, use <code class="snippet">killspi</code> again until they are all gone.</li>
             <li>Clean any un-needed output files (you may want to save
                 <i>final/*</i> and <i>results.*</i> if you are restarting at a
                 later iteration): <i>e.g.</i>: <br />
                 <code class="snippet">
                  rm -rf&nbsp;pubsub.log&nbsp;results.*&nbsp;LOG.*&nbsp;work/&nbsp;local/&nbsp;final/&nbsp;core*&nbsp;fort.*</code>
                 </code> </li>
             <li>To finish only the groups that had not finished that iteration, run
                 <a href="../Procs/pub-refine-fix1.spi">pub-refine-fix1.spi</a>, 
                 after setting the appropriate parameters.
                 Note that for the iteration <i>[iter]=16</i> will result in files ending in <i>017</i>.
                 The parameter <i>[rn]</i> is a random number inserted in the  
                 <font class="output">jnk_sync_jnk_sync***</font> output files, 
                 to prevent a zombie batch run from deleting a subsequent run's files. 
                 The parameter <i>[task]</i> is 0 for "regular" refinement and 1 for small-angle refinement.</li>
            <li>Edit <a href="../Procs/refine-settings.spi">refine-settings.spi</a>
                with a new starting iteration (if necessary)</li>
            <li>Restart according to step 7.</li>
         </ol>
         </li>

         <li>Refinement will halt after specified number of iterations.</li> <p />
      </li></ol>
   </li></ol>

<li><p class="action">Plot the refinement resolution curves                   <br />
   <a class="project" href="../Procs/plot-fsc-curves.spi">plot-fsc-curves.spi</a> reads:
   <font class="input">[refi_dir]/fscdoc_m_##</font>. <br /> 
   It creates a gnuplot script:         
   <table class="outs">
   <tr valign="top"><td>&curren;                                                </td>
      <td><span class="nobreak"><font class="output">[refi_dir]/fsc_iter.gnu</font>:</span></td>
      <td>Plots FSC resolution curve for each iteration of refinement.     </td> </tr> 
   </table>
           
   The plot of the FSC resolution curves should be displayed automatically, if not  
          <a href="gnuplot.html?file=fsc_iter.gnu">click here</a>.            
   <table>
   <tr> <td> <div class="right">
      <a href="pics/fsc_iter.jpg" <img src="pics/small_fsc_iter.jpg"></img></a>.
   </td> </tr > 
   </table>

 </li></ol>
 </li></ol>

 <b>Refinement Procedures:</b> (not all procedures are called)
 <p />

 <table border="1" style="background-color:eeeeee">
 <tr>
 <td valign="top"> 
 <pre>
   <a    class="project"       href="../Procs/refine.spi"><b>refine</b></a>
   .. <a class="project"       href="../Procs/refine-settings.spi">refine-settings</a>
   .. <a class="project"       href="../Procs/show-r2.spi">show-r2.spi</a>
   .. <a class="project"       href="../Procs/refine-setrefangles.spi">refine-setrefangles.spi</a>            
   .. <a class="project"       href="../Procs/pub-prjrefs.spi">pub-prjrefs</a>            
   .. <a class="project"       href="../Procs/refine-loop.spi">refine-loop</a>            
   .. <a class="project"       href="../Procs/refine-smangloop.spi">refine-smangloop</a>            
   .. <a class="project"       href="../Procs/refine-bp.spi">refine-bp</a>            
   .. <a class="project"       href="../Procs/merge-fsc-filt.spi">merge-fsc-filt</a>
   .. <a class="project"       href="../Procs/sphdecon.spi">sphdecon</a>            
   .. <a class="project"       href="../Procs/enhance.spi">enhance</a>
 </pre></td>

 <td><pre>
   <a class="project"          href="../Procs/pub-refine.spi"><b>pub-refine</b></a>
   .. <a class="project"       href="../Procs/refine-settings.spi">refine-settings</a>
   .. <a class="project"       href="../Procs/show-r2.spi">show-r2.spi</a>
   .. <a class="project"       href="../Procs/refine-setrefangles.spi">refine-setrefangles.spi</a>            
   .. <a class="project"       href="../Procs/pub-prjrefs.spi">pub-prjrefs</a>            
   .... <a class="project"     href="../Procs/pub-submit.spi">pub-submit</a>
   ...... <a class="project"   href="../Procs/memforqsub.spi">memforqsub.spi</a>
   .... <a class="project"     href="../Procs/publish.perl">publish</a>
   ...... <a class="project"   href="../Procs/pub-refine-start.spi">pub-refine-start (<i>[task]</i>=2)</a>          
   ........ <a class="project" href="../Procs/refine-settings.spi">refine-settings</a>            
   ........ <a class="project" href="../Procs/refine-prjloop.spi">refine-prjloop</a>
            
   .. <a class="project"       href="../Procs/pub-submit.spi">pub-submit</a>
   .... <a class="project"     href="../Procs/memforqsub.spi">memforqsub.spi</a>
   .. <a class="project"       href="../Procs/publish.perl">publish</a>
   .... <a class="project"     href="../Procs/pub-refine-start.spi">pub-refine-start (<i>[task]</i>=0/1)</a>          
   ...... <a class="project"   href="../Procs/refine-settings.spi">refine-settings</a>            
   ...... <a class="project"   href="../Procs/refine-loop.spi">refine-loop</a>            
   ...... <a class="project"   href="../Procs/refine-smangloop.spi">refine-smangloop</a>            
   ........ <a class="project" href="../Procs/refine-bp.spi">refine-bp</a>            
   .. <a class="project"       href="../Procs/merge-fsc-filt.spi">merge-fsc-filt</a>
   .... <a class="project"     href="../Procs/pub-submit.spi">pub-submit</a>
   ...... <a class="project"   href="../Procs/memforqsub.spi">memforqsub.spi</a>
   .... <a class="project"     href="../Procs/publish.perl">publish</a>
   ...... <a class="project"   href="../Procs/pub-refine-start.spi">pub-refine-start (<i>[task]</i>=3)</a>          
   ........ <a class="project" href="../Procs/refine-settings.spi">refine-settings</a>            
   ........ <a class="project" href="../Procs/sphdecon.spi">sphdecon</a>            
   .... <a class="project"     href="../Procs/enhance.spi">enhance</a>
   <a class="project"          href="../Procs/pub-refine-fix.spi">pub-refine-fix</a>
 </pre></td>
 </tr></table>
</li>
<p />

<b>Refinement Flowchart</b> (Steps indicated in <i><font color="#ff0000">red</font></i> 
   can be conducted in parallel on different processors.) 

<ol>
  <li><a href="../Procs/refine-settings.spi">refine-settings.spi</a> -- Set initial
      parameters &amp; file names</li>

  <li>Loop over all iterations creating iteration volumes<br />
  <ul>
     <li>Create reference projections used for this iteration <br />
     <table border="1">
        <tr>
        <td>'VO EA'</td>
        <td>Create reference angles for this iteration</td>
        </tr>

        <tr>
        <td>'PJ 3Q'</td>
        <td><font color="#ff0000">Create stack holding reference projections.</font></td>
        </tr>
     </table>
     </li>
     </li>

     <li><i><font color="#ff0000"><a href= "../Procs/refine-loop.spi">refine-loop.spi</a> 
         -- Loop over all groups creating group volumes<br /> </font></i> 
     <ul>
     <li>Find alignment parameters for particle images

     <table border="1">
       <tr>
       <td>'CP'</td>
       <td>Copy current unaligned images to inline stack for speed</td>
       </tr>

       <tr>
       <td>'AP REF' &nbsp; or <br /> 'AP SHC'</td>
       <td>Find reference projection that matches each current aligned image.
         Find alignment parameters to match selected reference projection.</td>
       </tr>
     </table>
     </li>

     <li>Loop over all images in current group</li>
     <ul>
       <li>Align original images for back-projection 

       <table border="1">
         <tr>
         <td> 'RT SF' </td>
         <td>Rotate, mirror, and shift unaligned original image to create
             current aligned image</td>
         </tr>
       </table>
       </li>
     </ul>
     </li>

     <li>Back-project original images into new group volume 

     <table border="1">
       <tr> <td>'BP 3F' or 'BP CG'</td>
       <td>Calculate refined group volume from new aligned images and angle data</td> </tr>

       <tr> <td>FSC</td>
       <td>Calculate phase residual for refined group volume</td> </tr>

     </table>
     </li>
   </ul>
</li>

<li><a href="../Procs/merge-fsc-filt.spi">merge-fsc-filt.spi</a></font></i>
      -- Merge group volumes into iteration volume

   <table border="1">
      <tr> <td>'AS S'</td>
      <td>Merge refined group volumes</td> </tr>

      <tr> <td>'AS S'</td>
      <td>Merge first sub-set refined group volumes</td> </tr>

      <tr> <td>'AS S'</td>
      <td>Merge second sub-set refined group volumes</td> </tr>

      <tr> <td>'FSC'</td>
      <td>Calculate resolution for combined volume</td> </tr>

      <tr>
      <td><a href="../Procs/enhance.spi">enhance.spi</a> </td>
      <td>Optional amplitude enhancement</td>
      </tr>

      <tr> <td>'FQ'</td>
      <td>Filter final corrected volume to limit resolution</td> </tr>
   </table>
</li>

</ul>
</li>
<p />

<li>Stop iterating when resolution fails to improve.                 <br />
    [<b>Optionally</b>] -- Continue with small-angle refinement </a>.</li>
<p />


</ol>
<p />

<b>Refinement Output</b><br />

  Among the outputs of refinement are volumes and doc files, important outputs are listed here<br /> 
  (<font class="output">'[refi_dir]'</font> denotes refinement output directory,  
   '***' denotes group number, '##' denotes iteration number, and '@@' denotes subset number) <p />

    <table class="outs">
      <tr valign="top"><td>&curren;                                                          </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/vol_##_s@@_raw</font>:</span></td>
          <td> Unfiltered subset volumes &nbsp; (two / iter)                                 </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/vol_##_s@@_unfilt</font>:</span></td>
          <td> Unfiltered, deconvolved subset volumes  &nbsp; (two / iter)                    </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/vol_##_s@@</font>:</span></td>
          <td> Filtered, deconvolved subset volumes  &nbsp; (two / iter)                      </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/vol_##_unfilt </font>:</span></td>
          <td>Complete unfiltered volume   &nbsp; (one / iter)                                </td></tr> 

     <tr valign="top"><td>&curren;                                                            </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/vol_##  </font>:</span>   </td>
          <td>Complete filtered volume &nbsp; (one / iter)                                    </td></tr> 

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/vol_##_cent</font>:</span></td>
          <td>Complete filtered, centered volumes  &nbsp; (one / iter)                        </td></tr> 

      <tr valign="top"><td>&curren;                                                           </td>
          <td> <font class="output">[refi_dir]/fscdoc_m_##</font>                             </td>
          <td> Masked FSC resolution curve doc files  &nbsp; (one / iter)                     </td></tr>

       <tr valign="top"><td>&curren;                                                          </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/resolutions</font>:</span></td>
          <td>Doc file listing resolution at each iteration. &nbsp; (one)                     </td></tr> 

      <tr valign="top"><td>&curren;                                                               </td>
          <td><span class="nobreak"><font class="output">[refi_dir]/align_##_***_s@@</font>:</span></td>
          <td>Alignment parameter doc files  &nbsp; (two / group / iter)                          </td></tr>
    </table>
<p />

Alignment parameter doc files are created for each group at each iteration with doc file registers containing:

<table border="5" cellpadding="10">
  <tr>
    <td>Proj. angle - PSI    </td>
    <td>Proj. angle - THETA  </td>
    <td>Proj. angle - PHI    </td>
    <td>Reference #          </td>
    <td>Image #              </td>
    <td>Inplane rotation angle</td>
    <td>X Shift              </td>
    <td>Y Shift              </td>
    <td>Number of proj.      </td>
    <td>Angular difference   </td>
    <td>CC Rotation          </td>
    <td>Current Inplane angle</td>
    <td>Current X Shift      </td>
    <td>Current Y Shift      </td>
    <td>Mirror & Cross corr. </td>
  </tr>
</table>


<p>
<!--<li><p class="action">[Optional] View angular data output from Refinement procedure files</p>

   The procedure <a class="project" href="../angdisp.spi">angdisp.spi</a> reads
   <font class="input">final/align_##_***</font> 
   and  creates angular distribution images: <br /> 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">disp_<i>ii</i>_***</font>: </td>
          <td>Set of images showing angular positions from the  
             <font class="output">align_<i>ii</i>_***</font> refined alignment 
             parameter output files. </td></tr> 
    </table>   

   The procedure <a class="project" href="../angdiff.spi">angdiff.spi</a> reads
   <font class="input">final/align_##_***</font> 
   and creates: 
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">diff_<i>ii</i>_***</font>: </td>
          <td>Image showing changes in angular positions from iteration <i>n-1</i> to 
             iteration <i>n</i>.</td></tr> 
    </table>   
</li>-->

</p>

<!-- SPIRE end -->

<hr \>
<!-- ************************* Other Useful Methods *********************************** -->

<a name="OTHER"></a> 
<table class="heading" width="100%">
   <tr><td>  
   <p />
   <h3 class="heading"> Other Useful Methods </h3>  
   <p />
   </td></tr>
</table>

<dl>

  <p>
  <dt><a href="../../../techs/diffmaps/index.html">Difference Maps</a> </dt>
  <dd>Differences between volumes can be assessed by subtracting one volume 
      from the other.</dd>
  </p>

  <p>
  <dt><a href="../../../techs/xray/xray.html">Frequency amplitude correction with X-ray
      scattering data</a></dt>
  <dd>Enhance the Fourier amplitudes of a reconstructed cryo-EM volume so they more 
      closely resemble those of experimental low-angle X-ray scattering data. </dd>
  </p>

  <p>
  <dt><a href="../../../techs/classification/index.html">Classification of Particles</a></dt>
  <dd>This method can be used to investigate differences between particles.</dd>
  </p>

  <p>
  <dt>See more methods on the <a href="../../../techniques.html">techniques page</a></dt>
  </p>

  <!--    Not updated ------------------------------------
  <p>
  <dt><u>Create tar files for backup</u></dt>
  <dd><a href="../Procs/backup.sh">backup.sh</a> a shell script, puts a number of vital 
   files into tar files, which can be backed up on tape. Edit the 
   shell script as needed, <i>e.g.</i>, to correspond to your data extension, 
   The variable <i>$BACKUP</i> is intended to be substituted for, for example, an external drive.
   Make sure it is executable and run it from your project directory. 
   The contents of some directories will will copied as tarballs, and 
   others will have their files copied individually.
  </dd>
  </p> --------------------------------------- -->

</dl>

<hr />

<a name="Refs"></a> 

<table class="heading" width="100%">
   <tr><td> <h3 class="heading"> References</h3> </td></tr>
</table>

<ol>

<li> <a href="http://dx.doi.org/10.1016/j.jsb.2014.05.002">
     Spherical Deconvolution Improves Quality of Single Particle Reconstruction</a>. &nbsp;&nbsp;&nbsp;
  Kishchenko GP and Leith A.                    &nbsp;&nbsp;
 <i>J. Structural Biol.</i> 187: 84-92 (2014).  &nbsp;&nbsp;

<li> <a href="http://dx.doi.org/doi:10.1107/97809553602060000874">
     Use of SPIDER and SPIRE in Image Reconstruction </a>.&nbsp;&nbsp;&nbsp;
  Leith A, Baxter W and Frank J.                   &nbsp;&nbsp;  
  <i>International Tables for Crystallography.</i> &nbsp;&nbsp; 
 Vol. F, ch. 19.8, 620-623 (2012)                  &nbsp;&nbsp;

<li>Fundamentals of three-dimensional reconstruction from projections. &nbsp;&nbsp;&nbsp;
 Penczek PA.                                          &nbsp;&nbsp;
 <i>Methods in Enzymology</i> 482: pages 1-33 (2012). &nbsp;&nbsp;


<li> Prevention of overfitting in cryo-EM structure determination.&nbsp;&nbsp;&nbsp;
 Scheres SHW and Chen S.                   &nbsp;&nbsp;    
 <i>Nature Methods</i>. 9: 853-854 (2012)  &nbsp;&nbsp;  

<li> <a href="http://www.nature.com/nprot/journal/v3/n12/full/nprot.2008.156.html">
    SPIDER image processing for single-particle reconstruction of 
    biological macromolecules from electron micrographs</a>.&nbsp;&nbsp;&nbsp;
 Shaikh TR, Gao H, Baxter WT, Asturias FJ, Boisset N, Leith A, and Frank J &nbsp;&nbsp;
 Nature Protocols. (online) </i> 3: 1941-1974 (2008)  &nbsp;&nbsp;

<li><a href="http://www.amazon.com/gp/product/0195182189/">
   Three-Dimensional Electron Microscopy of Macromolecular Assemblies</a>&nbsp;&nbsp;&nbsp; 
 Oxford University Press, (2006) &nbsp;&nbsp;

<li>A cryo-electron microscopic study of ribosome-bound termination factor RF2.&nbsp;&nbsp;&nbsp; 
 Rawat UBS., Zavialov A, Sengupta J, Valle JM, Grassucci R, 
    Linde J, Vestergaard B, Ehrenberg M, and Frank J.  &nbsp;&nbsp; 
 <i>Nature</i> 421: 87-90 (2003)                       &nbsp;&nbsp;

<li>Ribosomal dynamics explored by cryo-electron microscopy.&nbsp;&nbsp;&nbsp; 
 J Frank                           &nbsp;&nbsp; 
 <i>Methods</i> 25: 309-315 (2001) &nbsp;&nbsp;

<li>Three Dimensional Reconstruction with Contrast Transfer Compensation 
    from Defocus Series.&nbsp;&nbsp;&nbsp;
 Penczek PA, Zhu J, Schrder R, and Frank J.  &nbsp;&nbsp;
 <i>Scanning Microscopy</i> 11: 147- (1997)   &nbsp;&nbsp; 

<li>SPIDER and WEB: Processing and Visualization of Images in 3D 
    Electron Microscopy and Related Fields.&nbsp;&nbsp;&nbsp; 
 Frank J, Radermacher M, Penczek P, Zhu J, Li Y, Ladjadj M, and Leith A.  &nbsp;&nbsp; 
 <i>J. Structural Biol.</i> 116: 190-199 (1996)                           &nbsp;&nbsp;

<li>The ribosome at improved resolution: New techniques for merging and 
    orientation refinement in 3D cryo-electron microscopy of biological 
    particles. &nbsp;&nbsp;&nbsp; 
  Penczek P, Grassucci RA and Frank J.       &nbsp;&nbsp;   
  <i>Ultramicroscopy</i> 53: 251-270 (1994)  &nbsp;&nbsp;
 
<li>Three-dimensional reconstruction of single particles embedded in ice.&nbsp;&nbsp;&nbsp;
 Penczek P, Rademacher M, and Frank J.   &nbsp;&nbsp;
 <i>Ultramicroscopy</i> 40: 33-53 (1992) &nbsp;&nbsp;

<li> SPIDER -- a modular software system for electron image processing.&nbsp;&nbsp;&nbsp;
 Frank J, Shimkin B, Dowse H.              &nbsp;&nbsp; 
 <i>Ultramicroscopy</i> 6: 343-358 (1981)  &nbsp;&nbsp;

</ol>

<hr />

<small>

<!-- ************************* Modifications *********************************** -->

<a name="Mods"></a>
<table class="heading" width="100%" >
   <tr> <td>    
   <p />
   <h3 class="heading">Modifications log</h3>
   <p class="explain"> For a more complete list of changes, see individual procedures.</p>
   <p />
   </td> </tr>
</table>

<p />

<ul>
    <li>2016-02-10 -- Rewritten for 'gold standard' resolution, al. </li>
    <li>2013-11-22 -- Rewritten from defocus group protocol, al.    </li>
</ul>
</small>


<hr />
<p />

<small>
  Source: mr1.html            &nbsp;&nbsp;&nbsp; 
  Page updated: Jan 12, 2017 &nbsp;&nbsp;&nbsp;
  Tapu Shaikh & ArDean Leith
  <br />
  <address> Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a> </address>
</small>

</body>
</html>
@


1.57
log
@updated some links
@
text
@d302 1
a302 1
    <li>montagefromdoc.py &nbsp; ../sel_micrograph.dat &nbsp; sm_mic_* &amp; </li>
d324 1
a324 1
    <li>montagefromdoc.py &nbsp; win/sel_part_0001.dat win/winser_0001.dat &amp </li>
d673 1
a673 1
   <a href="../Procs/montagefromdoc.py">
d676 1
a676 1
   <span class="nobreak">  <code class="snippet">montagefromdoc.py ../sel_micrograph.dat sm-mic*</code> </span><br />
d870 1
a870 1
       <code class="snippet">montagefromdoc.py ../sel_micrograph.dat power/pw_avg_*</code>.  
d1205 1
a1205 1
   <a  class="project" href="../Procs/montagefromdoc.py"> 
d1643 2
a1644 2
     <li>Use <a href="../../../../tools/docs/montagefromdoc.html">
       <font  class="project" class="guitool">montagefromdoc.py</font></a>.  
d2325 1
a2325 1
   .. <a class="project"       href="../Procs/set-refangles.spi">set-refangles.spi</a>            
d2339 1
a2339 1
   .. <a class="project"       href="../Procs/set-refangles.spi">set-refangles.spi</a>            
d2342 1
a2342 1
   ...... <a class="project"   href="../Procs/memforqsub.spi.spi">memforqsub.spi</a>
d2349 1
a2349 1
   .... <a class="project"     href="../Procs/memforqsub.spi.spi">memforqsub.spi</a>
d2358 1
a2358 1
   ...... <a class="project"   href="../Procs/memforqsub.spi.spi">memforqsub.spi</a>
d2734 1
a2734 1
  Page updated: Aug 24, 2016 &nbsp;&nbsp;&nbsp;
@


1.56
log
@referenced reworked
@
text
@a165 1

d177 1
a177 1
  <li> <a href="params.html">Description of reconstruction parameters.</a>.</li>
d179 1
a179 1
  <li> <a href="../../recon/zi/zidoc.html">Using images from a ZI scanner</a>. </li>
d205 1
a205 1
<li><b>Each step in the process is bold and marked  by a bullet</b>                <br />
d553 1
a553 1
        <a href="../../recon/zi/zidoc.html">ZI</a>, and Nikon Coolscan data.  
d555 1
a555 1
        be sure to indicate  compression in the <a href= "params.html">params file</a>.  
a2547 2


a2629 3



@


1.55
log
@updated
@
text
@d168 1
a168 8
  <li><a href="flowchart/flowchart.html">A flowchart of operations.</a></li>
  
  <li><a href="docfiles.html">Format information for doc files.</a> </li>
  
  <li>A description of the
      <a href= "params.html">reconstruction parameters</a>.</li>
  
  <li>Information about images from the <a href="../../recon/zi/zidoc.html">ZI scanner</a>. </li>
d170 1
a170 2
  <li>How to convert ZI scanner TIF files to SPIDER format: 
      <a href="../../recon/zi/zi2spi.c"> zi2spi.c</a></li>
d172 1
a172 2
  <li>Procedure files for handling circular images from 
      <a href="../../recon/quantifoil.html">Quantifoil grids</a>.</li>
d174 1
a174 1
  <li><a href= "mr1_verify.html">Classification-based particle verification</a>.</li>
d176 1
a176 3
   <li> <a href="../../../strategies.html"> Reconstruction strategies</a> and the 
       <a href="../../../glossary.html"> glossary</a>.
  </li>
d178 1
a178 2
  <li> <a href="#PP92">Penczek et al. (1992)</a> describe the technique 
       of 3D reconstruction from particle images.</li>
d180 1
a180 2
  <li> <a href="#PP94">Penczek et al. (1994)</a> describe reconstruction using 
       projection matching (the approach  outlined below).</li>
d182 3
a184 5
  <li> <a href="http://www.amazon.com/gp/product/0195182189/">
       Three-Dimensional Electron Microscopy of Macromolecular Assemblies</a>,
       Oxford University Press,  (February 2006)</li>

  <li> <a href="../../../ref.html"> More references</a>.</li>
d2634 3
d2638 1
d2640 1
a2640 5
   <tr><td> 
   <p />
   <h3 class="heading"> References</h3>
   <p />
   </td></tr>
a2641 1
<p />
a2643 5
   <a name="PP92" />
   <li> Penczek P, Rademacher M, and Frank J. (1992) &nbsp;&nbsp;  
   Three-dimensional reconstruction of single particles embedded in ice.&nbsp;&nbsp; 
    <i>Ultramicroscopy</i> 40:33-53.
   </li>
d2645 62
a2706 52
   <a name="PP94" />
   <li> Penczek P, Grassucci RA and Frank J. (1994) &nbsp;&nbsp;  
   The ribosome at improved resolution: New techniques for merging and orientation 
   refinement in 3D cryo-electron microscopy of biological particles. &nbsp;&nbsp; 
   <i>Ultramicroscopy</i> 53, 251-270.
   </li>

   <a name="PP97" />
   <li>Penczek PA, Zhu J, Schrder R, Frank J. (1997) &nbsp;&nbsp; 
   <a href="../../ctf/pfefferkorn.pdf">
   Three Dimensional Reconstruction with Contrast Transfer Compensation 
   from Defocus Series.</a> &nbsp;&nbsp; 
   Special Issue on Signal and Image Processing, <i>Scanning Microscopy</i> Volume 11, page 147.
   </li>

   <a name="PP12" />
   <li>Penczek PA. (2012) &nbsp;&nbsp; 
   Fundamentals of three-dimensional reconstruction from projections. &nbsp;&nbsp; 
   <i>Methods in Enzymology</i> Volume 482, pages 1-33.
   </li>

   <a name="BR04" />
   <li>Rath BK and Frank J. (2004) &nbsp;&nbsp; 
   <i>Journal of Structural Biology</i>, Volume 145, Issues 1-2, January 2004, 
   Pages 84-90.
   </li>

   <a name="AR03" />
   <li>Roseman A. (2003) &nbsp;&nbsp;
   <i>Ultramicroscopy</i>, Vol 94 (3-4), pp. 225-236
   </li>

   <a name="SC12" />
   <li>Scheres SHW, Chen S. (2012) &nbsp;&nbsp;
   <a href="http://www.ncbi.nlm.nih.gov/pubmed/22842542"> 
   <i>Prevention of overfitting in cryo-EM structure determination.</i></a>.    
   <i>Nature Methods.</i> Vol 9: 853-854</i>  &nbsp;&nbsp;&nbsp;
   </li>


   <a name="SH08" />
   <li>Shaikh TR, Gao H, Baxter WT, Asturias FJ, Boisset N, Leith A, Frank J. (2008) &nbsp;&nbsp;
   <a href="http://www.nature.com/nprot/journal/v3/n12/full/nprot.2008.156.html">
   SPIDER image processing for single-particle reconstruction of 
   biological macromolecules from electron micrographs.</a>  &nbsp;&nbsp;
   Nature Protocols 3, 1941-1974 
   </li>

   <a name="ZH04" />
   <li>Huang Z and Penczek PA. (2004) &nbsp; &nbsp;
   <i>Journal of Structural Biology</i>, Volume 145, Issues 1-2, Pages 29-40.  &nbsp;&nbsp;
   </li>
a2709 1

d2713 1
d2730 1
a2730 1
    <li>2013-11-22 -- Rewritten from defocus group protocol, al. </li>
d2740 1
a2740 1
  Page updated: June 22, 2016 &nbsp;&nbsp;&nbsp;
@


1.54
log
@*** empty log message ***
@
text
@d475 1
a475 1
   A reference volume, <font class="output">ref_vol</font>, is required in 
d487 3
a489 3
      <tr valign="top"><td>&curren;                                              </td>
          <td> <span class="nobreak"><font class="output">ref_vol</font>:</span> </td>
          <td>&nbsp; Resized reference volume.                                   </td></tr>
d2312 1
a2312 1
   <font class="input">[refi_dir]]/fscdoc_m_##</font>. <br /> 
d2316 1
a2316 1
      <td><span class="nobreak"><font class="output">[refi_dir]]/fsc_iter.gnu</font>:</span></td>
@


1.53
log
@updated file names
@
text
@d475 3
a477 1
   A reference volume is required. If the pixel size of your reference 
d487 3
a489 3
      <tr valign="top"><td>&curren;                                                       </td>
          <td> <span class="nobreak"><font class="output">reference_volume</font>:</span> </td>
          <td>&nbsp; Resized reference volume.                                            </td></tr>
d1381 4
d1430 3
a1432 4
   Edit <a class="project" href="../Procs/restack-n-ctf.spi">restack-n-ctf.spi</a> <i>e.g.</i>:                                                      <br />
   &nbsp;&nbsp;<code class="snippet">nedit restack-n-ctf.spi</code>                      <br />
   to set  the number of new groups.  This number is arbitrary, but usually would the 
   number of nodes available for parallelization. 
d1436 1
a1436 1
   <a class="project" href="../Procs/restack-n-ctf.spi">restack-n-ctf.spi</a> reads: 
d1438 1
a1438 1
   <font class="input">../Particles/good/sel_part_****    </font>, 
d1844 1
a1844 1
   <a name="bestim"><p class="action">Create new group and particle selection files and 
d2229 1
a2229 1
   <tr><td> <span class="nobreak"><font class="input">../reference_volume</font>:</span> </td> 
@


1.52
log
@bad link fixed for alignframes
@
text
@d183 1
a183 1
  <li><a href= "mr1verify.html">Classification-based particle verification</a>.</li>
d323 1
a323 5
    <li> Defocus determination choices:
      <ol  class="choice" type='A'>
        <li>spider spi/dat @@powdefocus                                   </li>
        <li>spider spi/dat @@ctffind                                      </li>
      </ol>                                                              </li>
d344 1
a344 1
        <li>Use <b>Montage</b> operation in <a href="../../../../web/docs/web.html">
d656 1
a656 1
   The Python script <a href="../Procs/mkfilenums.py">mkfilenums.py</a> creates 
d686 2
a687 2
   Screen the micrographs using 
   <a href="../../../techs/recon1/Procs/montagefromdoc.py">
d689 1
a689 1
   proper data extension. is:                        <br />
d693 3
a695 3
      <tr valign="top"><td>&curren;                                                   </td>
        <td> <span class="nobreak"><font class="output">sel_micrograph</font>:</span> </td>
        <td>&nbsp; An updated micrograph selection file.                              </td></tr>
d721 1
a721 1
     <li> <a href="../../../../tools/doc/ctfdemo.html">
d739 1
a739 10
    determine CTF parameters using one of the following three methods: </p> 

    Choices:
    <ol class="choice">
    <li><a class="project" href="../Procs/powdefocus.spi">powdefocus.spi</a> 
      (which calls SPIDER procedure <a class="project" href="../Procs/load-mic.spi">load-mic.spi</a>)
      loads each micrograph, computes an averaged power spectrum, and estimates defocus
      using SPIDER operation: <a href="../../../man/tfed.html"><b>'CTF ED'</b></a>.
    </li>
    <p />
d741 1
a741 1
    <li> <a class="project" href="../Procs/ctffind.spi">ctffind.spi</a> 
d748 1
a748 2
      <a href="http://grigoriefflab.janelia.org/software">ctffind3</a>. 
    </li>
d751 4
a754 8
    <li>Run <a href="../Procs/powdefocus.spi">powdefocus.spi</a> 
       as in <b>a.</b> to create power spectra: 
       <font class="input">power/roo_****</font>.  Then use the 
       <a href="../../../../web/docs/ctf.html">CTF from doc file</a> operation 
       in <font class="guitool">WEB</font> to read <font class="input">power/roo****</font>. 
       The user then manually fits a CTF model to the 1D profiles.
    </li>
    </ol>
d756 1
a756 6
   <p />

   They read:
   <font class="input">..params</font>, 
   <font class="input">../sel_micrograph</font>, and 
   <font class="input">../Micrographs/raw****</font>. They create:  
d765 5
d771 5
a775 1
          <td>Doc files of 1D profiles of the rotationally averaged power spectra.  
d777 1
a777 1
          <a href="../../../../tools/doc/pyplot.html">
d780 1
a780 5
       <tr valign="top"> <td>&curren;                                                     </td>
          <td><span class="nobreak"><font class="output">power/ctf_****</font>:</span>    </td>
          <td>Doc files of the background-subtracted 1D power spectra.                    </td></tr>

       <tr valign="top"> <td>&curren;                                                     </td>
d782 1
a782 1
          <td>A doc file of CTF parameter values.</td>
a783 1
   </p>
a784 4
  
   <p>The <font class="output">ctf****</font> files can be verified with 
   <a href="../../../../tools/docs/ctfmatch.html">
   <font class="guitool">ctfmatch.py</font></a></p>
d786 9
d796 1
a799 9
   <p>
   Make a montage using 
   <a href="../../../../web/docs/web.html"><font class="guitool">WEB</font></a> 
   (size reduction: 4) to look at these power spectra. <br /> 

    Additionally the <font class="output">ctf****</font> files can be checked with 
    <a href="../../../../tools/docs/ctfmatch.html">
    <font class="guitool">ctfmatch.py</font></a> <br />

d820 45
d867 1
d873 2
a874 2
   <li>Using a text editor, remove the lines corresponding to the micrographs numbers 
       from <font class="input">sel_micrograph</font> and then use the 
d876 4
a879 3
       <b>'DOC REN'</b></a> operation in SPIDER to renumber the lines in this 
       selection doc file.</li>
   
d881 5
a885 3
       <a href="../Procs/montagefromdoc.py"> <font class="guitool">montagefromdoc.py</font></a>.
       The syntax, not including the proper data extension. is:         <br />
       <code class="snippet">montagefromdoc.py ../sel_micrograph.dat power/pw_avg_*</code> 
d895 1
a895 1
    <font class="input">..params</font>, 
d906 1
a906 1
         <td>Optional 1D profiles of straight CTF, phase-flipped CTF, 
a909 6
         <td><span class="nobreak"><font class="output">power/firstmin</font>:</span>        </td>
         <td>Optional Listing of the first CTF extremum and first zero for each micrograph.   <br />
             These values can be useful for filtering the images to the first 
             phase reversal.                                                                 </td></tr>

      <tr valign="top"><td>&curren;                                                          </td>
d931 1
a931 1
          by default the <font class="output">power/flipctf****</font> files will be used. </p>
d942 23
d997 1
a997 1
   particle images. Do one of the following:
d1020 1
a1020 2

          <p>This noise file is randomly selected from a set of files 
d1023 4
a1026 4
     
          View the selected noise file.   
          If it has any structure (particle, junk), then select one of the other
          candidates and copy it to <font class="output">noise.dat</font>.</p>
a1029 2

          <a  href="pics/noise.jpg"
d1032 1
d1060 1
d1064 2
a1065 1
       It creates:                                                    <br />
d1091 1
a1091 1
       uses 'Local Fast Correlation' to window particles.                  <br />
d1102 1
d1108 1
a1108 2
 
       The procedure creates:                                        <br />
d1124 1
a1124 4
          <tr valign="top"><td>&curren;                                                         </td>
              <td><span class="nobreak"><font class="output">coords/ulcoor****</font>:</span>   </td>
              <td>Upper-left corner coordinates for particle windows.                           </td></tr>
       </table>
d1136 1
a1136 1
           <a href="../Procs/emancoords2spiderdoc.py">emancoords2spiderdoc.py</a> and 
d1165 3
d1177 1
a1177 1
         <td><span class="nobreak"><font class="output">filt/data_filt_bymic_****</font>:</span> </td>
d1185 2
a1186 7

          <p> Manual selection of good particles (the next step) is easier if
          the particles have been low-pass filtered beforehand. Use the 
          filtered particles, not the raw particles, during selection in 
          <a href= "../../../../web/docs/web.html">
          <font class="guitool">WEB</font></a>. 
          </p>
a1190 2

          <a  href="pics/data_bymic_0001_5.jpg"
d1193 1
a1197 2

          <a  href="pics/data_filt_bymic0001_5.jpg"
d1200 1
d1209 1
a1209 1
<li><p class="action">Verify the windowed particles</p>
d1211 5
a1215 5
   <p>Sort through the output files to eliminate any non-particles.
   This step is optional if using 
   <a href="mr1verify.html">classification-based verification</a> 
   later on.</p>
   
d1218 19
a1236 8
   <li>This can be done in 
   <a href="../../../../web/docs/web.html"><font class="guitool"> WEB</font></a> using the 
   <a href="../../../../web/docs/categorize.html"> Categorize from doc file</a> operation. 
   If, for example, you would like to view 
   the particles for micrograph #1234, navigate to the <i>win/</i> directory and select 
   <font class="input">sel_part_1234.dat</font>, and when asked for the image template, enter: 
   <font class="input">winser_1234@@*</font> <br />
   When the particle image files are displayed on the screen, use the mouse
d1239 1
a1239 1
   <font class="output">good/good1234</font>. (More details in the 
d1241 1
a1241 1
   <a href="../../../partpick.html">partpick.html</a>).            <br />
d1245 1
a1245 1
         <td><span class="nobreak"><font class="output">good/good****</font>:</span></td>
a1257 8
   
<li>Alternatively, you can screen the particle's micrograph using 
   <a href="../Procs/montagefromdoc.py"> <font class="guitool">montagefromdoc.py</font></a>, 
   with the syntax to open micrograph #1234:                                  <br />
   <span class="nobreak"><code class="snippet">montagefromdoc.py coords/pkcoor_1234.dat</code></span>   <br />
   You can open a new micrograph's particles with the <i>Open Selections</i> option.
</li>
   
d1259 1
d1283 9
a1291 10
   header for future reference.</p>
   
   <p>If you verified particles from each micrograph using 
   <font class="guitool">WEB</font>, use as input 
   the selection file <font class="input">good/good****</font> (the default).
   If you did not verify particles using <font class="guitool">WEB</font>, then use as input 
   <font class="input">win/sel_part_****</font> (commented out in the procedure). <br />
   It also reads: 
    <font class="input">sel_micrograph</font>, and
    <font class="input">win/data_bymic_****</font>. </p>
d1459 2
d1475 1
a1475 1
   <font class="input">../ref_volume</font>. It creates three files: 
d1483 1
a1483 1
          <td><span class="nobreak"><font class="output">[rec_dir]/ref_angs_01</font>:</span></td>
d1489 1
a1489 1
          <td><span class="nobreak"><font class="output">[rec_dir]/ref_projs_01</font>:</span></td>
d1495 1
a1495 1
   <small> Note:  The 84'th projection angle listed in: <font class="output">ref_angs_01</font>
d1540 3
a1542 3
    <font class="input">../ref_vol            </font>,  
    <font class="input">[rec_dir]/ref_projs_01</font>, and 
    <font class="input">[rec_dir]/ref_angs_01 </font>. 
d1621 1
a1621 1
        <a href="mr1verify.html"> classification-based verification.</a> </p>
d1625 1
a1625 1
   <a href="mr1verify.html">classification-based verification</a>.  
d1641 1
a1641 1
       <td>Filtered, aligned image stack [<b>Optional, required for <a href="mr1verify.html">
d1651 1
a1651 1
     <li>Use the <b>Montage</b> operation in  <a href="../../../../web/docs/web.html">
d1655 1
a1655 1
       <font class="guitool">montagefromdoc.py</font></a>.  
d1775 1
a1775 1
             Display the image in <a href="../../../../web/docs/web.html">
d1777 1
a1777 1
             <a href="../../../../tools/docs/qview.html">
d1795 1
a1795 1
      <a href="mr1verify.html"> classification-based verification</a> 
d1855 1
a1855 1
   <a href="mr1verify.html">classification-based verification</a>, 
d2139 1
a2139 1
   <a href="../../../../web/docs/web.html"> <font class="guitool">WEB</font></a> 
d2150 1
a2150 1
          <a href="../../../../tools/doc/montage.html">
d2746 1
a2746 1
  Page updated: Jun. 22, 2016 &nbsp;&nbsp;&nbsp;
@


1.51
log
@framealign added
@
text
@d532 1
a532 1
       <a href="framealign.spi">'framealign.spi'</a> which implements methodology from:
d568 1
a568 1
        <span class="nobreak"><code class="snippet">mv /actual-location-of-micrographs/###* &nbsp;  Micrographs/</code></span></p>
d572 2
a573 2
        These files may have been compressed with <i>gzip</i>, so  
        be sure to indicate the compression in the <a href= "params.html">params file</a>.  
a577 1

d581 2
a582 2
     If using the test data provided in the SPIDER distribution 
     (originally used with the Nature Protocols paper) load the data set and unpack it:          <br />
d585 1
a585 1
     in your project directory. This creates:                                                    <br />
d611 2
a612 2
     </small></li>
  </li>
@


1.50
log
@zi2spi location
@
text
@a457 55
<li><p class="action">Place micrograph files in  <i>Micrographs/</i> directory</p>

   <p> Place the digitized micrographs in the <i>Micrographs/</i> directory</p>

   <ol class="choice">
 
     <li>If you are using your own data:  <br />
     <span class="nobreak"><code class="snippet">mv /actual-location-of-micrographs/raw* &nbsp;  Micrographs/</code></span></p>
   
     <p>The procedures below can accept SPIDER, Hiscan TIFF, PerkinElmer, ZI, and Nikon Coolscan data.  
     More information about images from the ZI scanner can be found 
     <a href="zi/zidoc.html">here</a>, and the 'C' program to convert ZI scanner TIF files to SPIDER format is called 
     <a href="../../recon/zi/zi2spi.c">zi2spi.c</a>.
     Any of these files may have been compressed with <i>gzip</i>, so  
     be sure to indicate the compression in: <a href= "params.html">the params file</a>.  
     </p>

     </li>

     <a name="PROTOCOLS"></a>

     <li><small>
     If using the test data provided in the SPIDER distribution 
     (originally used with the Nature Protocols paper) load the data set and unpack it:          <br />

     <span class="nobreak"><code class="snippet">tar -xvf $SPIDER_DIR/docs/techs/recon1/natproc_data_mics.tar.gz </code></span> <br />
     in your project directory. This creates:                                                    <br />

     <table class="outs">
       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">sel_micrograph</font>:</span>            </td>
         <td>Micrograph selection doc file listing 4 micrographs 
             used later in the protocol.                                                         </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">Micrographs/raw****</font>:</span>       </td>
         <td>Four micrograph images.                                                             </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">orig_reference_volume.dat</font>:</span> </td>
         <td>Reference volume.                                                                   </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">reference_volume.dat</font>:</span>      </td>
         <td>Reference volume.                                                                   </td></tr>

       <tr valign="top"><td>&curren;                                                             </td>
         <td><span class="nobreak"><font class="output">params</font>:</span>                    </td>
         <td>Reconstruction parameter file.                                                      </td></tr>
     </table>

     If you are using this data you can skip the next two steps.   
     </small></li>
  </li>
  </ol>
d515 107
d2705 1
a2705 1
  Page updated: Jun. 2, 2016 &nbsp;&nbsp;&nbsp;
@


1.49
log
@procs updated
@
text
@d470 1
a470 1
     <a href="../../../..//download/zi2spi.c">zi2spi.c</a>.
@


1.48
log
@qsub
@
text
@d1433 5
a1437 3
      which likewise calls:  
      <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a>, and
      <a class="project" href="../Procs/align-loop.spi">    align-loop.spi    </a>. 
d1912 3
a1914 2
      <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a> and
      <a class="project" href="../Procs/align-loop.spi">    align-loop.spi    </a>  
d1923 5
a1927 3
      which likewise calls:  
      <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a>, and
      <a class="project" href="../Procs/recon-loop.spi">    recon-loop.spi    </a>. 
d2178 2
a2179 2
             <a class="project" href="../Procs/qsub.pbs">qsub.pbs</a>using PBS</a> or 
             <a href= "../../../../pubsub/publish.perl">using PubSub</a>.
d2243 1
d2257 1
d2260 1
d2267 1
d2276 1
d2653 1
a2653 1
  Page updated: May. 9, 2016 &nbsp;&nbsp;&nbsp;
@


1.47
log
@*** empty log message ***
@
text
@d2173 2
a2174 2
             qsub or  
             <a href= "../../../../pubsub/publish.perl">PubSub</a>.
d2177 1
a2177 1
         <li>If the refinement fails.<br />
d2190 1
a2190 1
                 <a href="../Procs/pub-refine-fix.spi">pub-refine-fix.spi</a>, 
d2643 1
a2643 1
  Page updated: Mar. 28, 2016 &nbsp;&nbsp;&nbsp;
@


1.46
log
@fixed
@
text
@a1874 7
   <p><b>NOTE:</b> If you aren't regrouping the images and have set <i>[num-stacks]</i> to 0, 
   the procedure is written such that it should be in the same directory as the output files. 
   To find how to circumvent this, look up the <code class="snippet">ln</code> 
   command regarding relative paths, or look up the example in 
   <a href="../Procs/refine-prepare.spi">refine-prepare.spi</a> below.
   </p>

a2249 1
   .. <a class="project"       href="../Procs/refine-prepare.spi">refine-prepare</a>
@


1.45
log
@changed lots of filenames and locations
@
text
@d41 2
a42 1
 This document contains a protocol for creating a 3D reconstruction from 
d44 1
a44 1
 alternative to the traditional SPIDER method of 
d324 1
a324 1
      <ol type='A'>
d339 1
a339 1
      <ol type='A'>
d360 1
a360 1
      <ol type='A'>
d391 1
a391 1
      <ol type='A'>
d395 1
a395 1
    <li>  spider spi/dat @@plot-fsc                  </li>
d402 1
a402 1
      <ol type='A'>
d1277 41
d1327 2
d1333 7
a1339 4
   Regroup images as desired.   The number of new groups is arbitrary, but 
   usually be the number of nodes available on your cluster. 
   If subsequent alignment is not going to be parallelized, 
   the number of new groups can be set to 1 (though not required). The  procedure: 
a1369 39
<li>Whether you are running alignment in parallel or in series, edit (but do not run)
    <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a> <i>e.g.</i>:                                                      <br />
    &nbsp;&nbsp;<code class="snippet">nedit recon-settings.spi</code> <br />
    to set desired values for parameters and file names that will be used 
    both during alignment and subsequent reconstruction steps.        <br />
 
    Some notable parameters in
    <a  href="../Procs/recon-settings.spi">recon-settings.spi</a> are :

    <table class="outs">
      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[shrange]</i></b>:                               </td>
          <td> Translation search range.</td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[step]</i></b>:                                  </td>
          <td>Translation step size.  The operation 
              <a href="../../../man/apsh.html">'AP SHC'</a>
              tries different combinations of shifts in increments of <i>[step]</i> 
              up to <i>[shrange]</i>,  performs an orientational alignment, 
              and chooses the best one. (See notes in the
              <a href="../../../man/apsh.html">'AP SHC' documentation</a>.) <br /> 
              For example, with a <i>[step]</i> and <i>[shrange]</i> both of 2, 
              'AP SHC' will try shifts of (-2,2),(0,2),(2,2),(-2,0),(0,0),
                                          (2,0),(-2,-2),(0,-2), and (2,-2).
           </td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[r2]</i></b>:                                    </td>
          <td>Outer alignment radius (pixels). The sum of 
              <i>[shrange]</i> and <i>[r2]</i> must be less than 
              half the image dimension.
           </td></tr> 

      <tr valign="top"><td>&curren;                                    </td>
          <td> <b><i>[incore-yn]</i></b>:                             </td>
          <td> Will load input images into incore stack. This more efficient, 
               but if you have insufficient memory, set it to zero.   </td></tr> 
    </table>
d1382 1
a1382 3
   <font class="input">../ref_volume</font>. It creates three sets of files
    in the reconstruction output directory specified in 
    <a href="../Procs/recon-settings.spi">recon-settings.spi</a>: 
a1384 1

d1395 3
a1397 3
      <tr valign="top"><td>&curren;                                                          </td>
          <td><span class="nobreak"><font class="output">[rec_dir]/refprj_01</font>:</span>  </td>
          <td>Stacked reference images from:    
d1412 1
a1412 3

    <p />
    The following alignment options choices depend on whether using you are using 
d1425 1
a1425 1
      <a href="../../../man/rtsf.html"><b>'RT SF'</b></a>.                  <br />
d1435 1
a1435 1
      <a class="project" href="../Procs/align-loop.spi">    align-loop.spi    </a>.  <br />
d1444 4
a1447 4
    Either option reads:
    <font class="input">../ref_vol           </font>,  
    <font class="input">[rec_dir]/prj_01     </font>, and 
    <font class="input">[rec_dir]/ref_angs_01</font>. 
d1465 1
d1493 6
d1500 1
a1500 1
   particles corresponding to each reference projection                </p>
d1540 8
a1547 8
     <tr valign="top"><td>&curren;                                                        </td>
        <td><span class="nobreak"><font class="output">views/prj###/allavg</font>:</span> </td>
        <td>Stacks of average images for each set of projections.                         </td></tr>

     <tr valign="top"><td>&curren;                                                        </td>
        <td><span class="nobreak"><font class="output">views/prj###/filtavg</font>:</span></td>
        <td>Filtered, aligned image stack [<b>Optional, required for <a href="mr1verify.html">
              classification-based verification</a></b>]                                   </td></tr>
d1561 2
a1562 2
       The syntax, not including the proper data extension. is:  <br />
       <code class="snippet">montagefromdoc sd_vsview_all.dat prj***/allavg</code>  <br /> !!!!
a1565 1

d1570 1
a1570 8
   erroneously selected particles. Create a histogram 
   that plots the number of particles vs. the cross correlation
   value. For example, if the histograms display a bimodal
   distribution, the higher peak may correspond to actual particles,
   while the lower peak may show noise. The threshold should be chosen
   between two such peaks.</p>

<p />
d1578 3
a1580 3
   <font class="input">views/prj###/sel_part_byv</font>. <br />

   Experiment with the parameter <i>[num-bins]</i> if
a1584 1

d1632 3
a1634 3
      <tr valign="top"><td>&curren;                                                          </td>
          <td><span class="nobreak"> <font class="output">parts_vsview_all.gnu</font></span> </td>
          <td> Gnuplot script to plot a histogram of number of particles vs projection view. </td></tr>
d1665 2
a1666 2
      <tr valign="top"><td>&curren;                                                       </td>
          <td> <span class="nobreak"><font class="output">show_ref_views</font>: </span>  </td> 
d1668 1
a1668 1
             among the various reference projections for all groups.                      </td></tr>
d1747 1
a1747 1
   <p>Run this procedure even if you aren't limiting overrepresented views as   
d1762 2
a1763 2
   "rechecked good" images from classification-based verification.</p> 
   This parameter will choose between reading: 
d1767 1
a1767 1
   <font class="input">views/prj???/sel_part_byv_sort </font>.    </p>
d1777 15
a1791 16
      <tr valign="top"><td>&curren;                                                   </td>
          <td><span class="nobreak"><font class="output">sel_group_best</font></span> </td>
          <td> Group selection file                                                   </td></tr>

       <tr valign="top"><td>&curren;                                                    </td>
          <td><span class="nobreak"><font class="output">sel_part_best_***</font></span></td>
          <td> List of particles selected for each new group                            </td></tr>

      <tr valign="top"><td>&curren;                                                    </td>
          <td><span class="nobreak"><font class="output">views/prj###/sel_part_byv_best</font></span></td>
          <td> List of particles retained from each reference view                     </td></tr>

      <tr valign="top"><td>&curren;                                                    </td>
          <td><span class="nobreak"><font class="output">part_vsview_best</font></span></td>
          <td> Summary of number of images in each reference view.                     </td></tr>

a1792 2
   

a1794 1

a1795 1

a1818 18
<li>
   <p class="action">Assign particles into groups for 3D reconstruction</p>
   
   <p> <a class="project" href="../Procs/bp-regroup.spi">bp-regroup.spi</a> 
   offers the choice between grouping particles into new groups or keeping the old groups. 
   If you have no desire to regroup the particles, set the parameter <i>[num-stacks]</i> to 0, 
   which will simply create links to the existing files for downstream files to read.
   Among the reasons to regroup the particles could be that
   the number of particles may have changed since groups were first established --
   for example following classification or limiting overrepresented views or by CC value --
   or perhaps the number of compute nodes available has changed.  </p>
   
   It reads: 
   <font class="input">../Averages/sel_group_best_*** </font>,  
   <font class="input">../Averages/sel_part_best_***  </font>,  
   <font class="input">[rec_dir]/data_***             </font>,  
   <font class="input">[rec_dir]/align_01_***         </font>, and 
   <font class="input">[rec_dir]/dala_01_***          </font>. 
d1820 5
a1824 9
   <p>To perform a dry run -- for example to see how big the groups will be -- 
   set the parameter <i>[stacks-yn]</i> to 0.</p>

   <p><b>NOTE:</b> If you aren't regrouping the images and have set <i>[num-stacks]</i> to 0, 
   the procedure is written such that it should be in the same directory as the output files. 
   To find how to circumvent this, look up the <code class="snippet">ln</code> 
   command regarding relative paths, or look up the example in 
   <a href="../Procs/refine-prepare.spi">refine-prepare.spi</a> below.
   </p>
a1825 32
   The procedure creates:  
   <table class="outs">
      <tr valign="top"><td>&curren;                                                    </td>
         <td><span class="nobreak"><font class="output">bp_sel_group</font>:</span>    </td> 
         <td>Group selection document file.                                       </td></tr>

      <tr valign="top"><td>&curren;                                                    </td>
         <td><span class="nobreak"><font class="output">bp_sel_part_***</font>:</span> </td>
         <td>Doc file listing the particles in each group.                        </td></tr>

      <tr valign="top"><td>&curren;                                                    </td>
         <td><span class="nobreak"><font class="output">bp_data_ctfd_***</font>:</span></td>
         <td>Stack files containing particle images for each group.               </td></tr>

      <tr valign="top"><td>&curren;                                                    </td>
         <td><span class="nobreak"><font class="output">bp_dala_01_***</font>:</span>  </td>
         <td>Stack files containing particle images for each group.               </td></tr>
   </table>
</p>
</li>

<li><p class="action">Compute 3D reconstruction</p>

    <p>Create paired reconstructions for each group, 
    merge group reconstuctions into final combined reconstruction, 
    and compute reconstruction resolution.</p>

   <p>Like alignment, 3D reconstruction is CPU-intensive and benefits by parallelization. 
    Whether you are running reconstruction in parallel or in series, edit (but do not run)
    <a class="project" href="../Procs/recon-settings.spi">recon-settings.spi</a>, 
    which reads parameters and input filenames.</p>
    
a1837 5
      <tr valign="top"><td>&curren;                                          </td>
          <td> <b><i>[max-wait]</i></b>:                                     </td>
          <td> Like in <a href="../Procs/recon-settings.spi">recon-settings.spi</a>
               above, will wait up to 10 minutes by default before 
               reading a new group's stack, in order to distribute disk I/O. </td></tr> 
d1854 1
d1856 31
d1888 7
d1896 6
d1903 5
a1907 6
!!!!!!!!!!!!
    which reads parameters and input filenames (<i>e.g.</i>, 
    <font class="input">[win_dir]/sel_group    </font>, 
    <font class="input">[win_dir]/sel_part***  </font>,  
    <font class="input">[win_dir]/dala_01_***  </font>, and 
    <font class="input">[win_dir]/align_01_*** </font>).</p>
d1910 2
a1911 1
   <a href="../../../../pubsub/pubsub.html"> Publish and Subscribe</a> on a cluster.
d1914 8
a1921 2
   <li>If you are not using Publish and Subscribe, run 
      <a class="project" href="../Procs/bp-inseries.spi">bp-inseries.spi</a>.  
d1925 8
a1932 14
   <li>If you are using <a href="../../../../pubsub/pubsub.html">
      Publish and Subscribe</a>, run 
      <a class="project" href="../Procs/bp-pubsub.spi">bp-pubsub.spi</a> 
      according to the following steps:
      <ul>
        <li>Copy the SPIDER executable to the local directory and rename it 
            <i>spider</i>, <i><i>e.g.</i></i>:                                   <br />
          <code class="snippet">cp ../spider  ./spider</code>                    <br />
        </li>
        <li>Start alignment with the following command:                          <br />
          <code class="snippet">./spider spi/dat bp-pubsub 1 &amp; </code>       <br />
          where <i>1</i> will be the number of the top-level SPIDER results file.
        </li>
      </ul>
d1935 1
a1935 1
   <p />
d1937 1
a1937 2
   Depending on the back-projection operation you selected, these
   procedures may create two particle selection doc files for each group 
a1938 1

d1941 1
a1941 1
        <td><span class="nobreak"><font class="output">vols_***/sel_odd</font>:  </td> 
d1945 1
a1945 1
        <td><span class="nobreak"><font class="output">vols_***/sel_even</font>: </td> 
d1953 11
a1963 11
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">vols_***/vol01_one</font>:</span>  </td>
          <td> Reconstructed volume from first subset of images for each group.             </td></tr> 

      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">vols_***/vol01_two</font>:</span>  </td>
          <td> Reconstructed volume from second subset of images for each group.            </td></tr> 

      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">vols_***/vol01_all</font>:</span>  </td>
          <td> Combined reconstructed volume for each group.                                </td></tr> 
d1974 1
a1974 1
          <td> <span class="nobreak"><font class="output">vol01</font>:</span>     </td>
a1989 4
    <table>
      <tr valign="top">
        <td><!-- ====================== left ============ -->
          <div class="left">
d1991 1
a1991 25
          <p>This reconstruction <font class="output">vol01</font> is known as 
          the <i>initial volume</i> and will be used as input for the Refinement step. 
          </p>

          <p /> View the volume as slices using the <i>Montage</i> operation in 
          <font class="guitool">WEB</font> or in 
          <a href="../../../../tools/doc/montage.html">
          <font class="guitool">montage.py</font></a>. 
          Ideally, each image should show a particle isolated from its surroundings, 
          exhibiting some internal structure - somewhat like the reference images. 
          If any images are blank or otherwise unusual, check the volume for specific groups.
          </p>
         </td>
        <td><!-- ====================== right ============ -->
          <div class="right">

          <a href="pics/vol01.jpg" <img src="pics/vol01.jpg"></img></a> <br />
          (Volume rendering)
        </td>

      </tr > 
   </table>


  
d2004 1
a2004 1
 <a class="project" href="../Procs/bp-pubsub.spi"><b>pub-recon</b></a>
d2012 1
a2012 1
 <li><p class="action">Check the FSC curve by viewing a plot. </p>
d2014 1
a2014 2
   <a class="project" href="../Procs/plot-fsc.spi">plot-fsc</a> reads:
   <font class="input">resolution             </font>,  
d2018 2
a2019 2
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">fsc.gnu</font>: </td>
d2034 1
a2034 1
          <a  href="pics/fsc.jpg" <img src="pics/small_fsc.jpg"></img></a>.
d2044 2
d2047 1
a2047 1
   View the filtered volume by using the <i>Surface</i> operation in 
d2050 23
a2072 1
   <a href="http://www.cgl.ucsf.edu/chimera/"><font class="guitool">Chimera</font></a>.
d2074 2
d2156 1
a2156 1
   <ol type='A'>
d2227 3
a2229 10
   <tr>
      <td><!-- ====================== right ============ -->
        <div class="right">
        <a href="pics/fsc_groups.jpg" <img src="pics/small_fsc_groups.jpg"></img></a>.
      </td>
      <td>
        <div class="right">
        <a href="pics/fsc_iter.jpg" <img src="pics/small_fsc_iter.jpg"></img></a>.
        </td>
   </tr > 
d2651 1
a2651 1
  Page updated: Feb. 11, 2016 &nbsp;&nbsp;&nbsp;
@


1.44
log
@for gold
@
text
@d307 1
a307 1
             spider spi/dat @@make-params                                              <br />
d343 1
a343 1
    <li>montagefromdoc.py &nbsp; win/sel_part_0001.dat win/winser_0001.dat &amp  </li>
d346 1
a346 1
        <li>spider spi/dat @@denoise-imgs                 </li>
d348 2
a349 2
          <font class="guitool">WEB</font></a>.   </li>
      </ol>                                       </li>
d351 1
a351 1
    <li>spider spi/dat @@number-parts          </li>
d354 1
a354 1
<p><a href="#SH"> In <b>Alignment/</b></a>: </p>
d356 2
a357 2
    <li>  spider spi/dat  @@restack-n-ctf      </li>
    <li>  spider spi/dat  @@make-ref-views     </li>
d360 2
a361 2
        <li>./spider spi/dat @@align-inseries </li>
        <li>./spider spi/dat @@align-pubsub </li>
d367 4
a370 4
    <li>spider spi/dat  @@select-byview     </li>
    <li>spider spi/dat  @@avg-filter-byview </li>
    <li>spider spi/dat  @@plot-cc-vs-view   </li>
    <li>spider spi/dat  @@show-ref-views    </li>
d387 1
a387 1
    <li>  spider spi/dat @@bp-regroup                      </li>
d391 4
a394 6
        <li>./spider spi/dat @@bp-inseries                 </li>
        <li>./spider spi/dat @@bp-pubsub                   </li>
      </ol>                                               </li>
    <li>  spider spi/dat @@plot-fsc                        </li>
    <li>  spider spi/dat @@make-matched-filt               </li>
    <li>  spider spi/dat @@matched-filt                    </li>
d402 4
a405 4
        <li>./spider spi/dat @@refine-inseries             </li>
        <li>./spider spi/dat @@pub-refine </li>
      </ol>                                               </li>
    <li>  spider spi/dat @@plot-fsc-curves                 </li>
d1265 1
a1265 1
   <p>Run these procedures  in the <i>Alignment/</i> directory.</p>
d1268 1
a1268 1
<!-- SPIRE directory=Alignment  subdirectories=output -->
d1276 9
d1293 1
a1293 3
   <a class="project" href="../Procs/restack-n-ctf.spi">restack-n-ctf.spi</a> 
   to: <i>0</i> reads: 
   <font class="input">../params                          </font>, 
d1298 2
a1299 2
   and restacks particles into an arbitrary (user-defined) number of groups for parallelization. 
   It optionally applies CTF correction (currently using phase flipping) to the images 
d1304 14
a1317 16
      <tr valign="top"><td>&curren;                                                            </td>
          <td><span class="nobreak"><font class="output">sel_group</font>:</span>              </td> 
          <td>New group selection doc file.                                                    </td></tr>

      <tr valign="top"><td>&curren;                                                            </td>
          <td><span class="nobreak"><font class="output">data_ctfd_***</font>:</span>          </td>
          <td>New particle image stacks.                                                       </td></tr>

      <tr valign="top"><td>&curren;                                                            </td>
          <td><span class="nobreak"><font class="output">sel_part_***</font>:</span>           </td>
          <td>New particle selection doc files.                                                </td></tr>

      <tr valign="top"><td>&curren;                                                            </td>
          <td><span class="nobreak"><font class="output">output/part2glonum_***</font>:</span> </td>
          <td>Lookup tables listing global number for particles.                               </td></tr>

d1323 40
d1374 3
a1376 1
   <font class="input">../reference_volume</font>. It creates two sets of files:  <br />
d1380 3
a1382 3
      <tr valign="top"><td>&curren;                                     </td>
          <td><span class="nobreak"><font class="output">../Averages/sel_proj</font>:</span>         </td>
          <td>List of reference views.                                  </td></tr>
d1384 2
a1385 2
       <tr valign="top"><td>&curren;                                    </td>
          <td><span class="nobreak"><font class="output">refangles</font>:</span>                    </td>
d1388 1
a1388 1
             listing the three Euler angles for each of the projections.</td></tr>
d1390 2
a1391 2
      <tr valign="top"><td>&curren;                                     </td>
          <td><span class="nobreak"><font class="output">projs/prj_01</font>:</span>                 </td>
d1394 1
a1394 1
              corresponding to the angles in the preceeding file.       </td></tr>
d1397 1
a1397 1
   <small> Note:  The 84'th projection angle listed in: <font class="output">refangles</font>
a1406 41
    Whether you are running the alignment in parallel or in series, edit (but do not run)
    <a class="project" href="../Procs/align-settings.spi">align-settings.spi</a>, 
    which reads parameters and sets filenames.                             <br /> 
    Some notable parameters in
    <a  href="../Procs/align-settings.spi">align-settings.spi</a> are :

    <table class="outs">
      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[shrange]</i></b>:                               </td>
          <td> Translation search range.</td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[step]</i></b>:                                  </td>
          <td>Translation step size.  The operation 
              <a href="../../../man/apsh.html">'AP SHC'</a>
              tries different combinations of shifts in increments of <i>[step]</i> 
              up to <i>[shrange]</i>,  performs an orientational alignment, 
              and chooses the best one. (See notes in the
              <a href="../../../man/apsh.html">'AP SHC' documentation</a>.) <br /> 
              For example, with a <i>[step]</i> and <i>[shrange]</i> both of 2, 
              'AP SHC' will try shifts of (-2,2),(0,2),(2,2),(-2,0),(0,0),
                                          (2,0),(-2,-2),(0,-2), and (2,-2).
           </td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[r2]</i></b>:                                    </td>
          <td>Outer alignment radius (pixels). The sum of 
              <i>[shrange]</i> and <i>[r2]</i> must be less than 
              half the image dimension.
           </td></tr> 

      <tr valign="top"><td>&curren;                                   </td>
          <td> <b><i>[max-wait]</i></b>:                              </td>
          <td> Will wait up to 10 minutes by default before reading a new group's stack, 
               in order to distribute disk I/O.                       </td></tr> 

     <tr valign="top"><td>&curren;                                    </td>
          <td> <b><i>[incore-yn]</i></b>:                             </td>
          <td> Will load input images into incore stack. This more efficient, 
               but if you have insufficient memory, set it to zero.   </td></tr> 
    </table>
d1410 1
d1412 1
a1412 1
    on a compute cluster:                                            <br />
d1415 2
a1416 3

   <li>If not using PubSub, run SPIDER procedure:
      <a class="project" href="../Procs/align-inseries.spi">align-inseries.spi</a> 
d1418 3
a1420 2
      <a class="project" href="../Procs/align-settings.spi">align-settings.spi</a>
      to carry out the alignment parameter determination and alignment using SPIDER operations:
d1422 3
a1424 1
      <a href="../../../man/rtsf.html"><b>'RT SF'</b></a> . 
d1428 8
a1435 18
   <li>If you are using PubSub, run 
      <a class="project" href="../Procs/align-pubsub.spi">align-pubsub.spi</a> 
      which calls:  
      <a class="project" href="../Procs/align-settings.spi">align-settings.spi</a>, 
      <a class="project" href="../Procs/check-exist.spi">   check-exist.spi   </a>,    
      <a class="project" href="../Procs/align-main.spi">    align-main.spi    </a>, and 
      <a class="project" href="../Procs/wait-pub.spi">      wait-pub.spi      </a> 
      according to the following steps:
      <ul>
        <li>Copy the SPIDER executable to the local directory and name it  
             <i>spider</i>, <i>e.g.</i>:<br />
        <code class="snippet">cp ../spider &nbsp; ./spider </code>
        </li>

        <li>Start alignment with the following command:                              <br />
        <code class="snippet">./spider spi/dat @@align-pubsub 1 &amp; </code>         <br />
        where <i>1</i> will be the number given to the top-level SPIDER results file.</li>
      </ul>
d1442 4
a1445 3
    <font class="input">projs/prj_001</font>, 
    <font class="input">refangles    </font>, and 
    <font class="input">data***      </font>.  
d1447 13
a1459 14

      <table class="outs">
      <tr valign="top"><td>&curren;                        </td>
          <td><span class="nobreak"><font class="output">dala_01_***</font>:</span>     </td>
          <td>Aligned stacks of particle images.           </td></tr>

      <tr valign="top"><td>&curren;                        </td>
          <td><span class="nobreak"><font class="output">align_01_***</font>:</span>    </td>
          <td>Shift and rotation parameters for each group.</td></tr>

      <tr valign="top"><td>&curren;                        </td>
          <td><span class="nobreak"><font class="output">align_01_all</font>:</span>    </td>
          <td>Consolidated shift and rotation parameters for all groups.</td></tr>
      </table>
d1461 2
a1462 18

   <br />The work flow is similar to that in <a href="refine.html">Refinement</a>, 
   with a few changes:

   <table class="outs">
      <tr valign="top">  <td>&curren;</td>
          <td><a class="project" href="../Procs/check-exist.spi">check-exist.spi</a>:</td>
          <td>Checks for presence of input files before publishing to the nodes.</td> 
      </tr>
      <tr valign="top">  <td>&curren;</td>
          <td><a class="project" href="../Procs/align-main.spi">align-main.spi</a>:</td>
          <td>Distribute disk I/O by waiting up to 10 minutes (as set in 
          <a class="project" href="../Procs/align-settings.spi">align-settings.spi</a>)
          before reading a new group's stack.</td> 
      </tr>
   </table>
<p />

d1466 1
d1479 1
a1479 1
   <p>Run these procedures  in the <i>Averages/</i> directory.</p>
d1495 4
a1498 4
   <font class="input">../Alignment/sel_group   </font>,  
   <font class="input">../Alignment/sel_part_***</font>, 
   <font class="input">../Alignment/refangles   </font>, and 
   <font class="input">../Alignment/output/align_01_***</font>.
d1500 1
a1500 2
   It creates:                                                      <br />

d1502 3
d1506 3
a1508 7
     <tr valign="top"><td>&curren;                                                        </td>
          <td><span class="nobreak"><font class="output">views/prj###/sel_part_byv</font>:</span></td>
          <td>List of particles associated with each reference view                       </td></tr>

      <tr valign="top"><td>&curren;                                                        </td>
          <td><span class="nobreak"><font class="output">parts_vsview_all</font>:</span    </td>
          <td>Summary of number of particles associated with rach reference view.          </td></tr>
d1515 1
a1515 1
     optionally, write out filtered, aligned images.   This step is required if using 
d1523 5
a1527 5
    <a class="project" href="../Procs/avg-filt-byview.spi">avg-filt-byview.spi</a> reads: 
    <font class="input">sel_proj                       </font>,
    <font class="input">../Alignment/output/dala_01_***</font>, and
    <font class="input">views/prj###/sel_part_byv      </font>.
    It creates:
d1529 4
a1532 9
    <table class="outs">
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">views/prj###/allavg</font>:</span> </td>
          <td>Stacks of average images for each set of projections.                         </td></tr>

      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">views/prj###/filtavg</font>:</span></td>
         <td>Filtered, aligned image stack [<b>Optional, required for <a href="mr1verify.html">
              classification-based verification</a></b>]                                    </td></tr>
d1534 4
d1546 1
a1546 2
     <li>Use the <b>Montage</b> operation in 
     <a href="../../../../web/docs/web.html">
d1550 2
a1551 2
       <font class="guitool">montagefromdoc.py</font></a>.  The syntax, not including 
       the proper data extension. is:  <br />
d1575 1
a1575 1
   <font class="input">sel_proj</font> and
d1585 12
a1596 12
      <tr valign="top"><td>&curren;                                                             </td>
          <td><span class="nobreak"><font class="output">prj###/sel_part_combined</font>:</span></td> 
          <td>Combined doc file of the same format as 
          <font class="input">views/prj###/sel_part_byv</font>.                                 </td></tr>

      <tr valign="top"><td>&curren;                                                             </td>
          <td><span class="nobreak"><font class="output">cc_vsview_all</font>:</span>           </td>
          <td>Histogram doc file of cross correlation values.                                   </td></tr>

      <tr valign="top"><td>&curren;                                                             </td>
          <td><span class="nobreak"><font class="output">cc_vsview_all.gnu</font>:</span>       </td> 
          <td>Gnuplot script for plotting the correlation histogram.                            </td></tr>
d1601 17
a1617 19
      <tr valign="top">
        <td> <!-- ====================== left ============ -->
          <div class="left">

          <p>The output Gnuplot script <font class="output">cc_vsview_all.gnu</font>
             will overlay the correlation histogram of the particle images 
             with a Gaussian profile. If the histograms display a bimodal
             distribution, the higher peak may correspond to actual particles,
             while the lower peak may show noise. A threshold can be chosen
             between two such peaks.   The plot should be displayed automatically, if not 
             <a href="gnuplot.html?file=cc_vsview_all.gnu">click here</a>. </p>
        </td>
        <td> <!-- ====================== right ============ -->
          <div class="right">

          <a href="pics/cc_vsview_all.jpg"
             <img src="pics/small_cc_vsview_all.jpg"></img></a>.
        </td>
      </tr > 
a1618 2

 
d1735 1
a1735 1
   <p>If performing this verification step, remember to set the input file selection in:  
d1762 1
a1762 1
   This paramater will choose between reading: 
d1771 20
a1790 20
   <font class="input">sel_proj                       </font>,
   <font class="input">../Alignment/sel_group         </font>, and
   <font class="input">../Alignment/sel_part_sort_*** </font>.        
   It creates:                                                        <br />
   <table class="outs">
      <tr valign="top"><td>&curren;                                       </td>
          <td><span class="nobreak"><font class="output">sel_group_best</font></span>                 </td>
          <td> Group selection file                                       </td></tr>

       <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">sel_part_best_***</font></span>               </td>
          <td> List of particles selected for each new group              </td></tr>

      <tr valign="top"><td>&curren;                                       </td>
          <td><span class="nobreak"><font class="output">views/prj###/sel_part_byv_best</font></span>  </td>
          <td> List of particles retained from each reference view        </td></tr>

      <tr valign="top"><td>&curren;                                       </td>
          <td><span class="nobreak"><font class="output">part_vsview_best</font></span>                </td>
          <td> Summary of number of images in each reference view.         </td></tr>
d1815 1
a1815 1
   <p>Run these procedures  in the <i>Reconstruction/</i> directory.</p>
d1818 1
a1818 1
<!-- SPIRE directory=Reconstruction subdirectories= -->
d1836 5
a1840 5
   <font class="input">../Averages/sel_group_best_***   </font>,  
   <font class="input">../Averages/sel_part_best_***    </font>,  
   <font class="input">../Alignment/data_ctfd_***       </font>,  
   <font class="input">../Alignment/output/align_01_*** </font>,
   <font class="input">../Alignment/output/dala_01_***  </font>. 
a1852 1

d1854 15
a1868 15
      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">bp_sel_group</font>:</span>           </td> 
          <td>Group selection document file.                             </td></tr>

      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">bp_sel_part_***</font>:</span>        </td>
          <td>Doc file listing the particles in each group.              </td></tr>

      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">bp_data_ctfd_***</font>:</span>       </td>
          <td>Stack files containing particle images for each group.     </td></tr>

      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">bp_dala_01_***</font>:</span>         </td>
          <td>Stack files containing particle images for each group.     </td></tr>
a1869 1
   
d1881 2
a1882 6
    <a class="project" href="../Procs/bp-settings.spi">bp-settings.spi</a>, 
    which reads parameters and input filenames (<i>e.g.</i>, 
    <font class="input">input/bp_sel_group    </font>, 
    <font class="input">input/bp_sel_part***  </font>,  
    <font class="input">input/bp_dala_01_***  </font>, and 
    <font class="input">bp_align_01_***       </font>).</p>
d1885 1
a1885 1
    <a class="project" href="../Procs/bp-settings.spi">bp-settings.spi</a>:
d1888 1
a1888 1
          <td> <b><i>[bp-method]</i></b>:                                    </td>
d1898 1
a1898 1
          <td> Like in <a href="../Procs/align-settings.spi">align-settings.spi</a>
d1904 1
a1904 1
    For the parameter <b><i>[bp-method]</i></b>, the Fourier-based backprojections -- 
d1912 1
a1912 1
    These artifacts include a rise in the FSC at high resolution, or 
d1918 10
d1943 2
a1944 2
            <i>spider</i>, <i><i>e.g.</i></i>:                                     <br />
          <code class="snippet">cp ../spider  ./spider</code>                      <br />
d1946 2
a1947 2
        <li>Start alignment with the following command:                            <br />
          <code class="snippet">./spider spi/dat bp-pubsub 1 &amp; </code>         <br />
d1955 3
a1957 3
    Depending on the back-projection operaation you selected, these
    procedures may create two particle selection doc files for each group 
    by partitioning alternate images into two sets:
d1959 4
a1962 4
    <table class="outs">
      <tr valign="top"><td>&curren;                                                </td>
          <td><span class="nobreak"><font class="output">vols_***/sel_odd</font>:  </td> 
          <td> List of odd numbered images for each group.                         </td></tr> 
d1964 3
a1966 3
      <tr valign="top"><td>&curren;                                                </td>
          <td><span class="nobreak"><font class="output">vols_***/sel_even</font>: </td> 
          <td> List of even numbered images for each group.                        </td></tr> 
d2044 2
a2045 2
 <a class="project" href="../Procs/bp-inseries.spi"><b>bp-inseries</b></a>
    <a class="project" href="../Procs/bp-settings.spi">bp-settings</a>
d2047 3
a2049 3
    <a class="project" href="../Procs/bp-main.spi">bp-main</a>
    <a class="project" href="../Procs/bp-merge.spi">bp-merge</a>
   </pre></td>
d2052 4
a2055 6
 <a class="project" href="../Procs/bp-pubsub.spi"><b>bp-pubsub</b></a>
    <a class="project" href="../Procs/bp-settings.spi">bp-settings</a>
    <a class="project" href="../Procs/check-exist.spi">exist-check</a>
        <a class="project" href="../Procs/bp-main.spi">bp-main</a>
    <a class="project" href="../Procs/bp-merge.spi">bp-merge</a>
    <a class="project" href="../Procs/wait-pub.spi">wait-pub.spi</a>
d2060 1
a2060 1
 <li><p class="action">Check the FSC curve by viewing  a plot. </p>
a2065 1

a2088 19
<li><p class="action">Generate a matched-filter profile</p>

   <p>Information at spatial frequencies above the cutoff value is  
   considered to be uncorrelated noise, and should be filtered out. 
   The resolution curve itself is used to determine the shape of the filter.
   This concept is described in: 
       <a href="#ZH04">Huang and Penczek (2004)</a></p>

   <p>
   <a class="project" href="../Procs/make-matched-filt.spi">make-matched-filt.spi</a> reads: 
   <font class="input">vol01_sub_one</font> and
   <font class="input">vol01_sub_two</font>. It creates: <br />

    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <span class="nobreak"><font class="output">matched_filt_doc_01</font>:</span> </td>
          <td> Filter doc file.  </td></tr> 
    </table></p>   
</li>
d2092 1
a2092 1
<li><p class="action">Filter the initial volume</p>
a2093 16
   <p>The filter generated above will be applied to the initial volume.
   This filter can also be applied to a different volume, 
   such that two reconstructions can be compared 
   after having been filtered to the exact same resolution.</p>

   <p><a class="project" href="../Procs/matched-filt.spi">matched-filt.spi</a> reads: 
   <font class="input">matched_filt_doc_01</font> and   
   <font class="input">vol01</font>. It filters the 
   initial volume at the cutoff frequency to create: <br />

    <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <span class="nobreak"><font class="output">vol01_matched</font>:</span> </td>
          <td>Filtered volume.  </td></tr> 
    </table></p>   
    
d2123 1
a2123 1
   <p>Run these procedures  in the <i>Refinement/</i> directory.</p>
d2126 1
a2126 1
<!-- SPIRE directory=Refinement subdirectories=input, final, work -->
d2130 1
a2130 1
<li><p class="action">Access your refinement_dir, <i>e.g.</i>:<br />
d2134 3
a2136 5
<li><p class="action">Remove any existing output files currently in the refinement
   directory, <i>e.g.</i>:<br />
   <code class="snippet">rm -f &nbsp;pubsub.log&nbsp;results.*
   &nbsp;LOG.* &nbsp;fort.*&nbsp;work/*
   &nbsp;local/*&nbsp;final/*&nbsp;core* &nbsp; </code></p>                     
d2139 2
a2140 2
<li><p class="action">Copy latest SPIDER executable into the current directory and rename it: <i>spider</i> 
    (ensures that same SPIDER executable is used throughout whole refinement), <i>e.g.</i>:<br />
d2145 1
a2145 1
   necessary values for refinement parameters   any check input file names,
d2149 5
a2153 2
   The following input files  are needed,
   where '***' denotes group number, and '##' denotes iteration number:  <p />
d2156 2
a2157 5
   <tr><td> <span class="nobreak"><font class="input">../params</font>:</span>                              </td> 
       <td> Parameter definition file. (one)                                                                </td></tr>

   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/input/vol01</font>:</span>          </td> 
       <td> Reference volume. (one)                                                                         </td></tr>
d2159 2
a2160 2
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/input/bp_sel_group</font>:</span>   </td> 
       <td> Group selection file. (one)                                                                     </td></tr>
d2162 2
a2163 2
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/input/bp_sel_part_***</font>:</span></td> 
       <td> Particle selection files. (one / group)                                                         </td></tr> 
d2165 2
a2166 2
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/bp_data_ctfd_***</font>:</span>     </td> 
       <td> Unaligned CTF corrected, stacked image files.  (one / group)                                    </td></tr>
d2168 2
a2169 2
   <tr><td> <span class="nobreak"><font class="input">input/scattering</font>:</span>                       </td> 
       <td> <b>Optional</b> amplitude enhancement scattering file.  (one)                                 </td></tr>
d2171 2
a2172 2
   <tr><td> <span class="nobreak"><font class="input">input/mask</font>:</span>                             </td> 
       <td> <b>Optional</b> amplitude enhancement mask file. (one)                                        </td></tr>
a2175 13
<li><p class="action">If you are using <b>OPTIONAL</b>
    <a href="../../../techs/xray/xray.html">
    amplitude enhancement</a> you will have to add the following initial files to input
   <table class="outs">
   <tr valign="top"><td>&curren;</td>
          <td><font class="input">  <a href="../../../techs/xray/scattering8.tst">
          input/scattering</a></font></td> 
          <td>X-ray scattering power spectrum</td> </tr>
   <tr valign="top"><td>&curren;</td>
          <td><font class="input">input/mask</font></td></td> 
          <td>Mask created from outer contour of reconstruction</td> </tr>
   </table></p>
</li> 
d2183 2
a2184 2
          <a href= "../Procs/refine-inseries.spi">refine-inseries.spi</a>, <i>e.g.</i>: <br />
          <code class="snippet">spider spi/dat @@refine-inseries 0 &amp;</code>
d2187 1
a2187 1
   <li><b>Refinement on Cluster using Pubsub</b>
d2190 4
a2193 4
         <li>Login to master node of cluster, where PubSub has been 
             <a href="../../../../pubsub/pubsub_inst.html">
             installed and is running</a>, <i>e.g.</i>:<br />
             <code class="snippet">ssh &nbsp;shipra</code>
d2196 1
a2196 1
         <li>Start Master SPIDER refinement process 
d2198 1
a2198 1
             <code class="snippet">spider spi/dat &nbsp; @@pub-refine 0 &amp;</code>
d2202 3
a2204 3
         <li>Master SPIDER refinement process will create and 
             <a href= "../../../../pubsub/publish.perl">publish</a> 
             new SPIDER jobs as necessary.
d2239 1
a2239 2
   <font class="input">final/resolutions   </font>, 
   <font class="input">final/fscdoc_m_##   </font>. <br /> 
d2243 1
a2243 1
      <td><span class="nobreak"><font class="output">fsc_iter.gnu</font>:</span></td>
d2272 1
a2272 1
   <a    class="project"       href="../Procs/refine-inseries.spi"><b>refine-inseries</b></a>
a2273 1
   .. <a class="project"       href="../Procs/refine-prepare.spi">refine-prepare</a>
d2279 2
a2280 2
   .. <a class="project"       href="../Procs/refine-merge.spi">refine-merge</a>
   .. <a class="project"       href="../Procs/refine-sphdecon.spi">refine-sphdecon</a>            
d2303 1
a2303 1
   .. <a class="project"       href="../Procs/refine-merge.spi">refine-merge</a>
d2308 1
a2308 1
   ........ <a class="project" href="../Procs/refine-sphdecon.spi">refine-sphdecon</a>            
a2322 2
  <li><a href="../Procs/refine-prepare.spi">refine-prepare.spi</a> -- Prepare input files.</li>

d2328 1
a2328 1
        <td>VO EA</td>
d2333 1
a2333 1
        <td>PJ 3Q</td>
d2347 1
a2347 1
       <td>CP</td>
d2352 1
a2352 1
       <td>AP REF &nbsp; or <br /> AP SHC</td>
d2365 1
a2365 1
         <td> RT SF </td>
d2377 1
a2377 1
       <tr> <td>BP 3F</td>
d2388 2
a2389 2
<li><a href="../Procs/refine-merge.spi">refine-merge.spi</a></font></i>
      -- <font color="#ff0000">Merge group volumes into iteration volume</font >
d2392 1
a2392 1
      <tr> <td>AS S</td>
d2395 2
a2396 2
      <tr> <td>AS S</td>
      <td>Merge "odd" half-set refined group volumes</td> </tr>
d2398 2
a2399 2
      <tr> <td>AS S</td>
      <td>Merge "even" half-set refined group volumes</td> </tr>
d2401 2
a2402 2
      <tr> <td>FSC</td>
      <td>Calculate resolution for combined volume</td> /tr>
d2405 1
a2405 1
      <td><a href="../Procs/enhance.spi">@@enhance</a> </td>
d2409 2
a2410 2
      <tr> <td>FQ</td>
      <td>Filter final corrected volume to resolution</td> </tr>
d2418 1
a2418 1
<li>Stop iteratiing when resolution fails to improve.    <br />
d2428 8
d2437 3
a2439 2
  Among the outputs of refinement are volumes and doc files, important outputs are listed here: <br /> 
  ('***' denotes group number, '##' denotes iteration number, and '@@' denotes subset number)
a2440 1
    <table class="outs">
d2442 2
a2443 2
          <td><span class="nobreak"><font class="output">final/vol_##_s@@_unfilt</font>:</span></td>
          <td> Unfiltered subset volumes                                                      </td></tr>
d2446 6
a2451 2
          <td><span class="nobreak"><font class="output">final/vol_##_all </font>:</span>     </td>
          <td>Complete filtered volumes                                                       </td></tr> 
d2454 2
a2455 2
          <td><span class="nobreak"><font class="output">final/vol_##</font>:</span>          </td>
          <td>Complete filtered, centered volumes                                             </td></tr> 
d2458 2
a2459 2
          <td> <font class="output">final/fscdoc_m_##</font>                                  </td>
          <td> Masked FSC resolution curve doc files                                          </td></tr>
d2462 2
a2463 2
          <td><span class="nobreak"><font class="output">final/resolutions</font>:</span>     </td>
          <td>Doc file listing resolution at each iteration.                                  </td></tr> 
d2465 3
a2467 3
      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">final/align_##_***_s@@</font>:</span> </td>
          <td>Alignment parameter doc files                                                   </td></tr>
d2471 1
a2471 2
Alignment parameter doc files ere created for each group at each iteration: 
final/align_{iteration}_{group} with document file columns containing:
d2475 2
d2478 1
a2478 3
    <td>Proj. angle - THETA  </td>
    <td>Proj. angle - PSI    </td>
    <td>Ref. #               </td>
d2489 1
@


1.43
log
@_filt instead of _centerd  for output vol
@
text
@d61 1
a61 1
 where the CTF oscillates more rapidly, this assumption will not hold.  
d72 1
a72 1
 However the strategy of using defocus groups has its own advantages.  
d136 1
a136 1
      initial alignments. Each projection is given a
d167 1
a167 1
  <li><a href="flowchart/flowchart.html">A flowchart of operations</a></li>
d169 1
a169 1
  <li><a href="docfiles.html">Format information for doc files</a> </li>
d174 1
a174 1
  <li>Information about images from the <a href="../../recon/zi/zidoc.html">ZI scanner</a> </li>
d176 1
a176 1
  <li>Convert ZI scanner TIF files to SPIDER format: 
d184 1
a184 3
  <li>Detailed information about <a href="refine.html">refinement</a>.</li>
    
  <li> <a href="../../../strategies.html"> Reconstruction strategies</a> and the 
d360 2
a361 2
        <li>./spider spi/dat  @@align-inseries </li>
        <li>cp ../spider . ;  ./spider spi/dat @@align-pubsub </li>
d391 2
a392 2
        <li>spider spi/dat @@bp-inseries                   </li>
        <li>cp ../spider . ;  ./spider spi/dat @@bp-pubsub </li>
d404 2
a405 2
        <li>./spider spi/dat @@refine                      </li>
        <li>cp ../spider . ; ./spider spi/dat @@pub-refine </li>
d693 33
a725 1
   determine CTF parameters using one of the following two methods:</p> 
d756 1
a756 1
   <a href="../../../../tools/doc/ctfmatch.html">
a758 30
 Choices:
<ol class="choice">
 <li><a class="project" href="../Procs/powdefocus.spi">powdefocus.spi</a> 
   (which calls SPIDER procedure <a class="project" href="../Procs/load-mic.spi">load-mic.spi</a>)
   loads each micrograph, computes an averaged power spectrum, and estimates defocus
   using SPIDER operation: <a href="../../../man/tfed.html"><b>'CTF ED'</b></a>.
</li>
</p>

 
<p>
<li> <a class="project" href="../Procs/ctffind.spi">ctffind.spi</a> 
   (which calls SPIDER procedure <a class="project" href="../Procs/load-mic.spi">load-mic.spi</a>)
   reads each micrograph, computes an averaged power spectrum, and estimates defocus, 
   astigmatism, and cut-off frequency using SPIDER operation:  
   <a href="../../../man/ctffind.html"><b>'CTF FIND'</b></a>.
   This operation invokes the functionality from the MRC 
   <a href="http://emlab.rose2.brandeis.edu/software">ctffind3</a>. 
</li>
<p />

<p>
<li>Run <a href="../Procs/powdefocus.spi">powdefocus.spi</a> 
    as in <b>a.</b> to create power spectra: 
    <font class="input">power/roo_****</font>.  Then use the 
    <a href="../../../../web/docs/ctf.html">CTF from doc file</a> operation 
    in <font class="guitool">WEB</font> to read <font class="input">power/roo****</font>. 
    The user then manually fits a CTF model to the 1D profiles.
</li></p>
</ol>
d766 11
a776 5
   (size reduction: 4) to
   look at these power spectra. They are equivalent to diffraction
   patterns obtained in an optical diffractometer. It is absolutely
   important that you screen the spectra before proceeding any
   further.</p>
d780 5
a784 5
         <td> Things to look out for:                                                  <br />
              Are the Thon rings round?                                                <br /> 
              Do the rings extend to high resolution?                                  <br />
                                                                                       <br />
              You can discard micrographs that show one of the following artifacts:    <br />
d1283 1
a1283 1
   a reasonable starting point would be the number of nodes available on your cluster. 
d1707 1
a1707 1
             <a href="../../../../tools/doc/qview.html">
d2088 1
a2088 1
   <font class="input">fsc_doc_m              </font>.   <br />
a2100 1

d2103 2
a2104 4
          automatically, if not <a href="gnuplot.html?file=fsc.gnu">click here</a>.</p>

          <p>Examine this plot and see if there is an unusual curve.</p>

d2108 1
a2108 3

          <a  href="pics/fsc.jpg"
          <img src="pics/small_fsc.jpg"></img></a>.
a2111 1

a2159 1
</ul>
d2177 4
a2180 2
>    images instead of the alignments from the reconstruction step, since this does not 
     take much additional time at coarse reference angles.
d2188 5
a2192 1
<ul>
d2194 16
a2209 2
<li><p />Below is a summary of details presented on the 
        <a href="refine.html">Refinement</a> page.<p /></li>
d2211 2
a2212 4
<li>
   Edit <a class="project" href="../Procs/refine-settings.spi">refine-settings.spi</a>, 
   which reads the following input files  where '***' denotes group number, 
   and '##' denotes iteration number:   <p />
d2215 2
a2216 2
   <tr><td> <span class="nobreak"><font class="input">../params</font>:</span>                                </td> 
       <td> Parameter definition file.                                                                        </td></tr>
d2218 2
a2219 2
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/input/vol01</font>:</span>            </td> 
       <td> Initial starting volume.                                                                          </td></tr>
d2221 2
a2222 2
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/input/bp_sel_group</font>:</span>     </td> 
       <td> Group selection file.                                                                             </td></tr>
d2224 39
a2262 2
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/input/bp_sel_part_***</font>:</span>  </td> 
       <td> Particle selection files.                                                                         </td></tr> 
d2264 47
a2310 2
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/bp_data_ctfd_***</font>:</span>       </td> 
       <td> Unaligned CTF corrected, stacked image files.                                                     </td></tr>
d2312 24
a2335 5
   <tr><td> <span class="nobreak"><font class="input">input/scattering</font>:</span>                         </td> 
       <td> [<b>Optional</b>] amplitude enhancement scattering file.                                          </td></tr>

   <tr><td> <span class="nobreak"><font class="input">input/mask</font>:</span>                              </td> 
       <td> [<b>Optional</b>] amplitude enhancement mask file.                                                </td></tr>
a2336 2
</li>
<p />
d2338 2
a2339 3
<li>First; Copy the SPIDER executable to the local directory and rename it: <br />
         <code class="snippet">cp ../spider &nbsp; ./spider</code>          <br />
    This ensures that the same SPIDER executable is available throughout whole refinement.
d2341 2
a2342 2
    The following options will depend on whether using you are using 
    <a href="../../../../pubsub/pubsub.html"> Publish and Subscribe</a> on a cluster:
d2344 16
a2359 1
    <ol class="choice">
d2361 29
a2389 20
      <li>If you are using serial refinement on a single workstation, run 
         <a class="project" href="../Procs/refine-inseries.spi">refine-inseries.spi</a> 
         according to the following steps:
         <ul>
            <li>Start alignment with the following command:    <br />
               <code class="snippet">./spider spi/dat @@refine  </code></li>
         </ul>
      </li>
 
      <li>If you are using <a href="../../../../pubsub/pubsub.html"> Publish and Subscribe</a>, run 
         <a class="project" href="../Procs/pub-refine.spi">pub-refine.spi</a> 
         according to the following steps:
         <ul>
           <li>Start alignment with the following command: <br />
               <code class="snippet">./spider spi/dat @@pub-refine 1 </code><br />
               where <i>1</i> will be the number of the top-level SPIDER results file.</li>
         </ul>
      </li>
 
  </ol>
a2391 4
<li>
  Among the outputs of refinement are volumes, images, and document files. 
  Some of the important outputs are listed here 
  ('***' denotes group number and '##' denotes iteration number):
d2393 8
a2400 4
    <table class="outs">
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">output/align_##_***</font>:</span> </td>
          <td>Alignment parameter doc files                                                 </td></tr>
d2402 16
a2417 3
      <tr valign="top"><td>&curren;                                                         </td>
          <td> <font class="output">output/fscdoc_m_##_***</font>                           </td>
          <td> Group masked FSC resolution curve doc files                                  </td></tr>
d2419 18
a2436 3
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">output/vol##_all</font>:</span>    </td>
          <td> Complete unfiltered volumes                                                  </td></tr>
d2438 14
a2451 3
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">output/vol##_filt</font>:</span>   </td>
          <td>Complete centered volumes                                                     </td></tr> 
d2453 1
a2453 3
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">output/vol##</font>:</span>        </td>
          <td>Complete filtered, centered volumes                                           </td></tr> 
d2455 3
a2457 3
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">output/vol##_s1</font>:</span>     </td>
          <td>Complete volume from first subset of images                                   </td></tr>
d2459 2
a2460 3
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">output/vol##_s2</font>:</span>     </td>
          <td>Complete volume from second subset of images                                  </td></tr>
d2462 3
a2464 4
       <tr valign="top"><td>&curren;                                                        </td>
          <td><span class="nobreak"><font class="output">output/resolutions</font>:</span>  </td>
          <td>Doc file listing resolution at each iteration.                                </td></tr> 
    </table>
d2467 9
d2477 2
a2478 2
<br />There are several sub-procedures used during refinement.
      The following is a tree of procedure calls:
d2480 2
a2481 20
<table border="1" style="background-color:eeeeee">
<tr><td valign="top">
<pre>
<a class="project" href="../Procs/refine-inseries.spi"><b>refine-inseries</b></a>
    <a class="project" href="../Procs/refine-settings.spi">refine-settings</a>
    <a class="project" href="../Procs/refine-prepare.spi">refine-prepare</a>
    
    <a class="project" href="../Procs/refine-refangles.spi">refine-refangles</a>
    
    <a class="project" href="../Procs/refine-loop.spi">refine-loop</a>
       <a class="project" href="../Procs/refine-bp.spi">refine-bp</a>
        
        
    
 
   
    <a class="project" href="../Procs/refine-smangloop.spi">refine-smangloop</a>
        <a class="project" href="../Procs/refine-bp.spi">refine-bp</a>
   
    
d2483 4
a2486 3
    <a class="project" href="../Procs/refine-merge.spi">refine-merge</a>
        <a class="project" href="../Procs/enhance.spi">enhance</a>
   </pre></td>
d2488 4
a2491 17
   <td><pre>
<a class="project" href="../Procs/pub-refine.spi"><b>pub-refine</b></a>
    <a class="project" href="../Procs/refine-settings.spi">refine-settings</a>
    <a class="project" href="../Procs/refine-prepare.spi"> refine-prepare</a>
    <a class="project" href="../Procs/pub-refine-start.spi">pub-refine-start</a> (<i>[task]</i>=0)
        <a class="project" href="../Procs/pub-ref-loop-clone.spi">pub-ref-loop-clone</a>
        <a class="project" href="../Procs/refine-loop.spi">refine-loop</a>
           <a class="project" href="../Procs/refine-bp.spi">refine-bp</a>
        <a class="project" href="../Procs/pub-ref-loop-declone.spi">pub-ref-loop-declone</a>
    <a class="project" href="../Procs/pub-refine-wait.spi">pub-refine-wait</a>

    <a class="project" href="../Procs/pub-refine-start.spi">pub-refine-start</a> (<i>[task]</i>=1)
        <a class="project" href="../Procs/pub-ref-loop-clone.spi">pub-ref-loop-clone</a>
        <a class="project" href="../Procs/refine-smangloop.spi">refine-smangloop</a>
           <a class="project" href="../Procs/refine-bp.spi">refine-bp</a>
        <a class="project" href="../Procs/pub-ref-loop-declone.spi">pub-ref-loop-declone</a>
    <a class="project" href="../Procs/pub-refine-wait.spi">pub-refine-wait</a>
d2493 1
a2493 9
    <a class="project" href="../Procs/refine-merge.spi">refine-merge</a>
        <a class="project" href="../Procs/enhance.spi">enhance</a>
      
</pre></td>
</tr></table>
  
   <p>If you are running on a cluster with <i>PubSub</i> you may also need: 
   <a href="../../../../pubsub/publish.perl">publish.perl</a>,  &nbsp; 
   <a class="project" href="../Procs/pub-refine-fix.spi">pub_refine-fix.spi</a>.</p>
d2495 5
a2500 1
<li><p>Further details are given in the <a href="refine.html">Refinement</a> page.</p>  </li>
d2502 1
d2505 1
d2508 2
a2509 1
<li><p class="action">Plot the refinement resolution curves</p>
d2511 20
a2530 4
   <a class="project" href="../Procs/plot-fsc-curves.spi">plot-fsc-curves.spi</a> reads:
   <font class="input">final/resolutions   </font>, 
   <font class="input">final/fscdoc_m_##   </font>. 
   It creates a gnuplot script:         <br /> 
d2532 5
a2536 8
   <table class="outs">
      <tr valign="top"><td>&curren;                                                    </td>
          <td><span class="nobreak"><font class="output">fsc_iter.gnu</font>:</span>   </td>
          <td>Plots FSC resolution curve for each iteration of refinement.             </td></tr> 
   </table>   
</li>
</p>
 
d2538 2
a2539 4
   <table>
      <tr valign="top">
        <td><!-- ====================== left ============ -->
          <div class="left">
d2541 18
a2558 6
          <p>The plot of the FSC resolution curves should be displayed 
          automatically, if not  <a href="gnuplot.html?file=fsc_iter.gnu">click here</a>.
 
        </td>
        <td><!-- ====================== right ============ -->
          <div class="right">
a2559 3
          <a href="pics/fsc_groups.jpg"
             <img src="pics/small_fsc_groups.jpg"></img></a>.
        </td>
a2560 2
        <td>
          <div class="right">
a2561 5
          <a href="pics/fsc_iter.jpg"
             <img src="pics/small_fsc_iter.jpg"></img></a>.
        </td>
      </tr > 
   </table>
d2607 5
a2611 5
<p>
<dt><a href="../../../techs/diffmaps/index.html">Difference Maps</a> </dt>
<dd>Differences between volumes can be assessed by subtracting one volume 
    from the other.</dd>
</p>
d2613 2
a2614 2
<p>
<dt><a href="../../../techs/xray/xray.html">Frequency amplitude correction with X-ray
d2616 17
a2632 17
<dd>Enhance the Fourier amplitudes of a reconstructed cryo-EM volume so they more 
   closely resemble those of experimental low-angle X-ray scattering data. </dd>
</p>

<p>
<dt><a href="../../../techs/classification/index.html">Classification of Particles</a></dt>
<dd>This method can be used to investigate differences between particles.</dd>
</p>

<p>
<dt>See more methods on the <a href="../../../techniques.html">techniques page</a></dt>
</p>

<!--    Not updated ------------------------------------
<p>
<dt><u>Create tar files for backup</u></dt>
<dd><a href="../Procs/backup.sh">backup.sh</a> a shell script, puts a number of vital 
d2639 2
a2640 3
</dd>
</p>        
--------------------------------------- -->
d2695 8
d2729 1
a2729 2
   <p class="explain">Not an exhaustive list.
      For a more complete list of changes, see individual procedures.</p>
d2737 1
d2747 2
a2748 2
  Source: mr1.html           &nbsp;&nbsp;&nbsp; 
  Page updated: Dec. 11, 2015 &nbsp;&nbsp;&nbsp;
@


1.42
log
@ctf correction using 'TF COR'
@
text
@d2259 31
a2289 31
      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">output/align_##_***</font>:</span>   </td>
          <td>Alignment parameter doc files                                                   </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td> <font class="output">output/fscdoc_m_##_***</font>                             </td>
          <td> Group masked FSC resolution curve doc files                                    </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">output/vol##_all</font>:</span>      </td>
          <td> Complete unfiltered volumes                                                    </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">output/vol##_centered</font>:</span> </td>
          <td>Complete centered volumes                                                       </td></tr> 

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">output/vol##</font>:</span>          </td>
          <td>Complete filtered, centered volumes                                             </td></tr> 

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">output/vol##_s1</font>:</span>       </td>
          <td>Complete volume from first subset of images                                     </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td><span class="nobreak"><font class="output">output/vol##_s2</font>:</span>       </td>
          <td>Complete volume from second subset of images                                    </td></tr>

       <tr valign="top"><td>&curren;                                                          </td>
          <td><span class="nobreak"><font class="output">output/resolutions</font>:</span>    </td>
          <td>Doc file listing resolution at each iteration.                                  </td></tr> 
d2576 1
a2576 1
  Page updated: Nov. 18, 2015 &nbsp;&nbsp;&nbsp;
@


1.41
log
@"project" removed from unwanted procs in each spr2tar listing
@
text
@d116 2
a117 2
    <li> <a href="#CTF">Contrast Transfer Function (CTF) Estimation</a> -- 
       Estimate the CTF for each micrograph.</li>
d235 1
a235 2

   If you have <a href="../../../../tools/install.html">installed</a> them,   
d662 1
d667 1
a667 1
   <h3 class="heading">Contrast Transfer Function Estimation</h3>
d674 1
a674 1
     <li> <a href="../../../techs/ctf/ctf.html">
d695 1
a695 1
   determine defocus using one of the following two methods:</p> 
d699 1
a699 1
   <font class="input">../Micrographs/raw****</font>, They create:  
d720 1
a720 1
          <td>A doc file of defocus values.</td>
d761 1
a761 1
   <p class="action">Check the rings in the power spectrum images</p>
d774 1
a774 1
         <td> Things to look out for:                                                 <br />
d777 1
a777 1
                                                                                      <br />
d779 2
a780 2
              &nbsp;&nbsp; Rings that are cut off unidirectionally (evidence of drift).             <br />
              &nbsp;&nbsp; Rings that are elliptical, or even  hyperbolic (evidence of astigmatism) &nbsp;&nbsp;&nbsp; .<br />
d800 3
a802 3
   <a href="../Procs/montagefromdoc.py"> <font class="guitool">montagefromdoc.py</font></a>.
   The syntax, not including the proper data extension. is:         <br />
     <code class="snippet">montagefromdoc.py ../sel_micrograph.dat power/pw_avg_*</code> 
d807 1
a807 1
<li><p class="action">Generate CTF profiles for each micrograph.</p>
d810 2
a811 1
       generates a set of 1D profiles, which will be applied to subsequent particle images. It reads:
d813 1
a813 1
    <font class="input">defocus</font>, and 
a817 4
         <td><span class="nobreak"><font class="output">power/straightctf_****</font>:</span></td>
         <td>1D profile of the normal CTF.                                                   </td></tr>

      <tr valign="top"><td>&curren;                                                          </td>
d819 1
a819 1
         <td>1D profile corresponding to CTF-correction by phase-flipping.                   </td></tr>
d822 3
a824 3
         <td><span class="nobreak"><font class="output">power/trapctf_****</font>:</span>    </td>
         <td>1D profile of the normal CTF, except that low-resolution terms 
             are unaffected.                                                                 </td></tr>
d828 1
a828 1
         <td>Listing of the first CTF extremum and first zero for each micrograph.<br />
d834 1
a834 1
         <td>Gnuplot script for plotting the 1D profiles of the the computed 
d1274 1
a1274 1
   <p class="action">CTF correct images and assign to groups for parallelization.   </p>
d1277 2
a1278 2
   a reasonable starting point would be the number of nodes available on your cluster 
   (or half that number, etc.).  If subsequent alignment is not going to be parallelized, 
d1282 5
a1286 5
   <font class="input">../params                         </font>, 
   <font class="input">../sel_micrograph                 </font>, 
   <font class="input">../Particles/good/sel_part_****   </font>, 
   <font class="input">../Particles/win/data_bymic_****  </font>, and 
   <font class="input">../Power_Spectra/power/flipctf****</font>. 
d1288 2
a1289 3
   It optionally applies CTF correction to the images during restacking.  
   A rotationally invariant 1D profile is used to correct for the CTF. 
   In principle, a 2D CTF could be used, which could correct for astigmatism.
d1298 1
a1298 1
          <td><span class="nobreak"><font class="output">data_ctf_***</font>:</span>           </td>
d2576 1
a2576 1
  Page updated: Oct. 9, 2015 &nbsp;&nbsp;&nbsp;
@


1.40
log
@removed vols_***/fsc_doc_m,  no longer starts with: input/bp_align_01_***
@
text
@d5 1
a5 1
  <title>Single Particle Reconstruction Techniques</title> 
d41 1
a41 1
 This document contains a protocal for creating a 3D reconstruction from 
d135 1
a135 1
      Improvie the resolution of the reconstruction by iteratively improving the 
d529 1
a529 1
             <a href="./params.html">reconstruction parameters                             </td></tr>
d565 1
a565 1
   This will ensure that the same spider exectable is available for the whole
d1324 2
a1325 3
    The row and column dimensions of the reference volume must match the 
    dimensions of the particle windows. (see 
    <a class="project" href="../Procs/resizevol.spi">resizevol.spi</a>)
d1364 1
a1364 1
    <a class="project" href="../Procs/align-settings.spi">align-settings.spi</a> are :
d1730 1
a1730 1
   <!-- <a class="project" href="../Procs/make-good-classes.spi"> Used for testing only!</a> -->
a1846 1

d1873 1
a1873 1
   <a class="project" href="../Procs/refine-prepare.spi">refine-prepare.spi</a> below.
d2580 1
a2580 1
  Page updated: Oct. 7, 2014 &nbsp;&nbsp;&nbsp;
@


1.39
log
@missing files for spiproject
@
text
@d1992 1
a1992 3
   They then create two reconstructions for each group using 
   back projection, and compute the nominal resolution for each group 
   reconstruction by comparing the two volumes: 
a2005 6

      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"><font class="output">vols_***/fsc_doc_m</font>:</span>  </td>
          <td> Doc files containing a masked
               <a href="../../../glossary.html#Fourier">
               FSC curve</a> for each group.                                                </td></tr> 
d2183 3
a2185 1
     is reasonable to start.
a2215 3
   <tr><td> <span class="nobreak"><font class="input">../Reconstruction/input/bp_align_01_***</font>:</span>  </td> 
       <td> Initial alignment parameter files.                                                                </td></tr> 
 
d2581 2
a2582 2
  Source: mr1.html            &nbsp;&nbsp;&nbsp; 
  Page updated: Sep. 3, 2014 &nbsp;&nbsp;&nbsp;
@


1.38
log
@Fixed broken link to ctffind.html
@
text
@d2317 1
a2317 1
    <a class="project" href="../Procs/refine-prepare">refine-prepare</a>
d2319 1
a2319 1
    <a class="project" href="../Procs/refine-refangles">refine-refangles</a>
d2591 1
a2591 1
  Page updated: Aug. 14, 2014 &nbsp;&nbsp;&nbsp;
@


1.37
log
@missing refine-refangles
@
text
@d744 1
a744 1
   <a href="../../man/ctffind.html"><b>'CTF FIND'</b></a>.
@


1.36
log
@added good-parts-bymic to comment to get it into tar ball
@
text
@d2319 1
@


1.35
log
@*** empty log message ***
@
text
@d1069 1
a1069 2
<li><p class="action">[Optional] Low-pass filter particle images before
    particle verification.</p>
d1269 3
@


1.34
log
@Closed previously-open HTML tag
@
text
@d310 4
a313 4
             spider spi/dat @@make-params                    <br />
             spider spi/dat @@resizevol                      </li>
        <li> tar -xvf $SPIDER_DIR/docs/techs/recon1/natproc_data_mics.tar.gz <br />                              </li>
      </ol>  </li>
d464 1
a464 1
<p> Place the digitized micrographs in the <i>Micrographs/</i> directory</p>
d468 2
a469 2
   <li>If you are using your own data:  <br />
   <span class="nobreak"><code class="snippet">mv /actual-location-of-micrographs/raw* &nbsp;  Micrographs/</code></span></p>
d471 7
a477 9
   <p>The procedures below can accept SPIDER, Hiscan TIFF, PerkinElmer, ZI, and Nikon Coolscan data.  
   More information about images from the ZI scanner can be found 
   <a href="zi/zidoc.html">here</a>, and 
   the C program to convert ZI scanner TIF files to SPIDER format is called 
   <a href="../../../..//download/zi2spi.c">zi2spi.c</a>.
   Any of these files may have been compressed with <i>gzip</i>, so  
   be sure to indicate the compression in: <a href= "params.html">the params file</a>.  
   </p>
</li>
d479 1
d481 1
d483 1
a483 3
   <a name="PROTOCOLS"></a>

   <li><small>
d490 2
a491 2
   <table class="outs">
      <tr valign="top"><td>&curren;                                                              </td>
d496 1
a496 1
      <tr valign="top"><td>&curren;                                                              </td>
d500 1
a500 1
      <tr valign="top"><td>&curren;                                                              </td>
d504 1
a504 1
      <tr valign="top"><td>&curren;                                                              </td>
d508 1
a508 1
      <tr valign="top"><td>&curren;                                                              </td>
d511 1
a511 1
   </table>
d513 4
a516 4
   If you are using this data you can skip the next two steps.   
   </small></li>
</li>
</ol>
d521 1
a521 1
   Some information is stored in a project-wide document file that is used 
d1162 1
a1162 1
   <span class="nobreak"><code class="snippet">montagefromdoc.py coords/pkcoor_1234.dat</code></span>      <br />
d1280 1
a1280 1
   the number of new groups can be set to 1 (though not required).The  procedure: 
d1286 1
a1286 1
   <font class="input">../Particles/win/winser_****      </font>,and 
d1288 2
a1289 2
   and restacks particles into an arbitrary (user-defined) number of groups for parallelization 
   and optionally applies CTF correction to the images during restacking.  
d1295 15
a1309 11
      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">sel_group</font>:</span>                     </td> 
          <td>New group selection doc file.                              </td></tr>

      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">data_ctf_***</font>:</span>                  </td>
          <td>New particle image stacks.                                 </td></tr>

      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">sel_part_***</font>:</span>                  </td>
          <td>New particle selection doc files.                          </td></tr>
a1310 3
      <tr valign="top"><td>&curren;                                      </td>
          <td><span class="nobreak"><font class="output">part2glonum</font>:</span>                   </td>
          <td>Lookup tables listing global number for particles.</td></tr>
d1654 3
a1656 3
      <tr valign="top"><td>&curren;                                                         </td>
          <td><span class="nobreak"> <font class="output">parts_vsview_all.gnu</font></span>                             </td>
          <td> Gnuplot script to plot a histogram of number of particles vs projection view.</td></tr>
d1687 2
a1688 2
      <tr valign="top"><td>&curren;                                  </td>
          <td> <span class="nobreak"><font class="output">show_ref_views</font>: </span>          </td> 
d1690 1
a1690 1
             among the various reference projections for all groups. </td></tr>
d1880 1
a1880 1
          <td><span class="nobreak"><font class="output">bp_sel_group</font>:</span>                   </td> 
d1884 1
a1884 1
          <td><span class="nobreak"><font class="output">bp_sel_part_***</font>:</span>                </td>
d1888 1
a1888 1
          <td><span class="nobreak"><font class="output">bp_data_ctfd_***</font>:</span>               </td>
d1892 1
a1892 1
          <td><span class="nobreak"><font class="output">bp_dala_01_***</font>:</span>                 </td>
d1995 3
a1997 3
      <tr valign="top"><td>&curren;                                                </td>
          <td><span class="nobreak"><font class="output">vols_***/vol01_one</font>:</span>                  </td>
          <td> Reconstructed volume from first subset of images for each group.    </td></tr> 
d1999 3
a2001 3
      <tr valign="top"><td>&curren;                                                </td>
          <td><span class="nobreak"><font class="output">vols_***/vol01_two</font>:</span>                  </td>
          <td> Reconstructed volume from second subset of images for each group.   </td></tr> 
d2003 3
a2005 3
      <tr valign="top"><td>&curren;                                                </td>
          <td><span class="nobreak"><font class="output">vols_***/vol01_all</font>:</span>                  </td>
          <td> Combined reconstructed volume for each group.                       </td></tr> 
d2007 2
a2008 2
      <tr valign="top"><td>&curren;                                                </td>
          <td><span class="nobreak"><font class="output">vols_***/fsc_doc_m</font>:</span>                  </td>
d2011 1
a2011 1
               FSC curve</a> for each group.                                       </td></tr> 
d2209 1
a2209 1
       <td> Parameter definition file.                                          </td></tr>
d2212 1
a2212 1
       <td> Initial starting volume.                                            </td></tr>
d2215 1
a2215 1
       <td> Group selection file.                                               </td></tr>
d2218 1
a2218 1
       <td> Particle selection files.                                           </td></tr> 
d2221 1
a2221 1
       <td> Initial alignment parameter files.                                  </td></tr> 
d2224 1
a2224 1
       <td> Unaligned CTF corrected, stacked image files.                       </td></tr>
d2227 1
a2227 1
       <td> [<b>Optional</b>] amplitude enhancement scattering file.            </td></tr>
d2230 1
a2230 1
       <td> [<b>Optional</b>] amplitude enhancement mask file.                  </td></tr>
d2236 1
a2236 1
         <code class="snippet">cp ../spider &nbsp; ./spider</code> <br />
d2248 1
a2248 1
            <li>Start alignment with the following command: <br />
d2587 2
a2588 2
  Source: mr1.html          &nbsp;&nbsp;&nbsp; 
  Page updated: Aug. 5, 2014 &nbsp;&nbsp;&nbsp;
@


1.33
log
@python tools links, cosmetic, spire removal
@
text
@d1528 1
a1528 1
/li>
@


1.32
log
@no group resolution calc.
@
text
@d33 2
a34 1
   <tr> <td>    <br />  
a35 3
   
   <p class="explain"></p>
   
a36 1
   
d79 1
a79 2
 whereas the use of defocus groups does not present such 
 limitations.   
d85 2
d88 1
d90 2
a91 1
   <tr> <td>    <br />  
a92 2
   
   <p class="explain"></p>
d97 1
d106 1
a106 1
<br />
d111 1
a111 1
       Set up a project directory with the proper subdirectories and procedure files.</li>
d117 1
a117 1
       The CTF is estimated for each micrograph.</li>
d120 2
a121 2
       Identifies likely particles from the micrographs, 
       and extracts windowed images of individual particles from the micrographs.</li>
d124 1
a124 1
       The particle images are aligned to reference projections using shifts 
d128 1
a128 1
       The averages of each reference view are computed, to assess the distribution 
d132 1
a132 2
       An initial volume is calculated by back projection, along with an estimate 
       of its resolution.</li>
d135 4
a138 3
       Initial alignments are iteratively improved, as each projection is given a
       chance "to find a better home" in terms of its translation and orientation 
       parameters, thus improving the resolution of the reconstruction.</li>
d143 1
a143 1
    frequency correction by X-ray scattering.  Additional details about these 
a151 1

d153 1
d157 3
a159 3
   <tr> <td>                                       <br />  
   <h3 class="heading">Links to further information</h3>
   
a160 2
   </p>
      
d163 1
a170 2
  <li>How to run SPIDER procedure files in <a href="../../recon/mrspire.html">SPIRE</a>. </li>
  
d179 2
a180 2
  <li>Procedure files for circular images from 
      <a href= "../../recon/quantifoil.html">Quantifoil grids</a>.</li>
d184 1
a184 1
  <li>Detailed information about <a href= "refine.html">refinement</a>.</li>
d187 1
a187 1
    <a href="../../../glossary.html"> glossary</a>.
d211 2
a212 1
   <tr> <td>    <br />  
a213 2
   
   <p class="explain"></p>
d233 2
a234 1
   but not both (unless you want to compare the two techniques)  <br />
d236 4
a239 3
   <font class="guitool"> Graphical tools</font>:  
   <a href="../../../../spire/doc/guitools/index.html">marked in brown</a>  
   are available (if installed) for analyzing some results. 
d241 1
a241 1
</ul>
d244 1
a244 8
<p>There are two different choices for running SPIDER procedures: Using 
   <a href="../../../../spire/doc/index.html">
   <font class="guitool">SPIRE</font></a> or using SPIDER
   procedures directly. <p />

<ol class="choice">

   <li> If you are running SPIDER at the Unix prompt, the processing steps are 
d260 3
a262 2
   </li>
   <p />
a263 8
   <li> If you are using 
     <a href="../../../../spire/doc/index.html">
     <font class="guitool">SPIRE</font></a>, then read 
     <a href="mrspire.html"> how to run SPIDER procedure files in SPIRE</a>. 
     <font class="guitool">SPIRE</font> will create the necessary top level directory.
   </li>
   <p />
</ol>
d266 1
a266 1
   The data below are sometimes shown plotted with <i>gnuplot</i>;   see the
d281 2
a282 1
   <tr> <td>    <br />  
d420 2
a421 1
   <tr> <td>      <br />
d443 2
a444 2
     into a   tar file <a href="../spiproject.tar.gz">spiproject.tar.gz</a>  
     Unpack this tar archive inside your working directory:                                 <br />
a452 13
   <li> If using <a href="../../../../spire/doc/index.html">
     <font class="guitool">SPIRE</font></a>, it will create the necessary top level 
     directory and populate the directories with the current set of procedure files. 
     See <a href="mrspire.html">"Single-particle reconstruction using SPIRE"</a>  
     for more information.    
     <table>  
       <tr> 
       <td> <a class="project"  href="../Procs/ctf2d.xml"><font class="input">ctf2d.xml</font></a>: </td> 
       <td> Spire protocol description.</td> </tr>
     </table>
    </li>
   <p />

d616 2
a617 3
   a file containing possibly non-consecutive file numbers.  Installation of the 
   <a href="../../../../spire/doc/packages.html"><font class="guitool">SPIRE</font></a>
   libraries is required.  The syntax, not including the proper data extension. is: <br />
d671 1
a671 1
   <p class="explain">Estimate the defocus of each micrograph by calculating its 
d677 1
a677 1
          Contrast transfer function correction</a> tutorial.                </li>
d679 1
a679 1
     <li> <a href="../../../../spire/doc/guitools/ctfdemo.html">
d681 1
a681 1
          demonstrates the effects of various parameters on the CTF.         </li>
d683 1
a683 1
     <li> <a href="#PP97">Penczek et al., 1997</a> for a fuller discussion.  </li>
d685 1
a685 1
 </div>
d687 1
a687 2

   <p>Run these procedures  in the <i>Power_Spectra/</i> directory.  <br />
d713 1
a713 1
          <a href="../../../../spire/doc/guitools/pyplot.html">
d728 1
a728 1
   <a href="../../../../spire/doc/guitools/ctfmatch/ctfmatch.html">
d880 2
a881 1
<table class="heading" width="100%"><tr><td>      <br />
d1256 2
a1257 1
   <tr><td> <br />
d1497 1
a1497 1
   <p> Note:  *** denotes image group,  ### denotes view,  ??? denotes class)</p>
d1705 1
a1705 1
             <a href="../../../../spire/doc/guitools/qview.html">
d1830 2
a1831 1
<table class="heading" width="100%"><tr><td> <br />
d1841 1
d1964 2
a1965 2
            <i>spider</i>, <i><i>e.g.</i></i>:                                             <br />
          <code class="snippet">cp ../spider  ./spider</code> <br />
d1967 2
a1968 2
        <li>Start alignment with the following command:                                    <br />
          <code class="snippet">./spider spi/dat bp-pubsub 1 &amp; </code>                 <br />
d1974 1
a1974 1

d1976 2
a1977 1
    The procedures may create two particle selection doc files for each group 
d1981 1
a1981 1
      <tr valign="top"><td>&curren;                           </td>
d1983 1
a1983 1
          <td> List of odd numbered images for each group.    </td></tr> 
d1985 1
a1985 1
      <tr valign="top"><td>&curren;                           </td>
d1987 1
a1987 1
          <td> List of even numbered images for each group.   </td></tr> 
d1996 1
a1996 1
      <tr valign="top"><td>&curren;                                             </td>
d1998 1
a1998 1
          <td> Reconstructed volume from first subset of images for each group. </td></tr> 
d2000 1
a2000 1
      <tr valign="top"><td>&curren;                                             </td>
d2002 1
a2002 1
          <td> Reconstructed volume from second subset of images for each group.</td></tr> 
d2004 1
a2004 1
      <tr valign="top"><td>&curren;                                             </td>
d2006 1
a2006 1
          <td> Combined reconstructed volume for each group.                    </td></tr> 
d2008 1
a2008 1
      <tr valign="top"><td>&curren;                                             </td>
d2012 1
a2012 1
               FSC curve</a> for each group.                                    </td></tr> 
d2044 1
a2044 1
          <p>   This reconstruction <font class="output">vol01</font> is known as 
d2050 1
a2050 1
          <a href="../../../../spire/doc/guitools/montage.html">
d2179 2
a2180 1
<table class="heading" width="100%"><tr><td> <br />
d2273 1
a2273 1
      <tr valign="top"><td>&curren;                               </td>
d2275 1
a2275 1
          <td>Alignment parameter doc files                       </td></tr>
d2277 3
a2279 3
      <tr valign="top"><td>&curren;                               </td>
          <td> <font class="output">output/fscdoc_m_##_***</font>:</td>
          <td> Group masked FSC resolution curve doc files        </td></tr>
d2281 1
a2281 1
      <tr valign="top"><td>&curren;                               </td>
d2283 1
a2283 1
          <td> Complete unfiltered volumes                        </td></tr>
d2285 1
a2285 1
      <tr valign="top"><td>&curren;                               </td>
d2287 1
a2287 1
          <td>Complete centered volumes                           </td></tr> 
d2289 1
a2289 1
      <tr valign="top"><td>&curren;                               </td>
d2291 1
a2291 1
          <td>Complete filtered, centered volumes                 </td></tr> 
d2293 1
a2293 1
      <tr valign="top"><td>&curren;                               </td>
d2295 1
a2295 1
          <td>Complete volume from first subset of images         </td></tr>
d2297 1
a2297 1
      <tr valign="top"><td>&curren;                               </td>
d2299 1
a2299 1
          <td>Complete volume from second subset of images        </td></tr>
d2301 1
a2301 1
       <tr valign="top"><td>&curren;                              </td>
d2303 1
a2303 1
          <td>Doc file listing resolution at each iteration.      </td></tr> 
d2380 1
a2380 1
          <td>Plots FSC resolution curve for each iteration of refinement.    </td></tr> 
d2446 2
a2447 1
   <tr><td>    <br /> 
a2448 3
   
   <p class="explain"></p>
   
a2449 1
   
d2455 2
a2456 2

<p><dt><a href="../../../techs/diffmaps/index.html">Difference Maps</a> </dt>
d2461 2
a2462 1
<p><dt><a href="../../../techs/xray/xray.html">Frequency amplitude correction with X-ray
d2468 2
a2469 1
<p><dt><a href="../../../techs/classification/index.html">Classification of Particles</a></dt>
d2473 2
a2474 2
<p><dt>See more methods on the <a href="../../../techniques.html">techniques page</a></dt>
<dd></dd>
d2477 3
a2479 2
<!--    NOt updated ------------------------------------
<p><dt><u>Create tar files for backup</u></dt>
d2488 2
a2489 1
</p>        --------------------------------------- -->
a2492 1

a2494 1

d2497 5
a2501 3
  <tr><td> <br />
    <h3 class="heading"> References</h3>
  </td></tr>
d2507 1
a2507 1
   <li> Penczek, P., M. Rademacher, and J. Frank (1992) &nbsp;&nbsp;  
d2513 1
a2513 1
   <li> Penczek, P., Grassucci, R.A. and Frank, J. (1994) &nbsp;&nbsp;  
d2520 1
a2520 1
   <li>P.A. Penczek, J. Zhu, R. Schrder, J. Frank (1997) &nbsp;&nbsp; 
d2528 1
a2528 1
   <li>P.A. Penczek (2012) &nbsp;&nbsp; 
d2534 1
a2534 1
   <li>B.K. Rath and J. Frank (2004) &nbsp;&nbsp; 
d2540 1
a2540 1
   <li>Alan Roseman (2003) &nbsp;&nbsp;
d2553 1
a2553 1
   <li>Huang Z and Penczek PA. (2004) &nbsp;&nbsp;
d2561 1
d2567 2
a2568 1
   <tr> <td>    <br />  
a2569 1
   
d2571 1
a2571 2
   For a more complete list of changes, see individual procedures.</p>
   
a2572 1
   
d2576 2
a2577 2
<p>
<b><font SIZE="4"><a name="mods">Recent modifications:</a></font></b></p>
d2579 1
a2579 29
    <li>2013-11-22 -- Rewrite al. 
    <li>2012-07-31 -- <a href="../ctf2d.xml">SPIRE configuration file</a> updated. </li> 
    <li>2012-07-19 -- the following procedures explicitly create necessary output directories: </li> 
        <ul class="circles">
            <li>lfc-pick.spi       </li>
            <li>eman2spider.spi    </li>
            <li>rewindow.spi       </li>
            <li>number-parts.spi</li>
        </ul>
    <li>2012-05-17 -- changed <i>X##</i> format registers to named registers for 
        the following procedures:</li>
        <ul class="circles">
            <li>rewindow.spi           </li>
            <li>recheck.spi            </li>
            <li>goodparticlesbydf.spi  </li>
            <li>eman2spider.spi        </li>
            <li>combinegoodclasses.spi </li>
            <li>classify.spi           </li>
        </ul>
    <li>2012-05-10 -- added options to spawn Gnuplot in the following:</li> 
      <ul class="circles">
        <li>goodpartsbymic.spi </li>
        <li>make-ctf-cor.spi        </li>
        <li>histallcc.spi      </li>
        <li>histgoodcc.spi     </li>
      </ul>
    <li>2012-05-02 -- nat2stk.spi -- converts 
        <a href= "../../../protocol_download.html">
        Nature Protocols data set</a> to a form usable here </li> 
a2583 1

d2585 1
d2588 5
a2592 11
   <p>
   Source: mr1.html         &nbsp;&nbsp;&nbsp; 
   Page updated: Apr. 30 2014 &nbsp;&nbsp;&nbsp;
   Tapu Shaikh & ArDean Leith
   </p>

   <p>
   <address> 
   Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a>
   </address>
   </p>
@


1.31
log
@refine-bp call
@
text
@d406 1
a406 1
    <li>  spider spi/dat @@bp-regroup                         </li>
d2116 1
a2116 2
 <li><p class="action">Check the FSC curves from the group volumes by viewing 
      a plot of the curves </p>
a2119 2
   <font class="input">input/bp_sel_group     </font>,  
   <font class="input">vols_***/fsc_doc_m     </font>, and   
d2126 1
a2126 2
          <td> Gnuplot script for plotting the resolution curve of each group, 
               along with the combined resolution curve. </td></tr> 
d2138 1
a2138 2
          <p>Examine this plot and see if there are any unusual curves, 
          if so, go back and check the processing of that group.</p>
d2310 1
a2310 1
          <td><span class="nobreak"><font class="output">output/vol##_centered</font>:</span>  </td>
d2314 1
a2314 1
          <td><span class="nobreak"><font class="output">output/vol##</font>:</span>           </td>
d2318 1
a2318 1
          <td><span class="nobreak"><font class="output">output/vol##_sub1</font>:</span>     </td>
d2322 1
a2322 1
          <td><span class="nobreak"><font class="output">output/vol##_sub2</font>:</span>      </td>
d2338 1
a2338 1
<a class="project" href="../Procs/refine-inseries.spi"><b>refine</b></a>
d2344 1
a2344 1
    <a class="project" href="../Procs/refine-bp.spi">refine-bp</a>
d2351 2
a2352 1
    
d2366 1
a2366 1
        <a class="project" href="../Procs/refine-bp.spi">refine-bp</a>
d2373 1
a2396 1
   <font class="input">input/sel_group     </font>, 
a2397 1
   <font class="input">work/fscdoc_m_##_***</font>, and 
d2399 1
a2399 1
   It creates two gnuplot scripts:         <br /> 
d2404 2
a2405 6
          <td>Plots combined FSC resolution curve for each iteration of refinement.    </td></tr> 

      <tr valign="top"><td>&curren;                                                    </td>
          <td><span class="nobreak"><font class="output">fsc_groups.gnu</font>:</span> </td>
          <td>Plots FSC resolution curve for each group at the last iteration.         </td></tr> 
    </table>   
d2415 1
a2415 1
          <p>The plot of the combined FSC resolution curves should be displayed 
d2417 1
a2417 3
          Likewise if the plot of the FSC curves for each group of the last iteration is
          not displayed  <a href="gnuplot.html?file=fsc_groups.gnu">click here</a>.</p>

@


1.30
log
@*** empty log message ***
@
text
@d580 1
a580 1
          <td>&nbsp; Resized reference volume.                                           </td></tr>
d2349 1
d2370 1
d2653 1
a2653 1
   Page updated: Apr. 28 2014 &nbsp;&nbsp;&nbsp;
@


1.29
log
@ctf2d.xml class=project
@
text
@d1310 1
a1310 3
   the number of new groups can be set to 1 (though not required). 
   If you would simply like to check the size of the groups before writing the stack files, 
   set the variable <i>[want_stacks-yn]</i> in the  procedure: 
d1312 1
a1312 1
   to: <i>0</i> in order to do a dry run. The procedure reads: 
d1339 1
a1339 1
          <td>Optional lookup tables listing global number for particles.</td></tr>
d2651 1
a2651 1
   Page updated: Oct 23 2013 &nbsp;&nbsp;&nbsp;
@


1.28
log
@guitools links, bp-regroup bugs
@
text
@d475 1
a475 1
       <td> <a href="../Procs/ctf2d.xml"><font class="input">ctf2d.xml</font></a>: </td> 
d2615 1
a2615 3
    <li>2012-07-31 -- <a href="../ctf2d.xml">SPIRE configuration file</a> updated. 
        Non-backwards-compatible changes for SPIRE v1.5.4 retained in 
        <a href="../ctf2d.xml">ctf2d_spire154.xml</a></li> 
@


1.27
log
@Added '.gz' to tarball references
@
text
@d406 1
a406 1
    <li>  spider spi/dat @@regroup                         </li>
d1544 2
a1545 1
   <font class="input">../Alignment/output/align_01_***</font>.  
d1550 1
a1550 1
     <tr valign="top"><td>&curren;                                                         </td>
d1552 1
a1552 2
          <td>List of particles associated with reference views (uses:
          <a href="../../../man/vomq.html"> 'VO MQ'</a>).                                  </td></tr>
d1555 2
a1556 2
          <td><span class="nobreak"><font class="output">part_per_view_all</font>:</span   </td>
          <td>Summary of number of particles associated with reference views.              </td></tr>
d1558 1
a1558 1
</li>
d1566 2
a1567 2
   <p />To skip the output of the filtered images, set the register <i>[save-filt-yn]</i>
   in the procedure parameters to 0.  Note that these filtered images are required if using
a1570 1

d1572 3
a1574 3
    <font class="input">sel_proj</font> and
    <font class="input">../Alignment/dala_01_***</font> and
    <font class="input">views/prj###/sel_part_byv</font>
d1578 8
a1585 8
      <tr valign="top"><td>&curren;                                                             </td>
          <td><span class="nobreak"><font class="output">views/prj###/allavg_???</font>:</span> </td>
          <td>Stacks of average images for each set of projections.                             </td></tr>

      <tr valign="top"><td>&curren;                                                             </td>
          <td><span class="nobreak"><font class="output">views/prj###/filtavg_???</font>:</span></td>
         <td>[<b>Optional, required for <a href="mr1verify.html">
              classification-based verification</a></b>] Filtered, aligned image stack          </td></tr>
d1599 2
a1600 2
     <li>Use <a href="../Procs/montagefromdoc.py">
     <font class="guitool">montagefromdoc.py</font></a>.  The syntax, not including 
d1602 3
a1604 3
       <code class="snippet">montagefromdoc.py summary-avgbyview.dat Avg/allavg*</code> <br />
       Changing the column number for the image label will display: (1) the view number, 
       (2) the number of particles, or (3) the s.d. for the variance map.</li>
@


1.26
log
@cosmetic
@
text
@d458 1
a458 1
     into a   tar file <a href="../spiproject.tar">spiproject.tar</a>  
d460 1
a460 1
     <span class="nobreak"><code class="snippet">tar xvf $SPIDER_DIR/docs/techs/recon1/spiproject.tar.gz </code></span> <br />
@


1.25
log
@*** empty log message ***
@
text
@d111 2
a112 2
    <li> <a href="#CreatingProject">Creating new reconstruction project</a> 
    -- Set up a project directory with the proper subdirectories and procedure files.</li>
d114 2
a115 2
    <li> <a href="#Micrographs">Selecting micrographs</a> 
    -- Generate a list of micrographs and a preliminary screening.</li>
d117 2
a118 2
    <li> <a href="#CTF">Contrast Transfer Function (CTF) Estimation</a> 
    -- The CTF is estimated for each micrograph.</li>
d120 2
a121 2
    <li> <a href="#AUTO">Particle Windowing and Verification</a> 
    -- Identifies likely particles from the micrographs, 
d124 2
a125 2
    <li> <a href="#SH">Alignment</a> 
    -- The particle images are aligned to reference projections using shifts 
d128 2
a129 2
    <li> <a href="#CA">Averaging and Verification</a> 
    -- The averages of each reference view are computed, to assess the distribution 
d132 2
a133 2
    <li> <a href="#3D">3D Reconstruction</a>
    -- An initial volume is calculated by back projection, along with an estimate 
d136 2
a137 2
    <li> <a href="#REF">Refinement</a> 
    -- Initial alignments are iteratively improved, as each projection is given a
d140 1
a140 1
    </ul>
d155 2
a156 1
<a name="Links">
d158 1
a158 1
   <tr> <td>    <br />  
a160 2
   <p class="explain"></p>
   
d162 2
a163 1
   
d166 1
a166 1
</a>
d171 1
a171 1
  <li><a href="docfiles.html">Format information for doc files</a></li>
d183 2
a184 1
  <li>Procedure files for circular images from <a href= "../../recon/quantifoil.html">Quantifoil grids</a>.</li>
d283 1
a283 1
   The data below are sometimes shown plotted with <i>gnuplot</i>.  See the
d460 1
a460 1
     <code class="snippet">tar xvf $SPIDER_DIR/docs/techs/recon1/spiproject.tar.gz </code> <br />
d474 3
a476 2
       <tr> <td> <a href="../Procs/ctf2d.xml"><font class="input">ctf2d.xml</font></a>: </td> 
       <td> for the current version of SPIRE.</td> </tr>
d497 1
a497 1
   <code class="snippet">mv /actual-location-of-micrographs/raw* &nbsp;  Micrographs/</code></p>
d515 4
a518 3
     (originally used with the Nature Protocols paper) load the data set and unpack it:      <br />
     <code class="snippet">tar -xvf $SPIDER_DIR/docs/techs/recon1/natproc_data_mics.tar.gz . </code> <br />
     in your project directory. This creates: <br />
d527 1
a527 1
         <td><span class="nobreak"><font class="output">Micrograpsh/raw****</font>:</span>       </td>
d678 7
a684 4
     <code class="snippet">montagefromdoc.py ../sel_micrograph.dat sm-mic*</code> <br />
   The selection file <font class="input">sel_micrograph</font> will be backed up each 
   time that is is saved. 
   .
d694 1
a694 1
<!-- ******************************* Power Spectra -  CTF *********************** --> 
d698 1
a698 1
   <h3 class="heading">Contrast Transfer Function estimation</h3>
d728 1
a728 8

<ol class="choice">

<li><a class="project" href="../Procs/powdefocus.spi">powdefocus.spi</a> 
   (which calls SPIDER procedure <a class="project" href="../Procs/load-mic.spi">load-mic.spi</a>)
   loads each micrograph, computes an averaged power spectrum, and estimates defocus
   using SPIDER operation: <a href="../../../man/tfed.html"><b>'CTF ED'</b></a>.
   It reads:
d731 1
a731 1
   <font class="input">../Micrographs/raw****</font> It creates: 
d752 1
a752 1
          <td>A doc file of defocus values.</td>                                          </tr>
d754 1
d756 2
a757 1
   The <font class="output">ctf****</font> files can be verified with 
d759 8
a766 1
   <font class="guitool">ctfmatch.py</font></a>
d768 2
a769 1
<p />
d771 1
a778 23
   It reads:
   <font class="input">..params</font>, 
   <font class="input">../sel_micrograph</font>, and 
   <font class="input">../Micrographs/raw****</font>. It creates: 

   <table class="outs">
      <tr valign="top"><td>&curren;                                                            </td>
          <td><span class="nobreak"><font class="output">power/diag_pw_avg_****</font>:</span> </td>
          <td>2D power spectra, each is an average of many smaller
              power spectra calculated over the surface of the 
              micrograph and one side is replaced by an idealized
              power spectrum from the CTF correction.                                          </td> </tr>

      <tr valign="top"><td>&curren;                                                            </td>
          <td><span class="nobreak"><font class="output">power/pw_avg_****</font>:</span>      </td>
          <td>2D power spectra in SPIDER format, each is an average 
              of many smaller power spectra calculated over the 
              surface of the micrograph                                                        </td> </tr>

       <tr valign="top"> <td>&curren;                                                          </td>
          <td><span class="nobreak"><font class="output">defocus</font>:</span>                </td>
          <td>A doc file of defocus and astigmatism values.                                    </td></tr>
   </table>
d782 1
d789 1
a789 1
</li>
a791 3
<p />
<p />

d800 3
a802 3
   patterns obtained in the optical diffractometer. It is absolutely
   important that you screen these spectra before proceeding any
   further. Things to look out for: </p>
d806 3
a808 2
         <td>Are the Thon rings round?                                                <br /> 
             Do the rings extend to high resolution?                                  <br />
d810 1
a810 1
             You can discard micrographs that show one of the following artifacts:    <br />
d941 1
a941 1
         <a class="project" href="../Procs/convert-p.spi">convert-p.spi</a>, reads 
d961 1
a961 2
          candidates and copy it to <font class="output">noise.dat</font>.
          </p>
d966 3
a968 2
          <a href="pics/noise.jpg"
             <img src="pics/noise.jpg"></img></a>.
d1173 1
d1180 1
d1185 2
a1186 2
   <font class="output">win/docmontage****_##</font> (by default with 200 particles each), 
   and select these files using 
d1188 1
a1188 1
   </li>                                                                      <br />
d1190 1
a1190 1
   <li>Alternatively, you can screen the particle's micrograph using 
d1193 1
a1193 1
   <code class="snippet">montagefromdoc.py coords/pkcoor_1234.dat</code>      <br />
d1195 1
a1195 1
   </li>
d1197 1
a1197 1
   </ol>
d1199 1
d1254 2
a1255 2
      <tr valign="top"><td>&curren;                                      </td>
         <td><span class="nobreak"><font class="output">good/sel_part_****</font>:</span>             </td>
d1257 4
a1260 4
             listing unduplicated selected particle numbers.             </td></tr>

      <tr valign="top"><td>&curren;                                      </td>
         <td><span class="nobreak"><font class="output">win/win/micwin2glonum_****</font>:</span>     </td>
d1262 1
a1262 1
             mapped to a unique global particle number.                  </td></tr>
d1264 2
a1265 2
      <tr valign="top"><td>&curren;                                      </td>
         <td><span class="nobreak"><font class="output">win/glonum2micwin</font>:</span>              </td>
d1267 1
a1267 1
             mapped to a unique global particle number.                  </td></tr>
d1269 2
a1270 2
      <tr valign="top"><td>&curren;                                      </td>
         <td><span class="nobreak"><font class="output">percent_selected</font>:</span>              </td>
d1272 1
a1272 1
             manually selected particles for each micrograph and overall.</td></tr>
d1766 3
a1768 3
      <tr valign="top"><td>&curren;                                                                  </td>
          <td> <a class="project" href="../Procs/verify-class-byview.spi">verify-class-byview.spi</a></td>
          <td> Classifies the particles corresponding to each reference projection.                  </td></tr>
d1771 4
a1774 4
      <tr valign="top"><td>&curren;                                                           </td>
          <td> <a class="project" href="../Procs/verifybyview.py">
               <font class="guitool">../Procs/verifybyview.py</font></a>                      </td>
          <td> <a href="verifybyview.html"> Select particles by orientation and classification</a>
d1777 7
a1783 7
      <tr valign="top"><td>&curren;                                                           </td>
          <td> <a class="project" href="../Procs/verify-combine-classes.spi">verify-combine-classes.spi</a> 
          <td> Collects information about selected particles.                                 </td></tr>

      <tr valign="top"><td>&curren;                                                           </td>
          <td> <a class="project" href="../Procs/plot-cc-vs-view.spi">plot-cc-vs-view.spi</a> </td>
          <td> Creates histogram of cross correlation values.                                 </td></tr>
d1785 3
a1787 3
      <tr valign="top"><td>&curren;                                                           </td>
          <td> <a class="project" href="../Procs/parts-vs-defocus.spi">parts-vs-defocus.spi</a> </td>
          <td> Creates histogram of particle numbers vs defocus values.                                 </td></tr>
@


1.24
log
@*** empty log message ***
@
text
@d1142 1
@


1.23
log
@edited many lines
@
text
@d1146 2
a1147 1
          <img src="pics/data_bymic_0001_5.jpg"></img></a>.
d1149 1
a1149 1
        vs
d1154 2
a1155 1
          <img src="pics/data_filt_bymic0001_5.jpg"></img></a>.
a2503 11
<!--    NOt updated ------------------------------------
<p><dt><u>Create tar files for backup</u></dt>
<dd><a href="../Procs/backup.sh">backup.sh</a> a shell script, puts a number of vital 
   files into tar files, which can be backed up on tape. Edit the 
   shell script as needed, <i>e.g.</i>, to correspond to your data extension, 
   The variable <i>$BACKUP</i> is intended to be substituted for, for example, an external drive.
   Make sure it is executable and run it from your project directory. 
   The contents of some directories will will copied as tarballs, and 
   others will have their files copied individually.
</dd>
</p>        --------------------------------------- -->
d2523 12
@


1.22
log
@*** empty log message ***
@
text
@d173 1
a173 3
  <li>How to run SPIDER procedure files in <a href="mrspire.html">SPIRE</a>. </li>
  
  <li><a href="../../tar_archive/archive.html"> Tarball archive</a>. </li>
d178 1
a178 1
  <li>Information about images from the <a href="zi/zidoc.html">ZI scanner</a> </li>
d181 1
a181 1
      <a href="../../../../download/zi2spi.c"> zi2spi.c</a></li>
d183 1
a183 1
  <li>Procedure files for circular images from <a href= "quantifoil.html">Quantifoil grids</a>.</li>
@


1.21
log
@commented out ctffind use
@
text
@a186 2
  <li>Conversion of defocus information from <a href= "defmrc.html">CTFFIND3</a>.</li>
  
d348 1
a348 1
    Following two procedures require powdefocus output:
d355 8
a362 2
    <li>spider spi/dat @@make-noise-img                                           </li>
    <li>spider spi/dat @@pick                                                     </li>
d406 2
a407 2
<ol start=29><code class="snippet">
    <li>  spider spi/dat @@regroup         </li>
d411 6
a416 4
        <li>cp ../spider . ;  ./spider spi/dat @@bp-pubsub   </li>
        <li>spider spi/dat @@bp-inseries </li>
      </ol></li>
    <li>  spider spi/dat @@plot-fsc        </li>
d424 4
a427 4
        <li>cp ../spider . ; ./spider spi/dat @@pub-refine  </li>
        <li>./spider spi/dat @@refine      </li>
      </ol></li>
    <li>  spider spi/dat @@plot-fsc-curves </li>
d520 2
a521 2
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">sel_micrograph</font>: </td>
d523 1
a523 13
             used later in the protocol.</td></tr>

      <tr valign="top"><td>&curren;</td>
         <td><font class="output">Micrograpsh/raw****</font>: </td>
         <td>Four micrograph images.</td></tr>

      <tr valign="top"><td>&curren;</td>
         <td><font class="output">orig_reference_volume.dat</font>: </td>
         <td>Reference volume.</td></tr>

      <tr valign="top"><td>&curren;</td>
         <td><font class="output">reference_volume.dat</font>: </td>
         <td>Reference volume.</td></tr>
d525 15
a539 3
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">params</font>: </td>
         <td>Reconstruction parameter file .</td></tr>
d555 2
a556 2
      <tr valign="top">  <td>&curren;                         </td>
          <td><code class="output">params</code>:             </td>
d558 1
a558 2
             <a href="./params.html">reconstruction parameters</td> 
      </tr>
d577 3
a579 3
      <tr valign="top"><td>&curren;                          </td>
          <td> <font class="output">reference_volume</font>: </td>
          <td>&nbsp; Resized reference volume.               </td></tr>
d629 2
a630 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">sel_micrograph</font>:</td>
d632 1
a632 1
             the micrograph files to be processed. </td> </tr>
d664 3
a666 3
      <tr valign="top"><td>&curren;                    </td>
          <td> <font class="output">sm-mic****</font>: </td>
          <td>&nbsp; Reduced size micrographs.         </td></tr>
d737 2
a738 2
      <tr valign="top"><td>&curren;                                        </td>
          <td><font class="output">power/pw_avg_****</font>                </td>
d740 1
a740 1
              power spectra calculated over the surface of the micrograph. </td> </tr>
d742 2
a743 2
      <tr valign="top"><td>&curren;                                        </td>
          <td><font class="output">power/roo_****</font>                   </td>
d747 1
a747 1
          <font class="guitool">pyplot</font></a>                          </td>  </tr>
d749 7
a755 7
       <tr valign="top"> <td>&curren;                                      </td>
          <td><font class="output">power/ctf_****</font>:                  </td>
          <td>Doc files of the background-subtracted 1D power spectra.</td></tr>

       <tr valign="top"> <td>&curren;                                      </td>
          <td><font class="output">defocus</font>:                         </td>
          <td>A doc file of defocus values.</td>                           </tr>
a763 1
<!--  Not usable for ctf correction using: make-ctf-cor.spi xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
d777 2
a778 2
      <tr valign="top"><td>&curren;                                      </td>
          <td><font class="output">power/pw_avg_****</font>              </td>
d782 1
a782 1
              power spectrum.                                            </td> </tr>
d784 9
a792 3
       <tr valign="top"> <td>&curren;                                    </td>
          <td><font class="output">defocus</font>:                       </td>
          <td>A doc file of defocus and astigmatism values.              </td></tr>
a795 1
 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
d864 7
a870 7
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">power/straightctf_****</font>: </td>
         <td>1D profile of the normal CTF.</td></tr>

      <tr valign="top"><td>&curren;</td>
         <td><font class="output">power/flipctf_****</font>: </td>
         <td>1D profile corresponding to CTF-correction by phase-flipping.</td></tr>
d872 2
a873 2
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">power/trapctf_****</font>: </td>
d875 1
a875 1
             are unaffected.</td></tr>
d877 2
a878 2
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">power/firstmin</font>: </td>
d881 1
a881 1
             phase reversal.</td></tr>
d883 2
a884 2
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">viewtrap.gnu</font>: </td>
d886 1
a886 1
             transfer functions.</td></tr>
d892 1
a892 2
        <!-- ====================== left ============ -->
        <td>
d906 2
a907 3
        <td>
        <!-- ====================== right ============ -->
        <td>
d912 1
a912 1
        <td>
d966 8
a973 3
         This noise file is randomly selected from a set of files 
         (<font class="output">tmpnoise/noi***</font>) that are windowed from regions 
         in the micrograph that appear not to contain any particles.   
d975 14
a988 3
         View the selected noise file.   
         If it has any structure (particle, junk), then select one of the other
         candidates and copy it to <font class="output">noise.dat</font>.
d1018 15
a1032 15
         <tr valign="top"><td>&curren;                               </td>
              <td><font class="output">win/sel_part_****</font>:     </td>
              <td>Particle selection doc file for each micrograph.   </td></tr>

          <tr valign="top"><td>&curren;                              </td>
              <td><font class="output">win/data_bymic_****</font>:   </td>
              <td>Stacked particle images.                           </td></tr>

           <tr valign="top"><td>&curren;                             </td>
              <td><font class="output">coords/pkcoor****</font>:     </td>
              <td>Peak coordinates for particles.                     </td></tr>

          <tr valign="top"><td>&curren;                              </td>
              <td><font class="output">coords/ulcoor****</font>:     </td>
              <td>Upper-left corner coordinates for particle windows.</td></tr>
d1062 15
a1076 15
          <tr valign="top"><td>&curren;                              </td>
              <td><font class="output">win/sel_part_****</font>:     </td>
              <td>Particle selection doc file for each micrograph.   </td></tr>

          <tr valign="top"><td>&curren;                              </td>
              <td><font class="output">win/data_bymic_****</font>:   </td>
              <td>Stacks of particle images for each micrograph.     </td></tr>

           <tr valign="top"><td>&curren;                             </td>
              <td><font class="output">coords/pkcoor****</font>:     </td>
              <td>Peak coordinates for particles.                    </td></tr>

          <tr valign="top"><td>&curren;                              </td>
              <td><font class="output">coords/ulcoor****</font>:     </td>
              <td>Upper-left corner coordinates for particle windows.</td></tr>
d1092 7
a1098 7
              <tr valign="top"><td>&curren;                                  </td>
                  <td><font class="output">win/sel_part_****</font>:         </td>
                  <td> Particle selection doc file for each micrograph.      </td></tr>

              <tr valign="top"><td>&curren;                                  </td>
                  <td><font class="output">coords/pkcoor_****</font>:        </td>
                  <td>Pixel coordinates for <i>center</i> of particle images.</td></tr>
d1104 3
a1106 3
              <tr valign="top"><td>&curren;                                  </td>
                  <td><font class="output">win/data_bymic_****</font>:       </td>
                  <td>Stacks of particle images for each micrograph.         </td></tr>
d1127 31
a1157 3
      <tr valign="top"><td>&curren;                        </td>
         <td><font class="output">filt/data_filt_bymic_****</font>: </td>
         <td>Stacks of low-pass filtered particle images.  </td></tr>
d1159 2
a1160 5
   Manual selection of good particles (the next step) is easier if
   the particles have been low-pass filtered beforehand. Use the 
   filtered particles, not the raw particles, during selection in 
   <a href= "../../../../web/docs/web.html">
   <font class="guitool">WEB</font></a>. 
d1187 3
a1189 3
      <tr valign="top"><td>&curren;                                </td>
         <td><font class="output">good/good****</font>:            </td>
         <td>Particle selection doc files, one for each micrograph.</td>
d1212 1
a1212 1
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
d1222 1
a1222 1

d1663 1
a1663 2
        <!-- ====================== left ============ -->
        <td>
d1673 2
a1674 3
        <td>
        <!-- ====================== right ============ -->
        <td>
d1679 1
a1679 1
        <td>
d1697 1
a1697 1
          <td> <font class="output">parts_vsview_all.gnu</font>                             </td>
a1699 1

a1700 4
   <p>The output Gnuplot script <font class="output">parts_vsview_all.gnu</font>
      will plot a histogram of number of particles vs projection view. 
      The plot should be displayed automatically, if not 
      <a href="gnuplot.html?file=parts_vsview_all.gnu">click here</a>. </p>
d1704 1
a1704 2
        <!-- ====================== left ============ -->
        <td>
d1711 1
d1713 1
a1713 3
        <td>
        <!-- ====================== right ============ -->
        <td>
d1718 1
a1718 1
        <td>
d1730 1
a1730 1
          <td> <font class="output">show_ref_views</font>:           </td> 
d1738 1
a1738 2
        <!-- ====================== left ============ -->
        <td>
d1748 2
a1749 4

        <td>
        <!-- ====================== right ============ -->
        <td>
d1754 1
a1754 1
        <td>
d2004 1
a2004 1
          <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.18.16 ./spider</code> <br />
d2060 15
a2074 15
      <tr valign="top"><td>&curren;                                               </td>
          <td> <font class="output">vol01</font>:                                 </td>
          <td> A 3D reconstruction from entire set of particles.                  </td></tr>
 
      <tr valign="top"><td>&curren;                                               </td>
          <td> <font class="output">fsc_doc_u</font>:                             </td>
          <td> Doc file containing unmasked FSC curve for final reconstruction.   </td></tr>
 
      <tr valign="top"><td>&curren;                                               </td>
          <td> <font class="output">fsc_doc_m</font>:                             </td>
          <td> Doc file containing masked FSC curve for final reconstruction.     </td></tr>
 
      <tr valign="top"><td>&curren;                                               </td>
          <td> <font class="output">resolution</font>:                            </td>
          <td> Doc file containing masked and unmasked resolution (in Angstroms). </td> </tr> 
d2076 25
d2102 5
a2106 13
   This reconstruction <font class="output">vol01</font> is known as 
   the <i>initial volume</i> and will be used as input for the Refinement step. 
   
   <p />
   View the volume as slices using the <i>Montage</i> operation in 
   <font class="guitool">WEB</font> or in 
   <a href="../../../../spire/doc/guitools/montage.html">
   <font class="guitool">montage.py</font></a>. 
   Ideally, each image should show a particle isolated from its surroundings, 
   exhibiting some internal structure - somewhat like the reference images. 
   If any images are blank or otherwise unusual, check the volume for specific groups.
   </p>
   
d2146 1
a2146 1
   <table>
d2148 1
a2148 2
        <!-- ====================== left ============ -->
        <td>
d2154 1
d2158 2
a2159 3
        <td>
        <!-- ====================== right ============ -->
        <td>
d2162 3
a2164 4
          <a href="pics/fsc.jpg"
             <img src="pics/small_fsc.jpg"></img></a>.
        <td>

d2172 1
a2172 1
   Information at spatial frequencies above the cutoff value is  
d2175 2
a2176 2
   This concept is described in 
       <a href="#ZH04">Huang and Penczek (2004)</a><br />
d2178 1
d2187 1
a2187 1
    </table>   
d2194 1
a2194 1
   The filter generated above will be applied to the initial volume.
d2197 1
a2197 1
   after having been filtered to the exact same resolution.<br />
d2199 1
a2199 1
   <a class="project" href="../Procs/matched-filt.spi">matched-filt.spi</a> reads: 
d2206 1
a2206 1
          <td> <font class="output">vol01_matched</font>: </td>
d2208 1
a2208 1
    </table>   
d2251 1
a2251 1
   <tr><td> <font class="input">../params</font>:                               </td> 
d2254 1
a2254 1
   <tr><td> <font class="input">../Reconstruction/input/vol01</font>:           </td> 
d2257 1
a2257 1
   <tr><td> <font class="input">../Reconstruction/input/bp_sel_group</font>:    </td> 
d2260 1
a2260 1
   <tr><td> <font class="input">../Reconstruction/input/bp_sel_part_***</font>: </td> 
d2263 1
a2263 1
   <tr><td> <font class="input">../Reconstruction/input/bp_align_01_***</font>: </td> 
d2266 1
a2266 1
   <tr><td> <font class="input">../Reconstruction/bp_data_ctfd_***</font>:      </td> 
d2269 1
a2269 1
   <tr><td> <font class="input">input/scattering</font>:                        </td> 
d2272 1
a2272 1
   <tr><td> <font class="input">input/mask</font>:                              </td> 
d2278 3
a2280 2
<li>The following options will depend on whether using you are using 
      <a href="../../../../pubsub/pubsub.html"> Publish and Subscribe</a> on a cluster:
d2282 2
a2283 4
      First; Copy the SPIDER executable to the local directory and rename it :
         <i>spider</i>, <i><i>e.g.</i></i>:                                               <br />
         <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.20.16 ./spider</code> <br />
      This ensures that the same SPIDER executable is available throughout whole refinement.
d2410 1
a2410 1
   The procedure <a class="project" href="../Procs/plot-fsc-curves.spi">plot-fsc-curves.spi</a> reads:
d2418 7
a2424 7
      <tr valign="top"><td>&curren;                                                </td>
          <td><font class="output">fsc_iter.gnu</font>:                            </td>
          <td>Plots combined FSC resolution curve for each iteration of refinement.</td></tr> 

      <tr valign="top"><td>&curren;                                                </td>
          <td><font class="output">fsc_groups.gnu</font>:                          </td>
          <td>Plots FSC resolution curve for each group at the last iteration.     </td></tr> 
d2432 1
a2432 2
        <!-- ====================== left ============ -->
        <td>
d2440 2
a2441 3
        <td>
        <!-- ====================== right ============ -->
        <td>
d2446 1
a2446 1
        <td>
d2453 1
a2453 1
        <td>
@


1.20
log
@pub_refine.spi refine.spi do not exist
@
text
@d585 1
a585 1
   <!--<a class="project" href="clean.sh">clean.sh</a> -->
d718 1
a718 1
   determine defocus using one of the following three methods:</p> 
d759 1
a759 1

d786 1
d1737 2
a1738 1
   Summary of required steps: <br />
@


1.19
log
@rewrite
@
text
@d1025 1
a1025 1
       <a  href="../Procs/pick-particles-lfc.spi">pick-particles-lfc.spi</a>
d2303 1
a2303 1
<a class="project" href="../Procs/refine.spi"><b>refine</b></a>
d2323 1
a2323 1
<a class="project" href="../Procs/pub_refine.spi"><b>pub_refine</b></a>
@


1.18
log
@*** empty log message ***
@
text
@d44 1
a44 1
 This page describes a method for creating a 3D reconstruction from 
d51 3
a53 1
 resolution. In the traditional method, ensembles of particles with similar defocus values 
a85 2
<p>The procedures are described in greater detail below.</p>

a101 2
<li> <a href="#Quick">Quick-start guide</a> -- A simplified list of steps.</li>

d105 2
d108 1
d147 2
a150 2
<li> <a href="#Refs">References</a> -- Citations to additional background information.</li>

d212 3
d216 80
a295 1
<!-- ************************ Creating new reconstruction project ******************** -->
d297 1
d299 1
a299 1
<hr /> <a name="Quick"></a>
a425 82
<!-- ------------------- Running  SPIDER procedure files ------------------- -->

<a name="RunningSPIDER"></a>
<table class="heading" width="100%" >
   <tr> <td>    <br />  
   <h3 class="heading">Running SPIDER procedure files</h3>
   
   <p class="explain"></p>
   <p />
   </td> </tr>
</table>

<p />
In the sections below, various file types are denoted by different fonts:

<ul>
<li><b>Each step in the process is bold and marked  by a bullet</b>                <br />
   <a href="../">Procedure files</a> are links to the procedure script,            <br />
   <font class="input">Input files  </font> for that procedure are marked in pink, <br />
   <font class="output">Output files</font> from that procedure are marked in green.                                                                <br />
   Sometimes more than one approach is available. 
   Lists starting with lowercase letters indicate that you should choose:

   <ol class="choice">
      <li>one approach, or   </li>
      <li>the other approach,</li>
   </ol>
   but not both (unless you want to compare the two techniques)  <br />

   <font class="guitool"> Graphical tools</font>:  
   <a href="../../../../spire/doc/guitools/index.html">marked in brown</a>  
   are available (if installed) for analyzing some results. 
</li>
</ul>
<p />

<p>There are two different choices for running SPIDER procedures: Using 
   <a href="../../../../spire/doc/index.html">
   <font class="guitool">SPIRE</font></a> or using SPIDER
   procedures directly. <p />

<ol class="choice">

   <li> If you are running SPIDER at the Unix prompt, the processing steps are 
     carried out by procedure files, which run many SPIDER operations automatically. 
     To use a procedure referred to in this document, copy the procedure to your 
     current working directory. Near the beginning 
     of each procedure, there is a list of parameters that can be adjusted
     according to your particular project. Some of the procedures may
     call additional procedure(s) listed below the procedure
     filename. You need not change anything inside these additional
     procedures. Use the following format to run a SPIDER procedure: <br />
   
     <code class="snippet">spider spi/dat @@proc</code>              <br />
   
     where 
     <code class="snippet">spi</code> is the procedure file extension, 
     <code class="snippet">dat</code> is the project data file extension, and 
     <code class="snippet">proc.spi </code> is the procedure file.
   </li>
   <p />

   <li> If you are using 
     <a href="../../../../spire/doc/index.html">
     <font class="guitool">SPIRE</font></a>, then read 
     <a href="mrspire.html"> how to run SPIDER procedure files in SPIRE</a>. 
     <font class="guitool">SPIRE</font> will create the necessary top level directory.
   </li>
   <p />
</ol>

<p />
   The data below are sometimes shown plotted with <i>gnuplot</i>.  See the
   <a href="http://www.gnuplot.info/">Gnuplot manual</a> for details. 
<p />

<h4>After each step check the output files to make sure the results are 
    sensible. If you are not sure what is "sensible," ask an expert. </h4> 
</p>

<hr />

d486 1
a486 1
<p> Files of the digitized micrographs should be placed in the <i>Micrographs/</i> directory</p>
d728 1
a728 1
   <font class="input">../sel_micrograph</font>, &amp;
d769 1
a769 1
   <font class="input">../sel_micrograph</font>, &amp;
d850 1
a850 1
    <font class="input">defocus</font>, &amp;
d878 16
a893 9
   
   <br />In the Gnuplot output script <font class="output">viewtrap.gnu</font>
   one micrograph is chosen to plot the corresponding 1D transfer-function profiles. 
   By default, the micrograph with the highest defocus is chosen.  
   To plot a different micrograph's profiles, 
   set the parameter <i>[mic2plot]</i> to a different micrograph number in 
   <a class="project" href="../Procs/make-ctf-cor.spi">make-ctf-cor.spi</a>, 
   or simply edit the Gnuplot script.  The  plot should be displayed 
      automatically, if not  <a href="gnuplot.html?file=viewtrap.gnu">click here</a>.</p>
d895 13
a907 2
   The 1D profile outputs are interchangeable for CTF correction in the later procedures, but 
   by default the <font class="output">power/flipctf****</font> files will be used. 
d1216 1
a1216 1
         <td><font class="output">good/sel_part_****</font>:             </td>
d1221 1
a1221 1
         <td><font class="output">win/win/micwin2glonum_****</font>:     </td>
d1226 1
a1226 1
         <td><font class="output">win/glonum2micwin</font>:              </td>
d1231 1
a1231 1
         <td> <font class="output">percent_selected</font>:              </td>
d1279 1
a1279 1
   <font class="input">../Particles/win/winser_****      </font>,&amp;
d1289 1
a1289 1
          <td><font class="output">sel_group</font>:                     </td> 
d1293 1
a1293 1
          <td><font class="output">data_ctf_***</font>:                  </td>
d1297 1
a1297 1
          <td><font class="output">sel_part_***</font>:                  </td>
d1301 1
a1301 1
          <td><font class="output">part2glonum</font>:                   </td>
d1325 1
a1325 1
          <td><font class="output">../Averages/sel_proj</font>:         </td>
d1329 1
a1329 1
          <td><font class="output">refangles</font>:                    </td>
d1335 1
a1335 1
          <td><font class="output">projs/prj_01</font>:                 </td>
d1405 1
a1405 1
      <a href="../../../man/apshc.html"><b>'AP SHC'</b></a> &amp; 
d1415 1
a1415 1
      <a class="project" href="../Procs/align-main.spi">    align-main.spi    </a>, &amp;
d1441 1
a1441 1
          <td><font class="output">dala_01_***</font>:     </td>
d1445 1
a1445 1
          <td><font class="output">align_01_***</font>:    </td>
d1449 1
a1449 1
          <td><font class="output">align_01_all</font>:    </td>
d1612 23
a1634 7
   <p>The output Gnuplot script <font class="output">cc_vsview_all.gnu</font>
   will overlay the correlation histogram of the particle images 
   with a Gaussian profile. If the histograms display a bimodal
   distribution, the higher peak may correspond to actual particles,
   while the lower peak may show noise. A threshold can be chosen
   between two such peaks.   The plot should be displayed automatically, if not 
   <a href="gnuplot.html?file=cc_vsview_all.gnu">click here</a>. </p>
d1660 23
d1696 25
a1720 6
   This image shows the various angular reference groups represented by small 
   circles. The radii of these circles are proportional to the number of 
   particles in each group. 
   Display the image in <a href="../../../../web/docs/web.html">
   <font class="guitool">WEB</font></a> or
   <a href="../../../../spire/doc/guitools/qview.html"><font class="guitool">qview.py</font></a>.
d1742 1
d1744 4
a1747 3
          <td> <a class="project" href="..../Procs/verifybyview.py">
               <font class="guitool">../Procs/verifybyview.py</font>                          </td>
          <td> Select particles after separation by orientation and classification.           </td></tr>
d1804 1
a1804 1
          <td> <font class="output">sel_group_best</font>                 </td>
d1808 1
a1808 1
          <td> <font class="output">sel_part_best_***</font>              </td>
d1812 1
a1812 1
          <td> <font class="output">views/prj###/sel_part_byv_best</font> </td>
d1816 1
a1816 1
          <td> <font class="output">part_vsview_best</font>               </td>
d1882 1
a1882 1
          <td><font class="output">bp_sel_group</font>:                  </td> 
d1886 1
a1886 1
          <td><font class="output">bp_sel_part_***</font>:               </td>
d1890 1
a1890 1
          <td><font class="output">bp_data_ctfd_***</font>:              </td>
d1894 1
a1894 1
          <td><font class="output">bp_dala_01_***</font>:                </td>
d1982 1
a1982 1
          <td> <font class="output">vols_***/sel_odd</font>:  </td> 
d1986 1
a1986 1
          <td> <font class="output">vols_***/sel_even</font>: </td> 
d1997 1
a1997 1
          <td> <font class="output">vols_***/vol01_one</font>:                  </td>
d2001 1
a2001 1
          <td> <font class="output">vols_***/vol01_two</font>:                  </td>
d2005 1
a2005 1
          <td> <font class="output">vols_***/vol01_all</font>:                  </td>
d2009 1
a2009 1
          <td> <font class="output">vols_***/fsc_doc_m</font>:                  </td>
d2091 23
a2113 6
   <p>The output Gnuplot script <font class="output">fsc.gnu</font>
      will plot the fsc curve and should be displayed 
      automatically, if not <a href="gnuplot.html?file=fsc.gnu">click here</a>.</p>
   
<!--   <p>
   <a href="Old/plotres2.gif"><img width="200" height="150" src="./Old/plotres2.gif"></a></p>-->
a2114 2
   Examine this plot and see if there are any unusual curves, if so, go back and check 
   the processing of that group.
d2131 1
a2131 1
          <td> <font class="output">matched_filt_doc_01</font>: </td>
d2263 1
a2263 1
          <td> <font class="output">output/align_##_***</font>:   </td>
d2271 1
a2271 1
          <td> <font class="output">output/vol##_all</font>:      </td>
d2275 1
a2275 1
          <td><font class="output">output/vol##_centered</font>:  </td>
d2279 1
a2279 1
          <td><font class="output">output/vol##</font>:           </td>
d2283 1
a2283 1
          <td> <font class="output">output/vol##_sub1</font>:     </td>
d2287 1
a2287 1
          <td><font class="output">output/vol##_sub2</font>:      </td>
d2291 1
a2291 1
          <td><font class="output">output/resolutions</font>:     </td>
d2376 29
a2404 4
   <p>The plot of the combined FSC resolution curves should be displayed 
      automatically, if not  <a href="gnuplot.html?file=fsc_iter.gnu">click here</a>.
      Likewise if the plot of the FSC curves for each group of the last iteration is
      not displayed  <a href="gnuplot.html?file=fsc_groups.gnu">click here</a>.</p>
d2573 1
@


1.17
log
@gnuplot links, many cosmetic changes, etc
@
text
@d212 3
d222 1
a222 1
   A <a href="../test_recon1.spi">procedure for testing a complete reconstruction</a>
d232 1
d235 7
a241 2
    <li>tar -xvf spiproject.tar.gz                             </li>
    <li>cd myproject                                           </li>
d243 2
a244 2
      <ol type='A'>
         <li>mv &nbsp; /actual-location-of-your/micrographs/raw* &nbsp;&nbsp; Micrographs/ <br />
d247 1
a247 1
        <li> tar -xvf $SPIDER_DIR/docs/techs/recon1/natproc_data_mics.tar.gz  <b>.</b>     <br />                              </li>
a248 1
    <!-- <li>cp &nbsp;  /your-spider-executable  &nbsp;&nbsp; <b>./spider </b></li>  -->
d262 2
a263 2
        <li>spider spi/dat @@powdefocus &amp;                             </li>
        <li>spider spi/dat @@ctffind    &amp;                             </li>
d266 1
d293 1
a293 1
        <li>./spider spi/dat  @@align-pubsub   </li>
d323 2
a324 2
        <li>./spider spi/dat @@bp-pubsub   </li>
        <li>./spider spi/dat @@bp-inseries </li>
d331 1
a331 1
<ol start=34><code class="snippet">
d334 1
a334 1
        <li>./spider spi/dat @@pub-refine  </li>
d341 1
d453 1
a453 1
     <code class="snippet">tar xvf $SPIDER_DIR/docs/techs/recon1/spiproject.tar.gz .</code> <br />
d473 3
d1479 3
a1481 1
   <a class="project" href="../Procs/select-byview.spi">select-byview.spi</a></i> reads:  
d1676 4
d1682 1
a1682 3
   <p>If performing this step, remember to substitute: 
   <font class="output">views/prj###/sel_part_byv_good</font> for: 
   <font class="input"> views/prj###/sel_part_byv_sort</font> in:  
d1687 1
@


1.16
log
@gnuplot, ...
@
text
@d89 1
a89 1
<!-- --------------------- Outline ------------------------------------ -->
d92 1
a92 1
   <h3 class="heading">Outline</h3>
d172 1
a172 2
  <li>How to run SPIDER procedure files in 
      <a href="mrspire.html">SPIRE</a>. </li>
d174 1
a174 5
  <li><a href="../../tar_archive/archive.html">
      Tarball archive</a>. </li>
  
  <li>Download link for the 
      <a href= "../../../protocol_download.html"> Nature Protocols data set</a>.</li>
d179 1
a179 2
  <li>Information about images from the 
      <a href="zi/zidoc.html">ZI scanner</a> </li>
d184 1
a184 2
  <li>Procedure files for circular images from 
      <a href= "quantifoil.html">Quantifoil grids</a>.</li>
d186 1
a186 2
  <li>Conversion of defocus information from 
      <a href= "defmrc.html">CTFFIND3</a>.</li>
d190 1
a190 2
  <li>Detailed information about 
      <a href= "refine.html">refinement</a>.</li>
d192 1
a192 2
  <li> <a href="../../../strategies.html">
    Reconstruction strategies</a> and the 
d217 2
a218 3
   <p class="explain">This is a brief list of the steps comprised in this protocol. 
   For simplicity, options have been limited. 
   For further information, see below
d408 1
a408 1
<h4>After each step check the  output files to make sure the results are 
d572 1
a572 1
   <code class="snippet">cp `which spider`  ./spider</code>
d629 1
a629 1
<p>
d633 1
a633 1
   helpful to shrink the micrographs in order to quickly scan through them.       <br />  
d635 9
a643 4
   <font class="input">../sel_micrograph</font>, &amp; 
   <font class="input">raw****</font>.  It creates:                               <br />

   <table class="outs">
a647 4
   
   Choose a reduction factor that will allow for placing a 
   reasonable number of micrographs on your computer screen (say, 2 to 6) at a 
   sufficient level of detail to evaluate them.
d649 1
a649 1
</p>
d677 15
a691 1
   power spectrum.</p>
a697 1
 For more information, see:
d699 2
a700 12
 <ul class="options">
    <li> <a href="../../../techs/ctf/ctf.html">
    Contrast transfer function correction</a> tutorial.                      </li>
    <li> <a href="../../../../spire/doc/guitools/ctfdemo.html">
         <font class="guitool">ctfdemo</font></a>, a program that demonstrates 
         the effects of various parameters on the CTF.                       </li>
    <li> <a href="#PP97">Penczek et al., 1997</a> for a fuller discussion.   </li>
  </ul>
  </p>

<ul>
<a name="DEF"></a>
d809 4
a812 2
   
   <br />Remove such micrographs from the selection doc file by either:
d864 1
a864 1
   <br />In the Gnuplot output script <font class="output">viewtrap.gnu</font>, 
d870 4
a873 24
   or simply edit the Gnuplot script.  To view the 1D profiles, choose one of the following:


   <ol class="choice">
   
   <li>In the procedure <a class="project" href="../Procs/make-ctf-cor.spi">make-ctf-cor.spi</a>,
       leave the parameter <i>[viewplot-yn]</i> as 1 (the default).  
       A Gnuplot window will pop up automatically. 
       <br />(NOTE: This may not work if <font class="output">viewtrap.gnu</font> 
       is not in the same directory as the procedure.)</li>

   <li>From the command line, type:
       <br /><code class="snippet">gnuplot -persist viewtrap.gnu</code> <br /></li>

   <li>Start Gnuplot by typing from the command line:
       <br /><code class="snippet">gnuplot</code> <br />
       And from the Gnuplot prompt, type:
       <br /><code class="snippet">load 'viewtrap.gnu'</code> <br />
       Remember to include the quotes. 
       Running Gnuplot interactively will allow you to adjust the parameters 
       without opening a new plot each time.</li>
   </ol>
   
   <br />The 1D profile outputs are interchangeable in the later procedures, but 
d954 4
a957 4
       equalization and reads 
         <font class="input">sel_micrograph        </font> 
         <font class="input">noise                 </font> 
         <font class="input">../Micrographs/raw****</font> 
d993 9
a1001 2
       also performs a histogram-fitting normalization on the picked images. 
       It creates:                                                   <br />
d1107 2
a1108 1
         <td>Particle selection doc files, one for each micrograph.</td></tr>
d1117 1
a1117 1
   </li><br />
d1130 1
a1130 1

d1252 1
a1252 1
   It creates:        
d1290 1
d1292 4
d1386 4
a1389 4
        <li>Copy the SPIDER executable to the local directory and rename it 
            <i>spider</i>, <i>e.g.</i>:<br />
        <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.20.3 &nbsp; ./spider </code>
        <br /></li>
d1400 1
a1400 1
    Either procedure set reads:
d1403 2
a1404 1
    <font class="input">data***      </font>.  They create:
d1417 1
a1417 1
          <td>Shift and rotation parameters for all groups.</td></tr>
d1475 2
a1476 6
      <tr valign="top"><td>&curren;                                 </td>
          <td><font class="output">sel_proj</font>:                 </td>
          <td>List of reference views.                              </td></tr>

      <tr valign="top"><td>&curren;                                 </td>
          <td><font class="output">views/sel_part_byv_???</font>:   </td>
d1478 1
a1478 1
          <a href="../../../man/vomq.html"> 'VO MQ'</a>).           </td></tr>
d1480 3
a1482 3
      <tr valign="top"><td>&curren;                                           </td>
          <td><font class="output">part_per_view_all</font>:                  </td>
          <td>Summary of number of particles associated with reference views. </td></tr>
d1505 3
a1507 3
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">views/prj###/allavg_???</font>:    </td>
          <td>Stacks of average images for each set of projections.</td></tr>
d1509 2
a1510 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">views/prj###/filtavg_???</font>:    </td>
d1512 1
a1512 1
              classification-based verification</a></b>] Filtered, aligned image stack</td></tr>
d1549 2
a1550 1
    
d1553 1
a1553 1
   <font class="input">views/prj###/sel_part_byv</font>. It creates:
d1555 5
d1562 2
a1563 2
      <tr valign="top"><td>&curren;                                 </td>
          <td><font class="output">prj###/sel_part_combined</font>: </td> 
d1565 1
a1565 1
          <font class="input">views/prj###/sel_part_byv</font>.     </td></tr>
d1567 7
a1573 7
      <tr valign="top"><td>&curren;                                 </td>
          <td><font class="output">cc_vsview_all</font>:            </td>
          <td>Histogram doc file of cross correlation values.       </td></tr>

      <tr valign="top"><td>&curren;                                 </td>
          <td><font class="output">cc_vsview_all.gnu</font>:        </td> 
          <td>Gnuplot script for plotting the correlation histogram.</td></tr>
d1575 1
a1575 3
   <p>Experiment with the parameter <i>[num-bins]</i> if
   you want finer sampling per bin, or coarser (and thus more particles per bin).</p>
   
d1582 2
a1583 4
   between two such peaks.  </p>
   
   The overall histogram plot should be displayed automatically if not 
    <a href="gnuplot.html?suffix=all">see here</a>.
d1604 5
d1675 2
a1676 2
   <p>Run this procedure even if you aren't limiting overrepresented views.  
   Downstream procedures will need the outputs.</p>
d1686 6
a1691 2
   <p>
   If you performed <a href="mr1verify.html">classification-based verification</a>, then use 
d1698 2
a1699 1
   <a class="project" href="../Procs/best-imgs.spi">best-imgs.spi</a> reads:    
a1720 1

d1763 1
a1763 1
   Inputs include: 
d1768 13
a1780 1
   <font class="input">../Alignment/output/dala_01_***  </font>. &nbsp;&nbsp; Outputs: 
a1798 3

   <p>To perform a dry run -- for example to see how big the groups will be -- 
   set the parameter <i>[stacks-yn]</i> to 0.</p>
a1799 7
   <p><b>NOTE:</b> If you aren't regrouping the images and have set <i>[num-stacks]</i> to 0, 
   the procedure is written such that it should be in the same directory as the output files. 
   To find how to circumvent this, look up the <code class="snippet">ln</code> 
   command regarding relative paths, or look up the example in 
   <a class="project" href="../Procs/refine-prepare.spi">refine-prepare.spi</a> below.
   </p>
     
d1809 43
d1878 1
a1878 45
    <p>Like alignment, 3D reconstruction is CPU-intensive and benefits by parallelization. 
    Whether you are running reconstruction in parallel or in series, edit (but do not run)
    <a class="project" href="../Procs/bp-settings.spi">bp-settings.spi</a>, 
    which reads parameters and input filenames
    (<i><i>e.g.</i>, 
    <font class="input">input/bp_sel_group    </font>, 
    <font class="input">input/bp_sel_part***  </font>, and 
    <font class="input">input/bp_dala_01_***  </font>, and 
    <font class="input">bp_align_01_*** </font>).</p>
    
    Some notable parameters in
    <a class="project" href="../Procs/bp-settings.spi">bp-settings.spi</a>:
    <table class="outs">
      <tr valign="top"><td>&curren;                                  </td>
          <td> <b><i>[bp-method]</i></b>:                            </td>
          <td> Backprojection method. More information below.        </td></tr> 

      <tr valign="top"><td>&curren;                                  </td>
          <td> <b><i>[stk-opt]</i></b>:                              </td>
          <td> Stack options (<i>e.g.</i>, 0 to read from original location, 
               1 to copy into RAM, or 2 to copy temporarily to disk).</td></tr> 

      <tr valign="top"><td>&curren;                                  </td>
          <td> <b><i>[max-wait]</i></b>:                             </td>
          <td> Like in <a href="../Procs/align-settings.spi">align-settings.spi</a>
               above, will wait up to 10 minutes by default before reading a new group's stack, 
               in order to distribute disk I/O..                     </td></tr> 
    </table>
    
    <p>
    For the parameter <b><i>[bp-method]</i></b>, the Fourier-based backprojections -- 
    <a href="../../../man/bp32f.html">'BP 32F'</a> 
    (option 2 in <a href="../Procs/bp-settings.spi">bp-settings.spi</a>) or 
    <a href="../../../man/bp3n.html">'BP 3N'</a> 
    (option 4) -- are recommended.  The iterative, real-space methods --
    <a href="../../../man/bprp.html">'BP RP'</a> 
    (option 3) or 
    <a href="../../../man/bpcg.html">'BP CG'</a> 
    (option 1) -- sometimes cause artifacts in the reconstruction.  
    These artifacts include a rise in the FSC at high resolution, or 
    ripples in the reconstruction when viewed as <i>Z</i>-slices. 
    The artifacts may be due to inaccuracy in the estimated defocus. 
    Feel free to experiment, but be wary of the output.
    </p>

d1977 1
a1977 1
      a plot f the curves </p>
d1982 1
a1982 1
   <font class="input">vols_***/fsc_doc_m     </font>, &amp;  
d1993 3
a1995 2
   <p>Plot the resolution curves by typing, from the command line:
       <br /><code class="snippet">gnuplot -persist fsc.gnu</code> </p>
d2247 1
a2247 1
   <font class="input">work/fscdoc_m_##_***</font>, 
d2256 3
a2258 3
      <tr valign="top"><td>&curren;                                           </td>
          <td><font class="output">fsc_groups.gnu</font>:                     </td>
          <td>Plots FSC resolution curve for each group at the last iteration.</td></tr> 
d2261 6
a2266 1
</p> 
d2314 2
d2325 1
a2325 1
</p>
d2348 1
a2349 49
<!-- ************************* Modifications *********************************** -->

<a name="Mods"></a>
<table class="heading" width="100%" >
   <tr> <td>    <br />  
   <h3 class="heading">Modifications log</h3>
   
   <p class="explain">Not an exhaustive list.
   For a more complete list of changes, see individual procedures.</p>
   
   <p />
   
   </td> </tr>
</table>

<p>
<b><font SIZE="4"><a name="mods">Recent modifications:</a></font></b></p>
<ul>
    <li>2012-07-31 -- <a href="../ctf2d.xml">SPIRE configuration file</a> updated. 
        Non-backwards-compatible changes for SPIRE v1.5.4 retained in 
        <a href="../ctf2d.xml">ctf2d_spire154.xml</a></li> 
    <li>2012-07-19 -- the following procedures explicitly create necessary output directories: </li> 
        <ul class="circles">
            <li>lfc-pick.spi       </li>
            <li>eman2spider.spi    </li>
            <li>rewindow.spi       </li>
            <li>number-parts.spi</li>
        </ul>
    <li>2012-05-17 -- changed <i>X##</i> format registers to named registers for 
        the following procedures:</li>
        <ul class="circles">
            <li>rewindow.spi           </li>
            <li>recheck.spi            </li>
            <li>goodparticlesbydf.spi  </li>
            <li>eman2spider.spi        </li>
            <li>combinegoodclasses.spi </li>
            <li>classify.spi           </li>
        </ul>
    <li>2012-05-10 -- added options to spawn Gnuplot in the following:</li> 
      <ul class="circles">
        <li>goodpartsbymic.spi </li>
        <li>make-ctf-cor.spi        </li>
        <li>histallcc.spi      </li>
        <li>histgoodcc.spi     </li>
      </ul>
    <li>2012-05-02 -- nat2stk.spi -- converts 
        <a href= "../../../protocol_download.html">
        Nature Protocols data set</a> to a form usable here </li> 
</ul>
a2350 1
<hr />
d2355 1
a2355 1
    <h3> References</h3>
d2413 56
@


1.15
log
@*** empty log message ***
@
text
@d44 4
a47 4
 This page describes an alternative method for 
 <a href="../../../recon/mr.html">
 creating a 3D reconstruction from electron micrographs</a>, 
 except without defocus groups. 
d50 2
a51 3
 This is followed by refinement, which 
 iteratively adjusts the angles for finer resolution. 
 In the former method, ensembles of particles with similar defocus values 
d54 1
a54 1
 are merged.  
a94 1
   
a95 1
   
d109 1
a109 1
<ul class="circles">
d121 1
a121 1
    and extracts windowed images of individual particles from the micrographs.</li>
d125 1
a125 1
        and rotations.</li>
d127 1
a127 1
    <li> <a href="#CA">Averaging</a> 
d129 1
a129 1
        of projection views.</li>
d133 1
a133 1
        of its resolution.</li>
d137 3
a139 3
        chance "to find a better home" in terms of its translation and orientation parameters, 
        thus improving the resolution of the reconstruction.</li>
</ul>
d144 1
a144 3
    methods may be found at the 
    <a href="../../../techniques.html">
    techniques</a> page.</li>
d179 1
a179 2
      <a href= "../../../protocol_download.html">
      Nature Protocols data set</a>.</li>
d188 1
a188 2
      <a href="../../../..//download/zi2spi.c">
      zi2spi.c</a></li>
d196 1
a196 2
  <li>
      <a href= "mrverify.html">Classification-based particle verification</a>.</li>
d200 1
a200 4
  
<!--  <li>
      <a href= "URL">LINK</a>.</li>-->
  
d203 1
a203 2
    <a href="../../../glossary.html">
    glossary</a>.
d216 1
a216 2
  <li> <a href="../../../ref.html">
       More references</a>.</li>
d222 1
a222 2
<hr />
<a name="Quick">
d229 3
a231 1
   For further information, see below.</p>
d233 1
a233 1
   <p>Data extension is assumed to be <code class="snippet">dat</code></p>
d239 1
a239 1
<p><a href="#CreatingProject"> In toplevel directory (<i>e.g.</i><b>myproject/</b>):</a></p>
d241 11
a251 5
    <li>tar -xvf spiproject.tar     </li>
    <li>cd myproject                </li>
    <li>spider spi/dat @@makeparams  </li>
    <li>spider spi/dat @@resizevol   </li>
    <li>mv &nbsp;  /actual-location-of-micrographs/raw* &nbsp;&nbsp; Micrographs/</li>
d256 2
a257 2
    <li>spider spi/dat @@makefilelist                                         </li>
    <li>spider spi/dat @@shrink                                               </li>
d263 5
a267 1
    <li>spider spi/dat @@powdefocus &amp;                                 </li>
d270 1
a270 1
    <li>spider spi/dat @@trapctf                                          </li>
d275 3
a277 4
    <li>spider spi/dat @@noise          </li>
    <li>spider spi/dat @@pick           </li>
    <li>montagefromdoc.py &nbsp; coords/ulcoor_0001.dat win/winser_0001.dat &amp 
        with column number set to: 3         </li>
d280 1
a280 1
        <li>spider spi/dat @@pfilt                </li>
d282 2
a283 2
          <font class="guitool">WEB</font></a>.  </li>
      </ol></li>
d285 1
a285 1
    <li>spider spi/dat @@numberparticles      </li>
d290 2
a291 2
    <li>  spider spi/dat  @@restack-n-ctf </li>
    <li>  spider spi/dat  @@makerefproj   </li>
d294 2
a295 2
        <li>./spider spi/dat  @@align-inseries  </li>
        <li>./spider spi/dat  @@align-pubsub  </li>
d301 5
a305 4
    <li>spider spi/dat  @@select-byview    </li>
    <li>spider spi/dat  @@avg-filter-view </li>
    <li>spider spi/dat  @@histcc          </li>
    <li>spider spi/dat  @@show-ref-views  </li>
d309 1
a309 1
        <li>verifybyview.py views/prj001            </li>
d311 2
a312 3
        <li>spider spi/dat  @@histcc                 </li>
        <li>spider spi/dat  @@display                </li>
        <li>spider spi/dat  @@good-parts-bymic       </li>
d314 1
d316 1
a316 1
    <li>spider spi/dat @@bestim</li>
d321 2
a322 1
    <li>  spider spi/dat @@stackcombine </li>
d325 2
a326 2
        <li>./spider spi/dat @@bp-pubsub    </li>
        <li>./spider spi/dat @@bp-inseries    </li>
d328 1
a328 3
    <li>  spider spi/dat @@plotres      </li>
    <li>  spider spi/dat @@make-matched </li>
    <li>  spider spi/dat @@matchedfilter</li>
d331 1
d336 2
a337 2
        <li>./spider spi/dat @@pub-refine</li>
        <li>./spider spi/dat @@refine    </li>
d339 1
a339 1
    <li>  spider spi/dat @@plotrefres   </li>
a350 1
   
a351 1
   
d359 4
a362 5
<li><b>Each step in the process is bold and marked  by a bullet</b>              <br />
   <a href="../">Procedure files</a> are links to the procedure script,          <br />
   <font class="input">Input files</font> for that procedure are marked in pink, <br />
   <font class="output">Output files</font> created by that procedure are 
   marked in green.,                                                             <br />
d370 1
a370 1
   but not both (unless you want to compare the two techniques) <br />
d373 1
a373 1
   <a href="../../../../spire/doc/guitools/index.html">marked in red</a>  
d379 4
a382 6
There are two different choices for running SPIDER procedures: Using 
<a href="../../../../spire/doc/index.html">
<font class="guitool">SPIRE</font></a> or using SPIDER
procedures directly.

<p />
d388 2
a389 2
     To use a procedure referred to in this document, click the procedure filename 
     and copy the procedure to your current working directory. At the beginning 
d391 1
a391 1
     according to the particular project. Some of the procedures will
d393 2
a394 2
     filename. You need not change anything inside these procedures. Use the
     following format to run a SPIDER procedure:                    <br />
d419 2
a420 4
<h4>After each SPIRE step or after running each procedure file, check the 
  output files to make sure the results are sensible. If you are not sure what is
  "sensible," ask an expert.
</h4> 
d436 1
a436 1
   <p>These procedures should be run in the <i>project/</i> directory.   </p>
d442 1
a442 1
   <p />
d444 1
a444 1
   <ul>
d451 8
a458 10
   <li> If using SPIDER procedures, the procedure files below are packed into the 
     tar file <a href="../spiproject.tar">spiproject.tar</a>  
     (click for an 
     <a href="../../tar_archive/archive.html">archive of older procedure files</a>).  
     Copy this archive file to your working directory and unpack it:               <br />
     <code class="snippet">tar xvf spiproject.tar</code> <br />
     This will create a directory called <i>myproject/</i>, containing 
     the procedure files and subdirectories for a reconstruction project. Rename 
     <i>myproject</i> to the name of your project directory, for example:<br />
     <code class="snippet">mv myproject project</code> 
d474 27
a501 4
   <li><small>  If using data from Nature Protocols, 
     <a href="../../../protocol_download.html">
     download the data set</a>.  Then un-tar the data set and use the directory structure 
     as your project directory. </small> </li>
d503 31
a536 1
<p />
d542 1
a542 1
   <a class="project" href="../Procs/makeparams.spi">makeparams.spi</a> 
d545 2
a546 2
      <tr valign="top">  <td>&curren;</td>
          <td><code class="output">params</code>:</td>
d554 1
d556 1
a556 1
   <li><p class="action">[<b>Optional</b>] Resize reference volume</p>
d559 1
a559 1
   volume (key 5 in the <font class="input">params</font> file) and/or the 
d561 5
a565 3
   the data that you will be processing, then you must run the procedure 
   <a class="project" href="../Procs/resizevol.spi">resizevol.spi</a>
   in the top-level project directory to resize the volume. This creates:   <br />
d568 1
a568 1
      <tr valign="top"><td>&curren;</td>
d570 1
a570 1
          <td>&nbsp; Resized reference volume.</td></tr>
d578 2
a579 17
<li><p class="action">Place micrograph files in  <i>Micrographs/</i> directory</p>
<p> Files of the digitized micrographs should be placed in the <i>Micrographs/</i> 
   directory if they are not already there. 
   For example:  <br />
   
   <code class="snippet">mv /actual/location/of/micrographs/raw* &nbsp; Micrographs/</code></p>
   
<p>The procedures below can accept 
   SPIDER, Hiscan TIFF, PerkinElmer, ZI, and Nikon Coolscan outputs.  
   More information about images from the ZI scanner can be found 
   <a href="zi/zidoc.html">here</a>, and 
   the C program to convert ZI scanner TIF files to SPIDER format is called 
   <a href="../../../..//download/zi2spi.c">zi2spi.c</a>.
   Any of these files may have been compressed with <i>gzip</i>, but 
   be sure to indicate the compression in <a href= "params.html">the params file</a>.  
   </p>
</li>
d581 1
a581 30
<li><small>If using the Nature Protocols data, the files will be already in place.     
    However you must replace the procedures from the data set and 
    stack the particle images before using the set of current procedures. The procedure 
    <a class="project" href="../Procs/nat2stk.spi">nat2stk.spi</a> reads 
    <font class="input">win/ser******</font>,
    <font class="input">good/ngood***</font>, and
    <font class="input">order_select</font> 
    in order to stack images into groups and creates: <br />

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">sel_micrograph</font>: </td>
         <td>Micrograph selection doc file.</td></tr>

      <tr valign="top"><td>&curren;</td>
         <td><font class="output">sel_micrograph_14</font>: </td>
         <td>Micrograph selection doc file listing 14 micrographs 
             used later in the protocol.</td></tr>

      <tr valign="top"><td>&curren;</td>
         <td><font class="output">Particles/win/winser_****</font>: </td>
         <td>Stacks of particle images.</td></tr>

      <tr valign="top"><td>&curren;</td>
         <td><font class="output">Particles/good/good****</font>: </td>
         <td>Lists of particle images by micrograph.</td></tr>
   </table>
   
   It also renames the data set's micrograph files as necessary.
</small></li>
d583 5
d603 1
a603 1
   <p>These procedures should be run in the <i>Micrographs/</i> directory.     </p>
d611 1
a611 1
   <li><p class="action">Create a selection doc file for micrograph file numbers</p>
d615 1
a615 2
   <li>The procedure
   <a class="project" href="../Procs/makefilelist.spi">makefilelist.spi</a>  
d641 1
a641 1
   <li><p class="action">[<b>Optional</b>] Shrink micrographs</p>
d643 5
a647 4
   For the next step of screening the micrographs for quality, it may be 
   helpful to shrink the micrographs in order to quickly scan through them.  
   Run the procedure <a class="project" href="../Procs/shrink.spi">
   shrink.spi</a>, which will create:  <br />
d650 1
a650 1
      <tr valign="top"><td>&curren;</td>
d652 1
a652 1
          <td>&nbsp; Reduced micrographs.</td></tr>
d655 3
a657 3
   Choose a reduction factor that will allow for, in the next step, a 
   reasonable number of micrographs on the monitor (say, 2 to 6) at a 
   sufficient level of detail to screen them.
d661 1
a661 1
   <li><p class="action">[<b>Optional</b>] Screen micrographs</p>
d689 1
a689 1
   <p>These procedures should be run in the <i>Power_Spectra/</i> directory.  <br />
d714 3
a716 5
<li> Use SPIDER procedure:
   <a class="project" href="../Procs/powdefocus.spi">powdefocus.spi</a> which
   calls SPIDER procedure  
   <a class="project" href="../Procs/loadmic.spi">loadmic.spi</a>
   to read each micrograph, computes an averaged power spectrum, and estimates defocus
d718 4
a721 2
 
  This creates four  output files for each micrograph: 
d724 2
a725 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">power/pw_avg****</font> </td>
d729 2
a730 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">power/roo****</font></td>
d734 1
a734 1
          <font class="guitool">pyplot</font></a> </td>  </tr>
d736 2
a737 2
       <tr valign="top"> <td>&curren;</td>
          <td><font class="output">power/ctf****</font>: </td>
d740 3
a742 3
       <tr valign="top"> <td>&curren;</td>
          <td><font class="output">defocus</font>:</td>
          <td>A doc file of defocus and astigmatism values.</td></tr>
d752 4
a755 6
<li> Use SPIDER procedure:
   <a class="project" href="../Procs/ctffind.spi">ctffind.spi</a> 
   to read each micrograph using
   <a class="project" href="./newprogs/loadmic.spi">loadmic.spi</a>,
   compute an averaged power spectrum, and estimate defocus, 
   astigmatism, and cut-off frequency using SPIDER operation 
d757 6
a762 3
   This invokes the functionality from the MRC 
   <a href="http://emlab.rose2.brandeis.edu/software">ctffind3</a> 
   program and creates two output files for each micrograph: 
d765 2
a766 2
      <tr valign="top"><td>&curren;</td>
          <td><code class="output">power/powchk***</code> </td>
d769 2
a770 2
              micrograph and half is replaced by an idealized
              power spectrum. </td> </tr>
d772 3
a774 3
       <tr valign="top"> <td>&curren;</td>
          <td><code class="output">defocus</code>:</td>
          <td>A doc file of defocus and astigmatism values.</td></tr>
d781 1
a781 1
    <font class="input">power/roo****</font>.  Then use the 
d797 1
a797 1
   (reduction factor 4) to
d801 11
a811 6
   further. Things to look out for: 
   <ul>
      <li>Are the Thon rings round?              </li>
      <li>Do the rings extend to high resolution?</li>
   </ul>
   <br />
d813 3
a815 9
   See this example:
   <p><a href="pics/power.jpg"><img width="182" height="243" src="pics/power.jpg"></a></p>
</li>

   You can discard micrographs that show one of the following artifacts:
   <ul>
      <li>Rings that are cut off unidirectionally (evidence of drift).             </li>
      <li>Rings that are elliptical, or even  hyperbolic (evidence of astigmatism).</li>
   </ul>
d830 1
a830 1
     <code class="snippet">montagefromdoc.py ../sel_micrograph.dat power/pw_avg*</code> 
d837 7
a843 4
    The SPIDER procedure <a class="project" href="../Procs/trapctf.spi">trapctf.spi</a> 
       generates a set of 1D profiles, which will be applied to subsequent particle images. 
       Outputs:      <br />
   <table class="outs">
d845 1
a845 1
         <td><font class="output">power/straightctf****</font>: </td>
d849 1
a849 1
         <td><font class="output">power/flipctf****</font>: </td>
d853 1
a853 1
         <td><font class="output">power/trapctf****</font>: </td>
d874 1
a874 1
   <a class="project" href="../Procs/trapctf.spi">trapctf.spi</a>, 
d877 1
d880 1
a880 1
   <li>In the procedure <a class="project" href="../Procs/trapctf.spi">trapctf.spi</a>,
d885 1
d888 1
a902 8
<li><small>For the Nature Protocols data set, for the sake of speed, 
    only the power spectra for four micrographs are computed.  
    After examining the power spectra, 14 micrographs' worth of data will be used. 
    Rename the following files:</small>
        <br /><code><b>mv sel_micrograph_14mics.dat sel_micrograph.dat
        <br />mv Power_Spectra/defocus_14mics.dat Power_Spectra/defocus.dat</b>
        </code>
</li>
d921 1
a921 1
   <p>These procedures should be run in the <i>Particles/</i> directory.</p>
d940 3
a942 3
         <a class="project" href="../Procs/noise.spi">noise.spi</a> calls 
         <a class="project" href="../Procs/convert-p.spi">convert-p.spi</a>,reads 
         <font class="input">../Micrographs/raw****</font> and creates: <br />
d945 1
a945 1
            <tr valign="top"><td>&curren;</td>
d947 1
a947 1
                <td> &nbsp; A noise image.</td></tr>
d969 1
a969 1
       <a class="project" href="../Procs/pick.spi">pick.spi</a> 
d972 1
a972 1
       <a class="project" href="../Procs/pick-p.spi">pick-p.spi</a>)
d979 5
a983 1
       equalization and creates: <br />
d986 11
a996 7
          <tr valign="top"><td>&curren;</td>
              <td><font class="output">win/winser****</font>: </td>
              <td>Stacked particle images.</td></tr>

          <tr valign="top"><td>&curren;</td>
              <td><font class="output">win/sel_part_****</font>: </td>
              <td>Particle selection doc file for each micrograph.</td></tr>
d998 2
a999 2
          <tr valign="top"><td>&curren;</td>
              <td><font class="output">coords/ulcoor****</font>: </td>
d1005 1
a1005 1
    <li> <a class="project" href="../Procs/lfc-pick.spi">lfc-pick.spi</a> 
d1007 6
a1012 5
       <a class="project" href="../Procs/convert-p.spi">   convert-p.spi</a> and
       <a class="project" href="../Procs/pickparticle.spi">lfc-pickparticle.spi</a>) 
       uses the Local Fast Correlation algorithm to window particles.  <br />
       This algorithm uses <a href="../../../partpick.html#LFC">local cross-correlation</a> 
       calculated using Fourier methods outlined by
d1017 1
a1017 1
       <a  href="../Procs/lfc-pick.spi">lfc-pick.spi</a>
d1019 1
a1019 1
       These procedures create:  <br />
d1023 16
a1038 12
          <tr valign="top"><td>&curren; </td>
              <td><font class="output">win/winser_****</font>: </td>
              <td>Stacks of particle images for each micrograph.</td></tr>

          <tr valign="top"><td>&curren; </td>
              <td><font class="output">win/sel_part_****</font>: </td>
              <td>Particle selection doc file for each micrograph.</td></tr>

          <tr valign="top"><td>&curren; </td>
              <td><font class="output">coords/pkcoor_****</font>: </td>
              <td>Pixel coordinates for <i>center</i> of particle images.</td></tr>
        </table>
d1051 1
a1051 1
           requires the SPIRE libraries). creates:                           <br />
d1053 3
a1055 3
              <tr valign="top"><td>&curren; </td>
                  <td><font class="output">win/sel_part_****</font>: </td>
                  <td> Particle selection doc file for each micrograph.</td></tr>
d1057 2
a1058 2
              <tr valign="top"><td>&curren; </td>
                  <td><font class="output">coords/pkcoor_****</font>: </td>
d1063 1
a1063 1
           which windows out the particle images.  Output files: <br />
d1065 3
a1067 3
              <tr valign="top"><td>&curren; </td>
                  <td><font class="output">win/winser_****</font>: </td>
                  <td>Stacks of particle images for each micrograph.</td></tr>
d1077 1
a1077 1
<li><p class="action">[<b>Optional</b>] Low-pass filter particle images before
d1080 1
a1080 1
    The procedure <a class="project" href="../Procs/pfilt.spi">pfilt.spi</a> 
d1082 4
a1085 1
       based on its defocus and creates:                <br />
d1087 4
a1090 3
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">filt/winser_****</font>: </td>
         <td>Stacks of low-pass filtered particle images.</td></tr>
d1104 1
a1104 1
   <a href="mrverify.html">classification-based verification</a> 
d1109 4
a1112 3
   <li>This can be done in <a href="../../../../web/docs/web.html"><font class="guitool">
   WEB</font></a> using the <a href="../../../../web/docs/categorize.html">
   Categorize from doc file</a> operation. If, for example, you would like to view 
d1121 1
a1121 1
   <a href="../../../partpick.html">partpick.html</a>). <br />
d1123 3
a1125 3
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">good/good****</font>: </td>
         <td>A set of particle selection doc files, one for each micrograph.</td></tr>
d1131 1
a1131 1
   <font class="output">win/docmontage****_##</font> (by default with 150 particles each), 
d1138 2
a1139 2
   with the syntax to open micrograph #1234:                         <br />
  <code class="snippet">montagefromdoc.py coords/pkcoor_1234.dat</code> <br />
d1147 13
d1163 1
a1163 2
   <p>The procedure: 
   <a class="project" href="../Procs/numberparticles.spi">numberparticles.spi</a> 
d1165 2
a1166 1
   grouped and regrouped.</p>
d1172 5
a1176 2
   <font class="input">win/sel_part_****</font> (commented out in the procedure). </p>
   
d1178 1
a1178 1
   <a href="../Procs/lfc-pick.spi">lfc-pick.spi</a>, for example,
d1183 1
a1183 1
   from best to worst, as is the case in <a href="../Procs/lfc-pick.spi">lfc-pick.spi</a>.</p>
d1192 2
a1193 2
   will be copied too.  
   Modification of the image stacks in this manner is the rate-limiting step here, 
a1194 2
   It isn't used in any of the downstream procedures currently, so 
   feel free to skip the header assignment.  
d1198 3
a1200 3
  The procedure creates:    <table class="outs">
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">good/sel_part_****</font>: </td>
d1202 1
a1202 2
             listing unduplicated selected particle numbers.</td></tr>
      <tr valign="top"><td>&curren;</td>
d1204 9
a1212 4
         <td><font class="output">win/globalmic****</font>: </td>
         <td>A look-up table for the selected particles in each micrograph, 
             mapped to a unique global particle number.</td></tr>
      <tr valign="top"><td>&curren;</td>
d1214 2
a1215 1
         <td> <font class="output">percent_selected</font>: </td>
d1218 1
d1240 1
a1240 1
   <p>These procedures should be run in the <i>Alignment/</i> directory.</p>
d1252 8
a1259 2
   The procedure: <a class="project" href="../Procs/restack-n-ctf.spi">restack-n-ctf.spi</a> 
   reads: 
d1272 11
a1282 11
      <tr valign="top"><td>&curren;         </td>
          <td><font class="output">sel_group</font>:  </td> 
          <td>New group selection doc file. </td>  </tr>

      <tr valign="top"><td>&curren;            </td>
          <td><font class="output">data_ctf_***</font>: </td>
          <td>New particle image stacks.        </td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">sel_part_***</font>: </td>
          <td>New particle selection doc files.</td></tr>
d1284 2
a1285 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">part2glonum</font>: </td>
d1287 2
a1288 8
   </table> <br />
   
   The number of new groups is arbitrary, but 
   a reasonable starting point  would be the number of nodes available on your cluster 
   (or half that number, etc.).  If subsequent alignment is not going to be parallelized, 
   the number of new groups can be set to 1 (though not required). 
   If you would simply like to test the size of the groups before writing the stack files, 
   set the register <i>[want_stacks-yn]</i> to: <i>0</i> in order to do a dry run. 
d1294 1
a1294 1
    <p> Reference projections (images) are views of the object at known angles.
d1303 2
a1304 3
   The procedure: <a class="project" href="../Procs/makerefproj.spi">makerefproj.spi</a> 
   reads:
   <font class="input">../reference_volume</font> to create two sets of files:  <br />
d1307 2
a1308 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">refangles</font>: </td>
d1313 2
a1314 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">projs/prj_01</font>: </td>
d1317 1
a1317 1
              corresponding to the angles in the preceeding file.</td></tr>
d1319 3
d1332 3
a1334 23
    which reads parameters and input filenames
    (<i><i>e.g.</i></i>, <font class="input">projs/prj_001</font>, 
    <font class="input">refangles</font>, and 
    <font class="input">data***</font>)


    and establishes the output filenames:  </p>
      <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">dala_01_***</font>:</td>
          <td>Aligned stacks of particle images. </td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">align_01_***</font>:</td>
          <td>Shift and rotation parameters for each group.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">align_01_all</font>:</td>
          <td>Shift and rotation parameters for all groups.</td></tr>
      </table>
      
    <br /> Some notable parameters in
    <a class="project" href="../Procs/align-settings.spi">align-settings.spi</a>:
d1340 1
d1369 1
a1369 1
               but if you have insufficient memory, set it to zero.  </td></tr> 
d1375 1
a1375 1
    on a compute cluster: <br />
d1393 1
a1393 1
      <a class="project" href="../Procs/exist-check.spi">   exist-check.spi   </a>,    
d1409 22
d1437 1
a1437 1
          <td><a class="project" href="../Procs/exist-check.spi">exist-check.spi</a>:</td>
d1452 1
a1452 1
<!-- **************************** Compute Averages and Verify particles ************************** -->
d1456 1
a1456 1
   <h3 class="heading">Compute Averages</h3>
d1464 3
a1466 1
   <p>These procedures should be run in the <i>Averages/</i> directory.</p>
d1470 1
a1470 1
<!-- SPIRE directory=Averages subdirectories=views, avg -->
d1477 1
a1477 1
   <a class="project" href="../Procs/select-byview.spi">select-byview.spi</a></i> reads  
d1479 4
a1482 2
   <font class="input">../Alignment/sel_part_***</font>, and
   <font class="input">../Alignment/align_01_***</font> and creates: <br />
d1486 5
a1490 1
      <tr valign="top"><td>&curren;</td>
d1492 2
a1493 7
          <td>List of particles associated with each reference view (uses:
          <a href="../../../man/vomq.html"> 'VO MQ'</a>).          </td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">views/sel_part_byv_sort_???</font>: </td>
          <td>Lists of particles associated with each reference view, 
              sorted by correlation coefficient.                    </td></tr>
d1495 3
a1497 3
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">part_per_view_all</font>:        </td>
          <td>Lists total number of particles associated with each reference view. </td></tr>
d1503 8
a1510 3
<li> <p class="action">[<b>Optional</b>] Create average images for all projection views and, 
     optionally, write out filtered, aligned images.    This step is required if using 
        <a href="mrverify.html"> classification-based verification</a>.</p>
d1512 1
d1514 1
d1516 2
a1517 1
    <font class="input">views/prj???/sel_part_byv</font> and creates:
d1521 1
a1521 1
          <td><font class="output">avg/allavg_???</font>:    </td>
d1524 3
a1526 3
     <tr valign="top"><td>&curren;</td>
          <td><font class="output">views/prj???/stkfilt</font>: </td> 
          <td>[<b>Optional, required for <a href="mrverify.html">
d1528 2
a1529 1
</table>
d1531 3
a1533 8
   <p />To skip the output of the filtered images, set the register <i>[save-filt]</i>
   in the header to 0.  Note that these filtered images are required if using
   <a href="mrverify.html">classification-based verification</a>.  
   The setting for: <i>[reduction-factor]</i> is to save processing time and disk space.</p>
   
   Projection views with many particles will 
   have averages that resemble the reference projection. Projection views 
   with few particles will be noisy. To view the sets of average images, either:
d1537 10
a1546 10
   <li>Use the <b>Montage</b> operation in 
   <a href="../../../../web/docs/web.html">
   <font class="guitool">WEB</font></a>. </li>
   
   <li>Use <a href="../Procs/montagefromdoc.py">
   <font class="guitool">montagefromdoc.py</font></a>.  The syntax, not including 
      the proper data extension. is:  <br />
      <code class="snippet">montagefromdoc.py summary-avgbyview.dat Avg/allavg*</code> <br />
   Changing the column number for the image label will display: (1) the view number, 
   (2) the number of particles, or (3) the s.d. for the variance map.</li>
d1551 1
a1551 1
<p>The next three operations help to identify a threshold
d1565 4
a1568 4
   <a class="project" href="../Procs/histcc.spi">histcc.spi</a> with:
   <i>[want-good-yn] = 0</i> reads:
   <font class="input">projlist</font> and
   <font class="input">views/ref???/sel_part_byv_sort</font> to create:
d1571 2
a1572 5
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">histcc_all</font>:    </td>
          <td>Histogram doc file of cross correlation values.      </td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">prj???/sel_part_combined</font>: </td> 
d1574 8
a1581 3
          <font class="input">views/prj???/sel_part_byv_sort</font>.       </td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">fit_all.gnu</font>:       </td> 
d1584 3
d1588 1
a1588 1
   <p>The output Gnuplot script <font class="output">fit_all.gnu</font>
d1595 2
a1596 1
   To view the overall histogram plot, either:
d1598 1
a1598 20
   <ol class="choice">
   <li>In the procedure <a class="project" href="../Procs/histcc.spi">histcc.spi</a>,
       leave the parameter <i>[viewplot-yn]</i> as 1 (the default).  
       A Gnuplot window will pop up automatically. 
       NOTE: This may not work if <font class="output">fit_all.gnu</font> 
       is not in the same directory as the procedure.)</li>
   <li>From the command line, type:
       <br /><code class="snippet">gnuplot -persist fit_all.gnu</code> <br /></li>
   <li>Start Gnuplot by typing from the command line:
       <br /><code class="snippet">gnuplot</code> <br />
       And from the Gnuplot prompt, type:
       <br /><code class="snippet">load 'fit_all.gnu'</code> <br />
       Remember to include the quotes. 
       Running Gnuplot interactively will allow you to adjust the Gaussian parameters 
       without opening a new plot each time.</li>
   </ol>
   
   <p>Experiment with the parameter <i>[num-bins]</i> if
   you want finer sampling per bin, or coarser (and thus more particles per bin).</p>
   
d1603 1
a1603 1
   (angular directions) for the reconstruction     </p>
d1605 4
a1608 4
   <p> <a class="project" href="../Procs/plot-ref-views.spi">plot-ref-views.spi</a> with:
   <i>[want-good-yn] = 0</i> :reads  
   <font class="input">views/part_per_view_all</font>, and
   creates script files of gnuplot commands: <br />
d1611 2
a1612 2
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">gnuplot_view_all.gnu</font></td>
d1618 1
a1618 2
   <a class="project" href="../Procs/show-ref-views.spi">show-ref-views.spi</a> with:
   <i>[want-good-yn] = 0</i> reads 
d1620 1
a1620 1
   <font class="input">views/part_per_view</font> to create: <br />
d1623 2
a1624 2
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">show_ref_views</font>: </td> 
d1641 6
a1646 4
   <p>Further information is provided at the <a href="mrverify.html">
      classification-based verification</a> page. Briefly, this sub-protocol reads:
      <font class="input">views/prj???/sel_part_byv</font> and 
      <font class="input">views/prj???/stkfilt</font> and
d1649 2
d1653 1
a1653 1
      <tr valign="top"><td>&curren;</td>
d1655 1
a1655 1
          <td> Classifies the particles corresponding to each reference projection. </td></tr>
d1657 1
a1657 1
      <tr valign="top"><td>&curren;</td>
d1659 2
a1660 2
               <font class="guitool">../Procs/verifybyview.py</font> </td>
          <td> Select particles after separation by orientation and classification. </td></tr>
d1662 1
a1662 1
      <tr valign="top"><td>&curren;</td>
d1664 1
a1664 1
          <td> Collects information about selected particles. </td></tr>
d1666 3
a1668 4
      <tr valign="top"><td>&curren;</td>
          <td> <a class="project" href="../Procs/histgoodcc.spi">histcc.spi</a>with:
               <i>[want-good-yn] = 1</i>  </td>
          <td> Creates histogram of cross correlation values. </td></tr>
d1671 4
a1674 4
   <p>If performing this step, remember to substitute 
   <font class="output">views/prj???/goodsel</font> for
   <font class="input">views/prj???/sel_part_byv_sort</font> in 
   <a class="project" href="../Procs/bestim.spi">bestim.spi</a>.
d1683 3
d1687 2
a1688 2
   The procedure <a class="project" href="../Procs/bestim.spi">bestim.spi</a> reads
   limits the numbers of images per reference view direction as 
d1695 1
a1695 8
   <a class="project" href="../Procs/bestim.spi">bestim.spi</a> reads:    
   <font class="input">../Alignment/sel_group         </font>,
   <font class="input">sel_proj                       </font>,
   <font class="input">views/prj???/sel_part_byv_sort </font>, and
   <font class="input">../Alignment/sel_part_***      </font>.           </p>

   <p>
   If you performed <a href="mrverify.html">classification-based verification</a>, then use 
a1699 6
   
   It creates: <br />
   <table class="outs">
      <tr valign="top"><td>&curren;                                   </td>
          <td> <font class="output">views/prj???/sel_part_best</font> </td>
          <td> List of particles retained from each reference view    </td></tr>
d1701 22
a1722 3
      <tr valign="top"><td>&curren;                                   </td>
          <td> <font class="output">part_per_proj_best</font>         </td>
          <td> Summary of number of images in each reference view     </td></tr>
a1723 7
      <tr valign="top"><td>&curren;                                   </td>
          <td> <font class="output">sel_group_best</font>             </td>
          <td> Group selection file                                   </td></tr>

       <tr valign="top"><td>&curren;                                  </td>
          <td> <font class="output">sel_part_best_***</font>          </td>
          <td> List of particles selected for each new group          </td></tr>
a1726 2
   <br />Run this procedure even if you aren't limiting overrepresented views.  
   Downstream procedures will need the above outputs.
d1747 1
a1747 1
   <p>These procedures should be run in the <i>Reconstruction/</i> directory.</p>
d1758 1
a1758 1
   <p> <a class="project" href="../Procs/stackcombine.spi">stackcombine.spi</a> 
d1768 22
a1789 22
   <font class="input">../Averages/avgd_particles***</font>,  
   <font class="input">../Alignment/data***         </font>,  
   <font class="input">../Alignment/dala_01_***     </font>, and 
   <font class="input">../Alignment/align_01_***    </font> 
   to create new, equal-sized groups.  Outputs: 

   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">bps_groups</font>:  </td> 
          <td>A summary doc file listing the number of particles in each group. </td>  </tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">bps_particles***</font>: </td>
          <td>A doc file listing the particles in each group.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">bps_data***</font>: </td>
          <td>A stack file containing particle images for each group.</td></tr>

      <tr valign="top"><td>&curren;</td>
          <td><font class="output">bps_dala_01_***</font>: </td>
          <td>A combined lookup table for each particle to its group membership.</td></tr>
d1812 2
a1813 2
      <a href="../../../../pubsub/pubsub.html">
      Publish and Subscribe</a> on a cluster:
d1819 1
d1826 7
a1832 5
            <i>spider</i>, <i><i>e.g.</i></i>:<br />
        <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.18.16 ./spider</code> <br /></li>
        <li>Start alignment with the following command: <br />
        <code class="snippet">./spider spi/dat bp-pubsub 1 &amp; </code><br />
        where <i>1</i> will be the number of the top-level SPIDER results file.</li>
d1842 3
a1844 3
    <font class="input">bp_sel_group    </font>, 
    <font class="input">bp_sel_part***  </font>, and 
    <font class="input">bp_dala_01_***   </font>, and 
d1850 3
a1852 3
      <tr valign="top"><td>&curren;                           </td>
          <td> <b><i>[bp-method]</i></b>:                     </td>
          <td> Backprojection method. More information below. </td></tr> 
d1859 3
a1861 3
      <tr valign="top"><td>&curren;                           </td>
          <td> <b><i>[max-wait]</i></b>:                      </td>
          <td> Like in <a class="project" href="../Procs/align-settings.spi">align-settings.spi</a>
d1863 1
a1863 1
               in order to distribute disk I/O..              </td></tr> 
d1877 1
a1877 1
    ripples in the reconstruction when viewed as <i>z</i>-slices. 
d1882 1
a1882 1
    The procedures first create two particle selection doc files for each group 
d1885 4
a1888 4
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Groups/grp***/seleven</font>: </td> 
          <td> List of odd numbered images for each group.</td></tr> 
d1890 3
a1892 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Groups/grp***/selodd</font>: </td> 
          <td> List of even numbered images for each group.</td></tr> 
d1901 3
a1903 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Groups/grp***/vol01_sub_one</font>: </td>
          <td> Reconstructed volume from first subset of images for each group.</td></tr> 
d1905 2
a1906 2
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Groups/grp***/vol01_sub_two</font>: </td>
d1909 3
a1911 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Groups/grp***/vol01</font>: </td>
          <td> Combined reconstructed volume for each group.</td></tr> 
d1913 2
a1914 8
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Groups/grp***/doccmp001</font>: </td>
          <td> Doc files containing an unmasked
               <a href="../../../glossary.html#Fourier">
               FSC curve</a> for each group.</td></tr>
 
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Groups/grp***/docfscmasked001</font>: </td>
d1917 1
a1917 1
               FSC curve</a> for each group.</td></tr> 
d1921 4
a1924 5
     Finally, they add together the subset volumes to make a complete
     volume for the entire data set, . 
     and calculate the FSC resolution curve for the complete reconstruction  
     (see <a href="../../../man/fsc.html">'FSC'</a> operation) creating 
     the following files:                                        
d1927 3
a1929 3
      <tr valign="top"><td>&curren;                               </td>
          <td> <font class="output">vol01</font>:                 </td>
          <td> 3D reconstruction from entire set of particles.    </td></tr>
d1931 3
a1933 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">doccmp001</font>: </td>
          <td> Doc file containing unmasked FSC curve for final reconstruction. </td></tr>
d1935 3
a1937 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">docfsc001</font>: </td>
          <td> Doc file containing masked FSC curve for final reconstruction. </td></tr>
d1939 3
a1941 3
      <tr valign="top"><td>&curren;                               </td>
          <td> <font class="output">summary-bps</font>:            </td>
          <td> Doc. file containing masked and unmasked resolution (in Angstroms).</td> </tr> 
d1957 5
a1961 5
The following is a brief tree of procedure calls:
<table border="1" style="background-color:eeeeee">
<tr><td valign="top">
<pre>
<a class="project" href="../Procs/bp-inseries.spi"><b>bp-inseries</b></a>
d1969 1
a1969 1
<a class="project" href="../Procs/bp-pubsub.spi"><b>bp-pubsub</b></a>
d1971 1
a1971 1
    <a class="project" href="../Procs/bp-distribute.spi">bp-distribute</a>
d1974 1
d1976 2
a1977 2
</pre></td>
</tr></table>
d1979 2
a1980 2
<li><p class="action">Check the FSC curves from the group volumes by viewing a plot
    of the curves </p>
d1982 5
a1986 4
   <a class="project" href="../Procs/plotres.spi">plotres.spi</a> reads
   <font class="input">../Alignment/sel_group</font>,  
   <font class="input">docfscmasked001</font>, and 
   <font class="input">Groups/grp***/docfscmasked001</font>.  
d1991 1
a1991 1
          <td> <font class="output">gnuplot_res</font>: </td>
d1997 1
a1997 1
       <br /><code class="snippet">gnuplot -persist gnuplot_res</code> </p>
d2070 1
a2070 1
   <p>These procedures should be run in the <i>Refinement/</i> directory.</p>
d2086 2
a2087 2
   <tr><td> <font class="input">../params</font>: </td> 
       <td> Parameter definition file.</td></tr>
d2089 2
a2090 2
   <tr><td> <font class="input">../Reconstruction/sel_group</font>: </td> 
       <td> Group selection file.</td></tr>
d2092 2
a2093 2
   <tr><td> <font class="input">../Reconstruction/vol01</font>: </td> 
       <td> Initial starting volume.</td></tr>
d2095 2
a2096 2
   <tr><td> <font class="input">../Reconstruction/sel_part_***</font>: </td> 
       <td> Particle selection files.</td></tr> 
d2098 2
a2099 2
   <tr><td> <font class="input">../Alignment/align_01_***</font>: </td> 
       <td> Initial alignment parameter files.</td></tr> 
d2101 2
a2102 2
   <tr><td> <font class="input">../Alignment/data_ctfcor_***</font>: </td> 
       <td> Unaligned CTF corrected, stacked image files.</td></tr>
d2104 2
a2105 2
   <tr><td> <font class="input">input/scattering</font>: </td> 
       <td> [<b>Optional</b>] amplitude enhancement scattering file.</td></tr>
d2107 2
a2108 2
   <tr><td> <font class="input">input/mask</font>: </td> 
       <td> [<b>Optional</b>] amplitude enhancement mask file.</td></tr>
d2114 8
a2121 3
      <a href="../../../../pubsub/pubsub.html">
      Publish and Subscribe</a> on a cluster:
   <ol class="choice">
d2124 1
a2124 1
         <a class="project" href="../Procs/refine.spi">refine.spi</a> 
a2126 4
            <li>Copy the SPIDER executable to the local directory and rename it 
               <i>spider</i>, <i><i>e.g.</i></i>:<br />
               <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.20.16 ./spider</code> <br />
               This ensures that the same SPIDER executable is available throughout whole refinement.</li>
d2128 1
a2128 1
               <code class="snippet">./spider pam/dat @@refine  </code></li>
d2133 1
a2133 1
         <a class="project" href="../Procs/pub_refine.spi">pub-refine.spi</a> 
d2136 2
a2137 6
            <li>Copy the SPIDER executable to the local directory and rename it 
               <i>spider</i>, <i><i>e.g.</i></i>:<br />
               <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.20.16 ./spider</code> <br />
               This ensures that the same SPIDER executable is available throughout whole refinement.</li>
            <li>Start alignment with the following command: <br />
               <code class="snippet">./spider pam/dat @@pub-refine 1 </code><br />
d2146 3
a2148 2
  Among the outputs of refinement are volumes, images, and document files. Some of the
  important outputs are listed here ('***' denotes group number and '##' denotes iteration number):
d2151 3
a2153 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">final/align_##_***</font>: </td>
          <td>Alignment parameter doc files</td></tr>
d2155 3
a2157 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">final/fscdoc_m_##_***</font>: </td>
          <td> Group masked FSC resolution curve doc files</td></tr>
d2159 3
a2161 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">final/vol##_all</font>: </td>
          <td> Complete unfiltered volumes </td></tr>
d2163 3
a2165 3
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">final/vol##_centered</font>: </td>
          <td>Complete centered volumes</td></tr> 
d2167 3
a2169 3
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">final/vol##</font>: </td>
          <td>Complete filtered, centered volumes</td></tr> 
d2171 3
a2173 3
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">final/vol##_sub1</font>: </td>
          <td>Complete volume from first subset of images</td></tr>
d2175 3
a2177 3
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">final/vol##_sub2</font>: </td>
          <td>Complete volume from second subset of images</td></tr>
d2179 3
a2181 3
       <tr valign="top"><td>&curren;</td>
          <td><font class="output">resolutions</font>: </td>
          <td>Doc file listing resolution at each iteration.</td></tr> 
d2188 1
d2214 1
a2214 1
    <a class="project" href="../Procs/refine-prepare.spi">refine-prepare</a>
d2246 6
a2251 6
   The procedure <a class="project" href="../Procs/plotfsc.spi">plotfsc.spi</a> reads:
   <font class="input">input/sel_group</font>, 
   <font class="input">final/resolutions</font>, 
   <font class="input">fscdoc_m_##_***</font>, 
   <font class="input">fscdoc_m_##</font>. 
   It creates two text files of gnuplot commands: <br /> 
d2254 2
a2255 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">gnuplot_refi</font>: </td>
d2258 2
a2259 2
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">gnuplot_refd</font>: </td>
d2370 1
a2370 1
            <li>numberparticles.spi</li>
d2385 1
a2385 1
        <li>trapctf.spi        </li>
@


1.14
log
@*** empty log message ***
@
text
@d38 1
a38 1
   <P></P>
d44 12
a55 12
This page describes an alternative method for 
<a href="../../../recon/mr.html">
creating a 3D reconstruction from electron micrographs</a>, 
except without defocus groups. 
In both methods, once a set of particle images has been obtained, 
an initial 3D reconstruction is calculated using coarse projection angles. 
This is followed by refinement, which 
iteratively adjusts the angles for finer resolution. 
In the former method, ensembles of particles with similar defocus values 
are grouped together.  A separate 3D reconstruction is computed for each 
"defocus group."  CTF-correction is performed when these reconstructions 
are merged.  
d59 12
a70 12
In this alternative method, the CTF-correction is applied at the level of 
windowed particle images.  This method presents certain advantages.  First, 
it circumvents one of the approximations when using defocus groups, namely that 
all particles in a defocus group follow the same CTF profile.  At high resolution,
where the CTF oscillates more rapidly, this assumption will not hold.  
Second, parallelization can be more efficient, since groups can be of identical 
size, independent of the number of particles at each defocus.  Third, particles 
from what would be sparsely populated defocus groups need not be thrown out.  
In principle, though not yet implemented, astigmatic images can be corrected for 
with this method, as can tilted-specimen images.  Lastly, interoperability with
other software packages, which also correct for the CTF at the level of particle
images, will be more straightforward.
d74 9
a82 9
However the strategy of using defocus groups has its own advantages.  
First is that it can readily account for the non-uniform distribution of 
signal-to-noise in projection data (<a href="#PP12">Penczek, 2012</a>).  
Second, we find that reconstructions using particle-level CTF-correction 
sometimes show artifacts when using iterative backprojection methods, such as 
<a href="../../../../man/bprp.html"> <b>'BP RP'</b></a> or
<a href="../../../../man/bpcg.html"> <b>'BP CG'</b></a>, 
whereas the use of defocus groups does not present such 
limitations.   
d87 1
a87 1
<P></P>
d97 1
a97 1
   <P></P>
d111 1
a111 1
<li> <B>Protocol:</B></li>
d148 1
a148 1
    <a href="../../../../techniques.html">
d166 1
a166 1
   <P></P>
d184 1
a184 1
      <a href= "../../../../protocol_download.html">
d212 1
a212 1
  <li> <a href="../../../../strategies.html">
d214 1
a214 1
    <a href="../../../../glossary.html">
d228 1
a228 1
  <li> <a href="../../../../ref.html">
d245 1
a245 1
   <P>Data extension is assumed to be <code class="snippet">dat</code></P>
d251 67
a317 57
<P>In <a href="#CreatingProject">toplevel directory (<I>e.g.</I>, <B>myproject/</B>):</a></P>
<OL><code class="snippet">
    <li>tar -xvf spiproject.tar</li>
    <li>cd myproject </li>
    <li>spider spi/dat @@makeparams</li>
    <li>spider spi/dat @@resizevol</li>
    <li>mv  /the/actual/location/of/the/micrographs/raw* &nbsp; Micrographs/</li>
</code></OL>

<P>In <a href="#Micrographs"><B>Micrographs/</B></a>: </P>
<OL start=6><code class="snippet">
    <li>mkfilenums.py ../sel_micrograph.dat mic*.dat</li>
    <li>spider spi/dat @@shrink</li>
    <li>montagefromdoc.py ../sel_micrograph.dat sm-mic*</li>
</code></OL>

<P>In <a href="#Micrographs"><B>Power_Spectra/</B></a>: </P>
<OL start=9><code class="snippet">
    <li>spider spi/dat @@powdefocus</li>
    <li>montagefromdoc.py ../sel_micrograph.dat power/pw_avg*</li>
    <li>ctfmatch.py power/ctf* &amp;</li>
    <li>spider spi/dat @@trapctf</li>
</code></OL>

<P>In <a href="#AUTO"><B>Particles/</B></a>: </P>
<OL start=13><code class="snippet">
    <li>spider spi/dat @@noise</li>
    <li>e2boxer.py </li>
    <li>spider spi/dat @@eman2spider</li>
    <li>spider spi/dat @@rewindow</li>
    <li>montagefromdoc.py coords/sndc0001.dat win/winser0001.dat</li>
    <li>spider spi/dat @@numberparticles</li>
    <li>spider spi/dat @@filtctf</li>
</code></OL>

<P><a href="#SH">In <B>Alignment/</B></a>: </P>
<OL start=20><code class="snippet">
    <li>spider spi/dat @@group_particles</li>
    <li>spider spi/dat @@refproj</li>
    <li>./spider spi/dat @@apsh-pubsub</li>
</code></OL>

<P><a href="#CA">In <B>Averages/</B></a>: </P>
<OL start=23><code class="snippet">
    <li>spider spi/dat @@selectbyview</li>
    <li>spider spi/dat @@avgfilterbyview</li>
    <li>spider spi/dat @@histallcc</li>
    <li>spider spi/dat @@display</li>
    <li>[<b>Optional</b>] Classification-based verification</li>
    <OL type='A'>
        <li>spider spi/dat @@classifybyview </li>
        <li>verifybyview.py Views/prj001 </li>
        <li>spider spi/dat @@combinegoodclasses </li>
        <li>spider spi/dat @@histgoodcc </li>
        <li>spider spi/dat @@goodpartsbymic </li>
        <li>spider spi/dat @@display-good </li>
    </OL>
d319 1
a319 1
</code></OL>
d321 22
a342 14
<P><a href="#3D">In <B>Reconstruction/</B></a>: </P>
<OL start=29><code class="snippet">
    <li>spider spi/dat @@stackcombine</li>
    <li>./spider spi/dat @@bps-pubsub</li>
    <li>spider spi/dat @@plotres</li>
    <li>spider spi/dat @@make_matched</li>
    <li>spider spi/dat @@matchedfilter</li>
</code></OL>

<P><a href="#REF">In <B>Refinement/</B></a>: </P>
<OL start=34><code class="snippet">
    <li>./spider spi/dat @@pub_refine</li>
    <li>spider spi/dat @@plotrefres</li>
</code></OL>
d354 1
a354 1
   <P></P>
d363 5
a367 4
<li><b>Each step in the process is bold and marked  by a bullet</b><br />
   <a href="../">procedure files</a> are links to the procedure script, <br />
   <font class="input">input files</font> for that procedure are marked in pink, <br />
   <font class="output">output files</font> created by that procedure are marked in green., <br />
d369 1
a369 1
   Lists starting with lowercase letters indicate that you should choose
d372 1
a372 1
      <li>one approach, or</li>
d377 3
a379 4
   <font class="guitool"> Graphical tools </font> : 
   Some results can be analyzed with  
   <a href="../../../../../spire/doc/guitools/index.html">graphical interfaces</a>, 
   if they have been installed. 
d385 1
a385 1
<a href="../../../../../spire/doc/index.html">
d392 18
a409 4
   <li> If you are using 
   <a href="../../../../../spire/doc/index.html">
   <font class="guitool">SPIRE</font></a>, then read <a href="mrspire.html">how to run SPIDER procedure files in SPIRE</a>. 
   <font class="guitool">SPIRE</font> will create the necessary top level directory. </li>
d412 5
a416 16
   <li> If you are running SPIDER at the Unix prompt, the processing steps are 
   carried out by procedure files,
   which run many SPIDER operations automatically. To use a procedure
   in this document, click the procedure filename and copy the procedure
   to your current working directory. At the beginning of each
   procedure, there is a list of parameters that can be adjusted
   according to the particular project. Some of the procedures will
   call additional procedure(s) (listed below the procedure
   filename). You need not change anything in the procedures. Use the
   following format to run a SPIDER procedure: <br />
   
   <code class="snippet">spider spi/dat @@proc</code> <br />
   
   where <code class="snippet">spi</code> is the procedure file extension, 
   <code class="snippet">dat</code> is the project data file extension, and 
   <code class="snippet">proc.spi</code> is the procedure file.
d418 1
d423 1
a423 3
   <a href="http://www.gnuplot.info/docs_4.6/gnuplot.pdf">Gnuplot manual</a>
   and much more about <i>gnuplot</i> is available at
   <a href="http://www.gnuplot.info">Gnuplot Central</a> 
a425 1

d427 3
a429 2
  output files to make ure the results are sensible. If you are not sure what is
  "sensible," ask an expert.</h4> 
d432 1
d434 1
a434 2
<hr />
<!-- ------------------- Creating new reconstruction project ------------------- -->
d437 1
d439 1
a439 1
   <tr> <td>    <br />
d449 2
d454 1
d456 1
a456 1
   subdirectories and procedure files </li> 
a458 14
   <li> If using <a href="../../../../../spire/doc/index.html">
   <font class="guitool">SPIRE</font></a>, it will create the necessary top level 
   directory and populate the directories with the current set of procedure files. 
   See <a href="mrspire.html">"Single-particle reconstruction using SPIRE"</a> for more information. 
   Note that there are 2 versions of the XML configuration file for SPIRE:</li>
   
   <table>  
   <tr><td> <a href="../ctf2d.xml"><font class="input">ctf2d.xml</font></a> : </td> 
       <td> for the most current version of SPIRE.</td></tr>
   <tr><td> <a href="../ctf2d_spire154.xml"><font class="input">ctf2d_spire154.xml</font></a> : </td> 
       <td> for SPIRE versions 1.5.4 and earlier.</td></tr>
   </table>
   
   <p />
d461 11
a471 9
   tar file <a href="../spiproject.tar">spiproject.tar</a>  
   (click for an <a href="../../tar_archive/archive.html">archive of older procedure files</a>).  
   Copy this file to your 
   working directory and unpack it:               <br />
   <code class="snippet">tar xvf spiproject.tar</code> <br />
   This will create a directory called <i>myproject/</i>, containing 
   the procedure files and subdirectories for a reconstruction project. Rename 
   <i>myproject</i> to the name of your project directory, for example:<br />
   <code class="snippet">mv myproject project</code> </li>
d473 10
d486 5
a490 7
   <li><small>
    <p class="action"> If using data from Nature Protocols, 
    you can <a href="../../../../protocol_download.html">
    download the data set from here</a>.</p>
    
    Untar the data set and use the directory structure as your project directory.</li>
</small>
d498 4
a501 5
   Some information is stored in project-wide document files that are used 
   by many procedure files.
   Run the interactive procedure 
   <a class="project" href="../makeparams.spi">makeparams.spi</a> 
   in the top directory of your project. It makes a document file: <br />
d504 3
a506 3
          <td><font class="output">params</font>:</td>
          <td>A doc. file containing the 
             <a href="params.html">reconstruction parameters</a></td> 
d519 2
a520 2
   <a class="project" href="../resizevol.spi">resizevol.spi</a>.
   in the top-level project directory to resize the volume. This creates:      <br />
d538 1
a538 1
   <code class="snippet">mv  /the/actual/location/of/the/micrographs/raw* &nbsp; Micrographs/ </code></P>
d540 1
a540 1
<P>The procedures below can accept 
d547 2
a548 2
   be sure to note the compression in <a href= "params.html">the params file</a>.  
   </P>
d554 2
a555 2
    <a class="project" href="../nat2stk.spi">nat2stk.spi</a> 
    reads <font class="input">win/ser******</font>,
a557 1
    
d559 1
d564 1
d567 3
a569 1
         <td>Micrograph selection doc file listing 14 micrographs used later in the protocol.</td></tr>
d573 1
d588 1
a588 1
<!-- ------------------- Selecting micrographs ------------------- -->
d595 3
a597 4
   <p class="explain">A list of micrographs is generated, and preliminary screening 
   can be carried out.</p>

   <p>These procedures should be run in the <i>Micrographs/</i> directory.   </p>
d601 2
d610 2
a611 2
   <a class="project" href="../Micrographs/makefilelist.spi">makefilelist.spi</a>  
   creates a micrograph selection doc file containing consecutive file numbers in 
d624 1
a624 1
   <a href="../../../../man/docren.html">
d628 1
a628 1
   The Python script <a href="..//mkfilenums.py">mkfilenums.py</a> creates 
d630 1
a630 1
   <a href="../../../../../spire/doc/packages.html"><font class="guitool">SPIRE</font></a>
d640 1
a640 1
   Run the procedure <a class="project" href="../Micrographs/shrink.spi">
d658 1
a658 1
   <a href="../../../../techs/verify/VerifyDocs/montagefromdoc.py">
d660 2
a661 2
     proper data extension. is: 
       <br /><code class="snippet">montagefromdoc.py ../sel_micrograph.dat sm-mic*</code> <br />
d674 1
a674 1
<!-- ******************** CTF ******************************* --> 
d691 3
a693 3
    <li> <a href="../../../../techs/ctf/ctf.html">
    Contrast transfer function correction</a> tutorial. </li>
    <li> <a href="../../../../../spire/doc/guitools/ctfdemo.html">
d695 2
a696 2
         the effects of various parameters on the CTF.                              </li>
    <li> <a href="#PP97">Penczek et al., 1997</a> for a fuller discussion.           </li>
d709 6
a714 6
   <a class="project" href="../Power_Spectra/powdefocus.spi">powdefocus.spi</a> 
   to read each micrograph using
   <a class="project" href="../Power_Spectra/loadmic.spi">loadmic.spi</a>,
   compute an averaged power spectrum, and estimate defocus, 
   astigmatism, and cutoff frequency using SPIDER operation 
   <a href="../../../../man/tfed.html"><b>'TF ED'</b></a>. 
d727 1
a727 1
          <a href="../../../../../spire/doc/guitools/pyplot.html">
d740 1
a740 1
   <a href="../../../../../spire/doc/guitools/ctfmatch/ctfmatch.html">
d745 24
a768 6
<li>Run <a href="../Power_Spectra/powdefocus.spi">powdefocus.spi</a> 
    as in <b>a.</b> to create power spectra: 
    <font class="input">power/roo****</font>.  Then use  
    <a href="../../../../../web/docs/ctf.html">CTF from doc file</a>
    in <font class="guitool">WEB</font> to read <font class="input">power/roo****</font> 
    and the allow the user manually fits a CTF model to the 1D profiles.
d772 6
a777 31
<li>Run <a href="./defmrc.html">CTFFIND3</a> using SPIDER procedure:   
    <a class="project" href="../Power_Spectra/mrcctf.spi">mrcctf.spi</a>. 
    This procedure  reads    
    <font class="input">../sel_micrograph</font> and 
    <font class="input">../Micrographs/raw****</font>. 
    It calls 
    <a class="project" href="../Power_Spectra/loadmic.spi">loadmic.spi</a>, 
    <a href="http://emlab.rose2.brandeis.edu/ctf">ctffind3</a> 
    (the MRC CTFFIND3 program), and
    <a class="project" href="../Power_Spectra/readmrc.py">readmrc.py</a>, 
    (Python script), and creates: <br />

    <table class="outs">
       <tr valign="top"> 
          <td>&curren;</td>
          <td><font class="output">defocus</font>:</td>
          <td>A doc file of defocus and astigmatism values. 
          <a href="./def/defocus-mrc.txt">Example</a></td>
       </tr>
       <tr valign="top">
          <td>&curren;</td>
          <td><font class="output">powchk****</font>:</td>
          <td>SPIDER power spectra files for evaluating defocus. 
              <a href="./def/powchk4078.png">Example</a></td></tr>
       <tr valign="top">
          <td>&curren;</td>
          <td><font class="output">report****</font>:</td>
          <td>CTFFIND report <a href="./def/report4078.txt">Example</a>.</td></tr>
    </table>
    <B>NOTE:</B> <a href="../../../../man/tfed.html"><b>'TF ED'</b></a> produces different
    values for the astigmatism and astigmatism angle from CTFFIND3. 
d782 1
d788 2
a789 1
   Make a montage using <a href="../../../../../web/docs/web.html"><font class="guitool">WEB</font></a> 
d817 3
a819 2
       <a href="../../../../man/docren.html">
       <b>'DOC REN'</b></a> operation in SPIDER to renumber the lines in this selection doc file.</li>
d822 4
a825 3
   <a href="../../../../techs/verify/VerifyDocs/montagefromdoc.htm">
   <font class="guitool">montagefromdoc.py</font></a>.  The syntax, not including the proper data extension. is: 
       <br /><code class="snippet">montagefromdoc.py ../sel_micrograph.dat power/pw_avg*</code> </li>
d829 1
a829 1
<li><p class="action">Generate CTF profiles for each micrographs</p>
d831 1
a831 1
    The procedure <a class="project" href="../Power_Spectra/trapctf.spi">trapctf.spi</a> 
d838 1
d842 1
d845 3
a847 1
         <td>1D profile of the normal CTF, except that low-resolution terms are unaffected.</td></tr>
d851 3
a853 1
             These values can be useful for filtering the images to the first phase reversal.</td></tr>
d856 2
a857 1
         <td>Gnuplot script for plotting the 1D profiles of the the computed transfer functions.</td></tr>
d864 2
a865 2
   set the parameter <I>[mic2plot]</I> to a different micrograph number in 
   <a class="project" href="../Power_Spectra/trapctf.spi">trapctf.spi</a>, 
d870 2
a871 2
   <li>In the batch file <a class="project" href="../Power_Spectra/trapctf.spi">trapctf.spi</a>,
       leave the parameter <I>[viewplot-yn]</I> as 1 (the default).  
d874 1
a874 1
       is not in the same directory as the batch file.)</li>
d895 2
a896 2
        <br /><code><B>mv sel_micrograph_14mics.dat sel_micrograph.dat
        <br />mv Power_Spectra/defocus_14mics.dat Power_Spectra/defocus.dat</B>
d903 1
a903 1
<!-- ------------------- Particle Windowing and Verification ------------------- -->
d921 1
a921 1
<!-- SPIRE directory=Particles subdirectories=coords, good, win, flt ------ -->
d936 3
a938 3
         <a class="project" href="../Particles/noise.spi">noise.spi</a> calls 
         <a class="project" href="../Particles/convert_p.spi">convert_p.spi</a>, 
         reads <font class="input">../Micrographs/raw****</font> and creates: <br />
d960 1
a960 1
   Use one of the following approaches:
d965 5
a969 5
       <a class="project" href="../Particles/pick.spi">pick.spi</a> (and its procedures 
       <a class="project" href="../Particles/convert_p.spi">convert_p.spi</a> 
       and <a class="project" href="../Particles/pick_p.spi">pick_p.spi</a>)
       apply correlation with a Gaussian blob.
       <br />
d975 1
a975 1
       equalization. Output files:<br />
d981 1
d983 1
a983 1
              <td><font class="output">win/sel_particle****</font>: </td>
d985 1
d987 2
a988 2
              <td><font class="output">coords/sndc****</font>: </td>
              <td>Peak coordinates for particles.</td></tr>
d993 6
a998 6
    <li><a class="project" href="../Particles/lfc_pick.spi">lfc_pick.spi</a> 
       (and procedures 
       <a class="project" href="../Particles/convert_p.spi">convert_p.spi</a> and
       <a class="project" href="../Particles/pickparticle.spi">pickparticle.spi</a>) 
       use the Local Fast Correlation algorithm.  
       This procedure uses <a href="../../../../partpick.html#LFC">local cross-correlation</a> 
d1000 1
a1000 1
       <a href="#AR03">Roseman (2003)</a>. This implementation is described in 
d1004 3
a1006 3
       Procedure <a  href="../Particles/lfc_pick.spi">lfc_pick.spi</a>
       also performs a histogram-fitting normalization of the images.
       Output files:<br />
d1009 1
d1013 1
d1015 1
a1015 1
              <td><font class="output">win/sel_particle_****</font>: </td>
d1017 1
d1019 1
a1019 1
              <td><font class="output">coords/sndc****</font>: </td>
d1022 1
a1022 1
    </li>
d1026 3
a1028 2
       <font class="guitool">e2boxer.py</font></a> from <a href="http://blake.bcm.edu/emanwiki/EMAN2">
       EMAN2</a>, saving the coordinates. Then run:
d1031 4
a1034 3
           <li><a class="project" href="../Particles/eman2spider.spi">
           eman2spider.spi</a>, which calls Python procedure <a href="newprogs/Particles/emancoords2spiderdoc.py">
           emancoords2spiderdoc.py</a> (which requires the SPIRE libraries).  Output files: <br />
d1037 1
a1037 1
                  <td><font class="output">win/sel_particle_****</font>: </td>
d1039 1
d1041 1
a1041 1
                  <td><font class="output">coords/sndc****</font>: </td>
d1045 1
a1045 1
           <li><a class="project" href="../Particles/rewindow.spi">rewindow.spi</a>, 
d1061 1
a1061 1
    particle selection</p>
d1063 1
a1063 1
    The procedure <a class="project" href="../Particles/pfilt.spi">pfilt.spi</a> 
d1065 1
a1065 1
       based on its defocus and creates:      <br />
d1068 1
a1068 1
         <td><font class="output">flt/winser_****</font>: </td>
d1074 1
a1074 1
   <a href= "../../../../../web/docs/web.html">
d1082 3
a1084 1
   This step is optional if using <a href="mrverify.html">classification-based verification</a> later on.</p>
d1088 2
a1089 2
   <li>This can be done in <a href="../../../../../web/docs/web.html"><font class="guitool">
   WEB</font></a> using the <a href="../../../../../web/docs/categorize.html">
d1092 1
a1092 1
   <font class="input">sel_particle_1234.dat</font>, and when asked for the image template, enter: 
d1096 4
a1099 3
   selections to a file called, for the example above, <font class="output">good/good1234</font>. (More
   details in the <a href="../../../../faq.html#pick">SPIDER FAQ</a> and 
   <a href="../../../../partpick.html">partpick.html</a>). <br />
d1106 6
a1111 4
   <a class="project" href="../Particles/micmontagedocs.spi">micmontagedocs.spi</a>, 
   which will break each <font class="input">sel_particle_****</font> file into smaller files 
   of the form <font class="output">win/docmontage****_##</font> (by default with 150 particles each), 
   and select these files using <i>Categorize from doc file</i> in <font class="guitool">WEB</font> instead. 
d1114 4
a1117 4
   <li>Alternatively, you can screen the particles micrograph using 
   <a href="../../../../techs/verify/VerifyDocs/montagefromdoc.htm">
   <font class="guitool">montagefromdoc.py</font></a>, with the syntax to open micrograph #1234:
   <br /><code class="snippet">montagefromdoc.py coords/sndc1234.dat</code> <br />
d1125 2
a1126 1
<li><p class="action">Remove duplicate particles, and assign a unique global particle number for each image</p>
d1128 4
a1131 2
   <p>The procedure: <a class="project" href="../Particles/numberparticles.spi">numberparticles.spi</a> 
   will assign a global particle number that will help track particles later as they are grouped and regrouped.</p>
d1133 2
a1134 1
   <p>If you verified particles from each micrograph using <font class="guitool">WEB</font>, use as input 
d1137 1
a1137 1
   <font class="input">win/sel_particle_****</font> (commented out in the procedure). </p>
d1139 7
a1145 4
   <p>If you know from experience that <a href="../Particles/lfc_pick.spi">lfc_pick.spi</a>, for example,
   windows too many particles, you can set the register <i>[max-particles]</i> to the expected number. 
   The first [max-particles] number of particles will be retained, assuming that the particles are sorted 
   from best to worst, as is the case in <a href="../Particles/lfc_pick.spi">lfc_pick.spi</a>.</p>
d1147 2
a1148 2
   <p>If you are appending to an existing data set, set the register <I>[first-global]</I> to a number unused prior, 
   for example, the last particle number used plus 1.</p>
d1150 2
a1151 2
   <p>This batch file will optionally add the global particle number to the image header, 
   specified with the variable <I>[labelheader-yn]</I>.  
d1153 2
a1154 1
   <I>e.g.</I>, micrograph stacks, parallelization stacks, etc. -- this identifier will be copied too.  
d1157 1
a1157 1
   It isn't used in any of the downstream batch files currently, so 
d1162 1
a1162 2
   Outputs:
   <table class="outs">
d1164 1
a1164 1
         <td><font class="output">good/ngood****</font>: </td>
d1168 1
d1173 1
a1179 16
<li><p class="action">Apply the CTF to the particle images</p>

   The procedure: <a class="project" href="../Particles/filtctf.spi">filtctf.spi</a> 
   will apply a 1D CTF profile to the particle images using the 
   <a href="../../../../man/fd.html"><B>
   'FD'</B></a> command.  Outputs:
   
   <table class="outs">
      <tr valign="top"><td>&curren;</td>
         <td><font class="output">win/winctf_****</font>: </td>
         <td>CTF-corrected stacked images.</td></tr>
   </table>
   <br />Here, a rotationally invariant 1D profile is used to correct for the CTF. 
   In principle, a 2D CTF could be used, which would correct for astigmatism.
</li>

d1184 1
a1184 1
<!-- ---------------------------- Alignment ------------------------------ -->
d1186 3
a1188 1
<table class="heading" width="100%"><tr><td> <br />
d1196 1
a1196 2
   references.
   </p>
d1198 1
a1198 1
   <p>These procedures should be run in the <i>Alignment/</i> directory.</p
d1201 1
a1201 2

<!-- SPIRE directory=Alignment subdirectories=ali,projs -->
d1207 15
a1221 1
<li><p class="action">Assign particles to groups for parallelization   </p>
a1222 4
   <a class="project" href="../Alignment/group_particles.spi">group_particles.spi</a> reads 
   <font class="input">../Particles/good/ngood****</font> and 
   <font class="input">../Particles/win/winctf_****</font> and 
   assigns particles to a user-defined number of groups.  Outputs:        <br />
d1224 8
d1233 3
a1235 8
          <td><font class="output">data***</font>: </td>
          <td>A stack file containing particle images for each group.</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">apsh_grp_particles***</font>: </td>
          <td>A doc file listing the particles in each group.</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td><font class="output">sel_group</font>:  </td> 
          <td>A summary doc file listing the number of particles in each group. </td>  </tr>
d1237 3
a1239 3
          <td><font class="output">global2group</font>: </td>
          <td>A combined lookup table for each particle to its group membership.</td></tr>
   </table>
d1241 1
a1241 1
   <br />The number of groups (register <I>[num-groups]</I>) is arbitrary, but 
d1243 2
a1244 3
   (or half that number, etc.). 
   If subsequent alignment is not going to be parallelized, 
   the register <I>[num-groups]</I> can be set to 1 (though not required). 
d1246 1
a1246 1
   set the register <I>[stacks-yn]</I> to 0 in order to do a dry run. 
d1250 1
a1250 2
<li><p class="action">Create reference projections for alignment from a reference
     volume  </p>
d1255 1
a1255 1
    is needed in the top level project directory to create the projections. 
d1258 1
a1258 1
    <a class="project" href="../resizevol.spi">resizevol.spi</a>)
d1261 3
a1263 3
   <a class="project" href="../Alignment/refproj.spi">refproj.spi</a> reads 
   <font class="input">../reference_volume</font> 
   to create two sets of files:        <br />
d1268 3
a1270 3
          <td>A doc. file from
             <a href="../../../../man/voea.html"><b>'VO EA'</b></a>
            listing the three Euler angles for each of the projections.</td></tr>
d1273 3
a1275 3
          <td><font class="output">projs/prj_****</font>: </td>
          <td>Stacked reference images from   
              <a href="../../../../man/pj3q.html"><b>'PJ 3Q'</b></a> 
d1285 1
a1285 1
    <P>Alignment is compute-intensive and benefits by parallelization. 
d1287 1
a1287 1
    <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings.spi</a>, 
d1292 3
a1294 1
    and establishes the output filenames:  </P>
d1297 3
a1299 2
          <td><font class="output">dala01_***</font>:</td>
          <td>Aligned stacks of the particle images.</td></tr>
d1302 2
a1303 1
          <td>Shift and rotation parameters combined for each group.</td></tr>
d1306 1
a1306 1
          <td>Shift and rotation parameters combined for all groups.</td></tr>
d1310 2
a1311 1
    <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings.spi</a>:
d1314 1
a1314 1
          <td> <b><I>[shrange]</I></b>:                               </td>
d1317 12
a1328 9
          <td> <b><I>[step]</I></b>:                                  </td>
          <td> Translation step size. 
              <br />The command <a href="../../../../man/apsh.html">'AP SH'</a>
                  tries different combinations of shifts in increments of <I>[step]</I> up to <I>[shrange]</I>, 
                  <br /> performs an orientational alignment, and chooses the best one.  (See note 9 in the
                  <a href="../../../../man/apsh.html">'AP SH' documentation</a>.) 
              <br /> For example, with a <I>[step]</I> and <I>[shrange]</I> both of 2, 
                  'AP SH' will try shifts of (-2,2),(0,2),(2,2),(-2,0),(0,0),(2,0),(-2,-2),(0,-2), and (2,-2).
                  </td></tr> 
d1330 6
a1335 4
          <td> <b><I>[r2]</I></b>:                                    </td>
          <td> Outer alignment radius (pixels).
              <br /> The sum of <I>[shrange]</I> and <I>[r2]</I> must be less than half the image dimension.
              </td></tr> 
d1337 1
a1337 1
          <td> <b><I>[max-wait]</I></b>:                              </td>
d1340 5
d1347 4
a1350 5
      <br />NOTE: In <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings.spi</a>, 
      there is a temporary output labelled <I>[temp_images]</I>, where the default is 
      to try to copy <font class="input">data***</font> into memory. 
      This is the most efficient method, but if there is insufficient memory, 
      use the commented-out version as a template to store the stack file on disk.<br />
a1351 3
   <br />The following options will depend on whether using you are using 
      <a href="../../../../../pubsub/pubsub.html">
      Publish and Subscribe</a> on a cluster:
d1353 8
a1360 2
   <li>If you are not using Publish and Subscribe, run 
      <a class="project" href="../Alignment/apsh-inseries.spi">apsh-inseries.spi</a>.  
d1362 9
a1370 3
   <li>If you are using <a href="../../../../../pubsub/pubsub.html">
      Publish and Subscribe</a>, run 
      <a class="project" href="../Alignment/apsh-pubsub.spi">apsh-pubsub.spi</a> 
d1373 8
a1380 5
      <li>Copy the SPIDER executable to the local directory and rename it <I>spider</I>, <i>e.g.</i>:<br />
      <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.18.16 ./spider</code> <br /></li>
      <li>Start alignment with the following command: <br />
      <code class="snippet">./spider spi/dat @@apsh-pubsub 1 &amp; </code><br />
      where <I>1</I> will be the number of the top-level SPIDER results file.</li>
d1385 2
a1386 20
<br />The following is a tree of procedure calls:
<table border="1" style="background-color:eeeeee">
<tr><td valign="top">
<pre>
<a class="project" href="../Alignment/apsh-inseries.spi"><B>apsh-inseries</B></a>
    <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings</a>
    
    
    <a class="project" href="../Alignment/apsh-main.spi">apsh-main</a>
   </pre></td>

   <td><pre>
<a class="project" href="../Alignment/apsh-pubsub.spi"><B>apsh-pubsub</B></a>
    <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings</a>
    <a class="project" href="../Alignment/apsh-check.spi">apsh-check</a>
    <a class="project" href="../Alignment/apsh-distribute.spi">apsh-distribute</a>
        <a class="project" href="../Alignment/apsh-main.spi">apsh-main</a>
            <a class="project" href="../Alignment/apsh-wait.spi">apsh-wait</a>
</pre></td>
</tr></table>
a1387 2
<br />The flow of procedure calls is based on those from <a href="refine.html">Refinement</a>, 
with a few changes:
d1390 2
a1391 2
          <td><a class="project" href="../Alignment/apsh-check.spi">apsh-check.spi</a>:</td>
          <td>Checks for the presence of the input files before publising to the nodes.</td> 
d1394 4
a1397 4
          <td><a class="project" href="../Alignment/apsh-wait.spi">apsh-wait.spi</a>:</td>
          <td>Waits up to 10 minutes (by default in 
          <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings.spi</a>)
          before reading a new group's stack, in order to distribute disk I/O.</td> 
d1405 1
a1405 1
<!-- -------------------------- Compute Averages--------------------------- -->
d1421 1
a1421 1
<!-- SPIRE directory=Averages subdirectories=hist,ctf, avg, display -->
d1425 7
a1431 6
<li><p class="action"> Make particle selection document files listing 
   particles cooresponding to each reference projection</p>
   <a class="project" href="../Averages/selectbyview.spi">selectbyview.spi</a></i> reads  
   <font class="input">../Alignment/align_01_all</font> and
   <font class="input">../Alignment/global2group</font>
   to create the following doc files:<br />
d1434 1
d1436 3
a1438 2
          <td><font class="output">how_many-total</font>: </td>
          <td>Lists number of particles associated with each reference view. </td></tr>
d1441 3
a1443 4
          <td><font class="output">Views/sel???</font>: </td>
          <td>Lists the particles numbers associated with each reference view (from
          <a href="../../../../man/vomq.html">
          'VO MQ'</a>). </td></tr>
d1446 2
a1447 4
          <td><font class="output">Views/prj???/sortsel</font>: </td>
          <td>Lists the particles numbers associated with each reference view, 
              sorted by correlation coefficient. </td></tr>

d1453 7
a1459 2
<li> <p class="action">[<b>Optional</b>] Create average images for all projection groups and, 
     optionally, write out filtered, aligned images</p>
a1460 6
     <p>This step is required if using <a href="mrverify.html"> classification-based verification</a>.</p>
   
    <a class="project" href="../Averages/avgfilterbyview.spi">avgfilterbyview.spi</a> reads
    <font class="input">Views/sel???</font>, and 
    <font class="input">../Alignment/dala01_***</font> to
    create the following files:
d1463 1
a1463 1
          <td><font class="output">Avg/allavg***</font>:    </td>
d1467 1
a1467 1
          <td><font class="output">Views/prj???/stkfilt</font>: </td> 
d1472 1
a1472 1
   <p />To skip the output of the filtered images, set the register <I>[save-filt]</I>
d1475 1
a1475 1
   The register <I>[reduction-factor]</I> is to save processing time and disk space.</p>
d1484 1
a1484 1
   <a href="../../../../../web/docs/web.html">
d1487 4
a1490 3
   <li>Use <a href="../../../../techs/verify/VerifyDocs/montagefromdoc.htm">
   <font class="guitool">montagefromdoc.py</font></a>.  The syntax, not including the proper data extension. is: 
       <br /><code class="snippet">montagefromdoc.py summary-avgbyview.dat Avg/allavg*</code> <br />
d1508 2
a1509 2
<li><p class="action">Create a histograms that plots the number of particles 
    vs. the cross correlation value </P>
d1511 4
a1514 4
   <a class="project" href="../Averages/histallcc.spi">histallcc.spi</a> 
   reads 
   <font class="input">Views/prj???/sortsel</font> to
   to create:
d1518 2
a1519 2
          <td><font class="output">histcc-all</font>: </td>
          <td>Histogram doc file of cross correlation values.</td></tr>
d1521 1
a1521 1
          <td><font class="output">combinedparts</font>: </td> 
d1523 1
a1523 1
          <font class="input">Views/prj???/sortsel</font>.</td></tr>
d1525 1
a1525 1
          <td><font class="output">fit.gnu</font>: </td> 
d1529 1
a1529 1
   <P>The output Gnuplot script <font class="output">fit.gnu</font>
d1534 1
a1534 1
   between two such peaks.  </P>
d1536 1
a1536 1
   <br />To view the overall histogram plot, either:
d1539 2
a1540 2
   <li>In the batch file <a class="project" href="../Averages/histallcc.spi">histallcc.spi</a>,
       leave the parameter <I>[viewplot-yn]</I> as 1 (the default).  
d1542 2
a1543 2
       <br />(NOTE: This may not work if <font class="output">fit.gnu</font> 
       is not in the same directory as the batch file.)</li>
d1545 1
a1545 1
       <br /><code class="snippet">gnuplot -persist fit.gnu</code> <br /></li>
d1549 1
a1549 1
       <br /><code class="snippet">load 'fit.gnu'</code> <br />
d1555 2
a1556 2
   <P>Experiment with the parameter <I>[num-bins]</I> if
   you want finer sampling per bin, or coarser (and thus more particles per bin).</P>
a1557 6
   <P>NOTE: This batch file uses the 
   <a href="../../../../man/docstat.html">
   <b>'DOC STAT'</b></a> operation, new to versions 18.20 and up. 
   If you are running an older version, SPIDER will crash (no big deal) after writing 
   <font class="output">fit.gnu</font>, with perhaps unreasonable Gaussian parameters. 
   Edit the Gnuplot script as necessary.</P>
d1564 3
a1566 2
   <p> <a class="project" href="../Averages/plotrefviews.spi">plotrefviews.spi</a> reads  
   <font class="input">how_many</font>, and
d1571 1
a1571 1
          <td> <font class="output">gnuplot_view</font></td>
d1577 2
a1578 1
   <a class="project" href="../Averages/display.spi">display.spi</a> reads 
d1580 1
a1580 1
   <font class="input">how_many-total</font> to create: <br />
d1584 3
a1586 3
          <td> <font class="output">cndis</font>: </td> 
          <td>SPIDER image file showing distribution of sample images 
             among various reference projections for all groups. </td></tr>
d1590 1
a1590 1
   This image show the various angular reference groups represented by small 
d1593 1
a1593 1
   Display the image in <a href="../../../../../web/docs/web.html">
d1595 1
a1595 1
   <a href="../../../../../spire/doc/guitools/qview.html"><font class="guitool">qview.py</font></a>.
d1598 2
a1599 2
<li>
   <p class="action">[<b>Optional</b>] Classification-based verification </p>
d1601 5
a1605 6
   <P>Further information is provided at the <a href="mrverify.html">
      classification-based verification</a> page.
      Briefly, this sub-protocol reads
      <font class="input">Views/sel???</font> and 
      <font class="input">Views/prj???/stkfilt</font> and
      classifies the particles corresponding to each reference projection. </P>
d1610 1
a1610 1
          <td> <a class="project" href="../Averages/classifybyview.spi">classifybyview.spi</a></td>
d1612 1
d1614 2
a1615 1
          <td> <a href="../verifybyview.py"><font class="guitool">verifybyview.py</font> </td>
d1617 1
d1619 1
a1619 1
          <td> <a class="project" href="../Averages/combinegoodclasses.spi">combinegoodclasses.spi</a></td>
d1621 1
d1623 2
a1624 1
          <td> <a class="project" href="../Averages/histgoodcc.spi">histgoodcc.spi</a></td>
d1628 5
a1632 5
   <P>If performing this step, remember to substitute 
   <font class="output">Views/prj???/goodsel</font> for
   <font class="input">Views/prj???/sortsel</font> in 
   <a class="project" href="../Averages/bestim.spi">bestim.spi</a>.
   </P>
d1637 1
a1637 1
   <a name="bestim"><p class="action">Create new group selection files and 
d1640 4
a1643 4
   <P><a class="project" href="../Averages/bestim.spi">bestim.spi</a> reads
   <font class="input">Views/prj???/sortsel</font>
   limits the numbers of images per reference view direction, 
   specified by parameter <I>[maxim]</I>. This will limit overrepresented 
d1645 2
a1646 2
   If you do not wish to limit overrepresented views, 
   leave the parameter <I>[maxim]</I> to -1 (the default).</P>
d1648 13
a1660 7
   <P>The batch file reads:    
   <font class="input">Views/prj???/sortsel</font> and
   <font class="input">../Alignment/apsh_grp_particles***</font>.
   If you performed <a href="mrverify.html">classification-based verification</a>, then 
   use <font class="input">Byview/prj???/goodsel</font> 
   (or the corresponding output of <a href="../Averages/recheck.spi">recheck.spi</a>) in place of 
   the former input.</P>
d1662 1
a1662 1
   Outputs: <br />
d1664 17
a1680 13
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">Views/bestsel???</font></td>
          <td> Lists the particles retained from each reference view</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">how_many-bestim</font></td>
          <td> Summary of the number of images in each reference view</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">avgd_particles_***</font></td>
          <td> Particle selection file for each group</td></tr>
      <tr valign="top"><td>&curren;</td>
          <td> <font class="output">avgd_groups</font></td>
          <td> Group selection file for each group</td></tr>
   </table> 
d1682 2
a1683 2
   <br />Run this batch file even if you aren't limiting overrepresented views.  
   Downstream batch files will look for the above outputs.
d1693 1
a1693 1
<!-- -------------------------- 3D Reconstruction ------------------------ -->
d1706 1
d1715 1
a1715 1
   <p> <a class="project" href="../Reconstruction/stackcombine.spi">stackcombine.spi</a> 
d1717 1
a1717 1
   If you have no desire to regroup the particles, set the parameter <I>[num-stacks]</I> to 0, 
d1726 3
a1728 3
   <font class="input">../Alignment/data***</font>, and 
   <font class="input">../Alignment/dala01_***</font>, and 
   <font class="input">../Alignment/align_01_***</font> 
d1735 1
d1739 1
d1743 1
d1745 1
a1745 1
          <td><font class="output">bps_dala01_***</font>: </td>
d1749 2
a1750 2
   <P>To perform a dry run -- for example to see how big the groups will be -- 
   set the parameter <I>[stacks-yn]</I> to 0.</P>
d1752 6
a1757 5
   <P><B>NOTE:</B> If you aren't regrouping the images and have set <I>[num-stacks]</I> to 0, 
   the batch file is written such that it should be in the same directory as the output files. 
   To find how to circumvent this, look up the <code class="snippet">ln</code> command regarding relative paths, or 
   look up the example in <a class="project" href="../Refinement/prepare.pam">prepare.pam</a> below.
   </P>
d1769 1
a1769 1
      <a href="../../../../../pubsub/pubsub.html">
d1773 1
a1773 1
      <a class="project" href="../Reconstruction/bps-inseries.spi">bps-inseries.spi</a>.  
d1775 2
a1776 1
   <li>If you are using <a href="../../../../../pubsub/pubsub.html">
d1778 1
a1778 1
      <a class="project" href="../Reconstruction/bps-pubsub.spi">bps-pubsub.spi</a> 
d1781 2
a1782 1
        <li>Copy the SPIDER executable to the local directory and rename it <I>spider</I>, <i><i>e.g.</i></i>:<br />
d1785 2
a1786 2
        <code class="snippet">./spider spi/dat bps-pubsub 1 &amp; </code><br />
        where <I>1</I> will be the number of the top-level SPIDER results file.</li>
d1791 1
a1791 1
    <P>Like alignment, 3D reconstruction is CPU-intensive and benefits by parallelization. 
d1793 1
a1793 1
    <a class="project" href="../Reconstruction/bps-settings.spi">bps-settings.spi</a>, 
d1795 5
a1799 4
    (<i><i>e.g.</i></i>, <font class="input">bps_groups</font>, 
    <font class="input">bps_particles***</font>, and 
    <font class="input">bps_dala01_***</font>, and 
    <font class="input">bps_align_01_***</font>).</P>
d1802 1
a1802 1
    <a class="project" href="../Reconstruction/bps-settings.spi">bps-settings.spi</a>:
d1804 2
a1805 2
      <tr valign="top"><td>&curren;                               </td>
          <td> <b><I>[bp-method]</I></b>:                 </td>
d1807 3
a1809 2
      <tr valign="top"><td>&curren;                               </td>
          <td> <b><I>[stk-opt]</I></b>:                 </td>
d1812 4
a1815 3
      <tr valign="top"><td>&curren;                               </td>
          <td> <b><I>[max-wait]</I></b>:                 </td>
          <td> Like in <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings.spi</a>
d1817 1
a1817 1
               in order to distribute disk I/O..</td></tr> 
d1820 5
a1824 5
    <P>
    For the parameter <b><I>[bp-method]</I></b>, the Fourier-based backprojections -- 
    <a href="../../../../man/bp32f.html">'BP 32F'</a> 
    (option 2 in <a href="../Reconstruction/bps-settings.spi">bps-settings.spi</a>) or 
    <a href="../../../../man/bp3n.html">'BP 3N'</a> 
d1826 1
a1826 1
    <a href="../../../../man/bprp.html">'BP RP'</a> 
d1828 1
a1828 1
    <a href="../../../../man/bpcg.html">'BP CG'</a> 
d1831 1
a1831 1
    ripples in the reconstruction when viewed as <I>z</I>-slices. 
d1834 1
a1834 1
    </P>
d1842 2
a1843 1
          <td> List of odd numbered images for each group.</td></tr>  
d1856 3
a1858 2
          <td> <font class="output">Groups/grp***/vol01_odd</font>: </td>
          <td> Reconstructed volume from odd images for each group.</td></tr> 
d1860 3
a1862 2
          <td> <font class="output">Groups/grp***/vol01_even</font>: </td>
          <td> Reconstructed volume from even images for each group.</td></tr> 
d1866 1
d1870 3
a1872 2
               <a href="../../../../glossary.html#Fourier">
               FSC curve</a> for each group.</td></tr> 
d1876 1
a1876 1
               <a href="../../../../glossary.html#Fourier">
d1881 4
a1884 3
     Finally, they add together the 'odd' and 'even 'volumes to make a volume for the entire data set, . 
     and calculate the FSC resolution curve for the combined reconstruction  
     (see <a href="../../../../man/rf3.html">'RF 3'</a> operation) creating 
d1890 2
a1891 1
          <td> 3D reconstruction from entire set of particles.    </td></tr> 
d1894 2
a1895 1
          <td> Doc file containing unmasked FSC curve for final reconstruction. </td></tr> 
d1898 2
a1899 1
          <td> Doc file containing masked FSC curve for final reconstruction. </td></tr> 
d1906 1
a1906 1
   the <i>initial volume</i> and will be used as the input for the Refinement step. 
d1909 3
a1911 2
   View the volume as slices using the <I>Montage</I> operation in <font class="guitool">WEB</font> 
   or in <a href="../../../../../spire/doc/guitools/montage.html">
d1915 1
a1915 1
   If any images are blank or otherwise unusual,    check the volume for specific groups.
d1922 2
a1923 2
<a class="project" href="../Reconstruction/bps-inseries.spi"><B>bps-inseries</B></a>
    <a class="project" href="../Reconstruction/bps-settings.spi">bps-settings</a>
d1925 2
a1926 6
    
    <a class="project" href="../Reconstruction/bps-main.spi">bps-main</a>
    
        <a class="project" href="../Reconstruction/bps-calcres.spi">bps-calcres</a>
    <a class="project" href="../Reconstruction/bps-combine.spi">bps-combine</a>
        <a class="project" href="../Reconstruction/bps-calcres.spi">bps-calcres</a>
d1930 5
a1934 9
<a class="project" href="../Reconstruction/bps-pubsub.spi"><B>bps-pubsub</B></a>
    <a class="project" href="../Reconstruction/bps-settings.spi">bps-settings</a>
    <a class="project" href="../Reconstruction/bps-check.spi">bps-check</a>
    <a class="project" href="../Reconstruction/bps-distribute.spi">bps-distribute</a>
        <a class="project" href="../Reconstruction/bps-main.spi">bps-main</a>
            <a class="project" href="../Reconstruction/bps-wait.spi">bps-wait</a>
            <a class="project" href="../Reconstruction/bps-calcres.spi">bps-calcres</a>
    <a class="project" href="../Reconstruction/bps-combine.spi">bps-combine</a>
        <a class="project" href="../Reconstruction/bps-calcres.spi">bps-calcres</a>
d1942 1
a1942 1
   <a class="project" href="../Reconstruction/plotres.spi">plotres.spi</a> reads
d1944 2
a1945 1
   <font class="input">docfscmasked001</font>, and <font class="input">Groups/grp***/docfscmasked001</font>.  
d1973 3
a1975 3
   <a class="project" href="../Reconstruction/make_matched.spi">make_matched.spi</a> reads 
   <font class="input">vol01_odd</font> and
   <font class="input">vol01_even</font>. It creates: <br />
d1979 1
a1979 1
          <td> <font class="output">docmatched_vol01</font>: </td>
d1993 2
a1994 2
   <a class="project" href="../Reconstruction/matchedfilter.spi">matchedfilter.spi</a> reads 
   <font class="input">docmatched_vol01</font> and   
d2005 2
a2006 2
   <a href="../../../../../web/docs/web.html">
   <font class="guitool">WEB</font></a> or by loading the volume in
d2013 1
a2013 1
<!-- -------------------------- Refinement ------------------------ -->
d2022 1
a2022 1
     reference match each time. Thus the data particles are allowed to "settle in" 
d2036 2
a2037 1
<li><p />Below is a summary of details presented on the <a href="refine.html">Refinement</a> page.<p /></li>
d2040 3
a2042 2
   Edit <a class="project" href="../Refinement/refine_settings.pam">refine_settings.pam</a>, 
   which reads the following input files:
d2047 2
a2048 1
   <tr><td> <font class="input">../Reconstruction/bps_group</font>: </td> 
d2050 2
a2051 1
   <tr><td> <font class="input">../Reconstruction/vol01_matched</font>: </td> 
d2053 2
a2054 1
   <tr><td> <font class="input">../Reconstruction/bps_grp_particles_***</font>: </td> 
d2056 2
a2057 1
   <tr><td> <font class="input">../Reconstruction/bps_align_01_***</font>: </td> 
d2059 4
a2062 2
   <tr><td> <font class="input">../Reconstruction/bps_data***</font>: </td> 
       <td> Unaligned stacked image files.</td></tr>
d2065 1
a2068 3
   
   <br />In the refinement filenames above and below, 
   '***' denotes group number, and '##' denotes iteration number.
d2073 1
a2073 1
      <a href="../../../../../pubsub/pubsub.html">
d2076 12
a2087 3
      <li>If you are not using <a href="../../../../../pubsub/pubsub.html">
         Publish and Subscribe</a>, run 
         <a class="project" href="../Refinement/refine.pam">refine.pam</a>.  
d2089 3
a2091 3
      <li>If you are using <a href="../../../../../pubsub/pubsub.html">
         Publish and Subscribe</a>, run 
         <a class="project" href="../Refinement/pub_refine.pam">pub_refine.pam</a> 
d2094 3
a2096 4
            <li>If not installed from the <a href="./spiproject.tar.gz">tar archive</a>, copy
            <a href="../../../../../pubsub/publish.perl">publish.perl</a> here.</li>
            <li>Copy the SPIDER executable to the local directory and rename it <I>spider</I>, <i><i>e.g.</i></i>:<br />
               <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.18.16 ./spider</code> <br />
d2099 2
a2100 2
               <code class="snippet">./spider spi/dat @@pub_refine 1 </code><br />
               where <I>1</I> will be the number of the top-level SPIDER results file.</li>
d2103 2
a2104 1
   </ol>
d2106 1
a2106 1
<P></P>
d2115 1
d2117 3
a2119 2
          <td> <font class="output">final/dres##_***</font>: </td>
          <td> Resolution curve doc. file</td></tr>
d2121 7
a2127 2
          <td> <font class="output">final/val##</font>: </td>
          <td> Unfiltered volume </td></tr>
d2130 2
a2131 1
          <td>Filtered volume from all images</td></tr> 
d2133 3
a2135 2
          <td> <font class="output">final/vol##_odd</font>: </td>
          <td>Filtered volume from odd numbered images</td></tr>
d2137 3
a2139 2
          <td><font class="output">final/vol##_even</font>: </td>
          <td>Filtered volume from even numbered images</td></tr>
d2147 2
a2148 2
<br />There are a number of sub-procedures used in refinement.
  The following is a tree of procedure calls:
d2152 3
a2154 3
<a class="project" href="../Refinement/refine.pam"><B>refine</B></a>
    <a class="project" href="../Refinement/refine_settings.pam">refine_settings</a>
    <a class="project" href="../Refinement/prepare.pam">prepare</a>
d2157 1
a2157 2
    <a class="project" href="../Refinement/grploop.pam">grploop</a>
        <a class="project" href="../Refinement/saveresp.pam">saveresp</a>
d2161 3
a2164 1
    <a class="project" href="../Refinement/smangloop.pam">smangloop</a>
d2166 3
a2168 4
    
    <a class="project" href="../Refinement/mergegroups.pam">mergegroups</a>
        <a class="project" href="../Refinement/saveresp.pam">saveresp</a>
        <a class="project" href="../Refinement/enhance.pam">enhance</a>
d2172 17
a2188 17
<a class="project" href="../Refinement/pub_refine.pam"><B>pub_refine</B></a>
    <a class="project" href="../Refinement/refine_settings.pam">refine_settings</a>
    <a class="project" href="../Refinement/prepare.pam">prepare</a>
    <a class="project" href="../Refinement/pub_refine_start.pam">pub_refine_start</a> (<I>[task]</I>=0)
        <a class="project" href="../Refinement/pub_ref_loop_clone.pam">pub_ref_loop_clone</a>
        <a class="project" href="../Refinement/grploop.pam">grploop</a>
            <a class="project" href="../Refinement/saveresp.pam">saveresp</a>
        <a class="project" href="../Refinement/pub_ref_loop_declone.pam">pub_ref_loop_declone</a>
        <a class="project" href="../Refinement/pub_refine_doc_sync.pam">pub_refine_doc_sync</a>
    <a class="project" href="../Refinement/pub_refine_start.pam">pub_refine_start</a> (<I>[task]</I>=1)
        <a class="project" href="../Refinement/pub_ref_loop_clone.pam">pub_ref_loop_clone</a>
        <a class="project" href="../Refinement/smangloop.pam">smangloop</a>
        <a class="project" href="../Refinement/pub_ref_loop_declone.pam">pub_ref_loop_declone</a>
        <a class="project" href="../Refinement/pub_refine_doc_sync.pam">pub_refine_doc_sync</a>
    <a class="project" href="../Refinement/pub_refine_waitmerge.pam">pub_refine_waitmerge</a>
      <a class="project" href="../Refinement/saveresp.pam">saveresp</a>
      <a class="project" href="../Refinement/enhance.pam">enhance</a>
d2193 3
a2195 3
   <P>If you are running on a cluster with <i>PubSub</i> you will also need: 
   <a href="../../../../../pubsub/publish.perl">publish.perl</a>,                                  &nbsp; 
   <a class="project" href="../Refinement/pub_fixrefine.pam">pub_fixrefine.pam</a>.</P>
d2198 1
a2198 1
<li><P>Further details are given in the <a href="refine.html">Refinement</a> page.</P>  </li>
d2206 1
a2206 1
   The procedure <a class="project" href="../Refinement/plotrefres.spi">plotrefres.spi</a> reads
d2209 2
a2210 3
   <font class="input">dres##</font>, 
   <font class="input">dbpr##_***</font>, and
   <font class="input">dbpr##</font>. 
d2216 1
a2216 1
          <td>Plots combined resolution curve for each iteration of refinement.</td></tr> 
d2220 1
a2220 1
          <td>Plots resolution curve for each group for the last iteration.</td></tr> 
d2226 1
a2226 2
<!--<li><p class="action">[Optional] View angular data output from Refinement
   procedure files</p>
d2256 1
d2265 1
a2265 1
   <P></P>
d2272 1
a2272 1
<dd><a href="../backup.sh">backup.sh</a> a shell script, puts a number of vital 
d2274 2
a2275 2
   shell script as needed, <I>e.g.</I>, to correspond to your data extension, 
   The variable <I>$BACKUP</I> is intended to be substituted for, for example, an external drive.
d2282 1
a2282 1
<p><dt><a href="../../../../techs/diffmaps/index.html">Difference Maps</a> </dt>
d2287 1
a2287 1
<p><dt><a href="../../../../techs/xray/xray.html">Frequency amplitude correction with X-ray
d2293 1
a2293 1
<p><dt><a href="../../../../techs/classification/index.html">Classification of Particles</a></dt>
d2297 1
a2297 1
<p><dt>See more methods on the <a href="../../../../techniques.html">techniques page</a></dt>
d2304 1
a2304 1
<!-- ------------------- Running  SPIDER procedure files ------------------- -->
d2312 1
a2312 1
   For a more complete list of changes, see individual batch files.</p>
d2314 1
a2314 1
   <P></P>
d2319 1
a2319 1
<P>
d2323 3
a2325 2
        Non-backwards-compatible changes for SPIRE v1.5.4 retained in <a href="../ctf2d.xml">ctf2d_spire154.xml</a></li> 
    <li>2012-07-19 -- the following batch files explicitly create necessary output directories: </li> 
d2327 3
a2329 3
            <li>lfc_pick.spi</li>
            <li>eman2spider.spi</li>
            <li>rewindow.spi</li>
d2332 2
a2333 1
    <li>2012-05-17 -- changed <I>X##</I> format registers to named registers for the following batch files:</li>
d2335 4
a2338 4
            <li>rewindow.spi</li>
            <li>recheck.spi </li>
            <li>goodparticlesbydf.spi </li>
            <li>eman2spider.spi </li>
d2340 1
a2340 1
            <li>classify.spi </li>
d2345 3
a2347 3
        <li>trapctf.spi </li>
        <li>histallcc.spi </li>
        <li>histgoodcc.spi </li>
d2350 1
a2350 1
        <a href= "../../../../protocol_download.html">
d2357 4
a2360 3
<table class="heading" width="100%"><tr><td> <br />
   <h3 > References</h3>
   </td></tr>
d2380 3
a2382 2
   <a href="../../../../../docs/techs/pfefferkorn.pdf">
   Three Dimensional Reconstruction with Contrast Transfer Compensation from Defocus Series.</a> &nbsp;&nbsp; 
d2419 1
d2421 5
d2427 5
a2431 11
<p>
Source: mr.html        &nbsp;&nbsp;&nbsp; 
Page updated: 2013/07/31 &nbsp;&nbsp;&nbsp;
Tapu Shaikh
</p>

<p>
<address>&copy; <a href="../../../../copyright.html">Copyright notice</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Enquiries: <a href= "mailto:spider@@wadsworth.org">spider@@wadsworth.org</a>
</address>
</p>
@


1.13
log
@fixed broken link (refine-settings.spi -> refine_settings.pam)
@
text
@d31 1
d45 1
a45 1
<a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/recon/mr.html">
d62 1
a62 1
all particle in a defocus group follow the same CTF profile.  At high resolution,
d69 2
a70 2
other software packages which also correct for the CTF at the level of particle
images will be more straightforward.
d74 1
a74 1
In comparison, the strategy using defocus groups has its own advantages.  
d79 3
a81 4
<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bprp.html">
<b>'BP RP'</b></a> or
<a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bpcg.html">
<b>'BP CG'</b></a>, whereas the use of defocus groups does not present such 
d89 1
a89 1
<HR>
d102 1
a102 1
<UL>
d110 1
a110 1
<BR>
d148 1
a148 1
    <a href="http://www.wadsworth.org/spider_doc/spider/docs/techniques.html">
d158 1
a158 1
<HR>
d173 1
a173 1
  <li><a href="mrsphart/flowchart.html">A flowchart of operations</a></li>
d184 1
a184 1
      <a href= "http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
d194 1
a194 1
      <a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">
d212 1
a212 1
  <li> <a href="http://www.wadsworth.org/spider_doc/spider/docs/strategies.html">
d214 1
a214 1
    <a href="http://www.wadsworth.org/spider_doc/spider/docs/glossary.html">
d228 1
a228 1
  <li> <a href="http://www.wadsworth.org/spider_doc/spider/docs/ref.html">
d235 1
a235 1
<HR>
d253 5
a257 5
    <LI>tar -xvf spiproject.tar</LI>
    <LI>cd myproject </LI>
    <LI>spider spi/dat @@makeparams</LI>
    <LI>spider spi/dat @@resizevol</LI>
    <LI>mv  /the/actual/location/of/the/micrographs/raw* &nbsp; Micrographs/</LI>
d262 3
a264 3
    <LI>mkfilenums.py ../sel_micrograph.dat mic*.dat</LI>
    <LI>spider spi/dat @@shrink</LI>
    <LI>montagefromdoc.py ../sel_micrograph.dat sm-mic*</LI>
d269 4
a272 4
    <LI>spider spi/dat @@powdefocus</LI>
    <LI>montagefromdoc.py ../sel_micrograph.dat power/pw_avg*</LI>
    <LI>ctfmatch.py power/ctf* &amp;</LI>
    <LI>spider spi/dat @@trapctf</LI>
d277 7
a283 7
    <LI>spider spi/dat @@noise</LI>
    <LI>e2boxer.py </LI>
    <LI>spider spi/dat @@eman2spider</LI>
    <LI>spider spi/dat @@rewindow</LI>
    <LI>montagefromdoc.py coords/sndc0001.dat win/winser0001.dat</LI>
    <LI>spider spi/dat @@numberparticles</LI>
    <LI>spider spi/dat @@filtctf</LI>
d288 3
a290 3
    <LI>spider spi/dat @@group_particles</LI>
    <LI>spider spi/dat @@refproj</LI>
    <LI>./spider spi/dat @@apsh-pubsub</LI>
d295 5
a299 5
    <LI>spider spi/dat @@selectbyview</LI>
    <LI>spider spi/dat @@avgfilterbyview</LI>
    <LI>spider spi/dat @@histallcc</LI>
    <LI>spider spi/dat @@display</LI>
    <LI>[<b>Optional</b>] Classification-based verification</LI>
d301 6
a306 6
        <LI>spider spi/dat @@classifybyview </LI>
        <LI>verifybyview.py Views/prj001 </LI>
        <LI>spider spi/dat @@combinegoodclasses </LI>
        <LI>spider spi/dat @@histgoodcc </LI>
        <LI>spider spi/dat @@goodpartsbymic </LI>
        <LI>spider spi/dat @@display-good </LI>
d308 1
a308 1
    <LI>spider spi/dat @@bestim</LI>
d313 5
a317 5
    <LI>spider spi/dat @@stackcombine</LI>
    <LI>./spider spi/dat @@bps-pubsub</LI>
    <LI>spider spi/dat @@plotres</LI>
    <LI>spider spi/dat @@make_matched</LI>
    <LI>spider spi/dat @@matchedfilter</LI>
d322 2
a323 2
    <LI>./spider spi/dat @@pub_refine</LI>
    <LI>spider spi/dat @@plotrefres</LI>
d326 1
a326 1
<hr>
d360 1
a360 1
   <a href="http://www.wadsworth.org/spider_doc/spire/doc/guitools/index.html">graphical interfaces</a>, 
d367 1
a367 1
<a href="http://www.wadsworth.org/spider_doc/spire/doc/index.html">
d375 1
a375 1
   <a href="http://www.wadsworth.org/spider_doc/spire/doc/index.html">
d413 1
a413 1
<hr>
d435 1
a435 1
   <li> If using <a href="http://www.wadsworth.org/spider_doc/spire/doc/index.html">
d466 1
a466 1
    you can <a href="http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
d526 1
a526 1
   <a href="http://www.wadsworth.org/spider_doc/spider/download/zi2spi.c">zi2spi.c</a>.
d564 1
a564 1
<hr>
d600 1
a600 1
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/docren.html">
d602 1
a602 1
   <BR>
d606 2
a607 2
   <a href="http://www.wadsworth.org/spider_doc/spire/doc/packages.html"><font class="guitool">SPIRE</font></a>
   libraries is required.  The syntax, not including the proper data extension. is: <BR>
d634 7
a640 7
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
   <font class="guitool">montagefromdoc.py</font></a>.  The syntax, not including the proper data extension. is: 
       <BR><code class="snippet">montagefromdoc.py ../sel_micrograph.dat sm-mic*</code> <br>
   The selection file <font class="input">sel_micrograph</font> will be backed up each time that is is saved. 
   Further information for <font class="guitool">montagefromdoc.py</font> is available at its
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
   documentation page</a>.
d667 1
a667 1
    <li> <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/ctf/ctf.html">
d669 1
a669 1
    <li> <a href="http://www.wadsworth.org/spider_doc/spire/doc/guitools/ctfdemo.html">
d690 1
a690 1
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/tfed.html"><b>'TF ED'</b></a>. 
d703 1
a703 1
          <a href="http://www.wadsworth.org/spider_doc/spire/doc/guitools/pyplot.html">
d716 1
a716 1
   <a href="http://www.wadsworth.org/spider_doc/spire/doc/guitools/ctfmatch/ctfmatch.html">
d724 1
a724 1
    <a href="http://www.wadsworth.org/spider_doc/web/docs/ctf.html">CTF from doc file</a>
d759 1
a759 1
    <B>NOTE:</B> <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/tfed.html"><b>'TF ED'</b></a> produces different
d770 1
a770 1
   Make a montage using <a href="http://www.wadsworth.org/spider_doc/web/docs/web.html"><font class="guitool">WEB</font></a> 
d792 1
a792 1
   <br>Remove such micrographs from the selection doc file by either:
d798 1
a798 1
       <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/docren.html">
d802 1
a802 1
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
d804 1
a804 1
       <BR><code class="snippet">montagefromdoc.py ../sel_micrograph.dat power/pw_avg*</code> </li>
d825 1
a825 1
         <td>Listing of the first CTF extremum and first zero for each micrograph.<BR>
d832 1
a832 1
   <BR>In the Gnuplot output script <font class="output">viewtrap.gnu</font>, 
d845 1
a845 1
       <BR>(NOTE: This may not work if <font class="output">viewtrap.gnu</font> 
d848 1
a848 1
       <BR><code class="snippet">gnuplot -persist viewtrap.gnu</code> <BR></li>
d850 1
a850 1
       <BR><code class="snippet">gnuplot</code> <BR>
d852 1
a852 1
       <BR><code class="snippet">load 'viewtrap.gnu'</code> <BR>
d858 1
a858 1
   <BR>The 1D profile outputs are interchangeable in the later procedures, but 
d863 1
a863 1
<LI><small>For the Nature Protocols data set, for the sake of speed, 
d867 2
a868 2
        <BR><code><B>mv sel_micrograph_14mics.dat sel_micrograph.dat
        <BR>mv Power_Spectra/defocus_14mics.dat Power_Spectra/defocus.dat</B>
d870 1
a870 1
</LI>
d874 1
a874 1
<hr>
d968 1
a968 1
       This procedure uses <a href="http://www.wadsworth.org/spider_doc/spider/docs/partpick.html#LFC">local cross-correlation</a> 
d999 1
a999 1
           emancoords2spiderdoc.py</a> (which requires the SPIRE libraries).  Output files: <br>
d1010 1
a1010 1
           which windows out the particle images.  Output files: <br>
d1038 1
a1038 1
   <a href= "http://www.wadsworth.org/spider_doc/web/docs/web.html">
d1050 2
a1051 2
   <li>This can be done in <a href="http://www.wadsworth.org/spider_doc/web/docs/web.html"><font class="guitool">
   WEB</font></a> using the <a href="http://www.wadsworth.org/spider_doc/web/docs/categorize.html">
d1055 1
a1055 1
   <font class="input">winser_1234@@*</font> <BR>
d1059 2
a1060 2
   details in the <a href="http://www.wadsworth.org/spider_doc/spider/docs/faq.html#pick">SPIDER FAQ</a> and 
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/partpick.html">partpick.html</a>). <br />
d1071 1
a1071 1
   </li><br>
d1074 1
a1074 1
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
d1076 1
a1076 1
   <BR><code class="snippet">montagefromdoc.py coords/sndc1234.dat</code> <br>
d1134 1
a1134 1
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/fd.html"><B>
d1142 1
a1142 1
   <BR>Here, a rotationally invariant 1D profile is used to correct for the CTF. 
d1194 1
a1194 1
   <BR>The number of groups (register <I>[num-groups]</I>) is arbitrary, but 
d1224 1
a1224 1
             <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/voea.html"><b>'VO EA'</b></a>
d1230 1
a1230 1
              <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/pj3q.html"><b>'PJ 3Q'</b></a> 
d1260 1
a1260 1
    <BR> Some notable parameters in
d1269 1
a1269 1
              <BR>The command <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsh.html">'AP SH'</a>
d1271 3
a1273 3
                  <BR> performs an orientational alignment, and chooses the best one.  (See note 9 in the
                  <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/apsh.html">'AP SH' documentation</a>.) 
              <BR> For example, with a <I>[step]</I> and <I>[shrange]</I> both of 2, 
d1279 1
a1279 1
              <BR> The sum of <I>[shrange]</I> and <I>[r2]</I> must be less than half the image dimension.
d1287 1
a1287 1
      <BR>NOTE: In <a class="project" href="../Alignment/apsh-settings.spi">apsh-settings.spi</a>, 
d1291 1
a1291 1
      use the commented-out version as a template to store the stack file on disk.<BR>
d1293 2
a1294 2
   <BR>The following options will depend on whether using you are using 
      <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/pubsub.html">
d1300 1
a1300 1
   <li>If you are using <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/pubsub.html">
d1304 7
a1310 7
      <UL>
      <LI>Copy the SPIDER executable to the local directory and rename it <I>spider</I>, <i>e.g.</i>:<BR>
      <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.18.16 ./spider</code> <br /></LI>
      <LI>Start alignment with the following command: <BR>
      <code class="snippet">./spider spi/dat @@apsh-pubsub 1 &amp; </code><BR>
      where <I>1</I> will be the number of the top-level SPIDER results file.</LI>
      </UL>
d1314 1
a1314 1
<BR>The following is a tree of procedure calls:
d1335 1
a1335 1
<BR>The flow of procedure calls is based on those from <a href="refine.html">Refinement</a>, 
d1353 1
a1353 1
<hr>
d1389 1
a1389 1
          <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/vomq.html">
d1434 1
a1434 1
   <a href="http://www.wadsworth.org/spider_doc/web/docs/web.html">
d1437 1
a1437 1
   <li>Use <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/verify/VerifyDocs/montagefromdoc.htm">
d1439 1
a1439 1
       <BR><code class="snippet">montagefromdoc.py summary-avgbyview.dat Avg/allavg*</code> <BR>
d1485 1
a1485 1
   <br>To view the overall histogram plot, either:
d1491 1
a1491 1
       <BR>(NOTE: This may not work if <font class="output">fit.gnu</font> 
d1494 1
a1494 1
       <BR><code class="snippet">gnuplot -persist fit.gnu</code> <BR></li>
d1496 1
a1496 1
       <BR><code class="snippet">gnuplot</code> <BR>
d1498 1
a1498 1
       <BR><code class="snippet">load 'fit.gnu'</code> <BR>
d1508 1
a1508 1
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/docstat.html">
d1546 1
a1546 1
   Display the image in <a href="http://www.wadsworth.org/spider_doc/web/docs/web.html">
d1548 1
a1548 1
   <a href="http://www.wadsworth.org/spider_doc/spire/doc/guitools/qview.html"><font class="guitool">qview.py</font></a>.
d1621 1
a1621 1
   <BR>Run this batch file even if you aren't limiting overrepresented views.  
d1631 1
a1631 1
<hr>
d1703 1
a1703 1
      <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/pubsub.html">
d1709 1
a1709 1
   <li>If you are using <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/pubsub.html">
d1713 7
a1719 7
      <UL>
        <LI>Copy the SPIDER executable to the local directory and rename it <I>spider</I>, <i><i>e.g.</i></i>:<BR>
        <code class="snippet">cp /spider/bin/spider_linux_mp_opt64.18.16 ./spider</code> <br /></LI>
        <LI>Start alignment with the following command: <BR>
        <code class="snippet">./spider spi/dat bps-pubsub 1 &amp; </code><BR>
        where <I>1</I> will be the number of the top-level SPIDER results file.</LI>
      </UL>
d1751 1
a1751 1
    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bp32f.html">'BP 32F'</a> 
d1753 1
a1753 1
    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bp3n.html">'BP 3N'</a> 
d1755 1
a1755 1
    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bprp.html">'BP RP'</a> 
d1757 1
a1757 1
    <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bpcg.html">'BP CG'</a> 
d1776 1
a1776 1
   <br>
d1795 1
a1795 1
               <a href="http://www.wadsworth.org/spider_doc/spider/docs/glossary.html#Fourier">
d1800 1
a1800 1
               <a href="http://www.wadsworth.org/spider_doc/spider/docs/glossary.html#Fourier">
d1804 1
a1804 1
   <br>
d1807 1
a1807 1
     (see <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/rf3.html">'RF 3'</a> operation) creating 
d1830 1
a1830 1
   or in <a href="http://www.wadsworth.org/spider_doc/spire/doc/guitools/montage.html">
d1882 1
a1882 1
       <BR><code class="snippet">gnuplot -persist gnuplot_res</code> </p>
d1917 1
a1917 1
   after having been filtered to the exact same resolution.<BR>
d1931 1
a1931 1
   <a href="http://www.wadsworth.org/spider_doc/web/docs/web.html">
d1938 1
a1938 1
<hr>
d1962 1
a1962 1
<LI><p />Below is a summary of details presented on the <a href="refine.html">Refinement</a> page.<p /></LI>
d1987 1
a1987 1
   <BR>In the refinement filenames above and below, 
d1993 1
a1993 1
      <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/pubsub.html">
d1996 1
a1996 1
      <li>If you are not using <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/pubsub.html">
d2000 1
a2000 1
      <li>If you are using <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/pubsub.html">
d2004 4
a2007 4
         <UL>
            <LI>If not installed from the <a href="./spiproject.tar.gz">tar archive</a>, copy
            <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/publish.perl">publish.perl</a> here.</LI>
            <LI>Copy the SPIDER executable to the local directory and rename it <I>spider</I>, <i><i>e.g.</i></i>:<BR>
d2009 5
a2013 5
               This ensures that the same SPIDER executable is available throughout whole refinement.</LI>
            <LI>Start alignment with the following command: <BR>
               <code class="snippet">./spider spi/dat @@pub_refine 1 </code><BR>
               where <I>1</I> will be the number of the top-level SPIDER results file.</LI>
         </UL>
d2018 1
a2018 1
<LI>
d2048 1
a2048 1
<BR>There are a number of sub-procedures used in refinement.
d2095 1
a2095 1
   <a href="http://www.wadsworth.org/spider_doc/spider/pubsub/publish.perl">publish.perl</a>,                                  &nbsp; 
d2097 1
a2097 1
</LI>
d2099 1
a2099 1
<LI><P>Further details are given in the <a href="refine.html">Refinement</a> page.</P>  </LI>
d2184 1
a2184 1
<p><dt><a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/diffmaps/index.html">Difference Maps</a> </dt>
d2189 1
a2189 1
<p><dt><a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/xray/xray.html">Frequency amplitude correction with X-ray
d2195 1
a2195 1
<p><dt><a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/classification/index.html">Classification of Particles</a></dt>
d2199 1
a2199 1
<p><dt>See more methods on the <a href="http://www.wadsworth.org/spider_doc/spider/docs/techniques.html">techniques page</a></dt>
d2205 1
a2205 1
<hr>
d2222 5
a2226 5
<B><FONT SIZE="4"><a name="mods">Recent modifications:</a></FONT></B></P>
<UL>
    <LI>2012-07-31 -- <a href="../ctf2d.xml">SPIRE configuration file</a> updated. 
        Non-backwards-compatible changes for SPIRE v1.5.4 retained in <a href="../ctf2d.xml">ctf2d_spire154.xml</a></LI> 
    <LI>2012-07-19 -- the following batch files explicitly create necessary output directories: </LI> 
d2228 4
a2231 4
            <LI>lfc_pick.spi</LI>
            <LI>eman2spider.spi</LI>
            <LI>rewindow.spi</LI>
            <LI>numberparticles.spi</LI>
d2233 1
a2233 1
    <LI>2012-05-17 -- changed <I>X##</I> format registers to named registers for the following batch files:</LI>
d2235 6
a2240 6
            <LI>rewindow.spi</LI>
            <LI>recheck.spi </LI>
            <LI>goodparticlesbydf.spi </LI>
            <LI>eman2spider.spi </LI>
            <LI>combinegoodclasses.spi </LI>
            <LI>classify.spi </LI>
d2242 1
a2242 1
    <LI>2012-05-10 -- added options to spawn Gnuplot in the following:</LI> 
d2244 4
a2247 4
        <LI>goodpartsbymic.spi </LI>
        <LI>trapctf.spi </LI>
        <LI>histallcc.spi </LI>
        <LI>histgoodcc.spi </LI>
d2249 4
a2252 4
    <LI>2012-05-02 -- nat2stk.spi -- converts 
        <a href= "http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
        Nature Protocols data set</a> to a form usable here </LI> 
</UL>
d2254 1
a2254 1
<hr>
d2279 1
a2279 1
   <a href="http://www.wadsworth.org/spider_doc/spider/docs/techs/ctf/pfefferkorn.pdf">
d2326 1
a2326 1
<address>&copy; <a href="http://www.wadsworth.org/spider_doc/spider/docs/copyright.html">Copyright notice</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
@


1.12
log
@Typo in quick-start guide
@
text
@a30 1
<a name="Links">
a40 1
</a>
a90 1
<a name="Links">
a100 1
</a>
d1965 1
a1965 1
   Edit <a class="project" href="../Refinement/refine_settings.spi">refine-settings.spi</a>, 
d2321 1
a2321 1
Page updated: 2012/08/01 &nbsp;&nbsp;&nbsp;
@


1.11
log
@Updated for multiple versions of SPIRE XML file
@
text
@d301 1
a301 1
    <LI>spider spi/dat @@histallccc</LI>
d2325 1
a2325 1
Page updated: 2012/07/31 &nbsp;&nbsp;&nbsp;
@


1.10
log
@updated modification date
@
text
@d439 13
a451 3
   <li> If using <font class="guitool">SPIRE</font>, it will create the necessary top level 
   directory and populate the directories with the current set of procedure files. </li>

d2228 2
a2236 1
    <LI>2012-07-19 -- <a href="../ctf2d.xml">SPIRE configuration file</a> updated </LI> 
d2325 1
a2325 1
Page updated: 2012/07/19 &nbsp;&nbsp;&nbsp;
@


1.9
log
@updated modifications log
@
text
@d2314 1
a2314 1
Page updated: 2012/06/22 &nbsp;&nbsp;&nbsp;
@


1.8
log
@Fixed confusing wording in new intro
@
text
@d2218 8
a2225 1
    <LI>2012-05-17 -- <a href="../ctf2d.xml">SPIRE configuration file</a> updated </LI> 
@


1.7
log
@Added paragraph comparing with and without defocus groups
@
text
@d47 2
a48 1
creating a 3D reconstruction from electron micrographs without defocus groups</a>. 
d2307 1
a2307 1
Page updated: 2012/06/19 &nbsp;&nbsp;&nbsp;
@


1.6
log
@Fixed a couple of old typos
@
text
@d20 1
a20 1
       Specimens using Reference Projections </h2>
d30 42
a71 2
<!-- --------------------- Outline ------------------------------------ -->
<h3 align="center">Outline</h3>
d73 11
a83 6
<p>This page describes methods for creating a 3D reconstruction of
a ribosome from electron micrographs. Once a set of particle images
has been obtained, an initial 3D reconstruction is calculated using
coarse projection angles. This is followed by refinement, which
iteratively adjusts the angles for finer resolution. The following
procedures are described in greater detail below.
d86 18
a103 1
<dl>
a109 2
<li> <a href="#Mods">Modifications log</a> -- Recent changes to the protocol.</li>

d154 2
d254 1
a254 1
<P>In <a href="#CreatingProject">toplevel directory (<I>e.g.</I>, <B>batch/</B>):</a></P>
d257 1
a257 1
    <LI>cd batch </LI>
a331 41
<a name="Mods"></a>
<table class="heading" width="100%" >
   <tr> <td>    <br />  
   <h3 class="heading">Modifications log</h3>
   
   <p class="explain">Not an exhaustive list.
   For a more complete list of changes, see individual batch files.</p>
   
   <P></P>
   
   </td> </tr>
</table>

<P>
<B><FONT SIZE="4"><a name="mods">Recent modifications:</a></FONT></B></P>
<UL>
    <LI>2012-05-17 -- <a href="../ctf2d.xml">SPIRE configuration file</a> updated </LI> 
    <LI>2012-05-17 -- changed <I>X##</I> format registers to named registers for the following batch files:</LI>
        <ul class="circles">
            <LI>rewindow.spi</LI>
            <LI>recheck.spi </LI>
            <LI>goodparticlesbydf.spi </LI>
            <LI>eman2spider.spi </LI>
            <LI>combinegoodclasses.spi </LI>
            <LI>classify.spi </LI>
        </ul>
    <LI>2012-05-10 -- added options to spawn Gnuplot in the following:</LI> 
      <ul class="circles">
        <LI>goodpartsbymic.spi </LI>
        <LI>trapctf.spi </LI>
        <LI>histallcc.spi </LI>
        <LI>histgoodcc.spi </LI>
      </ul>
    <LI>2012-05-02 -- nat2stk.spi -- converts 
        <a href= "http://www.wadsworth.org/spider_doc/spider/docs/protocol_download.html">
        Nature Protocols data set</a> to a form usable here </LI> 
</UL>

<hr>
<!-- ------------------- Running  SPIDER procedure files ------------------- -->

d449 1
a449 1
   This will create a directory called <i>batch/</i>, containing 
d451 2
a452 2
   <i>batch</i> to the name of your project directory, for example:<br />
   <code class="snippet">mv batch project</code> </li>
d665 1
a665 1
    <li> <a href="#PP97">Penczek et al. 1997</a> for a fuller discussion.           </li>
d1730 1
a1730 2
          <td> Backprojection method (<i>e.g.</i>, 2 for
          <a href="http://www.wadsworth.org/spider_doc/spider/docs/man/bp32f.html">'BP 32F'</a>).</td></tr> 
d1741 16
d1758 1
a1758 1
    <br>The procedures first create two particle selection doc files for each group 
d2155 8
a2162 1
   <tr><td>    <br /> <h3> Other Useful Methods </h3>  </td></tr>
d2199 41
d2269 6
d2306 1
a2306 1
Page updated: 2012/06/12 &nbsp;&nbsp;&nbsp;
@


1.5
log
@Forgot to change the modification date
@
text
@d338 1
a338 1
   but not both (unless you want to compare the two techniques!) <br />
d391 1
a391 1
  "sensible", ask an expert.</h4> 
d661 1
a661 1
   astigmatism, and cuttoff frequency using SPIDER operation 
d2216 1
a2216 1
Page updated: 2012/06/08 &nbsp;&nbsp;&nbsp;
@


1.4
log
@Used extraneous *'s in command-line notation for montagefromdoc call
@
text
@d2216 1
a2216 1
Page updated: 2012/05/23 &nbsp;&nbsp;&nbsp;
@


1.3
log
@changed iteration# to 2 digits, i.e., vol01 from vol001
@
text
@d608 1
a608 1
       <BR><code class="snippet">montagefromdoc.py ../sel_micrograph.dat sm-mic****.dat</code> <br>
d776 1
a776 1
       <BR><code class="snippet">montagefromdoc.py ../sel_micrograph.dat power/pw_avg****.dat</code> </li>
d1411 1
a1411 1
       <BR><code class="snippet">montagefromdoc.py summary-avgbyview.dat Avg/allavg???.dat</code> <BR>
@


1.2
log
@added link to archive of tarballs
@
text
@d1741 1
a1741 1
          <td> <font class="output">Groups/grp***/vol001_odd</font>: </td>
d1744 1
a1744 1
          <td> <font class="output">Groups/grp***/vol001_even</font>: </td>
d1747 1
a1747 1
          <td> <font class="output">Groups/grp***/vol001</font>: </td>
d1769 1
a1769 1
          <td> <font class="output">vol001</font>:                 </td>
d1782 1
a1782 1
   This reconstruction <font class="output">vol001</font> is known as 
d1857 2
a1858 2
   <font class="input">vol001_odd</font> and
   <font class="input">vol001_even</font>. It creates: <br />
d1862 1
a1862 1
          <td> <font class="output">docmatched_vol001</font>: </td>
d1877 2
a1878 2
   <font class="input">docmatched_vol001</font> and   
   <font class="input">vol001</font>. It filters the 
d1883 1
a1883 1
          <td> <font class="output">vol001_matched</font>: </td>
d1930 1
a1930 1
   <tr><td> <font class="input">../Reconstruction/vol001</font>: </td> 
@


1.1
log
@Initial revision
@
text
@d114 1
a114 1
  <li><a href="flowchart/flowchart.html">A flowchart of operations</a></li>
d121 4
a124 1
  <li> Download link for the 
d128 1
a128 1
  <li> A description of the
d2216 1
a2216 1
Page updated: 2012/05/22 &nbsp;&nbsp;&nbsp;
@
