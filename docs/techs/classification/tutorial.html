<html>
<head>
  <title> Clustering and Classification Tutorial</title>
  <link rel='stylesheet' href='tutstyle.css' type='text/css' />
</head>


<body>
<br />
<p> <h1 align="center">Clustering and Classification Tutorial</h1> </p>

<hr />
 
<p>  <h3 align="center">Contents </h3> </p>

<p>
<ol>
   <li><a href="#source"> Source Data Set                                       </a>.</li>
   <li><a href="#CAPCA">  Correspondence or Principal Component Analysis        </a>.</li>
   <li><a href="#histo">  Determine what Factors are Attribute or Noise based   </a>.</li>
   <li><a href="#fm">     Create Factor Maps                                    </a>.</li>
   <li><a href="#clhc">   Controlled Clustering and Hierarchical Classification </a>.</li>
   <li><a href="#other">  Other Classification Methods                          </a>.</li>
   <li><a href="#analyze">View and Analyse Dendrograms                          </a>.</li>
   <li><a href="#recon">  Re-create certain images from eigenvectors            </a>.</li>
   <li><a href="#virtual">Create "virtual" images from eigenvectors             </a>.</li>
   <li><a href="#web">    View factor map and create class averages using Web   </a>.</li>
   <li><a href="#ref">    References                                            </a>.</li>
</ol>
</p>

<!-  xxxxxxxxxxxxxxx Clustering/Classification - Summary of Steps  xxxxxxxxxxxx  ->
<hr />

<p> <h4> Clustering/Classification - Summary of Steps </h4> </p>

<p> A note about "cluster" vs "class" terminology.  It seems natural to call the group of 
    points seen on a factor map a "cluster".  Likewise, it seems natural to call the group of
    images denoted by those points a "class".  However the boundary between "cluster" and
    "class" is fuzzy so both terms have been, and continue to be, used almost interchangably 
    in the field. </p>
 
<ol>
<li>Carry out CORAN or PCA 
   <ul><li>
      Create Orthogonal Vectors
      <dl>
        <dt>Run: <a href="../../man/cas.html">'CA S' </a> </dt>
        <dd>Reads images.                                 </dd>
        <dd>Carries out either PCA or CORAN analysis.     </dd>
        <dd>Creates data files that are input for following steps.</dd>
      </dl>
   </li></ul>
</li>	
<p />

<li>Determine Which Factors Are Important
   <ul>
       <li>Map Factors  

       <dl>
         <dt>Run: <a href="../../man/casm.html">'CA SM' </a>             </dt>
         <dd>Uses output from: <a href="../../man/cas.html">'CA S'</a>   </dd>
         <dd>Creates factor (vector) map of data: images, pixels, or eigenvectors </dd>
       </dl>
       </li>
       <p />

       <li>Clustering/Classification  <br />
           Uses output from: <a href="../../man/cas.html">'CA S' </a>. 

         <dl>
           <dt>Run: <a href="../../man/clhc.html">'CL HC' </a>  
           <dd>Finds clusters/classifies data using  single linkage, complete linkage,
               average linkage, the centroid method, or Ward's method and HAC. </dd>
           <dd>Creates dendrogram doc file, and dendrogram plot.               </dd>

           <dt>Run an <a href="./ca-otherops.html">alternative classification method</a>: 
                   <a href="../../man/clcla.html">'CL CLA'</a> &nbsp; or &nbsp;
                   <a href="../../man/clkm.html"> 'CL KM' </a>     </dt>
           <dd>Find clusters/classes.                              </dd> 
           <dd>Creates a dendrogram or class membership doc. file. </dd>
         </dl>
       </li>

       <p />

       <li>View and Analyse Dendrograms.                         <br />
         Uses dendrogram doc files from 
              <a href="../../man/clhc.html"> 'CL HC' </a> or 
              <a href="../../man/clcla.html">'CL CLA' </a>. 

         <dl>
           <dt>Run: <a href="../../man/clhd.html">'CL HD' </a>  </dt>   
           <dd>Counts number of classes and images 
               in each class, for a given threshold.            </dd>

           <dt>Run: <a href="../../man/clhe.html">'CL HE' </a>  </dt>   
           <dd>Creates doc files describing which images are 
               in each class for a given threshold.             </dd>

           <dt>Use: <a href="https://spider-em.github.io/Web/docs/web.html">Web </a> to 
              View dendrogram and average images.               </dt>
           <dd>Creates view containing average images for 
               each class at a specifed threshold.              </dd>
         </dl>
       </li>

       <p />
       <p />
    </ul>

   </li>

   <li>Analyse Eigenimages <br />
    Uses output from: <a href="../../man/cas.html">'CA S'</a>   

    <ul>
    <li>
      <dl>
        <dt>Run: <a href="../../man/casr.html">'CA SR' </a>  </dt>   
        <dd>Reconstitute images from eigenvalues & create "virtual" 
            image from arbitrary eigenvector values           </dd>
      </dl>
    </li>
    <p />

    <li>
      <dl>
        <dt>Run: <a href="../../man/casd.html">'CA SD' </a>  </dt>   
        <dd>Create difference eigenimages.                   </dd>
      </dl>
    </li>
    <p />

    <li>
      <dl>
        <dt>Run: <a href="../../man/casri.html">'CA SRI' </a> </dt>   
        <dd>Reconstitute importance images.                   </dd>
      </dl>
    </ul>
    <p />

   </li>
   </li>

   <li><a href="https://spider-em.github.io/Web/docs/web.html">View Factor maps</a> 
   <ul>
     <li>View the factor map and create arbitrary average images </li>
     <p />
   </ul>
</ol>   


<hr />

<!-  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  Source Data Set xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx ->

<a name="source"></a> 
 
<h4 align="left">Source Data Set</h4>

<p />
   SPIDER procedures: <a href="makefaces.spi">makefaces.spi</a> (and the
                      <a href="face.spi">face.spi</a> 
   procedure which it calls) were used to create the eight
   original faces below. These faces differ in three ways: oval vs. round
   head, left vs. right eyes, and big vs. small mouth. Ten copies of each
   face with random noise form the sample data set. 
   These procedure files create four SPIDER image stack files. 

   <table class="outs" cellpadding="4">
      <tr><th> </th> <th>Name</th>  <th>Contents</th> <th></th> <tr>

      <tr valign="top"><td>&curren;</td>
          <td><i>face_tmpl_stk</i></a> </td>
          <td>&nbsp;  Face templates</td> 

     <tr valign="top"><td>&curren;</td>
          <td><i>face_nois_stk</i></a> </td>
          <td>&nbsp;  Noisy faces </td> 
 
     <tr valign="top"><td>&curren;</td>
          <td><i>face_aver_stk</i></a> </td>
          <td>&nbsp;  Average of the ten noisy face images for each template </td> 

     <tr valign="top"><td>&curren;</td>
          <td><i>face_varn_stk</i></a> </td>
          <td>&nbsp; Variance of the ten noisy face images for each template </td> </tr>
   </table>
<p />
<p />

   <table align="center" cellpadding="4">
     <tr> <td><img width="557" height="143" src="save/16faces.gif"><td><tr>
     <tr> <th>Face Templates    </th>   <tr>
     <tr> <th>Sample Noisy faces</th>   <tr>
   </table>
<p />

<!-  xxxxxxxxxxxxxxxxxxxxxxxxxxxx  Correspondence Analysis...  xxxxxxxxxxxxxxxxxxxxxx - ->
<hr />

<p />
<a name="CAPCA"></a>

<h4> </a>Correspondence Analysis (<i>CA</i>) or 
         Principal Component Analysis (<i>PCA</i>)</h4>
<p />

<i>CA</i> is the preferred method of finding inter-image variations and we will
   principally be discussing inter-image variance. <i>PCA</i> computes the
   distance between data vectors with Euclidean distances, while <i>CA</i> uses
   Chi-squared distance. <i>CA</i> is superior here because it ignores differences
   in exposure between images, eliminating the need to rescale between
   images.                                                            <br />
<p />
   The procedure: <a href="cas.spi">cas.spi</a> creates a 
   mask and invokes 
   <a href="../../man/cas.html">'CA S'</a> assuming you want to run <i>CA</i>. 
<p />

<p>
Hints for: <a href="../../man/cas.html">'CA S'</a> <br/>

<ul>
   <li>The "Number of factors" requested should be larger than the 
       expected number of variations. This is to see the characteristic slope 
       of noise after the "useful" eigenvalues. Typically 10 should be 
       more than enough for our example, but see 
       <a href="../../man/cas.html">'CA S'</a> for more detail. </li>

    <li>"Output file prefix" names all output files. A "cas_ca" entry will 
       result in "cas_ca_IMC", "cas_ca_PIX", etc. </li>
</ul>


<p>  Output files from <a href="../../man/cas.html">'CA S'</a> and <a href="cas.spi">cas.spi</a>:

   <table class="outs" cellpadding="4">
      <tr><th> </th> <th>Name</th> <th>Contents</th> <th>File type</th><tr>

      <tr valign="top"><td>&curren;</td>

          <td><a href="save/cas_ca_IMC.dat"><i>cas_ca_IMC</i></a> </td>
          <td> Coordinates of each IMAGE in the new vector space. </td> 
          <td> <a href="cas_format.html">Text</a>                 </td> </tr>

      <tr valign="top"><td>&curren;</td>
          <td><a href="save/cas_ca_PIX.dat"><i>cas_ca_PIX</i></a> </td>
          <td>Coordinates of each PIXEL in the new vector space.  </td> 
          <td> <a href="cas_format.html">Text</a>                 </td> </tr>

      <tr valign="top"><td>&curren;</td>
          <td><a href="save/cas_ca_EIG.dat">cas_ca_EIG</a> </td>
          <td>Eigenvector values.                          </td> 
          <td> <a href="cas_format.html">Text</a>          </td> </tr>

      <tr valign="top"><td>&curren;</td>
          <td>cas_ca_SEQ </td>
          <td>Image pixel values within the mask from all the images.     <br />
          Only useful internally within other 'CA' &amp; 'CL' operations. </td> 
          <td> <a href="cas_format.html">Binary</a>                       </td> </tr>

      <tr valign="top"><td>&curren;</td>
          <td>cas_ca_SET </td>
          <td>Transposed data.                                               <br />        
              Only useful internally within other 'CA' &amp; 'CL' operations.</td>  
          <td> <a href="cas_format.html">Binary</a>                          </td> </tr>

  
      <tr valign="top"> <td></td>  <td></td> 
          <td> In addition to the  
          <a href="../../man/cas.html">'CA S' </a>output files, 
          <a href="cas.spi">           cas.spi</a> creates:                  </td> </tr> 

 
      <tr valign="top"><td>&curren;</td>
          <td><div class="output">face_mask.spi</div>   </td>
          <td>User-defined circular mask.               </td> 
          <td>SPIDER <br />image</td>                   </tr>

      <tr valign="top"><td>&curren;</td>
          <td><div class="output"> <a href="save/cas_ca_cor_doc.dat">cas_ca_cor_doc.dat</a></div></td>
          <td>List of eigenvectors for each 
              image for factors 1 and 2.  </td>
          <td>SPIDER <br />document</td>   </tr>
</table>
 
<!-  xxxxxxxxxxxxxxxxxxxxx   Which Eigenvalues Are Useful   xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  ->
<hr />

<a name="histo"></a>  

<img src="save/cas_ca_eigpct.jpg" align="right">

<p>

<h4> Determining Which Eigenvalues Are Useful, And Which Are From Noise</h4>

</p>The best method to determine what eigenvalues are useful, 
   and which are from noise is 
   to view a histogram showing the percentage of eigenvalue variance accounted for by 
   each factor.  As the histogram to the right shows, the last 
   five eigenvalues are small compared to the first three. Also their height is level, 
   typical of noise.  This is interpreted as the first three eigenvectors 
   control more inter-image variance than the last five.</p>

<p />
   The procedure: <a href="caeigpct.spi">caeigpct.spi</a> invokes 
   <a href="../../man/canoise.html">'CA NOISE'</a> 
   to create and plot an eigenvalue histogram.  Output files:

   <table class="outs" cellpadding="4">

      <tr valign="top"><td>&curren;</td>
          <td><div class="output"> <a href="save/cas_ca_eigpct_doc.dat">cas_ca_eigpct_doc</a></div>:</td>
          <td>A SPIDER document file listing eigenvalues and  
          the percentage of variance accounted for by each factor.</td> </tr>

      <tr valign="top"><td>&curren;</td>
          <td><div class="output"> <a href="save/cas_ca_eigpct.gnu">cas_ca_eigpct.gnu</a></div>:</td>
          <td>A Gnuplot file to plot the histogram.</td> </tr>

      <tr valign="top"><td>&curren;</td>
          <td><div class="output"> <a href="save/cas_ca_eigpct.ps">cas_ca_eigpct.ps</a></div>:</td>
          <td>A Postscript file containing the histogram.</td> </tr>
   </table>
<p />

   The <a href="save/cas_ca_eigpct.gnu">Gnuplot Histogram</a> can be visualized using:
            <b>gnuplot -persist save/cas_ca_eigpct.gnu </b> 
<p />
   The <a href="save/cas_ca_eigpct.gnu">Postscript Histogram</a> can be visualized using:
            <b>evince save/cas_ca_eigpct.ps             </b> 
       
 <p />

<!-  xxxxxxxxxxxxxxxxxxxx Creating Factor Maps to View Clusters xxxxxxxxxxxxxxxxxxxxxxxxxxx  ->
<hr />

<a name="fm"></a>

<h4><p>Creating Factor Maps to View Clusters</h4></p>

<p>Once we know which eigenvectors have some meaning 
   and which are from noise, we can use the output from <a href="#CAPCA">CA S</a>
   for clustering.
   The <a href="../../man/casm.html">'CA SM'</a> operation creates 
   2D factor maps (graphs) of selected pairs of factors  
   to visualize clustering (if any).</p> 


<p>The procedure: <a href="factor.spi">casm.spi</a> invokes 
   the SPIDER procedure: <a href="factor_casm.spi">factor_casm.spi</a> 
   three times, creating three
   different factor maps using <a href="../../man/casm.html">'CA SM'</a>
   for different pairs of factors. 'CA SM' is  run under 
   the assumptions that you want image space with "ID's" to create 
   PostScript plots.</p>

</p>

Hints for: <a href="../../man/casm.html">'CA SM'</a>

<ul>
  <li>Input for: "IMAGE OR PIXEL COORDINATES" should almost always be "I", 
      unless you are interested in "the images changing around the 
      pixels". This determines if 'CA SM' will read the 
      <i>*_PIX or *_IMC file</i>. </li>

  <li>"File prefix" is the name entered for the "Output file prefix" 
      in 'CA S'. </li>

  <li>"NUMBER OF HORIZONTAL PATCHES"  Usually zero, UNLESS 
      this particular CORAN analysis was done on a set of correlation 
      patch averages. </li>

  <li>"(S)YMBOL, (A)SSIGN SYMBOL, (C)LASS, (D)OC, (I)D", 
      "ID" is typically the best choice. </li>

  <li>"PREPARE POSTCRIPT FILE FOR MAP" should usually be yes, unless you 
      prefer an ASCII map like 
      <a href="save/ascii12.dat">ascii12.dat</a>. </li>

  <li>"FLIP #1" exchanges the map left-right. 
      "FLIP #2" exchanges the map up-down." </li>

  <li>Everything after "Postscript output file" can generally 
       be left as default values.  </li>

  <li>If you get an: "ERROR: *** MAP ABORTED, MORE THAN 264 POINTS ON FRAME" 
       message, this is due to a large number of points. 
       Overcome this by increasing the scale of the factor map by
       increasing the value given for ".NUMBER OF SD (OR &le;CR&gt;= 2.3)". </li> 

  <li> The SPIDER <a href="save/clcla_results.dat">results</a> file  
        holds a large amount of other useful information after a 
        <a href="../../man/casm.html">'CA SM'</a> run.</li>
</ul>


<p>The three factor maps below were created from image (<i>IMC</i>) factor
   maps  using GNUplot. Postscript files are similar.</p>

   <table cellpadding="4">

      <tr>
      <td>  <img src="save/plot12.jpg">Factor 1 vs. Factor 2 </a></td>
      <td>  <img src="save/plot13.jpg">Factor 1 vs. Factor 3 </a></td>
      <td>  <img src="save/plot23.jpg">Factor 2 vs. Factor 3 </a></td>
      </tr>

      <tr>
      <th> <a href="save/plot12.gif">Factor 1 vs. Factor 2</a></th>
      <td> <a href="save/plot13.gif">Factor 1 vs. Factor 3 </a></th>
      <td> <a href="save/plot23.gif">Factor 2 vs. Factor 3 </a></th>
      </tr>
    </table>

<p>'CA SM' also works for pixel factor maps (<i>_PIX</i>)as well. 
    The pixel factor maps below were created from a screen  
   snapshot. The large number of pixels located in the 
   center show that most pixels vary little if at all between 
   eigenvectors. </p>

   <table cellpadding="4">
      <tr>
      <td> <a href="save/1vs2pix.gif"> <img src="save/1vs2pix.jpg" </a></td>
      <td> <a href="save/1vs3pix.gif"> <img src="save/1vs3pix.jpg" </a></td>
      <td> <a href="save/2vs3pix.gif"> <img src="save/2vs3pix.jpg" </a></td>
      </tr>

      <tr>
      <th align="center"> <a href="save/plot12.gif">Factor 1 vs. Factor 2 </a></th>
      <th align="center"> <a href="save/plot13.gif">Factor 1 vs. Factor 3 </a></th>
      <th align="center"> <a href="save/plot23.gif">Factor 2 vs. Factor 3 </a></th>
      </tr>
    </table>

</p>

<!-  xxxxxxxxxx Controlled Clustering and Hierarchical Classification - Using 'CL HC' xxxxxxxxxxxx ->
<hr />

<a name="clhc">

<h4>Controlled Clustering and Hierarchical Classification - Using 
    <a href="../../man/clhc.html">'CL HC'</a></h4>

<p>With the "useful" eigenvectors known, we can more efficiently 
   determine the representative clusters. 
   Classification also allows compression of information with minimal loss.  
   The <a href="../../man/clhc.html">'CL HC'</a> operation usually gives 
   robust clustering because the user can control the clustering criterion 
   and can alter the "weights" for each factor.</p>

<p>The procedure: <a href="clhc.spi">clhc.spi</a> invokes  
   <a href="../../man/clhc.html">'CL HC'</a>
   which reads the <i>CA/PCA</i> files from 
   <a href="../../man/cas.html">'CA S'</a> and creates
   a dendrogram document file and dendrogram plot file.
</p>

Hints for: <a href="../../man/clhc.html">'CL HC'</a> 
<ul>
   <li>"CORAN/PCA FILE" is the name of the file from 
       <a href="../../man/cas.html">'CA S'</a>. 
       The 'CL HC' operation can accept <i>_IMC, _SEQ, or _PIX</i>  files. 
       So this entry must include one of these endings to distinguish the kind of file.</li> 

   <li>"FACTOR WEIGHTS" influence the clustering and the dendrograms. 
       The larger the weight, the more importance a factor has as compared 
       to the other factors. 
       To best represent the "truth" set all factor weights equal to each other.
       to the other factors. Zero sets all the remaining factors to 1.0.</li>

   <li>"CLUSTERING CRITERION".  Option 5 is the same method 'CL CLA' uses.</li>

   <li>A The output "DENDROGRAM DOC FILE" can be used with 
         <a href="https://spider-em.github.io/Web/docs/web.html">Web</a> 
         to produce dendrograms with cluster averages. It is also used with the
         <a href="../../man/clhd.html">'CL HD'</a> and 
         <a href="../../man/clhe.html">'CL HE'</a> 
         operations to create document files listing
         the images assigned to each cluster.</li>
</ul>

<p>Screen snaphots of the dendrograms from 
     <a href="../../man/clhc.html">'CL HC'</a>
    for our face data set using clustering option 2 (complete linkage) 
    and option 5 (Ward's method) &nbsp; (Click to see full-size):</p>

<p><table align="center"cellpadding="4">
      <tr>
      <td> <a href="save/clhc_den_2.jpg"> <img src="save/clhc_den_2_sm.jpg" </a></td>
      <td> <a href="save/clhc_den_5.jpg"> <img src="save/clhc_den_5_sm.jpg" </a></td>
      </tr>

      <tr>
      <th> <a href="save/clhc_den_2.jpg">Complete linkage</a></th>
      <th> <a href="save/clhc_den_5.jpg">Ward's method   </a></th>
      </tr>
    </table>
</p>


<p>Dendrogram <i>doc</i> files affiliated with the above dendrograms: 

   <table align= "center" cellpadding="4">
      <tr>
      <td> <a href="save/clhc_den_2_doc.jpg"> <img src="save/clhc_den_2_doc.jpg" </a></td>
      <td> <a href="save/clhc_den_5_doc.jpg"> <img src="save/clhc_den_5_doc.jpg" </a></td>
      </tr>

      <tr>
      <th> Complete linkage doc</th>
      <th> Ward's method doc   </th>
      </tr>
    </table>

<p />



<!-  xxxxxxxxxxxxxx Other Classification Alternatives xxxxxxxxxxxxxxx - ->

<hr />

<a name="other">

<h4>Other Classification Alternatives -  Using 
    <a href="../../man/clcla.html">'CL CLA'</a> or
    <a href="../../man/clkm.html"> 'CL KM' </a> </h4>

<p>Alternative automatic classification methods using 
    <a href="../../man/clcla.html">'CL CLA'</a>, 
    which is less controllable, and  
    <a href="../../man/clkm.html"> 'CL KM' </a>, 
    which may give spurious classes, are discussed in detail 
   <a href="./ca-otherops.html">elsewere</a>. These operations may be 
   usefull for  other classification applications, including classification
   using the <i>_PIX</i> files.



<!-  xxxxxxxxxxxxxx View and Analyse Classification Maps and Dendrograms  xxxxxxxxxxxxxxxx ->

<hr />

<a name="analyze">

<h4>View and Analyse Dendrograms </h4>

<p>In a dendrogram a the junction of a vertical and horizontal line 
   the joining of two classes below it. A representative  
   reconstruction can be formed for each class with the  
   <a href="../../man/casr.html">'CA SR'</a> operation. 
   The larger vertical bars signify a greater difference between 
   classes. The many small differences at the bottom can be eliminated 
   with an increase of the "% cutoff" setting. 
   (<small>The <i>jpg</i> file was obtained using screen snapshot.</small>) 
</p>


<p>The operation <a href="../../man/clhd.html">'CL HD'</a> 
   uses the dendrogram document file from 
   <a href="../../man/clhc.html"> 'CL HC'</a> or
   <a href="../../man/clcla.html">'CL CLA'</a> to create 
   a <a href="save/clhc_den_clas.dat">
   document file</a> listing how many classes there 
   for a given threshold and how many images there are in each class. 
   This operation is similar 
   to viewing the dendrogram in 
   <a href="https://spider-em.github.io/Web/docs/web.html">Web</a>, 
   setting a threshold, and recording 
   the number of images and the number above each image.</p>


<p>The operation <a href="../../man/clhe.html">'CL HE'</a> 
   uses the dendrogram doc file from 
   <a href="../../man/clhc.html">'CL HC'</a> or
   <a href="../../man/clcla.html">'CL CLA'</a> to create 
   a series of class selection doc. files 
  (e.g. <a href="save/clhc_den_clas_001.dat">clhc_den_clas_001</a>) ,
  which lists the images which are assigned to each ot the classes.</p>

<p>The procedure: <a href="clhe.spi">clhe.spi</a> invokes  
   <a href="../../man/clhd.html">'CL HD'</a>,
   <a href="../../man/clhe.html">'CL HE'</a>, and then  
   <a href="../../man/asr.html">'AS R'</a> to threshold the dendrogram 
   produced by  'CL HC' at a theshold of 66%, then average together the
   20 images in each of the resulting classes.
   The class averages are then placed in a SPIDER image montage:
   <a class="output">clhc_clas_montage.spi</a>

   <table align= "center"  cellpadding="4">
      <tr>  <td> <img src="save/clhc_clas_montage.jpg" </a>  </td> </tr>

      <tr>  <th> Class Montage (Threshold=60%)</th> </tr>
    </table>

 The face images are classified  perfectly according to head shape and eye direction.</p>



<p><a href="https://spider-em.github.io/Web/docs/web.html">Web</a>
   can be used to view a dendrogram from  
   <a href="../../man/clhc.html">'CL HC'</a> or 
   <a href="../../man/clcla.html">'CL CLA'</a>.

   <a href="https://spider-em.github.io/Web/docs/web.html">Web</a> will display 
   not only a usual dendrogram, but it also can annotate the dendrogram
   with the average images of all the images below a given threshold, 
   and note the number of images in each average.                 <br />

   The document file: <a href="save/den_doc.dat">den_doc.dat</a> 
   is an example of a dendrogram document file. 
</p>

How To Use The <a href="https://spider-em.github.io/Web/docs/web.html">Web</a> Dendrogram 
<ol>
   <li>Run <a href="../../man/clhc.html">'CL HC'</a> or 
           <a href="../../man/clcla.html">'CL CLA'</a> and create a 
   <a href="save/web_den_doc.dat">dendrogram doc file</a> .</li>

   <li>it's easier if  your image files and <i>dendrogram doc file</i> have 
       the same extension and are in the same directory. </li>

   <li>Start <a href="https://spider-em.github.io/Web/docs/web.html">Web</a> with your extension 
       (i.e."<a href="https://spider-em.github.io/Web/docs/web.html">Web</a> dat &") and select 
       Command -> image from the menus to navigate to where the images and 
       cluster files are. Press "OK". </li>

   <li> Select Commands -> Dendrogram and then select the cluster file.</li>

   <li>When the Dendrogram window pops up, to see all of what 
       you selected, choose lowest threshold option. All the 
       variation that was carried over from the 'CL HC' or 'CL CLA' operation is 
       scaled from what the lowest level selected  to +1 above.</li> 

   <li>If the "Show average images" option is selected, Web will 
       show the average of the lowest level shown. This is the 
       reason for having the images in the same folder as the dendrogram doc file.</li>
</ol>

</p>

<p>Screen snapshot of <a href="https://spider-em.github.io/Web/docs/web.html">Web</a>
  display of the complete linkage dendrogram truncated at 20% level. 
  Note that all of the images are properly separated by head shape and eye 
  direction. Mouth size is not so clear because it's eigenvalue is 
  close to the eigenvalue for noise (Click to see full-size):

   <table align= "center"  cellpadding="4">
      <tr>
      <td> <a href="save/web_clhc_den_2.jpg"> <img src="save/web_clhc_den_2_sm.jpg" </a></td>
      </tr>

      <tr>
      <th> <a href="save/web_clhc_den_2.jpg">Dendrogram snapshot</a></th>
      </tr>
    </table>
<p />




<!-  xxxxxxxxxxxxxx Re-Create Images From Eigenvectors xxxxxxxxxxxxxxxxxxxx - ->

<hr />
<a name="recon">

<h4>Re-Create Images From Eigenvectors - Using <a href="../../man/casr.html">'CA SR'</a> </h4>

<p>Re-creation of sample images from eigenvectors can eliminate 
   the noise in the reconstituted image, this also results in large data 
   compression. </p>

<p>The procedure: <a href="casr.spi">casr.spi</a> 
   invokes <a href="../../man/casr.html">'CA SR'</a>
   to re-constitute any image, or images, from the eigenvectors. </p>

Hints for: <a href="../../man/casr.html">'CA SR'</a> 

<ul>
   <li>"FILE PREFIX" is the response given for the "output file prefix" 
       question from 'CA S'.                                  </li> 

   <li>"FILE #'S TO BE USED" = file numbers of images.        </li>

   <li>"FACTORS TO BE USED" stands for which factors to be 
       utilized in the reconstitution.                        </li>

   <li>"OUTPUT FILE TEMPLATE" needs at least one <i>*</i> at the end 
       or it aborts program.                                  </li>
</ul>


<p>Below, is an single image from our sample data set and four 
   separate reconstructions using the first four eigenvectors. 
   (<small>The "halo" of noise and dark corners is a result of the masking 
   function in the procedures: 
   <a href="face.spi">face.spi</a> and 
   <a href="makefaces.spi">makefaces.spi</a>) 
   which were used to create the noisy face sample data. </small>)
   It is difficult to see what traits the original image has because of noise. 
   With the first three single eigenvalue reconstructions we can see that 
   it has an oval head, with eyes looking left, and a small mouth. The 
   fourth eigenvector does not "add" anything to our knowledge of the 
   image because there are only three attributes that carry information. 
   Therefore the fourth carries only noise. </p>

<p align=center><img src="save/casr_69.jpg"> </p>

<p>Below is the sample image again, and a reconstruction from the 
   first three eigenvectors combined. The image is from the 69'th  
   prototype image shown in the source data area.</p>

<p align =center> <img src="save/casr_69_1-3.jpg"> </p>


<p>Below we have the same "protoimage" images used to create the 
   source data, a sample image from each protoimage,and we also have 
   re-created the noisy samples using each eigenvector. The first row 
   is the protoimages used to create the 80 sample images, and the 
   second row consists of a sample image created from the protoimage 
   above it. The third row is each sample image re-created with only 
   the first eigenvector used. The next row includes the second 
   eigenvector, and the last includes all relevant eigenvectors.

<p align=center><img width="557" height="350" src="save/40faces.jpg"> </p>

<!-  xxxxxxxxxxxxxx Create Arbitrary "Virtual" Images.. xxxxxxxxxxxxxxxxxxxx - ->

<hr />
<a name="virtual">
<h4>Create Arbitrary "Virtual" Images From Eigenvectors</h4>

<p>The operation: <a href="../../man/casra.html">'CA SRA'</a>
   can create images or pixels that were not actually 
   captured, using eigenimages. To do this, the eigenvalues must 
   be given. This can be useful to interpolate images 
   in between classes.
</p>

<p>To choose what values to use for eigenvalues, use the 
   <a href="#fm">factor maps</a>.  If you try to use a value 
   outside the range of values for an eigenvalue, the results 
   will be difficult to predict and interpret.
</p>

<p>The procedure: <a href="casra.spi">casra.spi</a> 
   invokes 'CA SR'.</p>


Hints for: <a href="../../man/casra.html">'CA SRA'</a> 
<ul>
   <li>To determine coordinate values, consult a factor map.</li>
   <li>Do not assume that a zero will fill the rest of the 
       factor values to zero.                               </li>
   <li>"FILE PREFIX" is the response given for the "output file prefix" 
       question from 'CA S'.                                  </li> 

   <li>"FILE #'S TO BE USED" = file numbers of images.        </li>

   <li>"FACTORS TO BE USED" stands for which factors to be 
       utilized in the reconstitution.                        </li>

   <li>"OUTPUT FILE TEMPLATE" needs at least one <i>*</i> at the end 
       or it aborts program.                                  </li>
</ul>


<p>The images for eigenvector 1 equal to -0.1 and 0.1 are 
   shown in the first two images. They "make sense" in that this 
   vector controls headshape only. These values were chosen because 
   they are the most extreme values shown on the factor maps.
   But the images for eigenvector 1 equal to -1 and 1,the last 
   two images, do not represent "extreme" roundness like one 
   might think. This is because these values are outside the range 
   that they actually exist, i.e. the factor maps.
</p>

<p align=center>
   <img width="64" height="64" src="save/casra_0-6.jpg">
   <img width="64" height="64" src="save/casra_0-7.jpg">
   <img width="64" height="64" src="save/casra_0-2.jpg">
   <img width="64" height="64" src="save/casra_0-3.jpg">
</p>

<p>The following virtual images were created by changing only one 
   eigenvalue at a time from -0.2 to 0.2 at regular intervals. 
   The top row is eigenvalue one, and the bottom row 
   eigenvalue three. Along each row all other eigenvalues 
   were held to zero. The center column is identical 
   because it is at this point that the varrying 
   eigenvalues are equal to zero. Reconstitution with all 
   eigenvalues set to zero is equivalent to reconstiting 
   the average of the series. If reconstitution of each 
   indiviual eigenvalue had progressed to one, the result 
   would be the first three images directly above. 
   Reconstitution of the three eigenvalues together will result 
   in the fourth image above.
</p>

<p>The procedure: 
   <a href="casramontage.spi">casramontage.spi</a> 
   was used to assemble the montage: <br/>

<p align=center><img src="save/casra_18fade.jpg"></p>

<p />

<!-  xxxxxxxxxxxxxxxxxxxxxxxxxxx Viewing Eigenimages xxxxxxxxxxxxxxxxxxxxxxxx  ->
<hr />

<h4>Viewing Eigenimages</h4>

<p>The operation:  <a href="../../man/casre.html">'CA SRE'</a>
   creates eigenimages from 'CA S' outputs. With eigenimages, the user can easily 
   see what the computer has determined as the factors to 
   classify images by.
</p>

<p>The procedure:<a href="casre.spi">casre.spi</a> 
   invokes 'CA SRE'. It assumes that if you want more 
   than one factor, they are continuous. Also assumes that you 
   are using CORAN output. Both of these assumptions are in 
   the procedure file, not the operation. Edit the procedure 
   file to change them.
</p>

Hints for: <a href="../../man/casre.html">'CA SRE'</a> 
<ul>
  <li>None, see the manual page.</li>
</ul>

<p>Sample results:</p>

<p align=center><img width="64" height="64" src="save/casre_01.jpg">
                <img width="64" height="64" src="save/casre_02.jpg">
                <img width="64" height="64" src="save/casre_03.jpg">
                <img                        src="save/casre_01to03.jpg"></p>
<p />

<!-  xxxxxxxxxxxxxx Show Differences Between Images (Eigenimages) xxxxxxxxxxxxxxxxxxxx  ->

<hr />
<a name="diff">

<h4>Show Differences Between Images (Eigenimages)</h4>

<p> Use the <a href="../../man/casrd.html">'CA SRD'</a> operation  
   to see the different eigenimages that are used to recreate images.</p>

<p>The procedure: <a href="casrd.spi">casrd.spi</a> invokes
   'CA SRD'.  Note that it is similar to 
   <a href="casr.spi">casr.spi</a> except for minor changes. 
</p>


<p>Hints for: <a href="../../man/casrd.html">'CA SRD'</a></p> 

<ul>
   <li>"PREFIX" is the base name before <i>_SEQ, _IMC, _PIX,</i> etc.</li>
   <li>An entry out of bounds has no useful purpose.                 </li>
   <li>See hints for 'CA SR' above.                                  </li>
</ul>



<p>The first image below is the average of all 80 noisy sample face images. 
   The next three are the difference image for each useful 
   eigenvector for one image. The dark slivers in the first 
   eigenvector image show that in order to obtain the correct head 
   shape for this image, we must add black to either side of 
   the face. Similarily, for the eyes we would make the left side 
   of each eye socket brighter, and the right side darker. From 
   the fourth image this image has a wide mouth . <br/>
<p align=center><img width="64" height="64" src="save/face_avg_all.jpg">
                <img width="64" height="64" src="save/casrd_1_69.jpg">
                <img width="64" height="64" src="save/casrd_2_69.jpg">
                <img width="64" height="64" src="save/casrd_3_69.jpg">
</p>


<br/>Below are the separate difference eigenimages for another 
   image, as well as the combination of all three. This image has 
   the opposite of every trait of the image represented above. 
   We can tell because of white slivers on a dark background, 
   right-hand side of the eyes light, etc. The last image below 
   is the composite of the first three eigenimages.</p>
<p align=center><img width="64" height="64" src="save/casrd_4_19.jpg">
                <img width="64" height="64" src="save/casrd_5_19.jpg">
                <img width="64" height="64" src="save/casrd_6_19.jpg">
                <img width="64" height="64" src="save/casrd_8_19.jpg">
</p>

<p>Below is the average of all the images as well as the composite 
   difference eigenimage from above. When we add (superimpose) 
   these together we get the third image, a re-creation of the 
   original sample image. However, the re-creation has no noise. 
    This is because we only used the first three eigenimages. If we 
   included the other five, then we would have re-created the sample 
   image, with noise.</p>

<p align=center><img width="64" height="64" src="save/face_avg_all.jpg">
                <img width="64" height="64" src="save/casrd_8_19.jpg">
                <img width="64" height="64" src="save/casrd_1_2_3.jpg">
</p>


<!-  xxxxxxxxxxxxxx Subgrouping images xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx - ->

<hr />

<h4>Subgrouping Images Using <a href="../../man/casmi.html">'CA SMI'</a></h4>

<p> The operation <a href="../../man/casmi.html">'CA SMI'</a> 
   can be used to separate a series of images into active/inactive clusters. 
   It appears that this can actually perform operations on a series of images 
   using the 'CA S' files from another series. This has not 
   been tested. If the images used in 'CA SMI' will be used 
   with their 'CA S' run, it is a good idea to create a Postscript 
   map before running 'CA SMI' for comparison later. 
</p>

<p>The procedure: <a href="casmi.spi">casmi.spi</a> invokes 'CA SMI'. </p>

<p>Hints for: <a href="../../man/casmi.html">'CA SMI'</a></p> 

<ul>
   <li>Only supports image input and <i>_IMC</i> output?         </li>

   <li>If using images with their "native" 'CA S run', be sure to compare
      the Postcript maps of before and after 'CA SMI'. If they are not 
      very similar, you must re-run 'CA S' with "CN" instead of "C" as
      the fifth input.                                           </li>

   <li>After 'CA SMI', if an odd factor is chosen in 'CA SM', it's axis 
       may be flipped.                                           </li>
 
   <li>If using this to force certain images, from the same series, 
      to standout on a factor map (one class inactive, all others active), 
      use <a href="../../man/casm.html">'CA SM'</a> with <i>(S)</i>ymbol option
      (it's quicker).                                           </li>
</ul>

<p>Below are the 'CA SM' maps with no 'CA SMI' input, and below that are
   'CA SM' maps with 'CA SMI' input. Note the labeled images are 
   the same in all three, but the axis switch with an odd 
   numbered factor. This axis switch is caused by using non-transposed 
   data set. In order to have 'CA SMI' run on this data, forced 'CA S'
    to not transpose the data, with the "CN entry". Because of this, 
   'CA SM' reads in the 
   images differently from the transposed data. Be sure to take note of axes 
   if using 'CA SMI' -> 'CA SM'
</p>


   <table align="center" cellpadding="4">
      <tr>
      <td> <a href="save/casmi_reg1.gif"> <img src="save/casmi_reg1.jpg" </a></td>
      <td> <a href="save/casmi_reg2.gif"> <img src="save/casmi_reg2.jpg" </a></td>
      <td> <a href="save/casmi_reg3.gif"> <img src="save/casmi_reg3.jpg" </a></td>
      </tr>

      <tr>
      <th align= "center"> <a href="save/casmi_reg1.gif">Factor 1 vs. Factor 2</a></th>
      <th align= "center"> <a href="save/casmi_reg2.gif">Factor 1 vs. Factor 3 </a></th>
      <th align= "center"> <a href="save/casmi_reg3.gif">Factor 2 vs. Factor 3 </a></th>
      </tr>
   </table>
   <p align="center"><b> 'CA SM' maps with no 'CA SMI' input </b></p>


   <table align="center" cellpadding="4">
      <tr>
      <td> <a href="save/casmi_od1.gif"> <img src="save/casmi_od1.jpg" </a></td>
      <td> <a href="save/casmi_od2.gif"> <img src="save/casmi_od2.jpg" </a></td>
      <td> <a href="save/casmi_od3.gif"> <img src="save/casmi_od3.jpg" </a></td>
      </tr>

      <tr>
      <th align= "center"> <a href="save/casmi_od1.gif">Factor 1 vs. Factor 2</a></th>
      <th align= "center"> <a href="save/casmi_od2.gif">Factor 1 vs. Factor 3 </a></th>
      <th align= "center"> <a href="save/casmi_od3.gif">Factor 2 vs. Factor 3 </a></th>
      </tr>
    </table>
    <p align="center"><b> 'CA SM' maps with 'CA SMI' input </b></p>

<p />


<!-  xxxxxxxxxxxxxx View Factor (Correspondence) Map In.... xxxxxxxxxxxxxxxxxxxx - ->

<hr />

<h4>View Factor Map In 
    <a href="https://spider-em.github.io/Web/docs/web.html">Web</a> and Compute Average Images</h4>

<p>Using <a href="https://spider-em.github.io/Web/docs/web.html">Web</a>
   you can view a factor (correspondence) map and select 
   images which are similar 
   using a "lasso" interface. Then the average of that lassoed "class" 
   is computed and can be viewed or stored as a new image. Also, 
   a document file can created listing what class each image 
   was placed in. I believe that only images can be used, not pixels. 
</p>


How To Use The <a href="https://spider-em.github.io/Web/docs/web.html">Web</a> Factor Map
   <ol>
   <li>Run the <a href="../../man/sdc.html">'SD C'</a> operation in SPIDER. </li>

   <li>Start <a href="https://spider-em.github.io/Web/docs/web.html">Web</a>
       with your data file extension 
       (i.e. "<a href="https://spider-em.github.io/Web/docs/web.html">Web</a> dat &") 
       and use the command -> image and "accept" to 
       navigate to where the cluster file is. </li>

   <li>If you are going to make image averages, the data 
       files and the <a href="../../man/sdc.html">'SD C'</a>
       doc. file should be in the same 
       folder and have the same extension. It is easier. </li>

   <li>In <a href="https://spider-em.github.io/Web/docs/web.html">Web</a>, 
       Commands -> Corr-map. 
       <a href="https://spider-em.github.io/Web/docs/corrmap.html">Explanation of window options</a>. </li>

   <li>When you "accept", a <a href="https://spider-em.github.io/Web/docs/web.html">Web</a> 
       window will appear, with 
       either numbers or circles representing the images, 
        depending on the "show image numbers" toggle.
 
   <li>"Lasso" a group of images with the left mouse button, 
       and after completely enclosing the intended images, 
        press the center button. A new window will appear. </li>

      <ul>
      <li>"Save images in Doc file" will open another 
          window. From this new window you can name the file, and 
          specify which registers carries the X co-ordinate, Y co-ordinate, 
          and the order of that particular group created during the run 
          of Corr-map. The first register always is the image number. 
          Please remember that the X and Y co-ordinates are actually 
          the values of the eigenvectors that was specified during the 
          begining of corr-map. </li> 

      <li>"Display avg. image" will show an average of all 
          included images on the screen. It will not save that 
          image. The "overlap" toggle cas_cas where the average is displayed. </li>


      <li>"Store avg. image" will save the average of the 
       selected images, but it will not be displayed on the screen. </li>

      <li>"New masking" will return you to the image factor map. </li>

      <li>"Continue masking" will do the same as new masking, 
          except all the selected image markers will be shadowed 
          in green. Useful to see what image markers have already 
          been catagorized. </li>
      <li>"stop mapping" ends the corr-map function
      </ul>

   <li>Continue selecting image markers with new/continue 
       masking until satisfied. Note that one image can be in many
       different groups. </li>
   </ol>
</p>

<p>The doc. file: <a href="save/sdc_doc.dat">sdc_doc.dat</a> is the result of running 
   <a href="../../man/sdc.html">'SD C'</a>
   on a <i>_IMC file</i>. It lists the image number and factor co-ordinates 
   of each image.
</p>

<p>The following is a is a screen-shot of Web Corr-map run: </p>
 
<p align="center" <a href="save/web_corrmap.gif"> <img src="save/web_corrmap.jpg" </a></p>

<p>  Note the placement of the average 
   images. The upper-right image is overlapped with it's 
   respective mask. We can also see what two traits were 
   being compared in this factor map, head shape and eye direction.
</p>

<p> The file: <a href="save/web_docimg001.dat">web_docimg001.dat</a> contains  
   the data created with the "Save images in Doc. file" option. 
   It lists the image number, X and Y co-ordinates and the 
   order of class it was formed from. This particular class 
   was the third formed, but the first image document list.
</p>

<!-  xxxxxxxxxxxxxx OTHER xxxxxxxxxxxxxxxxxxxx - ->

<hr />

<a name="extrastuff"><h4>Other stuff</h4>


<p>The procedure: <a href="webdendro.spi">webdendro.spi</a>  
   invokes <a href="../../man/clcla.html">'CL CLA'</a>' so that a new dendrogram 
   document file is created, with a different  lower threshold.<br/>
</p>

<p>The procedure: <a href="rename.spi">rename.spi</a> 
   can be used to change the extensions of a whole series of images. Is not a
   problem if follow hint number three above.
</p>


<!-  xxxxxxxxxxxxxx References xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx - ->
<hr />

<a name="ref"><h4>References</h4>

 <ul>
 <li> <a href="http://www.nature.com/nprot/journal/v3/n12/full/nprot.2008.156.html">
      SPIDER image processing for single-particle reconstruction of 
      biological macromolecules from electron micrographs</a>.  <br />
      Nature Protocols 3, 1941-1974 (2008) 
 </li>
 <p />

 <li> <a href="http://www.amazon.com/gp/product/0195182189/">
      Three-Dimensional Electron Microscopy of Macromolecular Assemblies</a>  <br />
      Oxford University Press, (February 2006)
 </li>
</ul>

<p />

<hr /> 
<p>

<small>
  Source:      docs/techs/classif/tutorial.html  &nbsp;&nbsp;&nbsp;  
  Last update: 10 Sep 2013    &nbsp;&nbsp;&nbsp;
</small></p>

<hr /> 

</body>
</html>


