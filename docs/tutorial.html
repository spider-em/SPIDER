<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
   <title>Tutorial: SPIDER Image Manipulation</title>
   <link rel='stylesheet' type='text/css' href='./buttons.css' />

</head>

<body background="bgpink.gif" vlink="#ff000">
<!-- Begin Buttons -->
<table>
<tr>
  <td><a href="./spider.html"                 id="spider">    </a></td>
  <td><a href="./user_doc.html"               id="work">      </a></td>
  <td><a href="./operations_doc.html"         id="index">     </a></td>
  <td><a href="./documents.html"              id="help">      </a></td>
  <td><a href="./faq.html"                    id="faq">       </a></td>
  <td><a href="./documents.html#2D"           id="techs">     </a></td>
  <td><a href="./techs/recon1a/Docs/mr1.html" id="recon">     </a></td>
  <td><a href="./formats.html"                id="menu">      </a></td>
  <td><a href="./installation.html"           id="install">   </a></td>
  <td><a href="./release.html"                id="new">       </a></td>
  <td><a href="https://spider-em.github.io/Web" id="web"> </a></td> 
</tr>
</table>
<br><hr>
<!-- End Buttons -->


<h2 align="center"><a name="user_guider">Tutorial: SPIDER Image Manipulation</a></h2>

<br>

<hr>

<center>by Louis M. Miranda, Yiwei Chen</center>
<center>and</center>
<center>Joachim Frank</center>
<center>Laboratory of Computational Biology and Molecular Imaging</center>
<center>Wadsworth Center</center>
<center>New York State Department of Health</center>

<br>
<hr>
<dl>
<dd>
<p></p>
</dd>

<dt><b><a href="#introduction">INTRODUCTION</a></b></dt>

<dt><b><a href="#start1">1. STARTING A SPIDER SESSION</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#start1.1">1.1 Starting SPIDER</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#start1.2">1.2 Looking at
Images with WEB</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#start1.3">1.3
Two-dimensional (2D) and three-dimensional (3D) images in
SPIDER</a></b></dt>

<dt><b><a href="#processing2">2. PROCESSING PREVIOUSLY CREATED
IMAGES</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.1">2.1 The
Masking Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.2">2.2 The
Interpolation Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.3">2.3 The
Rotate Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.4">2.4 The Shift
Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.5">2.5 The RT SQ
Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.6">2.6 The
Windowing Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.7">2.7 The
Padding Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.8">2.8 The
Mirroring Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.9">2.9 The
Box-Convolution Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.10">2.10 The
Contrast Enhancement Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.11">2.11 The
Edge Detection Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.12">2.12 The
Average + Variance Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.13">2.13 The
File Contour Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.14">2.14 The
Subtract-Images Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.15">2.15 The
Multiply-Images Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.16">2.16 The
Square-Image Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.17">2.17 The
Cross-Correlation Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing2.18">2.18 The
Autocorrelation Operation</a></b></dt>

<dt><b><a href="#fourier3">3. THE FOURIER TRANSFORM</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#fourier3.1">3.1 The Montage
Operation With Scaling Option</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#fourier3.2">3.2 The Fourier
Transform Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#fourier3.3">3.3 The Power
Spectrum Operation</a></b></dt>

<dt><b><a href="#creating4">4. CREATING AND EDITING
IMAGES</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#creating4.1">4.1 The
Modelling Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#creating4.2">4.2 The
Create-Blank Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#creating4.3">4.3 The Insert
Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#creating4.4">4.4 The Patch
Operation</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#creating4.5">4.5 The
Threshold Operation</a></b></dt>

<dt><b><a href="#processing5">5. PROCESSING OF 3D DATA</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.1">5.1
MA</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.2">5.2
IP</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.3">5.3 RT
3D</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.4">5.4
SH</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.5">5.5
WI</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.6">5.6
PD</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.7">5.7
MR</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.8">5.8
BC</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.9">5.9
CE</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.10">5.10
ED</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.11">5.11 AS
R</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.12">5.12
FC</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.13">5.13
SU</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.14">5.14
MU</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.15">5.15
SQ</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.16">5.16 CC
N</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.17">5.17
AL</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.18">5.18 MN
S</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.19">5.19
FT</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.20">5.20
PW</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.21">5.21 MO
3</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.22">5.22
BL</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.23">5.23
IN</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.24">5.24
PA</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#processing5.25">5.25
TH</a></b></dt>

<dt><b><a href="#procedure6">6. PROCEDURE MODE OF
PROCESSING</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#procedure6.1">6.1 Procedure
versus Interactive Sessions</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#procedure6.2">6.2 How to
Create a Procedure File</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#procedure6.3">6.3 Preparing
and Running a Simple Procedure File</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#procedure6.4">6.4 Use of
Temporary In-core Files</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#procedure6.5">6.5 DO-LOOPS
and Run-time Designation of File Names</a></b></dt>

<dt><b><tt>&nbsp;&nbsp;</tt> <a href="#procedure6.6">6.6 Variables,
Arithmetic Expressions, and Computed Goto Statements</a></b></dt>

<dt><b><a href="#appendix">APPENDIX</a></b></dt>

<dd>
<hr>
</dd>

<dt><br>
</dt>
</dl>

<center><a name="introduction">INTRODUCTION</a></center>

<dl>
<dd><br>
<p>Welcome to the SPIDER Tutorial. The following pages will take
you on a brief self-guided tour of the image-manipulating abilities
of the SPIDER image processing software program. Each operation is
documented here with both a step-by-step procedure and the images
produced by it. By creating the image that is documented in the <a
href="#appendix">Appendix</a>, you can start right away--no other
images are necessary for most operations documented here.</p>

For more information on the specific options and choices of
parameters within each operation, use the 
<a href= "operations_doc.html">"Manual of Spider Operations"</a>.<br>
 
<hr>

<p>1. <a name="start1">STARTING A SPIDER SESSION</a></p>

<p>1.1 <a name="start1.1">Starting SPIDER</a></p>

<p>SPIDER is a command-driven program. To start a session, open a
window and type "spider". A Welcome notice appears which defines
the exact version and release of the program you are running. Next,
you will see the query</p>

.PROJECT/DATA CODE: SEC/80S 

<p><i>[Please note that the query by the computer is always
preceded by a period, so that it's easily distinguished from other
messages. The interpretation of the user response, in this case
"SEC/80S" is usually case sensitive.]</i></p>

<p>The codes are used to define the files that will be accessible
by the program in this session. The DATA CODE is a three-letter
sequence that will be the assumed default extension of image files
(or document files, i.e., files containing lists of important
numbers to be "transported" from one operation to another). These
may either be input files, or newly created output files. For
example, an existing file named RAW004.80S can be referred to in
above session as "RAW004". If the user types "WIN004" in response
to the question "OUTPUT FILE:", then a file named "WIN004.80S" will
be created.</p>

<p>[You can skip the following explanation of the project code in
the initial training session. It will have no importance until you
come to Section 6. For the time being, just enter the data code
only -- the project code will be the same by default.]</p>

<p>Similarly, the PROJECT CODE is a three-letter sequence that will
be used as default extension of files that define an entire batch
of operations: these are called "procedure files". In the above
example, "SEC" might be a mnemonic referring to a project that
seeks to reconstruct the 80S ribosome-Sec61 complex.  If operations to
perform two-dimensional alignment are stored in a file named
"ALIGN.SEC", then simply typing "@ALIGN" will refer to the desired
file, and will be understood as a request to execute operations
stored there.</p>

<p><i>[Note that there is a way to switch to another choice of
"DATA CODE" and "PROJECT CODE": at any ".OPERATION:" prompt, just
type "NC" (for "New Codes"), and the program will come back to the
initial prompt ".ENTER PROJECT/DATA CODE:".]</i></p>

<p>After the DATA CODE (and the PROJECT CODE) have been entered,
the system comes back with the standard prompt ".OPERATION:". Here
it expects one of the operations listed in the SPIDER manual defining
image processing operations.</p>

1.2 <a name="start1.2">Looking at the Image with WEB</a><br>
<br>
 

<p>In the course of the session, you need to look at the resulting
images. For this purpose, you open another window on your terminal.
Position and size the SPIDER window and the WEB window in such a
way that you can see them both without obstruction. Now start WEB
for the particular image data you want to view by typing "web 80s
&amp;", i.e., "web" followed by the DATA CODE defined at the
beginning of the SPIDER session. This operation starts the WEB
graphics user interface, that will allow you to display images
using self-explanatory point-and-click operations. However, a help
function is also available to explain the more complex interactive
  <td><a href="https://spider-em.github.io/Web" id="web"> </a></td> 
detail.</p>

<center><img width="75" height="75" src="./img/sam001.gif"> <img
width="75" height="75" src="./img/sam002.gif"></center>

<center><tt>SAM001 &nbsp; SAM002</tt></center>

<br>
 FIGURE 1. The original images (dimensions 75X75) to be
manipulated. SAM001 (left) was created from the example procedure
in the Appendix. SAM002 (right) is an image of the 70S ribosome
from <i>E. coli</i> obtained by cryo-electron microscopy. You may
substitute it by your own image.<br>
<p>1.3 <a name="start1.3">Two-dimensional (2D) and
three-dimensional (3D) images in SPIDER</a></p>

<p>SPIDER can operate on both 2D and 3D images. The file formats
permits creation of one-dimensional (1D) images as well, but there
are very few operations that operate on 1D data, thus they will not
be discussed in this tutorial. A 2D image is defined by its x,y
dimensions. x, the width of the image, is stored as the number of
sampling points and is always refered to as NX. y, the height of
the image, is stored as the number of horizontal rows and is
refered to as NY. A 3D image can be thought of as a stack of 2D
images (or slices), and the 2 dimension is stored as the number of
slices and refered to as NZ.</p>

<p>Section 2, 3 and 4 of this tutorial are devoted to processing of
2D imagaes. In section 5 all operations introduced so far are
reviewed for suitability in three dimensions and if a given operation
has a different meaning or a different version for 3D data, it is
decribed in more details.</p>

<p><a href="#user_guider">(Back to the front page)</a></p>

<p>2. <a name="processing2">PROCESSING PREVIOUSLY CREATED
IMAGES</a><br>
<br>
 2.1 <a name="processing2.1" href=
"man/ma.html">'MA'</a> --The Masking
Operation<br>
<br>
</p>

<p>Masking allows superfluous information in the image, normally at
the periphery, to be deleted. 'MA' applies a circular mask, but
there is also an option that allows an arbitrary shape to be used
as mask.</p>

<p>2.1.1 External masking</p>

<pre>
                 EXAMPLE:  Masking an Image

    .OPERATION: MA                ;Use the MA operation
    .INPUT  FILE: SAM002          ;Image to be masked
    .OUTPUT FILE: MAS002          ;Name of masked image
    .OUTER &amp;INNER RADII: 25,0     ;Radii, in pixels, 
                                  ;beyond which image 
                                  ;will be masked
    .(D)ISK,(G)AUSSIAN OR 
     (T)RUE GAUSSIAN: G           ;Type of mask used
    .(A)V, (P)REC AV, (C)IRCUMF,
     OR (E)XTERNAL: P         ;Type of background
    .MASK CENTER COOS: 38,38      ;Coordinates of the
                                  ;mask center
    .HALFWIDTH: 5                 ;Halfwidth for Gaussian
                                  ;mask only
</pre>

<p>The preceding procedure will create the masked image seen in
figure 2a. Note the soft transition created by the Gaussian
falloff.</p>

<center><img width="75" height="75" src=
"./img/mas002.gif"></center>

<center>MAS002</center>

<br>
 

<center>FIGURE 2a. Result of external masking operation.</center>

<br>
 

<p>2.1.2 Internal masking</p>

<pre>
                 EXAMPLE:  Masking an Image

    .OPERATION: MA                ;Use the MA operation
    .INPUT  FILE: SAM002          ;Image to be masked
    .OUTPUT FILE: MIN002          ;Name of masked image
    .OUTER &amp;INNER RADII: 0,25     ;Radii, in pixels, 
                                  ;beyond which image 
                                  ;will be masked
    .(D)ISK,(G)AUSSIAN OR 
     (T)RUE GAUSSIAN: G           ;Type of mask used
    .(A)V, (P)REC AV, (C)IRCUMF,
     OR (E)XTERNAL: P         ;Type of background
    .MASK CENTER COOS: 38,38      ;Coordinates of the
                                  ;mask center
    .HALFWIDTH: 5                 ;Halfwidth for Gaussian
                                  ;mask only
</pre>

<center><img width="75" height="75" src=
"./img/min002.gif"></center>

<center>MIN002</center>

<br>
 

<center>FIGURE 2b. Result of internal masking operation.</center>

<br>
 

<p>2.2 <a name="processing2.2" href=
"man/ip.html">'IP'</a>--The Interpolation
Operation<br>
<br>
</p>

<p>An image can be enlarged or reduced for clarity of display by
interpolating it onto a grid with different dimensions. For this
Guide, the two sample images were enlarged so that the processing
performed on them would be seen more clearly. 'IP' is especially
useful for enlarged display of images that result from
averaging.</p>

<pre>
   
            EXAMPLE:  Interpolating an Image

    .OPERATION: IP                  ;Use the IP operation
    .INPUT FILE1: SAM001            ;Image to be enlarged
                                    ;or reduced
    .OUTPUT FILE: INT001            ;Name of new image
    .ENTER DIMS NX,NY: 128,128  ;Size of output image

</pre>

[Here, DIMS refers to the dimensions of the image which are
expressed as NX, NY. This corresponds to the size of the image
in pixels: NX = the number of sampling points, or vertical
columns (i.e., the width of the image); NY = the number of
horizontal rows (i.e., the height of the image). For example, an
image of dimensions NX = 40, NY = 50 corresponds to a rectangle
with a width of 40 and a height of 50.]<br>
<br>
<center><img width="128" height="128" src="./img/int001.gif"> <img
width="128" height="128" src="./img/int002.gif"></center>

<center><tt>INT001 &nbsp; &nbsp; &nbsp; &nbsp; INT002</tt></center>

<br>
 FIGURE 3. The original 75X75 pixel images shown in Fig. 1 have
been enlarged. When the images are enlarged by a non-integer ratio,
as in this example, partial loss of information will occur. When
the image size is reduced, some information will be always lost.
For an integer enlargement of images, operation <a href=
"man/fp.html">'FP'</a> is recommended.
INT002 was computed from SAM002, the same way as INT001 was from
SAM001.<br>
<br>
 2.3 <a name="processing2.3" href=
"man/rt.html">'RT'</a>--The Rotate
Operation<br>
<br>
<p>This operation allows the image to be rotated within the frame.
By default, rotation is with respect to a center at (NX/2 + 1,
NY/2 + 1). Rotation angles can be positive or negative: the
positive direction is considered counterclockwise, by convention;
the negative direction is clockwise.</p>

<p>During the course of an alignment procedure, the 'RT' operation
will utilize the rotation angles obtained by orientation search to
rotate the particles into alignment with the reference.</p>

<pre>
                 EXAMPLE:  Rotating an Image

    .OPERATION: RT                ;Use the RT operation
    .INPUT  FILE: INT001          ;Image to be rotated
    .OUTPUT FILE: ROT001          ;Name of new image
    .ROTATION ANGLE: 130          ;Angle of rotation in
                                  ;degrees (+/-)

</pre>

<center><img width="128" height="128" src="./img/rot001.gif"> <img
width="128" height="128" src="./img/rot002.gif"></center>

<center><tt>ROT001 &nbsp; &nbsp; &nbsp; &nbsp; ROT002</tt></center>

<br>
 FIGURE 4. Rotated images. Note that a "new" background is
automatically created to replace the voids in the four corners
created by rotating the image. That background will have a value
equal to the mean of all pixels of the unrotated image. However,
note that there is also an option that allows you to specify the
background value (by <a href= "man/rtb.html">'RT B'</a>).<br>
<br>
 2.4 <a name="processing2.4" href="man/sh.html">'SH'</a>--The Shift Operation<br>
<br>
<p>The image is shifted with respect to the frame of reference. The
amount and direction of shift is specified by the x and y
components of the shift vector. Shift vector components can be
either positive or negative. According to the coordinate system
convention, the origin is at the upper left, so positive
x-direction is to the right, positive y-direction is down.</p>

<pre>
                                                    
             EXAMPLE:  Shifting an Image

    .OPERATION: SH                ;Use the SH operation
    .INPUT  FILE: ROT001          ;Image to be shifted
    .OUTPUT FILE: SHF001          ;Name of new image
    .SHIFT COMPONENTS: -15,-10    ;X- and Y- components of the
                                  ;shift vector, (+/-)
</pre>

<i>NOTE: <a href="man/shf.html">'SH F'</a> option allows non-integer shift vectors to be
applied.</i><br>
<br>
 

<center><img width="128" height="128" src="./img/shf001.gif"> <img width="128" height="128" src="./img/shf002.gif"></center>

<center><tt>SHF001 &nbsp; &nbsp; &nbsp; &nbsp; SHF002</tt></center>

<br>
 FIGURE 5a. Shifted Images. Notice that shifted image data "wrap
around" to the opposite sides of the image.<br>
<br>
 

<p>2.5 <a name="processing2.5" href="man/rtsq.html">'RT SQ'</a>-- Rotate -
image or volume, Shift, use Quadratic interpolation<br>
<br>
</p>

<p>Changes the scale, rotates and shifts image circularly. Rotates
a picture counter-clockwise around the center (NX/2 + 1, NY/2 +
1). (Negative angles = clockwise).</p>

<pre>
            EXAMPLE:  Rotating and Shifting an Image

    .OPERATION: RT SQ             ;Use the RT SQ operation
    .INPUT  FILE: INT001          ;Image to be rotated
    .OUTPUT FILE: RTS001          ;Name of new image
    .ROTATION ANGLE, SCALE: 130   ;Angle of rotation in
                                  ;degrees (+/-)
    .SHIFTS IN X AND Y:-15,-10    ;the X and Y shift values
</pre>

<center><img width="128" height="128" src=
"./img/rst001.gif"><tt>&nbsp;</tt> <img width="128" height="128"
src="./img/rst002.gif"></center>

<center><tt>RST001 &nbsp; &nbsp; &nbsp; &nbsp; RST002</tt></center>

<br>
 FIGURE 5b. The result of 'RT SQ' operation. Notice that the
difference between the 'RT SQ' operation and the 'RT', 'SH'
operations is that in the image resulting from the 'RT SQ'
operation no "new" background is created.<br>
<br>
 2.6 <a name="processing2.6" href= "man/wi.html">'WI'</a>--The Windowing Operation<br>
<br>
<p>Images may have to be windowed (i.e., a portion cut out) at
several stages of an investigation: the particle of interest is
windowed from a large field; once masked and aligned, it could
again be windowed to save computer storage space; or a large image
may have to be windowed to a size appropriate for certain
operations. For example, Fourier operations use a mixed-radix
algorithm, and dimensions that involve large prime numbers may
present a problem (see <a href=
"man/ft.html">'FT'</a> manual for
details).</p>

<pre>
                                              
              EXAMPLE:  Windowing an Image

    .OPERATION: WI                  ;Use the WI operation
    .INPUT  FILE: SHF001            ;Image to be windowed
    .OUTPUT FILE: WIN001            ;Name of new image
    .ENTER DIMS NX,NY: 110,110  ;Size of windowed area
    .TOP LEFT COOS: 2,2             ;Coordinates where the
                                    ;top left corner of the
                                    ;new image will be
    
    .OPERATION: WI                  ;Use the WI operation
    .INPUT FILE: SHF002            ;Image to be windowed
    .OUTPUT FILE: WIN002            ;Name of new image
    .ENTER DIMS NX,NY: 110,110  ;Size of windowed area
    .TOP LEFT COOS: 2,9             ;Coordinates of the point 
                    ;in the old image where 
                                    ;the top left corner of 
                                    ;the new image will be
</pre>

<i>NOTE: The top left corner of an image has coordinates 1,1 (not
0,0 !) by convention.<br>
<br>
</i> 

<center><img width="110" height="110" src=
"./img/win001.gif"><tt>&nbsp;</tt> <img width="110" height="110"
src="./img/win002.gif"></center>

<center><tt>WIN001
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspWIN002</tt></center>

<br>
 

<center>FIGURE 6. Result obtained by application of the 'WI'
operation.</center>

<br>
 2.7 <a name="processing2.7" href= "man/pd.html">'PD'</a>--The Padding Operation<br>
<br>
<p>Padding an image places the image into a larger field of
user-specified dimensions and background. This would be useful, for
example, in preparing the image for cross correlation with another
image, so as to avoid wrap-around overlaps.</p>

<pre>
                   EXAMPLE:  Padding an Image

    .OPERATION: PD                  ;Use the PD operation
    .INPUT  FILE: SAM001            ;Image to be padded
    .OUTPUT FILE: PAD001            ;Name of new image
    .ENTER DIMS NX,NY: 150,150  ;Size of final image
    .AVERAGE(Y/N),(C)IRC OP: Y      ;Choice of background
                                    ;density: use average
    .TOP LEFT COOS: 38,38           ;Coordinates of image
                                    ;placement within
                                    ;padded image
   
</pre>

<center><img width="150" height="150" src="./img/pad001.gif"> <img
width="150" height="150" src="./img/pad002.gif"></center>

<center><tt>PAD001 &nbsp; &nbsp; &nbsp; &nbsp; PAD002</tt></center>

<br>
 FIGURE 7. Here, padding has been used to produce an image twice
the size of the original. By placing the average of the windowed
area into the region around it, we have minimized the density step
at the border. This choice of background prevents artifacts from
occurring in the Fourier transform of the padded image. (By
answering 'N' to the question "average (Y/N)" you would indicate
that you wish to supply the background value yourself -- in that
case a solicitation for that value would follow.)<br>
<br>
 2.8 <a name="processing2.8" href= "man/mr.html">'MR'</a>--The Mirroring Operation<br>
<br>
<p>By this operation, a mirror-image of the input image is created.
The image is reflected across the vertical line or the horizontal
line running through the image center at (75,75). This might be
useful if the handedness is not certain.</p>

<pre>
              EXAMPLE:  Mirroring an Image

    .OPERATION: MR                ;Use the MR operation
    .INPUT  FILE: PAD001          ;Image to be mirrored
    .OUTPUT FILE: MIR001          ;Name of new image
    .MIRROR AT (X) OR (Y)-AXIS    ;the mirror axis. X = interchange
     (DEF=Y): Y                   ;rows, Y=interchange columns  
 
</pre>

<center><img width="150" height="150" src="./img/mir001.gif"> <img
width="150" height="150" src="./img/mir002.gif"></center>

<center><tt>MIR001 &nbsp; &nbsp; &nbsp; &nbsp; MIR002</tt></center>

<br>
 FIGURE 8. This picture is simply a mirror-reflection of the
previous picture with respect to a line parallel to Y running
through the point ((INT(NX/2) + 1, INT(NY/2) + 1).<br>
<br>
 2.9 <a name="processing2.9" href= "man/bc.html">'BC'</a>--The Box-Convolution Operation<br>
<br>
<p>Central to the box convolution operation is an algorithm that
replaces the value of each pixel by the average of a small
rectangular area around it. If the 'L' (low-pass filtering) option
is chosen, 'BC' results in an image that is a mixture between the
box-convolved image and the original image. If the 'H' option is
chosen, 'BC' subtracts the box-convolved image from the original
image. The resulting image is a high-pass filtered version of the
input image. It can again be mixed with the input image.</p>

<p>The filter weight is used to specify the proportion of the
filtered to the unfiltered image to be mixed to form the output
image. Filter weight = 1 means output is the pure filtered
image.</p>

<pre>
             EXAMPLE:  Box-Convoluting an Image

    .OPERATION: BC                  ;Use the BC operation
    .INPUT FILE: INT002            ;Image to be convoluted
    .OUTPUT FILE: BOX002            ;Name of new image
    .(H)IGH-PASS/(L)OW-PASS/(T)HRES/(D)IVIS/(V)AR: L
                                    ;Type of filtration, in
                                    ;this case low-pass
    .LOCAL AREA SIZE COL,ROW: 5,6   ;Size of convolution box
    .FILTER WEIGHT (0.0-&amp;gt1.0): 1    ;Mixing factor
</pre>

<center><img width="128" height="128" src="./img/box001.gif"> <img
 width="128" height="128" src="./img/box002.gif"></center>

<center><tt>BOX001 &nbsp; &nbsp; &nbsp; &nbsp; BOX002</tt></center>

<br>
 FIGURE 9. Note the fuzziness of the image. Fine detail and
surrounding noise are suppressed, but the particle stands up better
from the background.<br>

<br>
 2.10 <a name="processing2.10" href= "man/ce.html">'CE'</a>--The Contrast Enhancement Operation<br>

<br>
<p>'CE' operates by stretching the density variations on the basis
of the image histogram. Hence, this operation can be used to
enhance the overall contrast, by sacrificing the exact
representation of features whose densities are in the top or bottom
range. The output image will always be in the range 0...2.</p>

<pre>
             EXAMPLE:  Enhancing Contrast of an Image

    .OPERATION: CE                ;Use the CE operation
    .INPUT  FILE: BOX001          ;Image to be enhanced
    .OUTPUT FILE: CON001          ;Name of new image
    .(S)TRETCH, (H)ISTOGRAM EQUALIZE OR 
      (L)OCAL? (S/H/L): S         ;Choice of contrast                 
                                  ;enhancement algorithm,
                                  ;in this case linear 
                                  ;contrast stretching. 
    .(S)INGLE/(A)UTOMATIC/(D)OUBLE MAPPING: A
                                  ;Stretching mode.
                                  ;Automatic means that the
                                  ;top and bottom cutoff
                                  ;points are determined
                                  ;from the percentage of
                                  ;pixels specified.
    .INTEGRAL THRESHOLD PERC.: .5 ;Percent of pixels to be
                                  ;chopped off at top and
                                  ;bottom of histogram
    .PLOT RESULT HISTOGRAM: Y     ;If yes, the histogram of the stretched 
                  ;image is to be computed
    .BOTTOM DENSITY VALUE: .5     ;density value to be mapped to 0.0
    .TOP DENSITY VALUE: 1.2       ;density value to be mapped to 2.0
  
</pre>

<center><img width="128" height="128" src="./img/con001.gif"> <img
width="128" height="128" src="./img/con002.gif"></center>

<center><tt>CON001 &nbsp; &nbsp; &nbsp; &nbsp; CON002</tt></center>

<br>
 FIGURE 10. While Box Convolution was seen to be effective, a much
more dramatic effect was achieved here with contrast enhancement.
The particle stands out definitively against the background, albeit
with a complete loss of information in the areas affected by the
density truncation. Note, for instance, that the fringe surrounding
the particle (which is caused by the contrast transfer function of
the elecetron microscope) has become uniformly black.<br>
<br>
 2.11 <a name="processing2.11" href= "man/ed.html">'ED'</a>--The Edge Detection Operation<br>
<br>
 This operation will create a file containing only lines
delineating edges detected in the image. This is similar to the 
<a href="man/fc.html">'FC'</a> (file
contour) operation, except that the contours represent lines of steep
density changes, not lines of equal density.<br>
<pre>
           EXAMPLE:  Detecting Edges in Images

    .OPERATION: ED                ;Use the ED operation
    .INPUT  FILE: CON001          ;Image to which edge  
                                  ;detection should be 
                  ;applied
    .OUTPUT FILE: EDG001          ;Name of new image
                                  ;containing contours
    .FILTER NUMBER (1/2/3/4): 4   ;Specify type of filter
                                  ;(see note)
    .THRESHOLD (1)LOW/(2)MEDIUM/(3)HIGH: 3
                                  ;Density variation
                                  ;threshold                                                                
</pre>

NOTE: Type of filter varies with different images, depending on the
S/N (signal-to-noise) ratio and the crowdedness of edges:<br>
<pre>
       Filter 1--very high S/N ratio (typical for images resulting
                 from averaging low-pass filtering).
       Filter 2--medium S/N ratio, many edges expected.
       Filter 3--medium S/N ratio, few edges expected.
       Filter 4--low S/N ratio (typical for raw data).
</pre>

<center><img width="128" height="128" src="./img/edg001.gif"> <img
width="128" height="128" src="./img/edg002.gif"></center>

<center><tt>EDG001 &nbsp; &nbsp; &nbsp; &nbsp; EDG002</tt></center>

<br>
FIGURE 11. Compare this to the input images CON001 and CON002 in
Figure 10. Lines along which the density gradient is steepest are
computed by the program.<br>
<br>
 2.12 <a name="processing2.12" href= "man/asr.html">'AS R'</a>--The Average + Variance Operation<br>
<br>
<p>'AS R' computes the average image and variance image from two or
more original images. The variance image shows the areas where
pixels vary strongest among the image set. This is useful in
determining how uniform the particles are, and how significant
certain ultrastructural features are that show up in the average
image.</p>

<p>It is important to remember that all of the files must begin
with the same file series name, e.g. SAM001, SAM002, ..., SAM009,
SAM010. Also, even though the name of the first image is given
after the prompt ".FIRST FILE:", it must also be included as part
of the file numbers given in answer to ".ENTER FILE NUMBERS:",
otherwise it will be skipped in the computation of average and
variance images.</p>

<p>In the following example the set of images used is from an
experiment in which 70S ribosomes are visualized.</p>

<pre>
             EXAMPLE:  Averaging A Series of Images

    .OPERATION: AS R                 ;Use the AS operation
    .FILE PREFIX OR TEMPLATE: SAM*** ;First image of series
    .ENTER FILE NUMBERS: 2-10        ;Numbers in a series
                                     ;to be averaged
    .ALL, ODD-EVEN (A/O):A           ;all images will be added   
    .AVERAGE FILE: AVG002            ;Name of average file to
                                     ;be computed
    .VARIANCE FILE: VAR002           ;Name of variance file 
</pre>

<p><i>NOTE:</i></p>

<p><i>(1) If the average file already exists, then the system will
assume that you want to add the current image set to this file, and
will ask for the number of images already summed.</i></p>

<p><i>(2) If the ODD-EVEN option is selected, two average images
and corresponding variance images are created, one for the
odd-numbered, one for the even-numbered files. This option is used
for resolution tests where two independent averages are
compared.</i></p>

<p><i>(3) For negatively stained data the mean of images is
irrelevant. In this case operation <a href=
"man/as.html">'AS'</a> can be used. It
subtracts the mean from every image in the input series before
calculation of the average map. Thus the average map produced by
'AS' will have a zero mean.</i></p>

<p><i>If 'AS' is applied to images with relevant average the
resulting variance map will be incorrect (the variance values will
be too small).</i></p>

<center><img width="675" height="90" src=
"./img/ser002.gif"></center>

<br>
<center><img width="75" height="75" src="./img/avg002.gif"> <img
width="75" height="75" src="./img/var002.gif"></center>

<center><tt>AVG002 &nbsp; VAR002</tt></center>

<br>
 FIGURE 12. Average image and Variance map resulting from averaging
the 9 images in the top row. The average image (left) has
considerably less detail than any of its constituent images, but it
is more representative of a "typical" particle. The variance image
(right) shows specks of high variance within the area of the
particle. These may indicate regions most strongly affected by the
variation in projection direction, or actual changes in molecular
conformation.<br>
<br>
 2.13 <a name="processing2.13" href= "man/fc.html">'FC'</a>--The File Contour
Operation<br>
<br>
<p>Contouring an image creates isolines at discrete density values
within an image. These are generated with a user-specified number
of levels. The actual contouring levels used are generated by the
program. The <a href="man/fce.html">'FC
E'</a> operation allows the user to specify both the base density and
the density increment between successive contour lines. Note that
for 'FC E', contouring does NOT occur at densities less than zero.
The <a href="man/ar.html">'AR'</a>
operation may be used to make the image definitely positive by adding
a constant to each pixel (see the SPIDER documentation for more
information).</p>

<p>As a preparation for 'FC', the image must be expanded since the
contour lines occupy entire pixels. Otherwise the contours will
look very ragged.</p>

<pre>
           EXAMPLE:  Contouring an Image


    .OPERATION: IP                ;Use the IP operation
    .INPUT FILE1: AVG002          ;Image to be enlarged
    .OUTPUT FILE: IPL002          ;Name of new image
    .ENTER DIMS NX,NY: 200,200;Size of output image

    .OPERATION: FC                ;Use the FC operation
    .INPUT  FILE: IPL002          ;Image to be contoured
    .OUTPUT FILE: FIC002          ;Name of new image
    .NO. OF CONTOUR LEVELS: 4     ;Number of density 
                                  ;levels delineated
    .OVERWRITE (Y/N): Y           ;Superimposes contours
                                  ;onto image
    .(W)HITE,(B)LACK,OR (A)DJUSTED CONTOURS: A
                                  ;Appearance of contour
                                  ;lines (adjusted means the
                                  ;appearance switches from 
                                  ;lines on black background, 
                                  ;black on white background)
</pre>

<p><i>NOTE:</i></p>

<p><i>(1) Rule of thumb: for the image expansion by 'IP', use a
factor of 3 to 4, depending on the complexity of features.</i></p>

<p><i>(2) In the simple 'FC' operation, the points of highest and
lowest density are both counted as contour levels. In the above
example, only 2 contour lines are visible even though 4 was
specified as the number. The pixels at either extreme of the
density range show up as single "contour points".</i></p>

<center><img width="200" height="200" src=
"./img/fic002.gif"></center>

<center>FIC002</center>

<br>
FIGURE 13. A contoured image. This operation is especially useful
for the display of average images.<br>
<br>
 2.14 <a name="processing2.14" href= "man/su.html">'SU'</a>--The Subtract-Images Operation<br>
<br>
<p>One or more images may be subtracted from an initial image pixel
by pixel, using this operation. To end the subtraction series, place
an asterisk (*) in response to the recurring prompt ".SUBTRACTED
FILE:" .</p>

<pre>
        EXAMPLE:  Subtracting and Copying Images

    .OPERATION: SU            ; Use the SU operation
    .INPUT  FILE: CON001      ;   Name of image from which other 
                              ;   image will be subtracted
    .SUBTRACTED FILE: CON002  ; Name of image to be subtracted
    .OUTPUT FILE: SUB001      ; Output file
    .SUBTRACTED FILE: *       ; Terminates solicitation
                              ;   of additional images
                              ;   to be subtracted
</pre>

<center><img width="128" height="128" src=
"./img/sub001.gif"></center>

<center>SUB001</center>

<br>
FIGURE 14. The image CON002 was subtracted pixel-by-pixel from
CON001 (see Fig 10). In a real-world application of 'SU', one image
might be the average of particles labeled with a small ligand, the
other the average of unlabeled control particles. In that case, the
positive difference would show the position of the ligand
molecule.<br>
<br>
 2.15 <a name="processing2.15" href= "man/mu.html">'MU'</a>--The Multiply-Images Operation<br>
<br>
<p>The image created by 'MU' has each pixel from one image
multiplied by the corresponding pixel from the other image(s).
Thus, the resultant image appears very similar to one image where
the pixels have a value of 1 in the other image.</p>

<p>A whole series of images can be multiplied together; the '*'
inserted after the ".MULTIPLIER FILE:" prompt ends the MU
operation.</p>

<pre>
             EXAMPLE:  Multiplying Images

    .OPERATION: MU            ; Use the MU operation
    .INPUT FILE: CON001       ; Name of first image
    .MULTIPLIER  FILE: CON002 ; Name of second image
    .OUTPUT FILE: MUL001      ; Output file
    .MULTIPLIER FILE: *       ; Terminates solicitation
                              ;   of additional images
                              ;   to be multiplied
</pre>

<center><img width="128" height="128" src=
"./img/mul001.gif"></center>

<center>MUL001</center>

<br>
FIGURE 15. Result of Multiplying images. Note the extreme effect of
multiplying where the density in one image is very low ("absolute
veto effect").<br>
<br>
 2.16 <a name="processing2.16" href= "man/sq.html">'SQ'</a>--The Square-Image Operation<br>
<br>
<p>This operation mathematically squares the value of each pixel in
the image, and has a non-linear contrast-enhancing effect areas
with high density (white in our display) are enhanced, those with
low density (dark) remain unchanged and those with medium density
(grey) are pushed more toward low density.</p>

<pre>
          EXAMPLE:  Squaring Images

    .OPERATION: SQ            ;Use the SQ operation
    .INPUT  FILE: CON002          ;File to be squared
    .OUTPUT FILE: SQR002          ;Name of squared image
</pre>

<center><img width="128" height="128" src="./img/con002.gif"> <img
width="128" height="128" src="./img/sqr002.gif"></center>

<center><tt>CON002 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
SQR001</tt></center>

<br>
FIGURE 16. The contrast is selectively increased when the file is
squared; small density variations are accentuated when they occur
in the high density range.<br>
<br>
 2.17 <a name="processing2.17" href= "man/cc.html">'CC N'</a>--The Cross-Correlation Operation<br>
<br>
 

<p>The 'CC N' operation computes the normalized cross-correlation
function of two pictures by using the Fourier-transform
relationship. The dimensions of the two pictures must be the same;
however, the dimensions need not be powers of two (see <a href=
"man/ft.html">'FT'</a> for
restrictions).</p>

<p>The CCF is a measure of the degree of match (integrated
cross-product) of two images as a function of their relative
translation. For example, when two squares are superimposed, they
match perfectly. As they are moved farther and farther apart, in
any direction, the degree of match decreases. Their
cross-correlation will vary continuously and its value will depend
on the distance, and the direction in which they are separated. The
two images will be totally unmatched when no part of either square
is superposed upon the other.</p>

<p>In the example, we use two images of the ribosome, PAD002 (see
Section 2.6) and PAD003. The image PAD003 was created by padding
the image SAM003 in to a (150,150) image using 50,30 as top left
coordiates; i.e., shifted off the center by +12,-8. .</p>

<pre>
           EXAMPLE:  The Cross-correlation Function

    .OPERATION: CC N          ;Cross Correlation
    .INPUT FILE: PAD002           ;the first ribosome picture
    .REFERENCE FILE: PAD003       ;the second ribosome picture,  
                  ;which is used as the reference
    .OUTPUT FILE: CCF002          ;the file which will contain 
                  ;cross-correlation function
</pre>

<center><img width="150" height="150" src="./img/pad002.gif"> <img
width="150" height="150" src="./img/pad003.gif"> <img width="150"
height="150" src="./img/ccf002.gif"></center>

<center><tt>PAD002 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; PAD003
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; CCF002</tt></center>

<br>
FIGURE 17. Display of cross-correlation function computed in above
example. The peak (indicating highest correlation) is seen to be
shifted by -12, +8, indicating the relative shift of the input
images. Note: The sign of shifts convention in section 6.6.<br>
<br>
 2.18 <a name="processing2.18" href= "man/ac.html">'AC'</a>--The Autocorrelation Operation<br>
<br>
<p>The 'AC' operation computes the autocorrelation function of a
picture by using the Fourier transform relationship.</p>

<p>The ACF is simply defined as the CCF of an image with itself.
Thus, any inherent symmetry and internal structure of a particle
seen in an image will be reflected by its ACF. The ACF pattern is
independent of the location of the particle in the image; therefore
it allows the relative orientation of particles to be found before
their relative shift is accurately known. This, in fact, is how
some alignment procedures are designed (see "Single Particle
Alignment Using SPIDER").</p>

<pre>
       EXAMPLE:  Computing the Autocorrelation Function

    .OPERATION: AC        ;Autocorrelation operation
    .INPUT FILE: PAD002           ;Image to be auto-correlated
    .OUTPUT FILE: ACF002      ;the file which will contain 
                      ;the auto-correlation coefficients.
</pre>

<center><img width="150" height="150" src=
"./img/acf002.gif"></center>

<center>ACF002</center>

<br>
FIGURE 18. Display of the autocorrelation function computed in
above example. Values of high correlation are shown in white. Due
to the inherent peak in the center (that is due to the perfect
match of an image with itself for zero shift), contrast is
noticeably reduced, and features of the ACF relating to
intramolecular vectors are virtually invisible.<br>
<br>
<p>Often, the center of the ACF produced by 'AC' will be an
extremely high-density area. An extreme contrast situation such as
this will obliterate any small density variations elsewhere in the
image. Masking the interior will remove these upper-extreme density
values, concomitantly mapping the much smaller density variations
in the remaining area into the full display range, and thereby
enhance the visual data in the periphery of the image. [Masks with
arbitrary shapes can be created by using the <a href=
"man/thm.html">'TH M'</a> operation and
applied with the 'MM' operation, see manual chapters on <a href=
"man/th.html">'TH'</a> and <a href=
"man/mm.html">'MM'</a>.]</p>

<pre>
 
          EXAMPLE:  Inside Masking of an Image 
  
    .OPERATION: MA                ;Mask operation 
    .INPUT  FILE: ACF002          ;Image to be masked 
    .OUTPUT FILE: MAI002          ;Name of masked image 
    .OUTER &amp; INNER RADII: 76,7    ;Radii the outer and inner 
                  ;mask circles, in pixels 
    .(D)ISK, (G)AUSSIAN EDGE, OR (T)RUE GAUSSIAN: G     
                  ;Type of mask edge: sharp
                                  ;cutoff (D), piecewise 
                                  ;Gaussian(G), or true Gaussian(T) 
     .(A)V, (P)REC AV, (C)IRCUMF, OR (E)XTERNAL: P 
                                  ;the background is to be the 
                  ;average after masking 
     .MASK CENTER COOS: 76,76     ;Coordinates of the 
                                  ;center of the mask 
    
 
</pre>

<center><img width="150" height="150" src=
"./img/mai002.gif"></center>

<center>MAI002</center>

<br>
FIGURE 19. Here, by eliminating the peak at the origin, we have
made the important features of the antocorrelation function better
visible. Compare to Figure 18.<br>
<br>
 

<p><a href="#user_guider">(Back to the front page)</a></p>

<p>3. <a name="fourier3">THE FOURIER TRANSFORM</a><br>
<br>
</p>

<p>In this section, the Fourier transform will be introduced. A
comparison will be made between the transforms of 1) a montage of
nine images, and 2) the average of those images padded to the size
of that montage. This comparison will demonstrate the convolution
theorem and the origin of reflections formed in the Fourier
transform of a crystal lattice.</p>

<p>The first operation illustrated in this section will be the
montage operation. It is not normally needed for Fourier operations,
but this is an appropriate place to illustrate its function.</p>

3.1 <a name="fourier3.1" href= "man/mns.html">'MN S'</a>--The Montage Operation With Scaling Option<br>
<br>
<p>Images of a series (i.e., whose names start with the same
prefix) can be "bundled up" into a gallery, or montage. The 'MN S'
operation not only arranges the images in a gallery, but also scales
them so that they will all be in the same density range 0...2. This
is particularly important for the display of images of widely
differing contrasts and offsets.</p>

<p>Montaging can be accomplished with no space between the images,
or with a user-specified space between them. The density of this
optional space can also be specified; but it should be between 0
and 2.</p>

<pre>
              EXAMPLE:  Montaging an Image Series

    .OPERATION: MN S             ;Use the MN S operation
    .ENTER PREFIX OF FILE SERIES: SAM    ;File prefix of images
                             ;to be montaged
    .ENTER FILE NUMBERS: 2-10            ;Numbers of images in
                         ;file series to be 
                         ;placed in montage
    .NUMBER OF PICTURES PER ROW, MARGIN: 3,0   
                     ;Number of images per
                         ;horizontal row, size of
                         ;optional margin space
    .ENTER MARGIN  VALUE: .1             ;value to be put in margins 
    .OUTPUT FILE: MON001             ;Name of montage created   
</pre>

<center><img width="225" height="225" src=
"./img/mon001.gif"></center>

<center>MON001</center>

<br>
FIGURE 20a. A montage of the images used to create the average
image in Figure 12. In this case, no margin was specified (0
pixels) in the 'MN S' operation.<br>
<br>
<center><img width="225" height="225" src=
"./img/big002.gif"></center>

<center>BIG002</center>

<br>
 FIGURE 20b. The average image (Fig. 12) has been padded here to
the same size as the montage (Fig. 20a). Figures 21a &amp; b are
the Fourier transforms of the images in Figures 20a &amp; 20b,
respectively, displayed as power spectra.<br>
<br>
 3.2 <a name="fourier3.2" href= "man/ft.html">'FT'</a>--The Fourier Transform Operation<br>
<br>
<p>The 'FT' operation uses a mathematical expression termed a
Fourier series to create a representation of the image in Fourier
space. This representation employs a series of sinusoidal waves
characterized by their amplitudes and phases. To display a Fourier
transform in pictorial form, the <a href=
"man/pw.html">'PW'</a> operation (see
below) has to be used: this extracts the amplitudes of the
transform and arranges them in their logical two-dimensional order
according to their spatial frequencies (reciprocal wavelengths in
x- and y- direction). Note, however, that the phases of the Fourier
transform are lost in this representation.</p>

<p>The Fourier transform operation is useful in many steps of image
processing. When performed on a micrograph, the 'FT' operation
followed by 'PW' is equivalent to the use of an optical
diffractometer and so can yield information on the quality of the
micrograph. It is also useful in elucidating image symmetry and
presence of order in ultrastructural studies. An image of a crystal
with poor S/N ratio can be Fourier transformed, and the Fourier
components representing the repeated structure (reflections) can
then be separately back-transformed to generate a relatively
noise-free image of the crystal.</p>

<p>In the demonstration examples here, two images are Fourier
transformed: the montage of 9 particles (Fig 20a), and a padded
version of the image created by averaging those 9 particles (Fig
20b). By making the padded image the same size(225,225) as the
montage, a comparison can be made between the transform of the
single (average) image and that of a "crystal" (the montage) formed
by the images used in the averaging.</p>

<pre>
            EXAMPLE: Padding and Fourier-Transforming an Image

    .OPERATION: FT              ;Use the FT operation
    .INPUT FILE: MON001                 ;Image to be Fourier
                        ;transformed
    .OUTPUT FILE: FOU001        ;output file which will 
                                        ;contain the transformed image.

       (FOURIER TRANSFORMATION OF THE AVERAGE IMAGE)

    .OPERATION: PD          ;Pad image to make it
                    ;Fourier-transformable
    .INPUT  FILE: AVG002        ;Image to be padded     
    .OUTPUT FILE: BIG002        ;Padded image ready to
                    ;be transformed
    .ENTER DIMS, NX,NY: 225,225 ;Dimensions of padded image
    .AVERAGE (Y/N), (C)IRCULAR OPTION: Y;Average of image used for
                                        ;padding background
    .ENTER TOP LEFT COOS: 76,76     ;Coordinates of padded image 
                                        ;where smaller image is to be
                                        ;placed (arbitrary, as long
                                        ;as the Fourier phases
                                        ;are not considered)

    .OPERATION: FT              ;Use the FT operation
    .INPUT FILE: BIG002                 ;Image to be Fourier
                        ;transformed
    .OUTPUT FILE: FOU002        ;output file which will 
                                        ;contain the transformed image.
</pre>

<p><i>Note that the Fourier transform of an image is
complex-valued, so it cannot be represented in real space.
Therefore no image is displayed here.</i></p>

<p>To display the amplitudes of the Fourier transform, the 'PW'
operation is used.</p>

3.3 <a name="fourier3.3" href= "man/pw.html">'PW'</a>--The Power Spectrum Operation<br>
<br>
<p>'PW' is a companion operation to 'FT': it allows the visual
display of the amplitudes in the Fourier transform of an image. The
"power spectrum" is normally defined as the square of the
amplitudes; in SPIDER, 'PW' creates an image that contains the
unsquared amplitudes. The 'PW' operation can only be performed on
Fourier data.</p>

<p>In the following example, the two Fourier transforms generated
above were both subjected to the power spectrum operation. The two
resulting power spectra (Figs. 21a,b) are quite different: the one
relating to the single particle image (Fig. 21b) is continuous, the
one relating to the montage discontinuous. In the latter case, the
discrete amplitudes are seen to lie on a square grid. Closer
inspection shows that in these points, both power spectra are in
fact identical.</p>

<p>This phenomenon can be explained in terms of the convolution
theorem: apart from variations that can be regarded as noise, the
montage is the convolution of the averaged particle image with a
square grid of single points. Consequently, its Fourier transform
is the product of the single-image Fourier transform (Fig. 21b)
with the Fourier transform of the single-point lattice, which is
again a 2D point lattice (the "reciprocal lattice").</p>

<pre>
      EXAMPLE:  The Power Spectrum of a Fourier Transform

    .OPERATION: PW            ;Use the PW operation
    .INPUT FILE: FOU001           ;Fourier data to be converted
    .OUTPUT FILE: POW001          ;Name of new image

    .OPERATION: MA            ;Inside mask is used in
                      ;order to suppress the central
                  ;term  better and thus  
                      ;visualize the  diffraction 
                  ;peaks
    .INPUT  FILE: POW001          ;Image to be masked
    .OUPUT FILE: MAI001           ;Name of masked image
    .OUTER &amp; INNER RADII:112,3    ;Radius of circular mask
    .(D)ISK, (G)AUSSIAN EDGE, OR (T)RUE GAUSSIAN: D     
                  ;Type of mask edge
    .(A)V,(P)REC AV,(C)IRCUMF,OR (E)XTERNAL: E
                      ;Put user-whose background
                      ;value in  masked area
    .ENTER BACKGROUND: 0.00
    .MASK CENTER COOS: 113,113    ;Coordinates of the
                      ;center of the mask


    .OPERATION: PW
    .INPUT FILE: FOU002
    .OUTPUT FILE: POW002
</pre>

<p>To see the result clearly, you can use the 
<a href="man/wi.html">"WI"</a> operation to window
the central part of the power spectrum.</p>

<pre>
    .OPERATION: WI                 ;Use the WI operation
    .INPUT  FILE: MAI001           ;Image to be windowed
    .OUTPUT FILE: WMA001           ;Name of new image
    .ENTER DIMS NX,NY: 120,120 ;Size of windowed area
    .TOP LEFT COOS: 53,53        ;Coordinates where the
                                   ;top left corner of the
                                   ;new image will be
    

    .OPERATION: WI                 ;Use the WI operation
    .INPUT  FILE: POW002           ;Image to be windowed
    .OUTPUT FILE: WPO002           ;Name of new image
    .ENTER DIMS NX,NY: 120,120 ;Size of windowed area
    .TOP LEFT COOS: 53,53        ;Coordinates where the
                                   ;top left corner of the
                                   ;new image will be   
</pre>

<center><img width="120" height="120" src=
"./img/wma001.gif"></center>

<center>WMA001</center>

<br>
FIGURE 21a. WMA001--Central part of power spectrum of the montage
in Fig 20a. Note the discontinuity of the image, compared to Figure
21b.<br>
<br>
 

<center><img width="120" height="120" src=
"./img/wpo002.gif"></center>

<center>WPO002</center>

<br>
 FIGURE 21b. WPO002--Central part of power spectrum of the
Fourier-transformed padded average image in Fig 20b. Here the
density variations are continuous, yet agree exactly with those of
Figure 21a in the discrete lattice points ("reciprocal
lattice").<br>
<br>
 

<p><a href="#user_guider">(Back to the front page)</a></p>

<p>4. <a name="creating4">CREATING AND EDITING IMAGES</a><br>
<br>
 4.1 <a name="creating4.1" href="man/mo.html">'MO'</a>--The Modelling Operation<br>
<br>
</p>

<p><i>Note that another example for the use of this operation is
documented in the Appendix.</i><br>
 For the next series of images, a base image was created using the
'MO' operation. The image was specified to be of random densities,
between 0 and 1.</p>

<pre>
           EXAMPLE:  Creating a Random Image

    .OPERATION: Mo               ;Use the MO operation
    .OUTPUT FILE: MOD001             ;Name of file created
    .ENTER DIMS (NX,NY): 128,128 ;Size of image
    .(T)(S)(C)(W)(R)(P): R           ;Type of image, random
    .GAUSSIAN DIST.? (Y/N): N        ;Type of distribution
                         ;of pixel values; N results 
                         ;in a uniform distribution
                         ;between 0 and 1
</pre>

<center><img width="128" height="128" src=
"./img/mod001.gif"></center>

<center>MOD001</center>

<br>
<center>FIGURE 22. An image composed of completely random pixel
densities.</center>

<br>
 4.2 <a name="creating4.2" href= "man/bl.html">'BL'</a>--The Create-Blank Operation<br>
<br>
<p>A blank image is an image with a background of uniform density.
There is no inter-pixel variation as there is with the random 'MO'
image. This particular blank image was created to demonstrate the
following operations: 'IN' and 'PA'.</p>

<pre>
      EXAMPLE:  Creating a Blank (Constant Value) Image

    .OPERATION: BL            ;Use the BL operation
    .OUTPUT FILE: BLA001          ;Name of file created
    .ENTER DIMS NX,NY: 30,30  ;Dimensions of file
                          ;to be created
    .AVERAGE? (Y/N): N        ;Type of background
                      ;(Y allows average of
                      ;another, specified
                      ;image to be used)
    .BACKGROUND: .5           ;Background density,                  
</pre>

<p><i>Note: Because of their inherent lack of any density
variation, blank images cannot be displayed; attempts to rescale it
into the range 0...2 would result in division by 0.</i></p>

4.3 <a name="creating4.3" href= "man/in.html">'IN'</a>--The Insert Operation<br>
<br>
<p>One image can be inserted into another, larger, image by using
'IN'. The smaller image simply takes the place of the pixels in the
larger image.</p>

<p><i>Note that the new image REPLACES the old pixels--it is not
added to them, as in 'PA'. Also, the final image with the insert
replaces the original image, so if the original is to be saved, it
must be copied first.</i></p>

<pre>
       EXAMPLE:  Inserting an Image Into Another

    .OPERATION: CP            ;Copy large image
    .INPUT  FILE: MOD001          ;Image to be copied
    .OUTPUT FILE: INS001          ;Name of new image

    .OPERATION: IN            ;Use the IN operation
    .SMALL INPUT FILE: BLA001     ;Image to be inserted
    .LARGE INPUT (OVERWRITTEN!) FILE: INS001        
                      ;Final image with the
                      ;inserted blank
    .ENTER TOP LEFT COOS: 35,35   ;Coordinates of large
                      ;image where blank is
                      ;to be inserted   
</pre>

<center><img width="128" height="128" src=
"./img/ins001.gif"></center>

<center>INS001</center>

<br>
FIGURE 23. A small blank image (upper left) inserted into a larger
image. Note its homogeneity--the pixels of the inserted image
replace those of the larger one.<br>
<br>
 4.4 <a name="creating4.4" href= "man/pa.html">'PA'</a>--The Patch Operation<br>
<br>
 

<p>Patching an image is similar to inserting an image, in that a
smaller picture is placed into a larger one. The main difference,
however, which is quite important, is that while 'IN' REPLACES the
pixel-densities of the large picture with the smaller one, 'PA'
ADDS the pixel-densities of both images together. This can be
clearly seen in PAT001 which has an inserted image at the top left,
and a patched image at the lower right. Again, the new image
overwrites the old one, and therefore it is a good idea to copy the
original image before using it.</p>

<pre>
              EXAMPLE:  Patching an Image 
 
    .OPERATION: CP                ;Copy the large image 
    .INPUT  FILE: INS001          ;File to be copied 
    .OUTPUT FILE: PAT001          ;Name of copied image 
 
    .OPERATION: PA                ;Use the PA operation 
    .SMALL INPUT FILE: BLA001     ;Image to be patched 
    .LARGE INPUT (OVERWRITTEN!) FILE: PAT001      
                          ;Image to receive patch 
    .TOP LEFT COOS: 90,90         ;Coordinates of large 
                                  ;image where small one 
                                  ;is to be patched 
</pre>

<center><img width="128" height="128" src=
"./img/pat001.gif"></center>

<center>PAT001</center>

<br>
 FIGURE 24. The same small blank image (now lower right) patched
into a larger image. 

<p><i>Note that the pixels from both images were added, resulting
in a lighter overall appearance.</i></p>

4.5 <a name="creating4.5" href= "man/th.html">'TH'</a>--The Threshold Operation<br>
<br>
 

<p>An image that is subjected to the 'TH' operation has any
densities beyond a user-determined value set equal to the
threshold. Either an upper or a lower boundary or both can be
set.</p>

<pre>
            EXAMPLE:  Thresholding Images 
 
    .OPERATION: TH                ;Use the TH operation 
    .INPUT FILE: PAT001           ;Image to be thresholded 
    .OUTPUT FILE: THR001          ;Image with thresholded 
                                  ;density values 
    .ALTER (A)BOVE THRESHOLD, (B)ELOW, OR  
     (C)BOTH SIDES (A/B/C): C     ;Thresholding to be done 
                                  ;on both sides of the 
                                  ;density range 
    .UPPER,LOWER THRESHOLD: .6,.4 ;Upper and lower threshold 
                                  ;to be specified       
</pre>

<center><img width="128" height="128" src=
"./img/thr001.gif"></center>

<center>THR001</center>

<br>
 

<center>FIGURE 25. The result of 'TH' operation.</center>

<br>
<br>
 

<p><a href="#user_guider">(Back to the front page)</a></p>

<p>5. <a name="processing5">PROCESSING OF 3D DATA</a></p>

<p>5.1 <a name="processing5.1" href= "man/ma.html">MA</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.2 <a name="processing5.2" href= "man/ip.html">IP</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.3 <a name="processing5.3" href= "man/rt3d.html">RT 3D</a></p>

<p>This operation allows the volume to be rotated within the frame.
By default, rotation is with respect to a center at
((INT(NX/2)+1, INT(NY/2)+1, INT(NZ/2)+1). The related
operation <a href="man/rt3a.html">'RT
3A'</a> allows rotation of of a volume around an arbitrary center.
The rotation is specicified by three <a href="euler.html">Euler
angles</a>.</p>

<p>5.4 <a name="processing5.4" href= "man/sh.html">SH</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.5 <a name="processing5.5" href= "man/wi.html">WI</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.6 <a name="processing5.6" href= "man/pd.html">PD</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.7 <a name="processing5.7" href= "man/mr.html">MR</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.8 <a name="processing5.8" href= "man/bc.html">BC</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.9 <a name="processing5.9" href= "man/ce.html">CE</a></p>

<p>Operation does not work for 3D data.</p>

<p>5.10 <a name="processing5.10" href= "man/ed.html">ED</a></p>

<p>Operation does not work for 3D data.</p>

<p>5.11 <a name="processing5.11" href= "man/asr.html">AS R</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.12 <a name="processing5.12" href= "man/fc.html">FC</a></p>

<p>Operation does not work for 3D data.</p>

<p>5.13 <a name="processing5.13" href= "man/su.html">SU</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.14 <a name="processing5.14" href= "man/mu.html">MU</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.15 <a name="processing5.15" href= "man/sq.html">SQ</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.16 <a name="processing5.16" href= "man/ccn.html">CC N</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.17 <a name="processing5.17" href= "man/al.html">AL</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.18 <a name="processing5.18" href= "man/mns.html">MN S</a></p>

<p>Operation does not work for 3D data.</p>

<p>5.19 <a name="processing5.19" href= "man/ft.html">FT</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.20 <a name="processing5.20" href= "man/pw.html">PW</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p>5.21 <a name="processing5.21" href= "man/mo3.html">MO 3</a></p>

<p>Creates a 3-D model density distribution.</p>

<pre>
.MENU: 

     (B)LANK -- CONSTANT DENSITY 
     (C)YLINDER -- SET OF CYLINDERS 
     (H)ELIX -- HELIX OF SPHERES 
     (HA) -- HELIX OF SPHERES, ADD DENSITITY 
     (NUM)BERS -- LINE NUMBERS 
     (Q)UICK -- RANDOM UNIFORM/GAUSSIAN STATISTICS 
     (R)ANDOM -- RANDOM UNIFORM/GAUSSIAN STATISTICS 
     (S)INE -- SET OF SINE WAVES 
     (SP)HERE -- SET OF SPHERES 
     (SPA) -- SET OF SPHERES, ADD DENSITIES 
     (SPV) -- SET OF SPHERES, VARIABLE DENSITIES 
     (T)EST -- 3D SINE WAVE 
     (W)EDGE -- DENSITY WEDGE
</pre>

<p>5.22 <a name="processing5.22" href= "man/bl.html">BL</a></p>

<p>Operation does not work for 3D data, but a blank volume can be
created using <a href="man/mo3.html">MO 3</a> operation.</p>

<p>5.23 <a name="processing5.23" href= "man/in.html">IN</a></p>

<p>Operation does not work for 3D data.</p>

<p>5.24 <a name="processing5.24" href= "man/pa.html">PA</a></p>

<p>Operation does not work for 3D data.</p>

<p>5.25 <a name="processing5.25" href= "man/th.html">TH</a></p>

<p>Operation works for both 2D and 3D images.</p>

<p><a href="#user_guider">(Back to the front page)</a></p>

6. <a name="procedure6">PROCEDURE MODE OF PROCESSING</a>

<p>6.1 <a name="procedure6.1" href=
"user_doc.html#procedure">Procedure</a> versus <a href=
"user_doc.html#interactive">Interactive</a> Sessions</p>

<p>In the interactive sesssion, you are able to verify the
different processing steps, try out choices of various parameters,
and make sure all questions are answered.</p>

<p>For any large-scale project, however, many such steps are
required, often to be repeated over a large number of image files.
This is no longer practical in the interactive mode. Instead,
operations along with answers to the queries are stored in operation
files and submitted in the procedure mode of processing.</p>

<p>A "procedure file" is flexible as it allows run-time
replacements. In the following section, we will provide an
introduction in writing both procedure files. In the course of this
introduction, many new features will be covered that have no
relevance or importance in the interactive mode of SPIDER covered
so far: <a href= "man/do.html">DO-LOOP</a>s, computed <a
href="man/goto.html">GOTO</a>s,
register variables, arithmetic expressions, run-time construction of file
names, document files, and string variables.</p>

<p>6.2 <a name="procedure6.2">How to Create a Procedure
File</a></p>

<p>Choose a text editor and prepare a file that contains the
operation stream to be processed sequentially by SPIDER. It is good
practice to choose a filename that is descriptive; e.g. ALIGN for a
procedure designed to align an image set. Note that the file name
extention of this and other operation files should be three
characters; it is called PROJECT CODE, and is set at the beginning
of the SPIDER session. So a valid name would be 'ALIGN.SEC' if
'SEC' is chosen as project code.</p>

<p><i>The first lines may be used as comment line. In SPIDER,
comment lines are started with ';'. To keep your procedure files
organized, put the file name, a short description of its purpose
and the date of creation into a comment line. (If necessary, you
can continue with additional comment lines, all started with
';'.)</i></p>

<p><i>6.3 <a name="procedure6.3">Preparing and Running a Simple
Procedure File</a></i></p>

<p><i>In the first example, we combine the operations from two
earlier examples in the interactive session, illustrating the use
of the 'IP' and 'RT' operations. We create a file named
'IPRT.SEC'.</i></p>

<pre>
<i>    ;IPRT.SEC 1/5/98 interpolate and rotate
    IP
    SAM001
    INT001
    128,128
    RT
    INT001
    ROT001
    130.
    EN
</i>
</pre>

<p><i>This sequence is identical to the sequence of
computer-solicited text input in the combined examples in earlier
sections 2.2 and 2.3, with the exception of the comment line and
the <a href="man/en.html">'EN'</a>
operation.</i></p>

<p><i>To execute the command file, simply type @IPRT at the
operation prompt. SPIDER then accepts its operations from the file
'IPRT.SEC' until it encounters the 'EN' operation. After execution of
the procedure file, you will be able to verify that the new files
INT001 and ROT001 have been created, and that they are identical to
those shown in Figs 3 and 4.</i></p>

<p><i>6.4 <a name="procedure6.4">Use of Temporary In-core
Files</a></i></p>

<p><i>In the foregoing example, there may be only an interest in
obtaining the final output file, ROT001, while the "intermediate"
file INT001 is discarded. In that case, it is not necessary to
create a file on disk (which delays the processing because of the
input/output operations involved). Instead, a temporary area in
menory can be used. Here is the re-written procedure file, making
use of the "file" mapped in the core area 1:</i></p>

<pre>
<i>    ;IPRT1.SEC 1/5/98 interpolate and rotate
    IP
    SAM001
    _1
    128,128
    RT
    _1
    ROT001
    130.
    EN
</i>
</pre>

<p><i>Ten such areas can be used simultaneouly (_1 through _10),
but there are some restrictions on their size. See the detailed <a
href="user_doc.html#file_inline">user
documentation</a>.</i></p>

<p><i>6.5 <a name="procedure6.5">DO-LOOPS and Run-time Designation
of File Names</a></i></p>

<p><i>We may wish to apply above operations to a whole series of
images, for example the series used before, SAM002, ..., SAM010.
This is very easy, and the appropriate procedure file may be
created from 'IPRT.SEC' by editing:</i></p>

<pre>
<i>    ;IPRT2.SEC 1/5/98 interpolate and rotate image series
    DO LB1 [iter]=2,10
       IP
       SAM{***[iter]}
       _1
       (128,128)
       RT
       _1
       ROT{***[iter]}
       (130.)
    LB1
    EN
</i>
</pre>

<p><i>The file differs from the file created before by the addition
of two lines, 'DO LB1 [iter]=2,10' and 'LB1'. In addition, the file
names, both for input and output, now use a register variable index
'[iter]'.</i></p>

<p><i>The lines 'DO LB1 [iter]=2,10' and 'LB1' demarcate a segment of
the procedure file that is supposed to be repeated, giving the
values 2-10 successively to the index '[iter]'. Since index [iter] appears in
two file names, those file names are constructed with different
numbers each time, from SAM002 and ROT002 to SAM010 and
ROT010.</i></p>

<p><i>Another change you will notice is the parenthesis around the
numbers '128,128' and '130.'. This is a way of indicating "use the
same values each time round". Alternatively, different values could
be given for each round, by giving the explicit list. In the
following example, it is assumed that the target dimensions of the
output file of operation <a href= "man/ip.html">'IP'</a> are the same
throughout, but that the rotation angle is different for each
image:</i></p>

<pre>
<i>    ;IPRT3.SEC 1/5/98 interpolate and rotate image series
    DO LB1 [iter]=2,10
    IP
       SAM{***[iter]}
       _1
       (128,128)
       RT
       _1
       ROT{***[iter]}
       130.,10.,-30.,45.,15.,-8.5,34.,46.,170.
    LB1
    EN
</i>
</pre>

<p><i>6.6 <a name="procedure6.6" href="user_doc.html#variables">Variables</a>,
Arithmetic Expressions, and Computed Goto Statements</i></p>

<p><i>The sequence of operations in the procedure file can be
regarded as a "program" whose elements are entire images. The
DO-LOOP introduced in the the previous section is a feature that
reinforces this view. We now come to additional elements and
operations that bring out the program character even more. </i></p>

<p><i>Register Variables are reserved places in memory that can be used to
store numbers. They are represented with a alphanumerical name surrounded
by '[]' brackets. There are different ways to fill a
register variable: </i></p>

<p><pre>
       [size] = 5
</pre></p>

<p>would mean "store the number 5 in variable named 'size'". Alternatively,
variables could be specified in an output position of a operation. For example,
the peak search operation <a href="man/pk.html">'PK'</a>:</p>

<p><pre>
       PK [x],[y]
</pre></p>

<p>will locate the position of a peak in the cross-correlation
image given as input and store its value and its x- and y-
components in [x], and [y], respectively. Another way to assign
a value to a variable will become clear in the next subsection. The
numbers stored in the variables will remain available throughout
the session, or until overwritten.</p>
 
<p>How are register variables used? They can be used anywhere in operations
requiring numerical input. For example, when the cross-correlation
peak is found in the position -12, 8, it implies that the two
images being compared must be shifted relative to one another by
the inverse of that vector, to obtain optimum superimposition. Thus
the shift vector components to be used in a subsequent 
<a href= "man/sh.html">'SH'</a> operation would be12, -8.</p>

<p>Now if the values -12, 8 were stored in [x]and [y], as a result of
the 'PK [x],[y]' operation described above, then the input to
the 'SH' operation would be -[x], -[y]. <i>Thus, variabless can be
used in any position where numerical input is expected.</i></p>

<p>Here is the complete SPIDER "program" that performs peak search
and subsequent corrective shift by the amount necessary to bring
two images in superimposition. We start with the cross-correlation
function obtained in Section 2.16, CCF002:</p>

<pre>
    PK [x],[y]
    CCF002
    1,0  ; The first number is the number of peaks to be
         ; searched for, the second number means: use the default origin 
         ; position at the picture's center (NX/2+1, NY/2+1)
    SH
    PAD002
    SHI002
    -[x],-[y]
</pre>

<p>After execution of this little program, the image SHI002 is
exactly aligned with PAD003 (see Fig 26).</p>

<center><img width="150" height="150" src="./img/shi002.gif"> <img
width="150" height="150" src="./img/pad003.gif"></center>

<center><tt>SHI002 &nbsp; &nbsp; PAD003</tt></center>

<br>
<center>FIGURE 26. The result of the above program.</center>
<br>
<br>

<p><a href="#user_guider">(Back to the front page)</a></p>

<hr>
<br>

<center><a name="appendix">APPENDIX</a></center>

<br>
<hr>
This appendix is meant as a guide both to create test images, for
whatever reason, and to create sample images for the SPIDER
Tutorial as previously described. If no other images are
immediately available to you, it is a good idea to create this
image to use as a sample, in order to follow the stepwise
instructions of the <a href="#user_guider">Tutorial</a>.<br>
<br>
<a href="man/mo.html">'MO'</a>--The MODEL
operation<br>
<br>
 The following procedure will create a sample image, the one seen
at the beginning of the Tutorial. It will be a 75X75 pixel image,
composed of a diagonal sine wave with two full periods.<br>
<pre>
           EXAMPLE:  Sample Image Using 'MO'

    .OPERATION: MO                ; Use the MO operation
    .OUTPUT FILE: SAM001          ; "Sample image #1"
    .ENTER DIMS NX,NY: 75,75  ; Dimensions of image: 75x75 pixels
    .(T)(S)(C)(W)(R)(G): T        ; Generate test sine wave image
</pre>

After creating the above image, which should resemble figure 1
below, you may proceed with the beginning of the SPIDER Tutorial.<br>

<br>
<center><img width="75" height="75" src="./img/sam001.gif"></center>

<center>SAM001</center>

<br>
<center>FIGURE A1. The resultant image after following the above
example.</center>

<p><a href="#user_guider">(Back to the front page)</a></p>
</dd>
</dl>
</body>
</html>

</html>