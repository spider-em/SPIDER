<head>
<title>SPIDER: CP TO MRC (Copy SPIDER files To MRC format files)</title>
   <link rel='stylesheet' href='niceman.css' type='text/css' />
   <link rel='stylesheet' type='text/css' href='../buttons.css' />

</head>

<body>
<!-- Begin Buttons -->
<table>
<tr>
  <td><a href="../spider.html"                 id="spider">    </a></td>
  <td><a href="../user_doc.html"               id="work">      </a></td>
  <td><a href="../operations_doc.html"         id="index">     </a></td>
  <td><a href="../documents.html"              id="help">      </a></td>
  <td><a href="../faq.html"                    id="faq">       </a></td>
  <td><a href="../documents.html#2D"           id="techs">     </a></td>
  <td><a href="../techs/recon1a/Docs/mr1.html" id="recon">     </a></td>
  <td><a href="../formats.html"                id="menu">      </a></td>
  <td><a href="../installation.html"           id="install">   </a></td>
  <td><a href="../release.html"                id="new">       </a></td>
  <td><a href="https://spider-em.github.io/Web" id="web"> </a></td> 
</tr>
</table>
<br><hr>
<!-- End Buttons -->

<h2>CP TO MRC - Copy SPIDER files To MRC format files</h2>
<em>(1/6/20)</em><br />
<p>
<dl><dt><strong>PURPOSE</strong>
<p>
<dd>Copies a SPIDER-format image/volume file into a MRC format file.
to more fully support MRC file usage.
As of 2015 this operation converts to the MRC 2014+ format.
<b>Starting with SPIDER version: 22.11 this operation creates
little-endian (native Intel) byte order output files.
This operation and its expected inputs were altered in Jan 2020.
</b>
&nbsp; <a href="../exa/cptomrc.html">Example</a>.
</dl>
<p>
<dl><dt><strong>SEE ALSO</strong>
<p>
<dd><table><tr><td><a href="cpfromascii.html"><strong>CP FROM ASCII</strong></a></td><td> [Copy ASCII text file to SPIDER file]</td></tr>
<tr><td><a href="cpfromemi.html"><strong>CP FROM EMI</strong></a></td><td> [Copy EMISPEC format file to SPIDER file]</td></tr>
<tr><td><a href="cpfrommrc.html"><strong>CP FROM MRC</strong></a></td><td> [Copy MRC file to SPIDER file]</td></tr>
<tr><td><a href="cpfromnik.html"><strong>CP FROM NIK</strong></a></td><td> [Copy Nikon Coolscan format file to SPIDER file]</td></tr>
<tr><td><a href="cpfrompdb.html"><strong>CP FROM PDB</strong></a></td><td> [Copy PDB file to SPIDER format]</td></tr>
<tr><td><a href="cpfromraw.html"><strong>CP FROM RAW</strong></a></td><td> [Copy Raw Image to SPIDER file]</td></tr>
<tr><td><a href="cpfromterm.html"><strong>CP FROM TERM</strong></a></td><td> [Copy Terminal input to SPIDER image/volume]</td></tr>
<tr><td><a href="cpfromtiff.html"><strong>CP FROM TIFF</strong></a></td><td> [Copy TIFF format file to SPIDER file]</td></tr>
<tr><td><a href="cpfromvax.html"><strong>CP FROM VAX</strong></a></td><td> [Copy VAX SPIDER file to a Unix SPIDER file]</td></tr>
<tr><td><a href="cptoascii.html"><strong>CP TO ASCII</strong></a></td><td> [Copy SPIDER file to ASCII text format]</td></tr>
<tr><td><a href="cptobrix.html"><strong>CP TO BRIX</strong></a></td><td> [Copy SPIDER volume to BRIX file for "O" input]</td></tr>
<tr><td><a href="cptomrc.html"><strong>CP TO MRC</strong></a></td><td> [Copy SPIDER files To MRC format files]</td></tr>
<tr><td><a href="cptoopend.html"><strong>CP TO OPEND</strong></a></td><td> [Copy SPIDER file To Opposite Byte Endian]</td></tr>
<tr><td><a href="cptopost.html"><strong>CP TO POST</strong></a></td><td> [Copy SPIDER image to a POSTscript image]</td></tr>
<tr><td><a href="cptoraw.html"><strong>CP TO RAW</strong></a></td><td> [Copy SPIDER file to a 8-bit raw image]</td></tr>
<tr><td><a href="cptotiff.html"><strong>CP TO TIFF</strong></a></td><td> [Copy SPIDER file to a TIFF format]</td></tr>
</table></dl>
<p>
<dl><dt><strong>USAGE</strong></dt>
<p>
<dd>.OPERATION: CP TO MRC<br />
<p>
<dd>.SPIDER INPUT FILE NAME OR TEMPLATE (E.G. SPI_STK@**): SPI000<br />
[Enter the SPIDER file you want to copy. It can be an image, image
stack, image series, volume, or a volume stack.]
<p>
.MRC OUTPUT FILE NAME OR TEMPLATE (E.G. **@MRC_STK.mrc): @mrc_stk.mrc<br />
[Enter name for MRC format output file. Stacks are allowed.]
<p>
.MRC DATA MODE (0/1/2/6): 2<br />
[Possible MRC Data modes <br />
0: 8-bit signed integer, <br />
1: 16-bit signed integer, <br />
2: 32-bit real, <br />
6: 16-bit unsigned integer] <br />
<p>
</dd> <dt>If SPIDER input contains an image or image stack SPIDER asks the
following two questions:
</dd> <dd><div class="opt_inp">
<br />.DATA ORIGIN (UL/LL): UL<br />
[MRC data origin can be UL: upper left or LL: Lower left.
Relion and Cryosparc expect to have the origin: 'UL'.]
<p>
.PIXEL SIZE (A) FOR X &amp; Y AXES: 1.0 , 1.0<br />
[Pixel size value will be be multiplied by the
number of pixels in each axis to get the MRC cell dimensions.]
</div>
<p>
<p>
</dd> <dt>However if SPIDER input contains an image or image stack SPIDER asks the
following two questions:
</dd> <dd><div class="opt_inp">
'DATA ORIGIN (UL/LL) &amp; HANDEDNESS (L/R): UL L
[MRC data origin can be UL: upper left or LL: Lower left.
Relion and Cryosparc expect to have the origin: 'UL' and
handedness: 'L'.]
<p>
.PIXEL SIZE (A) FOR X, Y &amp; Z AXES: 1.0 , 1.0, 1.0<br />
[Pixel size value will be be multiplied by the
number of pixels in each axis to get the MRC cell dimensions.]
</div>
<p>
<p>
</dl>
<p>
<strong>NOTES</strong>
<ol>
<p>
<li>Can not copy SPIDER Fourier files.
<p>
<li>The simple <a href="cp.html">'CP'</a> operation
can now be used to copy to/from MRC files by just specifying
the MRC extension.
<p>
<li>The MRC file format is sometimes referred to as CCP4 format.
<p>
<li>The ancient legacy procedure "fit_ccp4_to_pdb.spi" below
creates a CCP4 file aligned for use in 'O'.
</ol>
<p>
<dl><dt><strong>SUBROUTINES</strong>
<p>
<dd><a href="../../src/copytomrc.f">COPYTOMRC</a>, <a href="../../src/opfiles.f">OPFILES</a>, <a href="../../src/opstreamfile.f">OPSTREAMFILE</a></dl>
<p>
<dl><dt><strong>CALLER</strong>
<p>
<dd><a href="../../src/copy1.f">COPY1</a> 
</dl>
<pre><pre>
;
; fit_ccp4_to_pdb.spi
;
; THIS ANCIENT PROCEDURE ORIENTS AND SHIFTS A SPIDER VOLUME THAT HAS BEEN CONVERTED TO
; A BRIX VOLUME BY "CP TO BRIX" AND HAS BEEN USED (THE BRIX VOLUME) TO
; FIT A PDB STRUCTURE USING "O" OR REAL SPACE REFINEMENT (RSR). THE OUTPUT 
; OF THIS PROCEDURE IS A CCP4 VOLUME WHICH IS AT THE CORRECT LOCATION AND 
; ORIENTATION AS THAT OF THE FITTED PDB STRUCTURE. THIS CAN BE VISUALIZED 
; USING "O", "CHIMERA" OR "PYMOL".

; ALTERNATIVELY, 

; (1) ONE CAN ALSO ORIENT AND SHIFT THE FITTED PDB FILE TO FIT THE CCP4 
; VOLUME WHICH IS GENERATED FROM THE UNROTATED AND UNSHIFTED SPIDER VOLUME,
; WHICH CAN BE VISUALIZED BY USING "O", "CHIMERA" OR "PYMOL". USE PROCEDURE 
; "fit_pdb_to_ccp4.spi" IN THE SPIDER PROCEDURE DIRECTORY"spider/proc/".

; (2) ONE CAN USE "CP TO BRIX" TO CONVERT THE UNROTATED AND UNSHIFTED 
; SPIDER VOLUME TO A BRIX VOLUME WHICH CAN BE USED TO VISUALIZE THE
; FITTED PDB STRUCTURE IN "O", "CHIMERA" OR "PYMOL".

;;;;;;;;;;;;;;;;;;;;;; BEGINING OF INPUT PARAMETERS ;;;;;;;;;;;;;;;;;;

 [input]  = 'vol_spi'
 [output] = 'vol_ccp4.ccp4'
 [ps]     = 2.82            ; Pixel size
 [len]    = 32              ; Data length for CCP4 file  

 ;;;;;;;;;;;;;;;;;;;;;; END OF INPUT PARAMETERS ;;;;;;;;;;;;;;;;;;;;;;;;

 ; ROTATE THE VOLUME SO THAT X = Y, Y = X AND Z = -Z
 RT 3D
   [input]
   _1
   90, 0, 0

 RT 3D
   _1
   _2
   0, 180, 0

 RT 3D
   _2
   _3
   180, 0, 0

 ; FIND NX, NY AND NZ
 FI [NX],[NY],[NZ]
   [input]
   12, 2, 1

 ; FIND THE CENTER IN PIXELS, FOR EVEN DIMENSION, IT IS NX/2 ETC..
 ; FOR ODD DIMENSION, IT IS (NX/2 + 1) ETC..

 [xc] = INT([NX]/2)
 [yc] = INT([NY]/2)
 [zc] = INT([NZ]/2)

 [x]  = ([NX] - 2*[xc]) + [xc]
 [y]  = ([NY] - 2*[yc]) + [yc]
 [z]  = ([NZ] - 2*[zc]) + [zc]

 ; CALCULATE THE CENTER IN ANGSTROMS
 [xa] = [x] * [ps]
 [ya] = [y] * [ps]
 [za] = [x] * [ps]

 ; CREATE THE MRC (CCP4) FILE
 ; NOTE: FOR DISPLAY, "CHIMERA" READS THE ORIGIN WHEREAS "O" READS THE STARTING 
 ; POINTS OF XYZ. ORIGIN IS GIVEN IN ANGSTROMS, STARTING POINTS ARE GIVEN IN PIXELS.

 CP TO MRC
   _3
   [output]
   [len] 
   LL
   [ps], [ps], [ps]    
 
 EN
 </pre>

</pre>
</body>
</html>