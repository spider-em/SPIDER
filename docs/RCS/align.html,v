head	1.16;
access;
symbols;
locks;
comment	@# @;


1.16
date	2012.03.30.14.30.14;	author leith;	state Exp;
branches;
next	1.15;

1.15
date	2012.03.21.16.28.18;	author leith;	state Exp;
branches;
next	1.14;

1.14
date	2012.03.21.11.47.18;	author leith;	state Exp;
branches;
next	1.13;

1.13
date	2006.09.13.12.38.45;	author leith;	state Exp;
branches;
next	1.12;

1.12
date	2005.02.04.17.27.48;	author leith;	state Exp;
branches;
next	1.11;

1.11
date	2002.12.17.15.24.44;	author leith;	state Exp;
branches;
next	1.10;

1.10
date	2000.10.16.14.09.09;	author bbaxter;	state Exp;
branches;
next	1.9;

1.9
date	2000.01.05.15.31.25;	author pawel;	state Exp;
branches;
next	1.8;

1.8
date	2000.01.05.15.29.25;	author pawel;	state Exp;
branches;
next	1.7;

1.7
date	2000.01.05.15.23.39;	author pawel;	state Exp;
branches;
next	1.6;

1.6
date	98.11.04.15.08.17;	author pawel;	state Exp;
branches;
next	1.5;

1.5
date	98.03.02.16.21.45;	author leith;	state Exp;
branches;
next	1.4;

1.4
date	98.01.30.16.50.35;	author pawel;	state Exp;
branches;
next	1.3;

1.3
date	98.01.30.16.20.13;	author leith;	state Exp;
branches;
next	1.2;

1.2
date	98.01.30.16.02.54;	author leith;	state Exp;
branches;
next	1.1;

1.1
date	98.01.30.15.22.45;	author leith;	state Exp;
branches;
next	;


desc
@@


1.16
log
@bugs
@
text
@<head>
   <title>Methodology of 2D particle alignment</title>
</head>

<body>

<a name="TOP"></a>
<center><h2>Methodology of 2D particle alignment</h2></center>

<hr>

<p>
<dd>Approaches to 2D particle alignment can be subdivided into 
    several categories.  The main division is created by the availability
    of a reference image, and the secondary division by the degree of variability 
    within the data set, <i>i.e.</i>, in how many orientations the particle 
    is observed to lie in a micrograph.<br /><br />

<i>Types of alignment problems:</i>

<ol>

<li>One or a small known number of reference images 
   are known or can be easily approximated, and
   particle orientations, i.e. the way the particle sits on a surface, 
   are well defined (with possible small variations).
   This case will  be referred to as 
   <a href="#reference"><i>Reference-based alignment</i>.</a>          </li><br />

<li>An approximation of a reference image is known and there is only one
    particle orientation (with possible small variations).  
    This case will be referred to as 
    <a href="#refi"><i>Refined Alignment with a reference</i>.</a> </li><br /> 

<li>Reference images are not known, but the data set
    can in principle be divided into a known number of homogeneous
    classes.  This case will be referred to as 
    <a href="#multiref"><i>Multireference classification alignment</i>.</a>            </li><br />

<li>Reference images are not known, but the data set
    can in principle be divided into a known number of homogeneous
    classes.  The particles can be centered. This case will be referred to as 
    <a href="#rotinv"><i>Rotationally invariant K-means alignment</i>.</a>  </li><br />

<li>Reference images are not known, and there is no clear
   groupings in the data set.  This case will be referred to as  
   <a href="#refree"><i>Reference-free alignment</i>.</a>   </li><br />

</ol>
</p>



<hr> <a name="reference"></a>                             <br \>
<center><h3>Reference-based alignment</h3></center>

<p>We assume that a limited number of  reference images are known or that a good
    approximation of them are available.  We expect all the particles to be noisy
    versions of the reference, with possible small variations.  In this case
    the alignment problem becomes a <i>pattern matching</i> problem.  We
    have to place every particle in an orientation in which it will best match
    the reference image.  In the case of multiple reference images, in
    addition, we have to decide which reference is the most similar one.  We
    must also try the mirror orientation since the particle may be flipped.  <br \>
    We use the cross-correlation coefficient to measure the similarity between 
    a particle and a reference.  </p>

<p>The <a href="./techs/align2d/ref-mult-ali.spi">ref-mult-ali.spi</a> procedure implements 
    reference based alignment with multiple references.  In this procedure alignment 
    is done using <a href="man/apshc.html">'AP SHC'</a> where 
    search for rotation is integrated with the search for translation resulting 
    highly accurate but somewhat slow alignment determination.
    The operation: <a href="man/apref.html">AP REF</a> could be used for poorer but
    faster alignment determination. </p>          

<i>Advantages of reference-based alignment:</i>         
<ul>
<li>It is very fast and robust.  Since all the reference images are
    known, every particle can be matched independently to all of them
    and the correct assignment can be based on a well-defined similarity measure
    (the correlation coefficient).                          </li>

<li>The best alignment is found in one pass through the reference
    images.                                                 </li>

<li>Results are easily verifiable.  Since the reference images are known,
    it can be easily verified by visual inspection whether the aligned particles 
    are in the proper orientation and how well they match the reference images.</li>
</ul>

<i>Disadvantages of reference-based alignment:</i>      
<ul>

<li>It relies strongly on the assumption that the particles
    resemble the reference image.  If this assumption is not true, the
    average of the aligned particles will (for noisy data) look like the
    reference, and it is difficult to decide whether this similarity is
    real or is caused by enhanced noise.                       </li>

<li>If exact reference images are not known, it is difficult and
    time consuming to come up with good approximation of the reference. </li>
</ul>





<hr /><a name="refi"></a><br \>
<center><h3>Refined Alignment with a reference</h3></center>

<p>We assume that a set of particles from one motif is
   available.  Particles are not identical, but they share the same motif (e.g.
   they are all oriented on their same side on a surface). A reference
   image may be available or can be calculated from the sample images.

   The <a href="./techs/align2d/refi-ref-ali.spi">refi-ref-ali.spi</a> 
   procedure begins with
   calculation of the global average to approximate the reference, then
   aligns all the images using the 
   <a href="man/apshc.html">'AP SHC'</a> operation, and calculates new
   average to obtain an improved reference.  These steps are iterated a 
   prescribed number of times.      </p>

<p><i>Advantages of refined Alignment with a reference:</i>  </p> 

<ul>
<li>This procedure is simple, fast, and robust.  In case of a 
    near-homogeneous data set one can obtain high-quality alignment. </li>
</ul>

<p><i>Disadvantages of refined Alignment with a reference:</i> </p>

<ul>
<li>The result depends on the first approximation of the reference image.
    By changing the way the first reference image is created one can obtain
    different results and it is difficult to determine which one is 
    correct/better.</li>

<li>If the first reference image is not a good approximation of the
    "true" average or if data set contains more than one orientation
    the results may not be stable.                              </li>
</ul>

<a href="#TOP"><i>Back to the beginning</i></a>




<hr /> <a name="multiref"></a><br />
<center><h3>Multireference classification alignment</h3></center>

<p>We assume that a very large data set is available.  It comprises
    particles in a few distinct orientations.  The data set is sufficiently
    large that at least some of the similar views occur in similar in-plane
    orientations, and so can be averaged.  Thus, 
    if we can approximately center the particles, the
    subsequent classification step should reveal some of the classes.  These
    classes are used as reference images in the next multireference
    alignment step, classification is repeated, and new classes are formed. 
    This procedure is iterated until stable classes are obtained.     </p>

    <p>Such a multireference classification alignment is sometimes called 
    <i>alignment through classification.</i>  This name reflects the idea 
    that alignment is done separately <i>within</i> groups produced by the 
    classification step.                                                             </p>

<p>The <a href="./techs/align2d/ref-mul-class-ali.spi">ref-mul-class-ali.spi</a> 
   procedure implements multireference alignment using 'AP SH'
    operation to do the alignment.  This operation employs exhaustive search
    to find rotation and translation simultaneously. In principle it should 
    be more accurate than using 'AP REF',
    but it is much slower (particularly for large number of classes).  This
    program uses the additional procedure:   
    <a href="./techs/align/proc/centr.spi">centr.spi</a>             </p>

<p>Since multireference alignment is a general idea rather than a
    detailed algorithm, 
    <a href="./techs/align2d/ref-mul-class-ali.spi">ref-mul-class-ali.spi</a>
    constitutes a particular implementation.  It
    should be considered a blueprint upon which one can build one's own
    procedure optimized for the particular data set.            </p>

<ul>
    <li>It is assumed that all the windowed particles are normalized in
    the same way.                                                       </li>  

    <li>The following free parameters have to be decided:               </li> 

    <ol>
    <li> - Radius for alignment and mask -- should correspond to the
           particle radius;                                             </li>
    <li> - Whether classification is done using all pixels within
           mask in the computation of Euclidean distance, or 
           factors from Principal Component Analysis (PCA);             </li>
    <li> - If PCA is to be used, the number of factors has to be set;   </li>
    <li> - the number of groups into which the data set will be divided -- this
           determines the number of class averages that will be obtained;    </li>
    <li> - The number of times the procedure should be repeated.        </li>       
    </ol>

    <li>The steps implemented in 
    <a href="./techs/align2d/ref-mul-class-ali.spi">ref-mul-class-ali.spi</a>: 
  
    <ol>
    <li>All the particles are centered using 
        <a href="./techs/align2d/centr.spi">centr.spi</a>. 
        In this procedure each particle
        is centered using its own rotational average as a reference, the
        particle is shifted, its new rotational average is formed and used as a
        reference, and so on, until no further shift is possible.      </li>

    <li>The particles are classified using k-means clustering. 
        Depending on the flag set either the raw particles are classified or a
        preset number of factors from PCA are used for classification.   </li>

    <li>Class averages are calculated.                                 </li>

    <li>Class averages are centered using the 
        <a href="man/cgph.html">'CG PH'</a> operation (phase
        approximation of the center of gravity).                       </li>

    <li>Class averages are rotationally aligned using the 
        <a href="man/apra.html">'AP RA'</a> operation
        (reference-free rotational alignment).                         </li>

    <li>All the particles are aligned using class averages as
        reference.  
        Each particle is placed in the orientation of its most similar reference
        image.  The alignment includes rotational alignment, shift alignment,
        and a check of mirrored orientation.  Rotational alignment is done using the
        AP MD operation and is separated from the shift alignment.  Shift is
        corrected using the most similar image (as determined by AP MD) as a
        reference.                                                  </li>

    <li>Alignment parameters are combined with the alignment
        parameters obtained in the previous step and a new, aligned image series
        is formed.                                                   </li>

    <li>Steps 2-7 are repeated a prescribed number of times.        </li>
    </ul>


<p><i>Advantages of multireference classification alignment:</i>                  </p>

<ul> 
<li>It is quite powerful. It is possible to obtain stable groups for data 
    with very low signal-to-noise ratio (SNR).  It works for data sets containing
    a mixture of entirely different views (an often-encountered problem, in which side
    views are, say, rectangular, and top views are circular).      </li>

<li>The approach is a general idea rather than a "black-box" program; 
    thus, it can be easily modified to the requirements of a particular data
    set.                                                          </li>

<li>There are many parameters that can be adjusted to better control the results.</li>

<li>Results are easily verifiable.  Since the class averages are formed
    it can be easily verified whether the aligned particles are in the proper
    orientation and how well they match the averages.              </li>
</ul> 

<p><i>Disadvantages of multireference classification alignment:</i>            </p>

<ul> 
<li>A very large data set is needed.  The program depends on the initial
    orientation of particles, <i>i.e.</i>, at least some of the similar views occur 
    in similar in-plane orientations, so that meaningful averages can be formed.
    Statistically, this can only happen in an adequately large data set. 
    Moreover, these averages should have a sufficiently high SNR to jumpstart the
    alignment, so they should each contain a sufficient number of particles.</li>

<li>The result is somewhat unpredictable.  It is impossible in practice
    to verify whether rare views were revealed as classes or remained
    misaligned and/or misclassified.                           </li>

<li>Since the approach is a general idea rather than a well-defined
    procedure, the result will differ depending on the particular implementation. 
    Thus, results obtained by different users/groups are difficult to
    compare.                                                   </li>

<li>Even if the general framework is decided upon the large number of
    crucial free parameters leaves the user with hard choices to make.  The
    results will depend on the values chosen and will differ from one trial
    to another.  The two most difficult choices are the number of clusters and
    number of factors for PCA.  Too few clusters will conceal rare views, while
    too many will result in large numbers of very similar averages, or else the
    procedure will fail due to a too-low SNR.               </li>

<li>The procedure is very slow.                             </li>
</ul>

<a href="#TOP"><i>Back to the beginning</i></a>




<hr /><a name="rotinv"></a><br />
<center><h3>Rotationally invariant K-means Alignment</h3></center>

<p>We assume that the particles were centered and we can divide
    the data set into a specified number of orientation classes.  In this case, 
    operation <a href="man/apca.html">'AP CA'</a>
    will perform classification and alignment.  For each particle the
    rotation angle as well as the group assignment will be found. 
    The procedure: <a href="./techs/align2d/rotkm-ali.spi">rotkm-ali.spi</a> 
    demonstrates how to use <a href="man/apca.html">'AP CA'</a>  
    and how to calculate group averages.                </p>
 
<a href="#TOP"><i>Back to the beginning</i></a>




<hr /><a name="refree"></a>  <br />
<center><h3>Reference-free alignment</h3></center>

<p>The rationale of the reference-free alignment is explained in the 
    <a href=./reffreealign.html><i>Introduction to Reference-Free Alignment</i>.</a>  
    The procedure will seek such orientations of all the particles in the data
    set that all the possible pairs of images from this
    set are in the 'best' relative orientation as determined by the
    maximum of the CCF.                              </p>

<p> The reference-free alignment procedures were designed for very noisy data, for
    particles in many different orientations, and in general for cases in which 
    a reference image is unknown or in which its usage could result in a bias and
    incorrect results.  There are three basic operations in SPIDER that implement
    this strategy:  <br />

    <a href="man/apsa.html">'AP SA'</a> is a shift alignment, 
    <a href="man/apra.html">'AP RA'</a> is a rotational alignment, and  
    <a href="man/apsr.html">'AP SR'</a> is a combined shift and 
     rotational alignment.</p> 

<p> In addition, <a href="man/apca.html">'AP CA'</a> 
    performs both classification and
    rotational alignment for pre-centered data.  Unlike previous procedures
    none of these procedures 
    checks mirrored orientations; thus, any mirror-related views will appear
    as two different orientations.  All the alignment operations can be either
    used separately or as a part of longer, more elaborate alignment
    schemes. </p>

<p>The procedure: 
    <a href="./techs/align2d/ref-free-apra-ali.spi">ref-free-apra-ali.spi</a> uses 
    <a href="man/apra.html">'AP RA'</a> to
    rotationally align an image series and applies parameters stored by 
    the operation in a document file to rotate all the particles.  
    Subsequently, aligned articles are subjected to PCA and
    classified using 
     <a href=../classification/tutorial.html>hierarchical classification</a> .     </p>

<p>The procedure:  
    <a href="./techs/align2d/ref-free-apsara-ali.spi">ref-free-apsara-ali.spi</a>  
    alternates between 
    <a href="man/apsa.html">'AP SA'</a>  and 
    <a href="man/apra.html">'AP RA'</a> to align an image series both
    translationally and rotationally.                  </p>

<p>The procedure: 
    <a href="./techs/align2d/ref-free-apsr-ali.spi">ref-free-apsr-ali.spi</a> uses 
    operation <a href="man/apsr.html">'AP SR'</a> to
    align an image series and applies parameters stored
    in a document file to rotate and shift all the particles.  
    Subsequently, aligned particles are subjected to PCA and
    classified using Hierarchical Classification.</p>

<p>Another approach to alignment uses self-correlation functions. 
    See   
    <a href="man/po.html">'PO'</a>, 
    <a href="man/ccp.html">'CC P'</a>, 
    <a href="man/acs.html">'AC S'</a>, 
    <a href="man/acns.html">'AC NS'</a>, 
    <a href="man/acmss.html">'AC MSS'</a>, 
    <a href="man/eptm.html">'EP TM'</a>, and 
    <a href="man/ccms.html">'CC MS'</a> for info on usefull operations.</p>

<!--
<p>The procedure: 
   <a href="./techs/align2d/ref-free-self-ali.spi">ref-free-self-ali.spi</a>   
    uses some of these operations to perform 2D alignment via self-correlation.</p>
-->


<p><i>Advantages of reference-free alignment:</i>      </p>

<ul>
<li>The operation <a href="man/apsr.html">'AP SR'</a>
    is very fast and robust.</li>

<li>The method has very few free parameters -- essentially only the
    radius of the particle.  The results do not depend significantly on
    these parameters, and there are no assumptions made about the reference,
    number of groups, and so on.                       </li>
</ul>

<p><i>Disadvantages of reference-free alignment:</i>    </p>

<ul>
<li>It is difficult to assess how well the particles were aligned.  In
    most practical cases the program gives a nearly-optimum solution, but in
    some cases (particularly for mixtures of entirely different shapes, but also
    for very low SNR or very small data sets) it may fail.  In these
    situations one should either use a combination of 
    <a href="man/apsa.html">'AP SA'</a> and 
    <a href="man/apra.html">'AP RA'</a> 
    (with more free parameters, and thus easier to control), 
    or multireference alignment.                  </li> 
</ul>

<a href="#TOP"><i>Back to the beginning</i></a>



<hr>

<small>
Source: align.html       &nbsp;&nbsp;&nbsp;  
Last update: 21 Mar 2012 &nbsp;&nbsp;&nbsp;
</small>

</body>
@


1.15
log
@date
@
text
@d68 1
a68 1
<p>The <a href="./techs/align2d/ref-ali.spi">ref-ali.spi</a> procedure implements 
d70 1
a70 1
    is done using <a href="man/apshc.html">'AP SHC'</a>) in which
a103 2
<a href="#TOP"><i>Back to the beginning</i></a>

d116 1
a116 1
   The <a href="./techs/align2d/ref-refi-ali.spi">ref-refi-ali.spi</a> 
d119 2
a120 1
   aligns all the images using the 'AP SHC' operation, and calculates new
d173 2
a174 4
    program uses the additional procedures:   
    <a href="./techs/align/proc/alqr.mar">alqr.mar</a>,
    <a href="./techs/align/proc/centr.mar">centr.mar</a>, &amp;
    <a href="./techs/align/proc/combat.mar">combat.mar</a>      </p>
d206 1
a206 1
        <a href="./techs/align2d/centr.mar">centr.mar</a>. 
d227 1
a227 2
        reference in the procedure 
        <a href="./techs/align2d/alqmd.mar">alqmd.mar</a>.  
d378 1
d382 2
@


1.14
log
@rewrite
@
text
@d420 1
a420 1
Last update: 22 Mar 2012 &nbsp;&nbsp;&nbsp;
@


1.13
log
@procedure
@
text
@d13 16
a28 19
<dd>The approaches to 2D particle alignment can be subdivided into 
several categories.  The main division is created by the availability
of a reference image, and the secondary division by the degree of variability 
within the data set, <i>i.e.</i>, in how many orientations the particle 
is observed to lie in a micrograph.<br /><br />

<I>Types of alignment problems:</i>

<ul>
<li>A reference image is known or can be easily 
   approximated, and there is only one particle orientation (with possible 
   small variations).  This case will be called <a href="#reference"><i>Reference-based
   alignment</i>.</a><br \><br \>

<li>A small number of reference images 
   are known or can be easily approximated, and their number is known, and
   particle orientations are well defined (with possible small variations).
   This case will also be called 
   <a href="#reference"><i>Reference-based alignment</i>.</a><br \><br \>
d32 2
a33 2
   This case will be called <a href="#refi"><i>Alignment with the reference
   refinement</i>.</a><br \><br \>
d36 3
a38 3
   can in principle be divided into a number (unknown) of homogeneous
   classes.  This case will be called 
   <a href="#multiref"><i>Multireference alignment</i>.</a><br \><br \>
d41 3
a43 6
   can in principle be divided into a number (unknown) of homogeneous
   classes.  The particles can be centered. This case will be called 
   <a href="#rotinv"><i>Rotationally invariant K-means 
   algorithm</i>.</a><br \><br \>


d46 2
a47 2
   groupings in the data set.  This case will be called <a href="#refree"><i>Reference-free 
   alignment</i>.</a><br \><br \>
d49 2
a50 2
</ul>
<a href="#TOP"><i>Back to the beginning</i></a>
a51 3
<p>Note: the information below utilizes the older "AP MQ' and "AP MD" operatiions
which should be updated for the newer 'AP SH" & " AP REF" operations.
</p>
a52 1
<hr>
d54 1
a54 1
<a name="reference"></a><br \>
d57 18
a74 22
<p><dd>We assume that the reference image is known or that a good
approximation of it is available.  We expect all the particles to be noisy
versions of the reference, with possible small variations.  In this case
the alignment problem becomes a <i>pattern matching</i> problem.  We
have to place every particle in an orientation in which it will best match
the reference image.  In the case of many reference images, in
addition, we have to decide which reference is the most similar one.  We
must also try the mirror orientation since the particle may be flipped.<br \>
<p>

<dd>We use the cross-correlation coefficient to measure the similarity between 
a particle and a reference.

The operation that performs reference-based alignment is 
<A href="man/apmq.html">AP MQ</A>.<br \>

<p><dd>The <a href="./techs/align/proc/b01.amq">b01.amq</a> procedure implements the
basic steps of the reference-based alignment.  "Expected size of the object" is 
an important alignment parameter.  It determines the search range for the
translation parameters.  A small expected size will result in a large
search range and a very long computation time.<br \><br \>
<i>Advantages of reference-based alignment:</i><br \><br \>
d76 2
d79 3
a81 3
known, every particle can be matched independently to all of them
and the correct assignment can be based on a well-defined similarity measure
(the correlation coefficient).<br \><br \>
d84 1
a84 1
images.<br \><br \>
d87 6
a92 3
it can be easily verified by visual inspection whether the aligned particles 
are in the proper orientation and how well they match the reference images.<br \><br \>
<br \><i>Disadvantages of reference-based alignment:</i><br \><br \>
d95 4
a98 4
resemble the reference image.  If this assumption is not true, the
average of the aligned particles will (for noisy data) look like the
reference, and it is difficult to decide whether this similarity is
real or is caused by enhanced noise.<br \><br \>
d101 2
a102 2
time consuming to come up with good approximation of reference.
<br \><br \>
a105 1
<hr />
a106 2
<a name="refi"></a><br \>
<center><h3>Alignment with the reference refinement</h3></center>
a107 14
<p><dd>We assume that a set of particles in one orientation is
available.  Particles are not identical, but they share the same motif.
The <a href="./techs/align/proc/b03.mar">b03.mar</a> procedure begins with
calculation of the global average to approximate the reference, then
aligns all the images using the 'AP MQ' operation, and calculates new
average to obtain improved reference.  These steps are iterated
prescribed number of times.  This program uses two additional procedures:
<a href="./techs/align/proc/alqr.mar">alqr.mar</a> and
<a href="./techs/align/proc/combat.mar">combat.mar</a>.  <br />
<i>Advantages of alignment with the reference refinement:</i><br /><br />

<li>This procedure is simple, fast, and robust.  In case of a near-homogeneous
data set one can obtain high-quality alignment.<br /><br />
<i>Disadvantages of alignment with the reference refinement:</i><br /><br />
d109 26
d136 3
a138 2
By changing the way the first reference image is created one can obtain
different results and it is difficult to determine which one is correct/better.<br /><br />
d141 3
a143 2
"true" average or if data set contains more than one orientations
the results will not be stable.<br /><br />
a146 1
<hr />
a147 1
<a name="multiref"></a><br />
a148 89
<center><h3>Multireference alignment</h3></center>
<p><dd>We assume that a very large data set is available.  It comprises
particles in a few distinct orientations.  The data set is sufficiently
large that at least some of the similar views occur in similar in-plane
orientations, and so can be averaged.  Thus, 
if we can approximately center the particles, the
subsequent classification step should reveal some of the classes.  These
classes are used as reference images in the next multireference
alignment step, classification is repeated, and new classes are formed. 
This procedure is iterated until stable classes are obtained.<br />
<p><dd>Such a multireference alignment is sometimes called <i>alignment
through classification.</i>  This name reflects the idea that alignment
is done separately <i>within</i> groups produced by the classification
step.<br />

<p><dd>The <a href="./techs/align/proc/b63.mar">b01.mar</a> procedure implements the
multireference alignment.  In this procedure search for rotation (done using AP MD)
is separated from the search for translation (CC N in procedure
alqmd.mar) resulting in a fast, albeit possibly not the most accurate
program.
It uses the additional procedures:<br /><br />
<a href="./techs/align/proc/alqmd.mar">alqmd.mar</a><br />
<a href="./techs/align/proc/centr.mar">centr.mar</a><br />
<a href="./techs/align/proc/combat.mar">combat.mar</a><br /><br />
<p><dd>Another version, <a href="./techs/align/proc/b52.mar">b02.mar</a>, uses AP MQ
operation to do the alignment.  This operation employs exhaustive search
to find rotation and translation simultaneously. In principle it should 
be more accurate,
but it is very slow (particularly for large number of classes).  This
program uses the additional procedures:<br /><br />
<a href="./techs/align/proc/alqr.mar">alqr.mar</a><br />
<a href="./techs/align/proc/centr.mar">centr.mar</a><br />
<a href="./techs/align/proc/combat.mar">combat.mar</a><br /><br />

Since the multireference alignment is a general idea rather than a
detailed algorithm, b01.mar constitutes a particular implementation.  It
should be considered a blueprint upon which one can build one's own
procedure optimized for the particular data set.<br /><br />

<dd><li>It is assumed that all the windowed particles are normalized in
the same way.<br /><br />

<dd><li>The following free parameters have to be decided:<br /><br />

<dd><i>(a)</i> - radius for alignment and mask -- should correspond to the
particle radius;<br /><br />

<dd><i>(b)</i> - whether classification is done using all pixels within
mask in the computation of Euclidean distance, or 
factors from Principal Component Analysis (PCA);<br /><br />

<dd><i>(c)</i> - if PCA is to be used, the number of factors has to be set;<br /><br />

<dd><i>(d)</i> - the number of groups into which the data set will be divided -- this
determines the number of class averages that will be obtained;<br /><br />

<dd><i>(e)</i> - the number of times the procedure should be repeated.<br /><br />
The steps implemented in b01.mar:<br /><br />

<dd><li>1.  All the particles are centered using <a
href="./techs/align/proc/centr.mar">centr.mar</a>. In this procedure each particle
is centered using its own rotational average as a reference, the
particle is shifted, its new rotational average is formed and used as a
reference, and so on, until no further shift is possible.<br /><br />

<dd><li>2.  The particles are classified using k-means clustering. 
Depending on the flag set either the raw particles are classified or a
preset number of factors from PCA is used for classification.<br /><br />

<dd><li>3.  Class averages are calculated.<br /><br />

<dd><li>4.  Class averages are centered using the CG PH operation (phase
approximation of the center of gravity).<br /><br />

<dd><li>5.  Class averages are rotationally aligned using the AP RA operation
(reference-free rotational alignment).<br /><br />

<dd><li>6.  All the particles are aligned using class averages as
reference in the procedure <a href="./techs/align/proc/alqmd.mar">alqmd.mar</a>.  
Each particle is placed in the orientation of its most similar reference
image.  The alignment includes rotational alignment, shift alignment,
and a check of mirrored orientation.  Rotational alignment is done using the
AP MD operation and is separated from the shift alignment.  Shift is
corrected using the most similar image (as determined by AP MD) as a
reference.<br /><br />

<dd><li>7.  Alignment parameters are combined with the alignment
parameters obtained in the previous step and a new, aligned image series
is formed.<br /><br />
d150 35
a184 2
<dd><li>8.  Steps 2-7 are repeated a prescribed number of times.<br /><br />
<i>Advantages of multireference alignment:</i><br /><br />
d186 64
d251 3
a253 3
with very low signal-to-noise ratio (SNR).  It works for data sets containing
a mixture of entirely different views (an often-encountered problem, in which side
views are, say, rectangular, and top views are circular).<br /><br />
d256 2
a257 2
thus, it can be easily modified to the requirements of a particular data
set.<br /><br />
d259 1
a259 1
<li>There are many parameters that can be adjusted to better control the results.<br /><br />
d262 3
a264 3
it can be easily verified whether the aligned particles are in the proper
orientation and how well they match the averages.<br /><br />
<br /><i>Disadvantages of multireference alignment:</i><br /><br />
d266 3
d270 5
a274 5
orientation of particles, <i>i.e.</i>, at least some of the similar views occur 
in similar in-plane orientations, so that meaningful averages can be formed.
Statistically, this can only happen in an adequately large data set. 
Moreover, these averages should have a sufficiently high SNR to jumpstart the
alignment, so they should each contain a sufficient number of particles.<br /><br />
d277 2
a278 2
to verify whether rare views were revealed as classes or remained
misaligned and/or misclassified.<br /><br />
d281 3
a283 3
procedure, the result will differ depending on the particular implementation. 
Thus, results obtained by different users/groups are difficult to
compare.<br /><br />
d286 6
a291 6
crucial free parameters leaves the user with hard choices to make.  The
results will depend on the values chosen and will differ from one trial
to another.  The two most difficult choices are the number of clusters and
number of factors for PCA.  Too few clusters will conceal rare views, while
too many will result in large numbers of very similar averages, or else the
procedure will fail due to a too-low SNR.<br /><br />
d293 2
a294 1
<li>The procedure is very slow.<br /><br />
d298 15
a312 11
<hr />
<a name="rotinv"></a><br />
<center><h3>Rotationally invariant K-means algorithm</h3></center>

<p><dd>We assume that the particles were centered and we can divide
the data set into a specified number of classes.  In this case, operation AP CA
will perform classification and alignment.  For each particle the
rotation angle as well as the group assignment will be found.  For
details see corresponding manual chapter.
The <a href="./techs/align/proc/b22.apc">b22.apc</a> demonstrates how to
use AP CA operation and how to calculate group averages.
d315 4
a318 2
<hr />
<a name="refree"></a><br />
d321 64
a384 45
<p><dd>The rationale of the reference-free alignment is explained in the 
<a href=./reffreealign.html>
<i>Introduction to the Reference-Free Alignment Programs</i>.</a>  
The program will seek such orientations of all the particles in the data
set that all the possible pairs of images from this
set are in the 'best' relative orientation as determined by the
maximum of the CCF.<br />
<p><dd>The reference-free alignment programs were designed for very noisy data, for
particles in many different orientations, and in general for cases in which 
a reference image is unknown or in which its usage could result in a bias and
incorrect results.  There are three basic operations in SPIDER that implement
this strategy: AP SA, AP RA, and AP SR.  AP SA is a shift alignment, AP
RA is a rotational alignment, AP SR is a combined shift and rotational
alignment.  In addition, AP CA performs both classification and
rotational alignment for pre-centered data.  Unlike previous procedures
none of these programs
checks mirrored orientations; thus, any mirror-related views will appear
as two different orientations.  All the alignment operations are "do-all"
operations -- they will perform all the necessary operations and store the
alignment parameters in the document files.  Thus, they can be either
used separately or as a part of longer, more elaborate alignment
schemes.<br /><br />

<li>The <a href="./techs/align/proc/b05.rtq">b05.rtq</a> procedure uses AP RA to
rotationally align an image series and applies parameters stored by AP RA
in a document file to rotate all the particles.  Subsequently, aligned
particles are subjected to PCA and
classified using Hierarchical Classification.<br /><br />

<li>The <a href="./techs/align/proc/b02.sub">b02.sub</a> procedure 
alternates between AP SA and AP RA to align an image series both
translationally and rotationally.<br /><br />

<li>The <a href="./techs/align/proc/b06.aps">b06.aps</a> procedure uses AP SR to
align an image series and applies parameters stored
in a document file to rotate and shift all the particles.  Subsequently, aligned
particles are subjected to PCA and
classified using Hierarchical Classification.<br /><br />
<p><dd>Another approach to alignment uses self-correlation functions. 
See the <a href="operations_doc.html">SPIDER Manual</a> 
for information on the PO, CC P, AC S, AC NS, AC MSS, EP TM, and CC MS operations.<br /><br />

<li>The <a href="./techs/align2d/b08.scf">b08.scf</a> procedure 
uses these operations to perform 2D alignment via self-correlation.<br /><br />
<i>Advantages of reference-free alignment:</i><br /><br />
d386 5
a390 1
<li>The operation AP SR is very fast and robust.<br /><br />
d393 4
a396 4
radius of the particle.  The results do not depend significantly on
these parameters, and there are no assumptions made about the reference,
number of groups, and so on.<br /><br />
<i>Disadvantages of reference-free alignment:</i><br /><br />
d398 3
d402 10
a411 6
most practical cases the program gives a nearly-optimum solution, but in
some cases (particularly for mixtures of entirely different shapes, but also
for very low SNR or very small data sets) it may fail.  In these
situations one should either use a combination of AP SA and AP RA (with
more free parameters, and thus easier to control), or multireference
alignment.<br /><br />
d414 2
d419 2
a420 2
Source: align.html     &nbsp;&nbsp;&nbsp;  
Last update: 13 Sept. 2006 &nbsp;&nbsp;&nbsp;
@


1.12
log
@some update
@
text
@d2 1
a2 1
<title>Methodology of 2D particle alignment</title>
d17 1
a17 1
is observed to lie in a micrograph.<BR><BR>
d25 1
a25 1
   alignment</i>.</a><br><br>
d31 1
a31 1
   <a href="#reference"><i>Reference-based alignment</i>.</a><br><br>
d36 1
a36 1
   refinement</i>.</a><br><br>
d41 1
a41 1
   <a href="#multiref"><i>Multireference alignment</i>.</a><br><br>
d47 1
a47 1
   algorithm</i>.</a><br><br>
d53 1
a53 1
   alignment</i>.</a><br><br>
d64 2
a65 2
<a name="reference"></a><br>
<center><h3>Reference-based alignment</H3></center>
d74 1
a74 1
must also try the mirror orientation since the particle may be flipped.<br>
d81 1
a81 1
<A href="man/apmq.html">AP MQ</A>.<br>
d83 1
a83 1
<p><dd>The <a href="./techs/align/proc/b01.amq">b01.amq</a> batch program implements the
d87 2
a88 2
search range and a very long computation time.<br><br>
<i>Advantages of reference-based alignment:</i><br><br>
d93 1
a93 1
(the correlation coefficient).<br><br>
d96 1
a96 1
images.<br><br>
d100 2
a101 2
are in the proper orientation and how well they match the reference images.<br><br>
<br><i>Disadvantages of reference-based alignment:</i><br><br>
d107 1
a107 1
real or is caused by enhanced noise.<br><br>
d111 1
a111 1
<br><br>
d115 1
a115 1
<HR>
d117 2
a118 2
<a name="refi"></a><br>
<CENTER><H3>Alignment with the reference refinement</H3></CENTER>
d122 1
a122 1
The <a href="./techs/align/proc/b03.mar">b03.mar</a> batch program begins with
d124 1
a124 1
aligns all the images using the AP MQ operation, and calculates new
d128 2
a129 2
<a href="./techs/align/proc/combat.mar">combat.mar</a>.<br>
<i>Advantages of alignment with the reference refinement:</i><br><br>
d132 2
a133 2
data set one can obtain high-quality alignment.<br><br>
<i>Disadvantages of alignment with the reference refinement:</i><br><br>
d137 1
a137 1
different results and it is difficult to determine which one is correct/better.<br><br>
d141 1
a141 1
the results will not be stable.<br><br>
d145 1
a145 2
<HR>
<a name="multiref"></a><br>
d147 3
a149 1
<CENTER><H3>Multireference alignment</H3></CENTER>
d158 1
a158 1
This procedure is iterated until stable classes are obtained.<br>
d162 1
a162 1
step.<br>
d164 1
a164 1
<p><dd>The <a href="./techs/align/proc/b63.mar">b01.mar</a> batch program implements the
d169 4
a172 4
It uses the additional procedures:<br><br>
<a href="./techs/align/proc/alqmd.mar">alqmd.mar</a><br>
<a href="./techs/align/proc/centr.mar">centr.mar</a><br>
<a href="./techs/align/proc/combat.mar">combat.mar</a><br><br>
d178 4
a181 4
program uses the additional procedures:<br><br>
<a href="./techs/align/proc/alqr.mar">alqr.mar</a><br>
<a href="./techs/align/proc/centr.mar">centr.mar</a><br>
<a href="./techs/align/proc/combat.mar">combat.mar</a><br><br>
d186 1
a186 1
procedure optimized for the particular data set.<br><br>
d189 1
a189 1
the same way.<br><br>
d191 1
a191 1
<dd><li>The following free parameters have to be decided:<br><br>
d194 1
a194 1
particle radius;<br><br>
d198 1
a198 1
factors from Principal Component Analysis (PCA);<br><br>
d200 1
a200 1
<dd><i>(c)</i> - if PCA is to be used, the number of factors has to be set;<br><br>
d203 1
a203 1
determines the number of class averages that will be obtained;<br><br>
d205 2
a206 2
<dd><i>(e)</i> - the number of times the procedure should be repeated.<br><br>
The steps implemented in b01.mar:<br><br>
d212 1
a212 1
reference, and so on, until no further shift is possible.<br><br>
d216 1
a216 1
preset number of factors from PCA is used for classification.<br><br>
d218 1
a218 1
<dd><li>3.  Class averages are calculated.<br><br>
d221 1
a221 1
approximation of the center of gravity).<br><br>
d224 1
a224 1
(reference-free rotational alignment).<br><br>
d233 1
a233 1
reference.<br><br>
d237 1
a237 1
is formed.<br><br>
d239 2
a240 2
<dd><li>8.  Steps 2-7 are repeated a prescribed number of times.<br><br>
<i>Advantages of multireference alignment:</i><br><br>
d245 1
a245 1
views are, say, rectangular, and top views are circular).<br><br>
d249 1
a249 1
set.<br><br>
d251 1
a251 1
<li>There are many parameters that can be adjusted to better control the results.<br><br>
d255 2
a256 2
orientation and how well they match the averages.<br><br>
<br><i>Disadvantages of multireference alignment:</i><br><br>
d263 1
a263 1
alignment, so they should each contain a sufficient number of particles.<br><br>
d267 1
a267 1
misaligned and/or misclassified.<br><br>
d272 1
a272 1
compare.<br><br>
d280 1
a280 1
procedure will fail due to a too-low SNR.<br><br>
d282 1
a282 1
<li>The procedure is very slow.<br><br>
d286 3
a288 3
<HR>
<a name="rotinv"></a><br>
<CENTER><H3>Rotationally invariant K-means algorithm</H3></CENTER>
d299 3
a301 3
<HR>
<a name="refree"></a><br>
<CENTER><H3>Reference-free alignment</H3></CENTER>
d309 1
a309 1
maximum of the CCF.<br>
d324 1
a324 1
schemes.<br><br>
d326 1
a326 1
<li>The <a href="./techs/align/proc/b05.rtq">b05.rtq</a> batch program uses AP RA to
d330 1
a330 1
classified using Hierarchical Classification.<br><br>
d332 1
a332 1
<li>The <a href="./techs/align/proc/b02.sub">b02.sub</a> batch program 
d334 1
a334 1
translationally and rotationally.<br><br>
d336 1
a336 1
<li>The <a href="./techs/align/proc/b06.aps">b06.aps</a> batch program uses AP SR to
d340 1
a340 1
classified using Hierarchical Classification.<br><br>
d343 1
a343 1
for information on the PO, CC P, AC S, AC NS, AC MSS, EP TM, and CC MS operations.<br><br>
d345 3
a347 3
<li>The <a href="./techs/align2d/b08.scf">b08.scf</a> batch program 
uses these operations to perform 2D alignment via self-correlation.<br><br>
<i>Advantages of reference-free alignment:</i><br><br>
d349 1
a349 1
<li>The operation AP SR is very fast and robust.<br><br>
d354 2
a355 2
number of groups, and so on.<br><br>
<i>Disadvantages of reference-free alignment:</i><br><br>
d363 1
a363 1
alignment.<br><br>
d370 1
a370 1
Last update: 4 Feb. 2005 &nbsp;&nbsp;&nbsp;
@


1.11
log
@b22
@
text
@d17 10
a26 8
is observed to lie in
a micrograph.<BR><BR>
<I>Types of alignment problems:</I>
<UL>
<LI>A reference image is known or can be easily 
approximated, and there is only one particle orientation (with possible 
small variations).  This case will be called <a HREF="#reference"><i>Reference-based
alignment</i>.</a><br><br>
d28 5
a32 4
are known or can be easily approximated, and their number is known, and
particle orientations are well defined (with possible small variations).
This case will also be called 
<a HREF="#reference"><i>Reference-based alignment</i>.</a><br><br>
d34 4
a37 3
 particle orientation (with possible small variations).  
This case will be called <a HREF="#refi"><i>Alignment with the reference
refinement</i>.</a><br><br>
d39 3
a41 3
can in principle be divided into a number (unknown) of homogeneous
classes.  This case will be called 
<a HREF="#multiref"><i>Multireference alignment</i>.</a><br><br>
d44 4
a47 4
can in principle be divided into a number (unknown) of homogeneous
classes.  The particles can be centered. This case will be called 
<a HREF="#rotinv"><i>Rotationally invariant K-means 
algorithm</i>.</a><br><br>
d52 3
a54 2
groupings in the data set.  This case will be called <a HREF="#refree"><i>Reference-free 
alignment</i>.</a><br><br>
d57 7
a63 1
<HR>
d65 2
a66 1
<CENTER><H3>Reference-based alignment</H3></CENTER>
d75 3
a77 1
<p><dd>We use the cross-correlation coefficient to measure the similarity between 
d79 5
a83 3
The command that performs reference-based alignment is <A HREF="man/apmq.html">AP
MQ</A>.<br>
<p><dd>The <a HREF="./techs/align/proc/b01.amq">b01.amq</a> batch program implements the
d89 1
d94 1
d97 1
d102 1
d108 1
d112 1
d115 1
a116 1
<HR>
d119 1
d122 1
a122 1
The <a HREF="./techs/align/proc/b03.mar">b03.mar</a> batch program begins with
d124 1
a124 1
aligns all the images using the AP MQ command, and calculates new
d127 2
a128 2
<a HREF="./techs/align/proc/alqr.mar">alqr.mar</a> and
<a HREF="./techs/align/proc/combat.mar">combat.mar</a>.<br>
d130 1
d134 1
d138 1
d147 1
d162 2
a163 1
<p><dd>The <a HREF="./techs/align/proc/b63.mar">b01.mar</a> batch program implements the
d169 5
a173 5
<a HREF="./techs/align/proc/alqmd.mar">alqmd.mar</a><br>
<a HREF="./techs/align/proc/centr.mar">centr.mar</a><br>
<a HREF="./techs/align/proc/combat.mar">combat.mar</a><br><br>
<p><dd>Another version, <a HREF="./techs/align/proc/b52.mar">b02.mar</a>, uses AP MQ
command to do the alignment.  This command employs exhaustive search
d178 3
a180 3
<a HREF="./techs/align/proc/alqr.mar">alqr.mar</a><br>
<a HREF="./techs/align/proc/centr.mar">centr.mar</a><br>
<a HREF="./techs/align/proc/combat.mar">combat.mar</a><br><br>
d186 1
d189 1
d191 1
d194 1
d198 1
d200 1
d203 1
d206 1
d208 1
a208 1
HREF="./techs/align/proc/centr.mar">centr.mar</a>. In this procedure each particle
d212 1
d216 1
d218 2
a219 1
<dd><li>4.  Class averages are centered using the CG PH command (phase
d221 2
a222 1
<dd><li>5.  Class averages are rotationally aligned using the AP RA command
d224 1
d226 1
a226 1
reference in the procedure <a HREF="./techs/align/proc/alqmd.mar">alqmd.mar</a>.  
d230 1
a230 1
AP MD command and is separated from the shift alignment.  Shift is
d233 1
d237 1
d240 1
d245 1
d249 1
d251 1
d256 1
d263 1
d267 1
d272 1
d280 1
d290 1
a290 1
the data set into a specified number of classes.  In this case, command AP CA
d294 2
a295 2
The <a HREF="./techs/align/proc/b22.apc">b22.apc</a> demonstrates how to
use AP CA command and how to calculate group averages.
d297 1
d301 1
d303 1
a303 1
<a HREF=./reffreealign.html>
d312 1
a312 1
incorrect results.  There are three basic commands in SPIDER that implement
d319 2
a320 2
as two different orientations.  All the alignment commands are "do-all"
commands -- they will perform all the necessary operations and store the
d324 2
a325 1
<li>The <a HREF="./techs/align/proc/b05.rtq">b05.rtq</a> batch program uses AP RA to
d330 2
a331 1
<li>The <a HREF="./techs/align/proc/b02.sub">b02.sub</a> batch program 
d334 2
a335 1
<li>The <a HREF="./techs/align/proc/b06.aps">b06.aps</a> batch program uses AP SR to
d340 5
a344 2
<p><dd>Another approach to alignment uses self-correlation functions. See the <a HREF="http://www.wadsworth.org/spider_doc/spider/docs/operations_doc.html">SPIDER Manual</a> for information on the PO, CC P, AC S, AC NS, AC MSS, EP TM, and CC MS commands.<br><br>
<li>The <a HREF="./techs/align2d/b08.scf">b08.scf</a> batch program 
d347 3
a349 1
<li>The command AP SR is very fast and robust.<br><br>
d355 1
d369 1
a369 1
Last update: 17 Dec 2002 &nbsp;&nbsp;&nbsp;
@


1.10
log
@Added self-correlation to Reference-free section.
@
text
@d1 3
a3 3
<HEAD>
<TITLE>Methodology of 2D particle alignment</TITLE>
</HEAD>
d5 1
a5 1
<BODY>
d7 4
a10 3
<A NAME="TOP"></A>
<CENTER><H2>Methodology of 2D particle alignment</H2></CENTER>
<HR>
d12 2
a13 1
<P><DD>The approaches to 2D particle alignment can be subdivided into 
d242 1
a242 1
The <a HREF="./techs/align/proc/b22.apc">b02.apc</a> demonstrates how to
d301 4
a304 2
<HR>
<SMALL>
d306 2
a307 2
Last update: 30 Jan 1998 &nbsp;&nbsp;&nbsp;
</SMALL>
d309 1
a309 1
</BODY>
@


1.9
log
@..\
@
text
@d281 3
@


1.8
log
@*** empty log message ***
@
text
@d103 1
a103 1
<a HREF=".techs/align/proc/combat.mar">combat.mar</a>.<br>
@


1.7
log
@*** empty log message ***
@
text
@d103 1
a103 1
<a HREF=".techs/align/proc/combat.mar>combat.mar</a>.<br>
@


1.6
log
@apca
@
text
@d101 3
a103 2
prescribed number of times.  This program uses one additional procedure:
<a HREF="./techs/align/proc/alqr.mar">alqr.mar</a>.<br>
@


1.5
log
@removed commented body statment as it makes page get two sets of buttons
@
text
@d239 2
@


1.4
log
@info about AP CA addedd
@
text
@a2 1
<!-- <BODY BACKGROUND ="./techs/align/bg3.gif" VLINK ="#ff000"> <FONT SIZE="4">-->
d11 1
a11 1
<p><dd>The approaches to 2D particle alignment can be subdivided into 
d16 4
a19 4
a micrograph.<br><br>
<i>Types of alignment problems:</i>
<ul>
<li>A reference image is known or can be easily 
@


1.3
log
@*** empty log message ***
@
text
@d37 9
d231 3
d235 6
@


1.2
log
@*** empty log message ***
@
text
@a279 1
ArDean Leith
@


1.1
log
@Initial revision
@
text
@d3 6
a8 3
<BODY BACKGROUND ="./techs/align/bg3.gif" VLINK ="#ff000"> <FONT SIZE="4">
<HDR>
<a name="TOP"></a>
a11 3



d227 1
a227 1
<a HREF=/net/ithaca/usr1/spider/docs/reffreealign.html>
d277 7
a283 1
</p>
@
