head	1.11;
access;
symbols;
locks;
comment	@# @;


1.11
date	2015.03.25.18.30.53;	author leith;	state Exp;
branches;
next	1.10;

1.10
date	2015.03.10.15.12.49;	author leith;	state Exp;
branches;
next	1.9;

1.9
date	2015.03.10.14.06.24;	author leith;	state Exp;
branches;
next	1.8;

1.8
date	2015.03.09.17.42.22;	author leith;	state Exp;
branches;
next	1.7;

1.7
date	2012.06.21.17.56.21;	author leith;	state Exp;
branches;
next	1.6;

1.6
date	2012.01.06.17.47.54;	author leith;	state Exp;
branches;
next	1.5;

1.5
date	2007.06.21.15.31.24;	author leith;	state Exp;
branches;
next	1.4;

1.4
date	2006.09.12.19.28.16;	author leith;	state Exp;
branches;
next	1.3;

1.3
date	2006.09.12.19.27.17;	author leith;	state Exp;
branches;
next	1.2;

1.2
date	2004.07.29.13.56.43;	author leith;	state Exp;
branches;
next	1.1;

1.1
date	2004.07.29.13.56.38;	author leith;	state Exp;
branches;
next	;


desc
@@


1.11
log
@html
@
text
@<html>
<head>
   <title>SPIDER LAB</title>
</head>

<body>

<center> <h1><b>A Quickstart Tutorial </b></h1> </center>

<center> <h3><b>Derived from Publication By: Bill Baxter</b></h3> </center>

<hr>

<center> <h3><b>Part I : An interactive session with SPIDER and WEB</b></h3> </center>

<p>
<dl><dd>
  <a href="#INTRO">Introduction</a>                            <br>
  <a href="#SPIDER">Filename extensions and starting SPIDER</a><br>
  <a href="#WEB">WEB</a>                                     <br>
  <a href="#TEST">Creating another test image in SPIDER</a>  <br>
  <a href="#FILTER">Filtering</a>                            <br>
  <a href="#GEO_OPS">Geometric and Algebraic operations</a>  <br>
  <a href="#CORREL">Correlation</a>                          <br>
  <a href="#REGISTERS">Registers</a>                         <br>
  <a href="#PEAK">Peak Search</a>                            <br>
  <a href="#SHIFT">Shift Alignment</a>                       <br>
  <a href="#VOLUME">Volumes</a>                              <br>
  <a href="#DOCS">Document Files</a>                         <br>
  <a href="#RUN">Running procedure files</a>                 <br>
  <a href="#DEBUG">Debugging</a>                             <br>
  <a href="#INLINE">Inline files</a>                         <br>
  <a href="#DO">Control Structures: DO Loops</a>             <br>
  <a href="#IF">The IF Statement</a>                         <br>
  <a href="#FILENAMES">Run-time Designation of File Names</a><br>
  <a href="#READDOC">Reading Document files</a>              <br>
  <a href="#RUN">Procedure files</a>                         <br>
</dd></dl>
</p>

<p />

<p><a name="INTRO"><b>Introduction</b></a></p>

<p>Below is a brief introduction to SPIDER and WEB. The 
  <a href="tutorial.html">SPIDER Tutorial</a> is a more detailed tour of many
  SPIDER operations. The SPIDER 
  <a href="operations_doc.html">Manual of operations</a> 
  provides information on the specific options and
  choices of parameters for each SPIDER operation. The 
  <a href="user_doc.html">User's guide</a> covers issues relating to the
  syntax and conventions of SPIDER, including a longer section on writing
  and using procedures.</p>

<p><a name="SPIDER"><b>Filename extensions and starting SPIDER</b></a></p>

<p>SPIDER expects all files within a session to have the same
   filename extension.</p>

<p>For this lab, we will use the extension "dat". In a Unix command
   window, start SPIDER by typing at the Unix prompt:</p>

<pre>
    spider dat
</pre>

 You will see a start banner with the version number, followed by the prompt: 

<pre>
    .OPERATION:
</pre>

   SPIDER operations are entered at the .OPERATION: prompt. These in
   turn are followed by prompts asking for parameters specialized for
   that operation, such as 

<pre>
    .INPUT FILE:
</pre>

   When in a SPIDER session, type all filenames without their
   extensions. In the exercises below, enter the provided text and
   numbers after each prompt. SPIDER prompts always start with a
   period (.) and end with a colon (:) 

<p>Create a simple image using the 
   <a href="man/mo.html">MO</a> operation:</p>

<pre>
 .OPERATION: MO

 .OUTPUT FILE: circ001

 .ENTER DIMENSIONS (NX,NY): 75,75
 
 .B/C/G/R/S/T/W:  C
 
 .RADIUS (FLOATING POINT): 16

 .OPERATION: 
</pre>

   You will see SPIDER echo the input, as well as print out additional
   information. Once the operation has all the required arguments, it
   carries out the processing, and returns to the .OPERATION: prompt.
   View the image you have created in Web (below). 

<p><a name="WEB"><b>WEB</b></a></p>

<p>Web is often run simultaneously with a SPIDER session, allowing
   the user to view the output files. We have two different Webs available
   <i>X-window Web</i> and <i>Java based JWeb</i>.  We will usually use 
   <i>JWeb</i> in this
   workshop but if you prefer you can use Web which is described below.  
   In another Unix window, type 'web dat' or  'jweb'</p>

<pre>
  web dat 
</pre>

   Adjust the Web and SPIDER windows so that you can see both of them.
   When either Web starts up, you will see a blank background screen, with
   menus at the top and a status window below. 

<p>Options listed under the main menu headings will be written as:
   <i>Menu/Command</i></p>

<p>For example, when Web is first started, you may have to clear
   the screen with the option <i>Commands/Clear</i></p>

<p>To view an image, use <i>Commands/Image</i>, and select the file
   to be viewed (circ001.dat). Web displays the image, and prints out
   some information (image size and range of the gray levels) in the
   status window.</p>

<p>In Web The size of the displayed image may be adjusted: select
   <i>Options/Image</i>, and enter -2 in the SIZE REDUCTION entry box.
   Positive numbers will decrease the size by the specified factor,
   while negative numbers will enlarge the displayed image. Use
   <i>Commands/Image</i> again to view circ001.dat. It should appear
   larger this time. All subsequently displayed images will also be
   enlarged, until SIZE REDUCTION is changed again. Remember, Web only
   displays a picture - it does not actually enlarge the original data
   file.</p>
<p>In JWeb The size of all subsequently displayed images may be adjusted: select
<i>Options/Settings</i>, and use the 'Resize' slider.</p>

<p>As you try out the SPIDER operations below, you will go back and
   forth between SPIDER and Web/JWeb, performing image processing in
   SPIDER, and using Web to view the results.</p>

<p><a name="TEST"><b>Creating another test image in SPIDER</b></a></p>

<p>The 'PT' operation allows you to create geometric shapes. Here is
   another test image you can make using <a href="man/pt.html">PT</a>:</p>

<pre>
 .OPERATION: PT

 .OUTPUT FILE: test001

 .ENTER DIMENSIONS (NX,NY): 75, 75

 .ENTER CODE (P,L,C,T,R,S): r

 .ENTER COORDINATES OF UPPER LEFT POINT: 18, 12

 .ENTER  X &amp; Y OFFSETS: 38, 16

 .CONTINUE? (Y/N): Y 

 .ENTER CODE (P,L,C,T,R,S): T

 .ENTER COORDINATES OF FIRST  POINT: 18, 33

 .ENTER COORDINATES OF SECOND POINT: 56, 36

 .ENTER COORDINATES OF THIRD  POINT: 32, 66

 .CONTINUE? (Y/N): N
</pre>

   In Web, view the resulting test file, test001.dat with
   <i>Commands/Image</i>. It doesn't show up in the Image file
   selection dialog? Every time you create a new image file, you need
   to press the 'Filter' button, so the program will reread the
   contents of the current directory. 


<p><a name="TEST"><b>Importing an image into SPIDER</b></a></p>

<p>The <a href="man/cpfromraw.html">'CP FROM RAW'</a> operation allows you to import 
   various non-SPIDER images:

<pre>
 .OPERATION: CP FROM RAW

 .EXISTING RAW FILE: img/esp_raw.dat

 .ENTER BITS / PIXEL IN INPUT IMAGE (8, 16 OR 32): 8 
          
 .ENTER COLUMNS, ROWS, & SLICES: 800, 526
       
 .ENTER HEADER BYTES TO BE SKIPPED: 0
         
 .NEW SPIDER IMAGE FILE: esp000
</pre>

   In Web, view the resulting file, esp000.dat with
   <i>Commands/Image</i>. It is mirrored about the 'X' axis? 
   This is a common import problem.  Just use SPIDER's 'MR' 
   <a href="man/mr.html">'MR'</a> to fix it.

<pre>
 .OPERATION:   MR

 .INPUT FILE:  esp000

 .OUTPUT FILE: esp001

 .MIRROR AT (Y) OR (X) AXIS (DEF=Y): x
</pre>



<p><a name="FILTER"><b>Filtering</b></a></p>

<p>SPIDER has a variety if filtering operations. The 
   <a href="man/fqnp.html">FQ NP</a> operation provides a set of filters to
   choose from. Filter your test image with 'FQ NP'. NOTE: text after a
   semicolon (;) is a SPIDER comment. You <b>DO NOT</b> have to type the
   comments upon input!</p>

<pre>
 .OPERATION:   FQ NP

 .INPUT FILE:  esp001

 .OUTPUT FILE: filt001

 .FILTER TYPE (1-8): 3      ; Selects Gaussian low-pass filter

 .FILTER RADIUS: 0.1 
</pre>

   View the result of the low-pass filter. Low-pass filters tend to
   blur the image, while high-pass filters emphasize the edges. Experiment 
   with filtration by adjusting the filter radius and trying different filters.
   Refer to the manual page for details. 


<p>If your input data is noisy there are various filters including a 
   median filter <a href="man/cemed.html">'CE MED'</a> operation that may help.
   Filter your test image with 'CE MED'.</p>

<pre>
 .OPERATION: CE MED

 .INPUT FILE:    img/espnoise

 .OUTPUT FILE:   filt002

 .FILTER LENGTH: 5       ; Selects filter dimension

 .BOX OR CROSS(B/C): C 
</pre>

   View the noisy input: img/espnoise.dat and denoised output: filt002.dat.
   Refer to the manual page for details. 

<p><a name="GEO_OPS"><b>Geometric and Algebraic operations</b></a></p>

<p>These include rotating (<a href="man/rt.html">RT</a>), 
   shifting (<a href="man/sh.html">SH</a>), or 
   resizing (<a href="man/ip.html">IP</a>) the image. 
   Apply a shift operation to an image:</p>

<pre>
 .OPERATION: SH

 .INPUT FILE:   esp001

 .OUTPUT FILE: shift001

 .SHIFT COMPONENTS IN X-Y: 16.7, -7.2            
</pre>

View the result, shift001.dat. For most operations, the origin of
SPIDER coordinates is in the upper left corner, which is pixel 1,1
(not 0,0!). So a positive X shift moves the image to the right, a
negative Y shift moves the image up. Note that the image may be
shifted by non-integer values. 

<p>Images may be added 
   (<a href="man/ad.html">AD</a>), subtracted
   (<a href="man/su.html">SU</a>), or multipiled 
   (<a href="man/mu.html">MU</a>) together. Subtract the image you just shifted
   from the original test image:</p>

<pre>
 .OPERATION: SU

 .INPUT FILE:      esp001

 .SUBTRACTED FILE: shift001

 .OUTPUT FILE:     sub001

 .SUBTRACTED FILE: *
</pre>

   The 'SU' operation allows you to subtract as many images as you want,
   so you must enter an asterisk (*) to terminate the operation. View
   sub001.dat in Web. The two images were subtracted pixel-by-pixel.
   In the resulting 'difference image', positive areas (where test001
   pixels &gt; shift001 pixels) appear light, while negative areas are
   dark. Pixels where the two images were equal are zero, and appear
   as gray. Web always stretches the contrast so that the pixels with
   the smallest (or most negative) value are set to black, and the
   pixels with highest value are white. Note the range of this image
   is -248.0 ... 248.0. This means that for images with different ranges,
   their gray levels in Web are not comparable. 

<p><a name="CORREL"><b>Correlation</b></a></p>

<p>Cross correlation (<a href="man/cc.html">CC</a>) is a way to
   measure the similarity of 2 images. The 2 images are multiplied
   together, pixel by pixel, and the sum of these multiplications is
   stored at a location representing the position of image1 relative
   to image2. Then the images are shifted by one pixel, and multiplied
   again, with the resultant value stored at the next pixel. This is
   carried out by shifting image1 across all positions of image2 (the
   reference image). Pixels with high values ('peaks') in the cross
   correlation result show where the best matches were, while the
   amplitude of the peaks indicates the degree of similarity.</p>

<pre>
 .OPERATION: CC

 .INPUT FILE:     shift001

 .REFERENCE FILE: esp001

 .OUTPUT FILE:    cc001
</pre>

   View the cross correlation result in Web. There should be a bright
   spot indicating the location of the best match, or highest
   correlation. Select: <i>Options/Contrast</i>. The sliders allow you
   to change the way the pixel intensities are displayed. Move the
   left slider rightward until the correlation result appears as
   nearly a single pixel. Next, set both sliders to the same
   intermediate value, e.g., 90. What happens to the images? They are
   binarized - all pixels above the threshold are white, pixels below
   the threshold are black. These contrast numbers refer the to actual
   pixels in the onscreen display, not to the floating point pixel
   intensities in the image files. When you are done, reset the
   contrast back to the original values (64, 127). 

<p><a name="REGISTERS"><b>Registers</b></a></p>

<p>SPIDER provides register variables to hold floating point values. 
   Register variables can be named by the user and the variables are 
   denoted with enclosing square brackets: e.g. [reg-var].  <small>(There is an
   older preset-name syntax for registers which you may encounter sometimes:
   x11....x99) </small>. 
 
   You can use registers anywhere you
   would normally enter a number in SPIDER. Registers can be used as a
   form of pocket calculator. At the prompt, type:</p>

<pre>
 .OPERATION: [loc] = 25

 .OPERATION: [newloc] = [loc] + 3.5
</pre>

Typing the register alone at the prompt returns its value: 

<pre>
 .OPERATION: [loc]
   25.0000    

 .OPERATION: [newloc]
   28.5000    
</pre>

A register variable can be created in five ways which will become clearer 
later in the lab:

<p><ol> <li>By being explicitly set equal to a value or a value from an 
            arithmetic expression (as above).                </li>
        <li>As output resulting from an operation.           </li>
        <li>When used as an index in a do-loop.              </li>
        <li>Using the <a href="man/rr.html">RR</a> operation.</li>
        <li>When received as a procedure argument.
	</ol></p>

<a name="PEAK"><b>Peak search</b></a> 

<p>A peak search is commonly applied after a correlation, to find
the location of the best match - a 'peak' in the pixel intensities.
The <a href="man/pk.html">PK</a> operation prints its results to the
screen, but it can also store these values in registers on the
operation line. In the following example, registers [ix] and [iy] are
set to the X and Y coordinates of the highest peak found. Apply a
peak search to the cross correlation result to find the coordinates
of the bright spot:</p>

<pre>
 .OPERATION:  PK [ix],[iy]

 .INPUT FILE: cc001

 .ENTER # OF PEAKS, CENTER ORIGIN OVERRIDE (0/1): 1,0
</pre>

Check the values of the registers: 

<pre>
 .OPERATION: [ix]
   17.0000    

 .OPERATION: [iy]
   -7.00000
</pre>

These numbers show the position of the highest peak (best match)
relative to the image center. These are integers, but there is a
way to get more accurate floating point values (see 'PK' in the
Operations Manual). To shift back to the center, we have to use the
negative of these numbers. Put the negative values in other
registers: 

<pre>
 .OPERATION: [ixn] = -[ix] 

 .OPERATION: [iyn] = -[iy]
</pre>

<a name="SHIFT"><b>Shift Alignment</b></a> 

<p>Use the results from the peak search to align the shifted image
to the original test image. For the X,Y shift components, use the
negative of the numbers obtained from the peak search (i.e., -17
and 7). Since we have these numbers in registers, use registers [ix]
and [iy] in place of the actual numbers.</p>

<pre>
 .OPERATION:   sh

 .INPUT FILE:  shift001

 .OUTPUT FILE: align001

 .SHIFT COMPONENTS IN X-Y: [ixn], [iyn]     ; Instead of -17,7 
</pre>

Compare the 'aligned' image with the original test image by
subtracting them: 

<pre>
 .OPERATION: SU

 .INPUT FILE:      filt001

 .SUBTRACTED FILE: align001

 .OUTPUT FILE:     sub002

 .SUBTRACTED FILE: *
</pre>

How does the subtracted image sub002.dat appear? Compare to
sub001.dat. The new difference image is zero (gray) everywhere,
except around the edges of the shapes. This is because the edges
were blurred in the filtered image, and therefore do not match the
original sharp edges exactly. 

<p><a name="VOLUME"><b>Volumes</b></a></p>

<p>A volume may be visualized in Web by viewing it slice-by-slice,
or by surface rendering. Create a model volume with SPIDER's <a
href="man/mo3.html">MO 3</a> operation:</p>

<pre>
 .OPERATION: MO 3

 .OUTPUT FILE: sphere

 .ENTER DIMENSIONS (NX,NY,NZ): 75,75,75

 .B/C/G/H/HA/NUM/R/S/SP/SPA/SPV/T/W: sp    ; Selects sphere from the menu

 .GET COORDINATES FROM DOCUMENT FILE (Y/N): n

 .ENTER MASS VALUE PER VOXEL (DEFAULT = 2.0): 2
   
 .OUTER AND INNER RADII OF SPHERES: 19, 14
   
 .X,Y,Z: 38,38,38                         ; The sphere's center
    
 .X,Y,Z: 0,0,0                            ; Terminates the operation
</pre>

View the volume slice by slice in Web. Under <i>Options/Image</i>,
set SIZE REDUCTION to 1. Under <i>Commands/Image</i>, select
sphere.dat. If a volume is selected for display, Web pops up a
dialog box that lets the user select which slices to display. Just
click the 'Accept' button to view all slices. You should see a
montage of all 75 slices from top to bottom of the sphere. You can
see that it is hollow in the center, but some images contain
circles as the volume is sliced. 

<p>View the ribosome volume 
   '<a href="img/ribosome.dat">img/ribosome.dat</a>' in Web:</p>

<p><i>Commands/Clear</i><br>
<i>Commands/Image</i><br>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Select img/ribosome.dat, 
    click 'Accept'</p>

<p>You will see slices of the ribosome volume, with a dark
intersubunit space in some of the central slices.</p>

<p>Now create a surface rendering of the volume.</p>

<p><i>Commands/Clear</i><br>
<i>Commands/Surface</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Select: img/ribosome.dat<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set Scale to 5.0, 
click 'Accept'</p>

<p>In this view, the small subunit is on the left, the large
subunit on the right. </p>

<p>Click the right mouse button to end the surface session.</p>

<p><a name="DOCS"><b>Document files</b></a></p>

<p>Information obtained during a SPIDER session can be saved to
document files (called doc files). Data is written to a doc file
with the <a href="man/sd.html">SD</a> operation, which writes one
line at a time. The numbers to be stored are placed on the SD
operation line. The first number (here 1), is the <i>key</i>. This
doc file can be read by other SPIDER operations; the key tells SPIDER
which line to read.</p>

<pre>
 .OPERATION: SD 1, [ix], [iy], [ixn], [iyn]

 .DOCUMENT FILE: doc001
</pre>

This writes the values of those four registers to the file
doc001.dat. This file can be viewed in a text editor, or with the
Unix 'cat' operation.  Unix system operations are also available from
SPIDER using the <a href="man/vm.html">VM</a> operation.  A '$DATEXT'
environmental variable is available within SPIDER to substitute the
current file extension.

<pre>
 .OPERATION: VM

 .SYSTEM COMMAND: cat doc001.$DATEXT
</pre>

<p>The doc file has two lines:</p>

<pre>
 ;dat/dat   01-MAY-2007 AT 20:29:05   doc001.dat
    1 4  17.000     -7.0000     -17.000      7.0000    
</pre>

The first line, starting with the semicolon, is a comment line with
file creation information. The lines following the comment have the
following format: 

<p>&lt;key&gt; &lt;number of data items in this line&gt;
&lt;data&gt; &lt;data&gt; &lt;data&gt; &lt;data&gt;</p>

<p>End your interactive SPIDER session now:</p>

<pre>
.OPERATION: EN
</pre>

<p> Certain operations may have written data in the SPIDER results file:
    results.dat.0.   A different results file will be created with each
    SPIDER run by incrementing the final digit(s) of the file name.</p>

<hr>

<p />

<center> <h3><b>Part II : Running Procedure files with SPIDER</b></h3> </center>

<p><a name="RUN"><b>Running Procedure files</b></a></p>

<p>
   For this part, you will not be running SPIDER in an interactive
   mode. Instead, you will run SPIDER repeatedly from the Unix prompt.
   Also, a text editor is required.</p>

<p>
   SPIDER's interactive mode is good for trying out operations and
   ideas. But more sophisticated processing can require dozens or even
   hundreds of operations. The operations can be put into a text file and
   executed in procedure mode. Open up an editor at the Unix prompt, and
   type the following (you don't have to type the comments following the ;): </p>

<pre>
 RT
   test001   ; Image            (input)
   rot001    ; Rotated image    (output)
   60        ; Rotation angle (in degrees)

 IP
   rot001    ; Image            (input)
   big001    ; Interpolated image    (output)
   150, 150  ; New dimensions

 WI
   big001    ; Image            (input)
   win001    ; Windowed image   (output)
   75, 75    ; Size of window
   1, 75     ; Top left window coordinates

 EN D  
</pre>

   Save this file as bat01.spf 

<p>Procedure files should have an extension different than the data
   extension. To run SPIDER in procedure mode, use the following format at
   the Unix prompt: </p>

<pre>
    spider spf/dat @@bat01  
</pre>

where         
  '<font face="courier">spf</font>' is the procedure file extension,    
  '<font face="courier">dat</font>' is the data file extension, and 
  '<font face="courier">bat01</font>' is the name of the procedure file without its extension. 

<p>Run the procedure file you created, and view the files rot001.dat,
   big001.dat, win001.dat in Web. The original file has been rotated,
   enlarged, and a subimage cut out, all in one call to SPIDER.</p>

<p><a name="DEBUG"><b>Debugging</b></a></p>

<p>In procedure mode, SPIDER still prints out the banner, version
   number, and the name of the results file:</p>

<pre>
    Results file: results.spf.0  
</pre>

The results file contains a listing of all operations and entries
   that were run in SPIDER. If your procedure file ends with the line 
  'EN D', the results file is deleted at the successful completion of the
   procedure. You will see: 

<pre>
    STOP **** SPIDER NORMAL STOP ****
</pre>

   Open bat01.spf in the editor, and change "test001" to "test999".
   Rerun the procedure file. This should cause an error, and the following
   will be printed: 

<pre>
    STOP *** FATAL ERROR ENCOUNTERED IN BATCH MODE
</pre>

   In this case, the results file will not be deleted. Look at the
   last few lines of the results file with the Unix <i>tail</i> operation: 

<pre>
   tail results.spf.0
</pre>

   The results file will contain a message indicating the type of
   error that occurred when the last operation failed: 

<pre>
 .OPERATION:      RT
 .INPUT FILE:     test999
 *** FILE NOT FOUND: test999.dat
 TERMINATED ON ERROR IN BATCH MODE  22-OCT-2002 at 16:42:39
</pre>

<a name="INLINE"><b>Inline files</b></a> 

<p>To obtain the final result (win001.dat) in the example above,
   two intermediate files were created (rot001.dat and big001.dat). If
   the images are large, and there are many operations, you can
   clutter your disk drive with numerous unnecessary files. SPIDER
   allows special variables to be substituted for filenames. These are
   called inline files, and are denoted by <b>_<i>N</i></b>, where
   <b><i>N</i></b> is a digit from 1..99, preceded by one to three
   underscore symbols. Therefore, up to nine inline files are allowed
   at any time. inline files may be used wherever a filename is used
   in SPIDER (even in interactive mode).  </p>

<p>Copy bat01.spf to bat02.spf, and, in the editor, make the
   following changes to bat02.spf at the lines marked *****:  </p>

<pre>
 RT
   test001 
   _1        ; ***** Replace the output filename with _1
   60        

 IP
   _1        ; ***** Use the above result
   _2        ; ***** Replace the output filename with _2
   150, 150 

 WI
   _2        ; ***** Use the above result
   win002    ; ***** Give the final result a different number
   75, 75     
   1, 1      ; ***** Window out a different region 

 EN D        ; End and delete results file
</pre>

 Save this file, and run it : 
  <font face="courier">spider spf/dat @@bat02</font> 

<p>This file created a new output (win002.dat) without writing the
   intermediate rotated and enlarged images. Those files were created
   in memory, but not written to disk. Not only does this save disk
   space, but it saves time - multiple disk accesses will slow down a
   procedure file. If you are processing thousands of image files, inline
   files can save much time and disk space.</p>

<p><a name="DO"><b>Control Structures: DO Loops</b></a></p>

<p><a href="man/do.html">DO</a> loops enable operations to be
   repeated. The DO loop syntax is:</p>

<pre>
 DO  &lt;loop register&gt; = &lt;start_value&gt;, &lt;end_value&gt; &lt;optional increment_value&gt;
    &lt; Any SPIDER operations can be inside the DO loop &gt;
 ENDDO
</pre>

<small>There is an older DO loop syntax that you may still see:</p>
<pre>
 DO &lt;Label&gt; &lt;loop register variable &gt; = &lt;start_value&gt;, &lt;end_value&gt, &lt;optional increment_value&gt;
    &lt; Any SPIDER operations can be inside the DO loop &gt;
 &lt;Label&gt;
</pre>

In this older syntax labels are denoted as LB<b><i>N</i></b>, 
where <b><i>N</i></b> is
an integer. The end of the DO loop is marked when the label occurs
by itself further down in the procedure file. 
</small>

<p>The start and end values set the number of times the operations
   inside the DO loop will be executed (in this case twenty times).
   Start and end values may be registers. The number of iterations,
   <b><i>K</i></b>, equals (end_value - start_value) + 1.</p>

<p>The loop register variable takes on a new value for each iteration. Here,
   [index] will have the values 1 to 20. (<i>Never</i> change the loop
   register inside a loop. You will be sorry.)</p>

<p>The DO construct executes all SPIDER operations between the lines
   DO ... and ENDDO, <b><i>K</i></b> times.</p>

<p>Create the following procedure file:</p>

<pre>
 [unused]= 0                ; Required for RAN operation
 DO [index] = 1,20          ; Set up the DO loop

   [ran] = RAN([unused])   ; These operations...

   SD [index],[ran]        ;    will be executed...
     randoc                ;    20 times.
 ENDDO                      ; End of the DO loop

 EN D
</pre>

Save the file as bat03.spf, and run: 
   <font face="courier">spider spf/dat @@bat03</font> 

<p>This procedure file uses the arithmetic operator RAN to generate
   random numbers in the range 0..1 (see 
   <a href="user_doc.html#math_functions">Mathematical Functions in the User's
   Guide</a>). The 'SD' operation writes a single line to a doc file,
   randoc.dat. Look at the contents of randoc.dat with the Unix
   <i>cat</i> command:</p>

<pre>
 cat randoc.dat
</pre>

   The loop executes 20 times, each time creating a new random number
   and writing another line to the doc file. The loop register is used
   as the key for each line, followed by the random number. The keys
   in the doc file (first column) are numbered from 1-20. The second
   columns all are '1', indicating that only one data item will
   follow. The third column is the stored data - the random numbers. 

<p>Run this procedure file again, and look at randoc.dat. What
   happened? Whereas SPIDER image and volume files are overwritten if
   you use the same filename, the 'SD' operation appends to the end of the
   doc file. This can be a problem: if you run a procedure file
   repeatedly, the resulting doc file will grow and grow. You should
   delete the old doc files first if you need to rerun the procedure
   file.</p>

<p><a name="IF"><b>The IF Statement</b></a></p>

<p>The <a href="man/if_then.html">IF</a> operation is a control
   structure that provides conditional execution. The <i>IF</i> syntax
   is:</p>

<pre>
 IF (TEST_CONDITION) THEN
    &lt;any SPIDER operations&gt;
 ENDIF
</pre>

   where the test condition tests the value of an expression (see example
   below). The SPIDER operations inside the IF statement are only
   executed if the condition is true, otherwise processing just moves
   to the next operation after the IF. 

<p>You can delete a file if it already exists, using an IF
   statement. Copy bat03.spf to bat04.spf, and add the following lines
   above the DO loop. In addition, make one change to the RAN
   expression in the DO loop:</p>

<pre>
 ; The new lines

 IQ FI [exists]           ; If the following file exists, set [exists]=1, else [exists]=0
    randoc

 IF ([exists].EQ.1) THEN  ; IF [exists] is equal to 1, THEN do the following...
    DE
    randoc
 ENDIF

 ; The DO loop :
 [unused]= 0                ; Required for RAN operation

 DO  [index] = 1,20

   [ran] = 360 * RAN([unused])   ; ***** change this line too

   SD [index],[ran]        
     randoc                  
 ENDDO                     

 EN D
</pre>

   Save the file as bat04.spf, and run: 
   <font face="courier">spider spf/dat @@bat04</font> <p>

   Look at the new contents of randoc.dat with the Unix
   <i>cat</i> command:</p>

<pre>
 cat randoc.dat
</pre>
   The <a href="man/iqfi.html">IQ FI</a> operation inquires if the file
   exists. If so, its register is set to 1, otherwise to zero. The 
   <a href="man/de.html">DE</a> operation deletes its input file. Any
   SPIDER operations between the IF..THEN and the ENDIF lines are only
   executed if the condition is true. This construct is required
   because 'DE' will report an error if it tries to delete a nonexistent
   file. 

<p>In addition to the IF..THEN operation, there is a one-liner
   version of <a href="man/if.html">IF</a>, as well as 
   <a href="man/if_goto.html">IF..GOTO</a>, which conditionally jumps to any
   line in the procedure file. See the Manual of Operations for details. 

<p>Multiplying the output of RAN by 360 changes the range of output
   numbers. When you run bat04.spf, you should be back to a single set
   of numbers in randoc.dat, this time in the range 0..360.</p>

   The IF..THEN operation has additional clauses available for
   <a href="man/elseif_then.html">ELSEIF THEN</a>, and
   <a href="man/else.html">ELSE</a> as shown using the following
   procedure b05.spf: 

<pre>
 [unused]= 0                     ; Required for RAN operation
 [ran]   = 10 * RAN([unused])    ; Random number 0..10
 [iran]  = INT([ran])   
 [iran]                          ; Echo: iran

 IF([iran] < 2) THEN
    [xsize]=100 
 ELSEIF ([iran] < 4) THEN
    [xsize]=400 
 ELSEIF ([iran] < 6) THEN
    [xsize]=600 
 ELSE
    [xsize]=800 
 ENDIF

 SYS
   echo ' 'Xsize: {****[xsize]}

EN
</pre>

  Save the file as bat05.spf, and run: 
  <font face="courier">spider spf/dat @@bat05</font> <p>

  The value of Xsize reported by the procedure should vary with invocations
  as the random number changes.<p>

  <p><a name="FILENAMES"><b>Run-time Designation of File Names</b></a></p>

<p>If a series of files is created in a loop, how do you name them,
   especially if you don't know how many there will be? SPIDER enables
   filenames to be created at run time with the following syntax:</p>

<pre>
   template{****[register-variable]}
</pre>

   where 'template' is a text string, there may be any number of
   asterisks, and any [register-variable] may be used. This notation adds a file
   number to the template. The number of asterisks denotes the number
   of digits, while the value of the register variable sets the number. For
   example, if [inum] = 2, then img{****[inum]} returns the text string 'img0002'. 

<p>Create a new file, bat06.spf:</p>

<pre>
 DO [idx] = 1,10

    [ang] = [idx] * 20  ; Use this as the rotation angle

    RT
      test001           ; File (input)
      rot{***[idx]}     ; This will produce rot001, rot002, ...
      [ang]             ; Rotation angle

 ENDDO

 EN D
</pre>

   After running this procedure file, you should have files rot001.dat,
   rot002.dat,... rot010.dat in the working directory. View this image
   series in Web: 

<p><i>Commands/Montage</i> <br>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Select rot001.dat (this is the
   first image in the series), click 'Ok'                  <br>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
   Enter 10 in the LAST FILE NUMBER box, click 'Accept'</p>

<p>You should see the test image going through a series of
   rotations.</p>

<p><a name="READDOC"><b>Reading Document files</b></a></p>

<p>Next, use the random numbers in the doc file as rotation angles,
using the <a href="man/ud.html">UD</a> operation to read the doc
file:</p>

<pre>
 ; bat07.spf

 ; UD N counts the number of lines in the doc file, puts result in [n]
 UD N [n]   
   randoc

 DO [idx] = 1,[n]   ; Loop for each line in the doc file

   UD [idx],[rotang]
     randoc

   RT
     filt001
     rot{***[idx]} 
     [rotang]
 ENDDO

 EN D
</pre>

   View the results in Web: 

<p><i>Commands/Clear</i><br> </p>

<p><i>Options/Image</i><br>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Check the SHOW FILE NAMES box,
   Click 'Accept'</p>

<p><i>Commands/Montage</i><br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The selected file will still
 be rot010.dat. Reselect rot001.dat as the first image.<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set LAST FILE NUMBER to 20.</p>

<p>You should see 20 copies of the test image, at random
   orientations.</p>

<p><a name="PROCS"><b>Procedure files</b></a></p>

<p>Procedure files are subroutines that can be called from other procedure
   files. They can have variable arguments that change with every call
   to the procedure.</p>

<p>Copy bat07.spf to proc.spf, and make the following changes:<br></p>

<ul class="noindent">

<li>Add 3 'FR' operations to the top of the file. These File-Read
   operations set the name of a file to a symbolic parameter, such as
   [symvar]. These parameters can become any file name used by the
   procedure file that calls this procedure. The text inside the 
  ?question marks? is used as a prompt in an interactive session; here, they
   are simply used as a reminder of the type of file the procedure is
   expecting.                                                 <br>
</li>

<li>Change all instances of "randoc" to "[angsdocfile]", 
                            "filt001" to "[img]", and 
                            "rot" to "[output]".               <br>
</li>

<li>Change the last operation, EN, to RE. When all the lines in a
    procedure file have been executed, control is returned to the
    calling procedure file.</li>

</ul>

<pre>
 FR
   ?angles?[angsdocfile]      ; This sets [angsdocfile] = "randoc"

 FR
   ?input file?[img]          ; This sets [img] = "filt001"

 FR
   ?output template?[output]  ; Sets [output] = "rot"

 UD N  [n]                    ;   
   [angsdocfile]              ; *** Change randoc to angsdocfile

 DO [num] = 1,[n]

   UD [num],[ang]
     [angsdocfile]           ; *** Change randoc to angsdocfile
 
   RT
     [img]                   ; *** Change filt001 to [img]
     [output]{***[num]}      ; *** This becomes rot001, rot002, ...
     [ang]

 ENDDO

RE                           ; ***** IMPORTANT - CHANGE "EN D" TO "RE"  *****
</pre>

Then create a new file, bat08.spf: 

<pre>
 ; bat08.spf  : rotate images using a procedure call

 @@proc          ; Call to the procedure (named proc)
   randoc       ; Doc file of rotation angles
   test001      ; Input file
   rot          ; Output template (will be expanded to rot001, rot002, ...)

                ; Any SPIDER operations may go here

 EN D
</pre>

  The procedure call is simply the name of the procedure file
  (without the extension), preceded by the '@@' sign. Subsequent lines
  must have text strings which correspond to the FR operations in the
  procedure. Any SPIDER operation can come before or after a procedure
  call. Note: procedure files must have the same file extension
  as the calling procedure file. 

<p>Run the procedure file: spider spf/dat @@bat08 . 
   SPIDER runs the procedure file, which in turn, calls the procedure.</p>

<p>The results are the same as for bat07.spf. Change bat08.spf so
   that the 3rd line after the procedure is "root", instead of "rot".
   When you run the procedure file, it will create a new set of images.
   Procedures provide reusable code with variable filenames, that can
   be called by procedure files, or even other procedures.</p>

<p><a name="PASSING"><b>Passing Arguments to Procedures</b></a></p>

<p>Register variables can be passed as arguments to procedures.</p>

Create a procedure: bat09.dat .
<pre>
 ; bat09.spf  : Fourier transform images using a procedure call

 [n] = 5        ; Number of images
 @@proc-ft([n])  ; Call to the procedure (named proc-ft)

 EN D
</pre>

Create a procedure: proc-ft.dat

<pre>
 ([numimgs])

 DO [img]=1,[numimgs]
   FT                 ; Fourier transform
     sam{***[img]}    ; Input image
     four{***[img]}   ; Output Fourier image

   PW                 ; Power spectrum of Fourier image
     four{***[img]}   ; Input image
     pow{***[img]}    ; Output Power spectrum
 ENDDO

 RE
</pre>

<p>Run the procedure file: spider spf/dat @@bat09  <br />

   SPIDER runs the procedure file: bat09 which in turn, 
   calls the procedure: proc-ft with argument <i>[numimgs]</i> set to
   the value of: 5.</p>

<p>Examine the Power Spectra in Web.  Adjust the contrast with:
   Options - Contrast to see more detail. <p>

<hr>

<p />

<p><small>
  Updated: Mar 31, 2009, &nbsp;&nbsp;&nbsp;
  Authors: Bill Baxter &amp; ArDean Leith </small>
</p>


</body>

</html>
@


1.10
log
@cosmetic, <,  DO LB
@
text
@a0 1
<html><!DOCTYPE html PUBLIC "-//w3c//dtd html 3.2//en">
@


1.9
log
@esp & espnoise in img/
@
text
@d19 20
a38 20
<a href="#INTRO">Introduction</a><br>
<a href="#SPIDER">Filename extensions and starting SPIDER</a><br>
<a href="#WEB">WEB</a><br>
<a href="#TEST">Creating another test image in SPIDER</a><br>
<a href="#FILTER">Filtering</a><br>
<a href="#GEO_OPS">Geometric and Algebraic operations</a><br>
<a href="#CORREL">Correlation</a><br>
<a href="#REGISTERS">Registers</a><br>
<a href="#PEAK">Peak Search</a><br>
<a href="#SHIFT">Shift Alignment</a><br>
<a href="#VOLUME">Volumes</a><br>
<a href="#DOCS">Document Files</a><br>
<a href="#RUN">Running procedure files</a><br>
<a href="#DEBUG">Debugging</a><br>
<a href="#INLINE">Inline files</a><br>
<a href="#DO">Control Structures: DO Loops</a><br>
<a href="#IF">The IF Statement</a><br>
<a href="#FILENAMES">Run-time Designation of File Names</a><br>
<a href="#READDOC">Reading Document files</a><br>
<a href="#PROCS">Procedure files</a><br>
a39 1
<p></p>
d42 2
d54 1
a54 1
  and using procedures.
d56 1
a56 3
<br />

<a name="SPIDER"><b>Filename extensions and starting SPIDER</b></a></p>
d61 1
a61 1
<p>For this lab, we will use the extension "dat". In a Unix
d68 1
a68 2
You will see a start banner with the version number, followed by
the prompt: 
d74 3
a76 3
SPIDER operations are entered at the .OPERATION: prompt. These in
turn are followed by prompts asking for parameters specialized for
that operation, such as 
d82 4
a85 4
When in a SPIDER session, type all filenames without their
extensions. In the exercises below, enter the provided text and
numbers after each prompt. SPIDER prompts always start with a
period (.) and end with a colon (:) 
d97 1
a97 1
 .B/C/G/R/S/T/W:  c
d104 4
a107 4
You will see SPIDER echo the input, as well as print out additional
information. Once the operation has all the required arguments, it
carries out the processing, and returns to the .OPERATION: prompt.
View the image you have created in Web (below). 
d112 5
a116 5
the user to view the output files. We have two different Webs available
<i>X-window Web</i> and <i>Java based JWeb</i>.  We will usually use 
<i>JWeb</i> in this
workshop but if you prefer you can use Web which is described below.  
In another Unix window, type 'web dat' or  'jweb'</p>
d122 3
a124 3
Adjust the Web and SPIDER windows so that you can see both of them.
When either Web starts up, you will see a blank background screen, with
menus at the top and a status window below. 
d127 1
a127 1
<i>Menu/Command</i></p>
d130 1
a130 1
the screen with the option <i>Commands/Clear</i></p>
d133 3
a135 3
to be viewed (circ001.dat). Web displays the image, and prints out
some information (image size and range of the gray levels) in the
status window.</p>
d138 8
a145 8
<i>Options/Image</i>, and enter -2 in the SIZE REDUCTION entry box.
Positive numbers will decrease the size by the specified factor,
while negative numbers will enlarge the displayed image. Use
<i>Commands/Image</i> again to view circ001.dat. It should appear
larger this time. All subsequently displayed images will also be
enlarged, until SIZE REDUCTION is changed again. Remember, Web only
displays a picture - it does not actually enlarge the original data
file.</p>
d147 1
a147 1
<i>Options/Settings</i>, and use The 'Resize' slider.</p>
d150 2
a151 2
forth between SPIDER and Web/JWeb, performing image processing in
SPIDER, and using Web to view the results.</p>
d156 1
a156 1
another test image you can make using <a href="man/pt.html">PT</a>:</p>
d163 1
a163 1
 .ENTER DIMENSIONS (NX,NY): 75,75
d167 1
a167 1
 .ENTER COORDINATES OF UPPER LEFT POINT: 18,12
d169 1
a169 1
 .ENTER  X &amp; Y OFFSETS: 38,16
d171 1
a171 1
 .CONTINUE? (Y/N): y 
d173 1
a173 1
 .ENTER CODE (P,L,C,T,R,S): t
d175 1
a175 1
 .ENTER COORDINATES OF FIRST  POINT: 18,33
d177 1
a177 1
 .ENTER COORDINATES OF SECOND POINT: 56,36
d179 1
a179 1
 .ENTER COORDINATES OF THIRD  POINT: 32,66
d184 5
a188 5
In Web, view the resulting test file, test001.dat with
<i>Commands/Image</i>. It doesn't show up in the Image file
selection dialog? Every time you create a new image file, you need
to press the 'Filter' button, so the program will reread the
contents of the current directory. 
d194 1
a194 1
various non-SPIDER images:
d203 1
a203 1
 .ENTER COLUMNS, ROWS, & SLICES: 800,526
d210 4
a213 4
In Web, view the resulting file, esp000.dat with
<i>Commands/Image</i>. It is mirrored about the 'x' axis? 
This is a common import problem.  Just use SPIDER's 'MR' 
<a href="man/mr.html">'MR'</a> to fix it.
d216 1
a216 1
 .OPERATION: MR
d218 1
a218 1
 .INPUT FILE: esp000
d230 4
a233 4
<a href="man/fqnp.html">FQ NP</a> operation provides a set of filters to
choose from. Filter your test image with 'FQ NP'. NOTE: text after a
semicolon (;) is a SPIDER comment. You <b>DO NOT</b> have to type the
comments upon input!</p>
d236 1
a236 1
 .OPERATION: FQ NP
d238 1
a238 1
 .INPUT FILE: esp001
d247 4
a250 4
View the result of the low-pass filter. Low-pass filters tend to
blur the image, while high-pass filters emphasize the edges. Experiment 
with filtration by adjusting the filter radius and trying different filters.
Refer to the manual page for details. 
d255 1
a255 1
  Filter your test image with 'CE MED'.</p>
d260 1
a260 1
 .INPUT FILE: img/espnoise
d262 1
a262 1
 .OUTPUT FILE: filt002
d264 1
a264 1
 .FILTER LENGTH: 5      ; Selects filter dimension
d269 2
a270 4
View the noisy input: img/espnoise.dat and denoised output: filt002.dat.
Refer to the manual page for details. 


d274 4
a277 4
<p>These include rotating (<a href="man/rt.html">RT</a>), shifting
(<a href="man/sh.html">SH</a>), or resizing 
(<a href="man/ip.html">IP</a>) the image. Apply a shift operation to an
image:</p>
d282 1
a282 1
 .INPUT FILE: esp001
d295 5
a299 4
<p>Images may be added (<a href="man/ad.html">AD</a>), subtracted
(<a href="man/su.html">SU</a>), or multipiled (<a href=
"man/mu.html">MU</a>) together. Subtract the image you just shifted
from the original test image:</p>
d304 1
a304 1
 .INPUT FILE: esp001
d308 1
a308 1
 .OUTPUT FILE: sub001
d313 11
a323 11
The 'SU' operation allows you to subtract as many images as you want,
so you must enter an asterisk (*) to terminate the operation. View
sub001.dat in Web. The two images were subtracted pixel-by-pixel.
In the resulting 'difference image', positive areas (where test001
pixels &gt; shift001 pixels) appear light, while negative areas are
dark. Pixels where the two images were equal are zero, and appear
as gray. Web always stretches the contrast so that the pixels with
the smallest (or most negative) value are set to black, and the
pixels with highest value are white. Note the range of this image
is -248.0 ... 248.0. This means that for images with different ranges,
their gray levels in Web are not comparable. 
d328 9
a336 9
measure the similarity of 2 images. The 2 images are multiplied
together, pixel by pixel, and the sum of these multiplications is
stored at a location representing the position of image1 relative
to image2. Then the images are shifted by one pixel, and multiplied
again, with the resultant value stored at the next pixel. This is
carried out by shifting image1 across all positions of image2 (the
reference image). Pixels with high values ('peaks') in the cross
correlation result show where the best matches were, while the
amplitude of the peaks indicates the degree of similarity.</p>
d341 1
a341 1
 .INPUT FILE: shift001
d345 1
a345 1
 .OUTPUT FILE: cc001
d348 12
a359 12
View the cross correlation result in Web. There should be a bright
spot indicating the location of the best match, or highest
correlation. Select <i>Options/Contrast</i>. The sliders allow you
to change the way the pixel intensities are displayed. Move the
left slider rightward until the correlation result appears as
nearly a single pixel. Next, set both sliders to the same
intermediate value, e.g., 90. What happens to the images? They are
binarized - all pixels above the threshold are white, pixels below
the threshold are black. These contrast numbers refer the to actual
pixels in the onscreen display, not to the floating point pixel
intensities in the image files. When you are done, reset the
contrast back to the original values (64, 127). 
d364 4
a367 4
Register variables can be named by the user and the variables are 
denoted with enclosing square brackets: e.g. [reg-var].  (There is an
older preset-name syntax for registers which you may encounter sometimes:
x11....x99). 
d369 3
a371 3
You can use registers anywhere you
would normally enter a number in SPIDER. Registers can be used as a
form of pocket calculator. At the prompt, type:</p>
d383 1
a383 1
   25.000000    
d386 1
a386 1
   28.500000    
d393 3
a395 3
               arithmetic expression (as above).</li>
        <li>As output resulting from an operation.</li>
        <li>When used as an index in a do-loop.</li>
d423 1
a423 1
   17.000000    
d426 1
a426 1
   -7.0000000
d447 2
a448 2
and 7). Since we have these numbers in registers, use registers x21
and x22 in place of the actual numbers.</p>
d451 1
a451 1
 .OPERATION: sh
d453 1
a453 1
 .INPUT FILE: shift001
d457 1
a457 1
 .SHIFT COMPONENTS IN X-Y: [ixn], [iyn]     ; instead of -17,7 
d466 1
a466 1
 .INPUT FILE: filt001
d470 1
a470 1
 .OUTPUT FILE: sub002
d494 1
a494 1
 .B/C/G/H/HA/NUM/R/S/SP/SPA/SPV/T/W: sp  ; Selects sphere from the menu
d500 1
a500 1
 .OUTER AND INNER RADII OF SPHERES: 19,14
d502 1
a502 1
 .X,Y,Z: 38,38,38                     ; The sphere's center
d504 1
a504 1
 .X,Y,Z: 0,0,0                        ; Terminates the operation
d517 1
a517 1
   '<a href="img/ribosome.dat">ribosome.dat</a>' in Web:</p>
d521 2
a522 2
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select img/ribosome.dat, click
   'Accept'</p>
d531 2
a532 2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select img/ribosome.dat<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set Scale to 5.0, 
d591 3
a593 1
    SPIDER run by incrementing the final digit(s) of the file name.
d595 1
a595 1
<p>
d597 1
d602 3
a604 4
For this part, you will not be running SPIDER in an interactive
mode. Instead, you will run SPIDER repeatedly from the Unix prompt.
Also, a text editor is required.
</p>
d607 5
a611 6
SPIDER's interactive mode is good for trying out operations and
ideas. But more sophisticated processing can require dozens or even
hundreds of operations. The operations can be put into a text file and
executed in procedure mode. Open up an editor at the Unix prompt, and
type the following (you don't have to type the comments following the ;):
</p>
d614 15
a628 15
RT
  test001   ; The input image
  rot001    ; The output image
  60        ; Rotation angle (in degrees)

IP
  rot001    ; Input image
  big001    ; Output image
  150,150   ; New dimensions

WI
  big001    ; Input image
  win001    ; Output image
  75,75     ; Size of the window
  1,75      ; Top left coordinates
d630 1
a630 1
EN D  
d633 1
a633 1
Save this file as bat01.spf 
d636 2
a637 3
extension. To run SPIDER in procedure mode, use the following format at
the Unix prompt:
</p>
d643 4
a646 4
where '<font face="courier">spf</font>' is the procedure file
extension, '<font face="courier">dat</font>' is the data file
extension, and '<font face="courier">bat01</font>' is the name of
the procedure file without its extension. 
d649 2
a650 2
big001.dat, win001.dat in Web. The original file has been rotated,
enlarged, and a subimage cut out, all in one call to SPIDER.</p>
d655 1
a655 1
number, and the name of the results file:</p>
d662 3
a664 3
that were run in SPIDER. If your procedure file ends with the line 'EN
D', the results file is deleted at the successful completion of the
procedure. You will see: 
d670 3
a672 3
Open bat01.spf in the editor, and change "test001" to "test999".
Rerun the procedure file. This should cause an error, and the following
will be printed: 
d678 2
a679 3
In this case, the results file will not be deleted. Look at the
last few lines of the results file with the Unix <i>tail</i>
operation: 
d685 2
a686 2
The results file will contain a message indicating the type of
error that occurred when the last operation failed: 
d689 4
a692 4
.OPERATION:      RT
.INPUT FILE: test999
*** FILE NOT FOUND: test999.dat
TERMINATED ON ERROR IN BATCH MODE  22-OCT-2002 at 16:42:39
d698 9
a706 9
two intermediate files were created (rot001.dat and big001.dat). If
the images are large, and there are many operations, you can
clutter your disk drive with numerous unnecessary files. SPIDER
allows special variables to be substituted for filenames. These are
called inline files, and are denoted by <b>_<i>N</i></b>, where
<b><i>N</i></b> is a digit from 1..99, preceded by one to three
underscore symbols. Therefore, up to nine inline files are allowed
at any time. inline files may be used wherever a filename is used
in SPIDER (even in interactive mode).</p>
d709 1
a709 1
following changes to bat02.spf at the lines marked *****:</p>
d712 4
a715 4
RT
  test001 
  _1        ; ***** Replace the output filename with _1
  60        
d717 4
a720 4
IP
  _1        ; ***** Use the above result
  _2        ; ***** Replace the output filename with _2
  150,150 
d722 5
a726 5
WI
  _2        ; ***** Use the above result
  win002    ; ***** Give the final result a different number
  75,75 
  1,1       ; ***** Window out a different region 
d728 1
a728 1
EN D      ; End and delete results file
d731 1
a731 1
Save this file, and run it : 
d735 5
a739 5
intermediate rotated and enlarged images. Those files were created
in memory, but not written to disk. Not only does this save disk
space, but it saves time - multiple disk accesses will slow down a
procedure file. If you are processing thousands of image files, inline
files can save much time and disk space.</p>
d744 1
a744 1
repeated. The DO loop syntax is:</p>
d747 3
a749 3
DO  &lt;loop register&gt; = &lt;start_value&gt;, &lt;end_value&gt; &lt;optional increment_value&gt;
   &lt; Any SPIDER operations can be inside the DO loop &gt;
ENDDO
d752 1
a752 1
An older DO loop syntax that you may still see is is:</p>
d754 3
a756 3
DO &lt;Label&gt; &lt;loop register variable &gt; = &lt;start_value&gt;, &lt;end_value&gt, &lt;optional increment_value&gt;
   &lt; Any SPIDER operations can be inside the DO loop &gt;
&lt;Label&gt;
d759 2
a760 1
In this older syntax labels are denoted as LB<b><i>N</i></b>, where <b><i>N</i></b> is
d763 1
d766 3
a768 3
inside the DO loop will be executed (in this case twenty times).
Start and end values may be registers. The number of iterations,
<b><i>K</i></b>, equals (end_value - start_value) + 1.</p>
d771 2
a772 2
[index] will have the values 1 to 20. (<i>Never</i> change the loop
register inside a loop. You will be sorry.)</p>
d775 1
a775 1
DO ... and ENDDO, <b><i>K</i></b> times.</p>
d780 2
a781 2
[unused]= 0                ; Required for RAN operation
DO [index] = 1,20          ; Set up the DO loop
d787 1
a787 1
ENDDO                      ; End of the DO loop
d789 1
a789 1
EN D
d793 1
a793 1
<font face="courier">spider spf/dat @@bat03</font> 
d796 5
a800 5
random numbers in the range 0..1 (see 
<a href="user_doc.html#math_functions">Mathematical Functions in the User's
Guide</a>). The 'SD' operation writes a single line to a doc file,
randoc.dat. Look at the contents of randoc.dat with the Unix
<i>cat</i> command:</p>
d806 6
a811 6
The loop executes 20 times, each time creating a new random number
and writing another line to the doc file. The loop register is used
as the key for each line, followed by the random number. The keys
in the doc file (first column) are numbered from 1-20. The second
columns all are '1', indicating that only one data item will
follow. The third column is the stored data - the random numbers. 
d814 6
a819 6
happened? Whereas SPIDER image and volume files are overwritten if
you use the same filename, the 'SD' operation appends to the end of the
doc file. This can be a problem: if you run a procedure file
repeatedly, the resulting doc file will grow and grow. You should
delete the old doc files first if you need to rerun the procedure
file.</p>
d824 2
a825 2
structure that provides conditional execution. The <i>IF</i> syntax
is:</p>
d828 3
a830 3
IF (TEST_CONDITION) THEN
   &lt;any SPIDER operations&gt;
ENDIF
d833 4
a836 4
where the test condition tests the value of an expression (see example
below). The SPIDER operations inside the IF statement are only
executed if the condition is true, otherwise processing just moves
to the next operation after the IF. 
d839 3
a841 3
statement. Copy bat03.spf to bat04.spf, and add the following lines
above the DO loop. In addition, make one change to the RAN
expression in the DO loop:</p>
d844 1
a844 1
; The new lines
d846 2
a847 2
IQ FI [exists]           ; If the following file exists, set [exists]=1, else [exists]=0
randoc
d849 4
a852 4
IF ([exists].EQ.1) THEN  ; IF [exists] is equal to 1, THEN do the following...
   DE
   randoc
ENDIF
d854 2
a855 2
; The DO loop :
[unused]= 0                ; Required for RAN operation
d857 1
a857 1
DO  [index] = 1,20
d862 2
a863 2
   randoc                  
ENDDO                     
d865 1
a865 1
EN D
d868 2
a869 2
Save the file as bat04.spf, and run: 
<font face="courier">spider spf/dat @@bat04</font> <p>
d871 2
a872 2
Look at the new contents of randoc.dat with the Unix
<i>cat</i> command:</p>
d877 7
a883 7
The <a href="man/iqfi.html">IQ FI</a> operation inquires if the file
exists. If so, its register is set to 1, otherwise to zero. The <a
href="man/de.html">DE</a> operation deletes its input file. Any
SPIDER operations between the IF..THEN and the ENDIF lines are only
executed if the condition is true. This construct is required
because 'DE' will report an error if it tries to delete a nonexistent
file. 
d886 3
a888 3
version of <a href="man/if.html">IF</a>, as well as 
<a href="man/if_goto.html">IF..GOTO</a>, which conditionally jumps to any
line in the procedure file. See the Manual of Operations for details. 
d891 2
a892 2
numbers. When you run bat04.spf, you should be back to a single set
of numbers in randoc.dat, this time in the range 0..360.</p>
d894 4
a897 4
The IF..THEN operation has additional clauses available for
<a href="man/elseif_then.html">ELSEIF THEN</a>, and
<a href="man/else.html">ELSE</a> as shown using the following
procedure b05.spf: 
d900 4
a903 4
[unused]= 0                     ; Required for RAN operation
[ran]  = 10 * RAN([unused])     ; Random number 0..10
[iran] = INT([ran])   
[iran]                          ; Echo: iran
d905 1
a905 1
IF([iran].LT.2) THEN
d907 1
a907 1
ELSEIF ([iran].LT.4) THEN
d909 1
a909 1
ELSEIF ([iran].LT.6) THEN
d911 3
a913 3
ELSE
    [xsize]=600 
ENDIF
d915 2
a916 2
VM
echo ' 'Xsize: {****[xsize]}
d921 2
a922 5
Save the file as bat05.spf, and run: 
<font face="courier">spider spf/dat @@bat05</font> <p>

The value of Xsizae reported by the procedure should vary with invocations
as the random number changes.<p>
d924 2
d927 1
a927 2
<p><a name="FILENAMES"><b>Run-time Designation of File
Names</b></a></p>
d930 2
a931 2
especially if you don't know how many there will be? SPIDER enables
filenames to be created at run time with the following syntax:</p>
d937 5
a941 6
where 'template' is a text string, there may be any number of
asterisks, and any [register-variable] may be used. This notation adds a file
number to the template. The number of asterisks denotes the number
of digits, while the value of the register variable sets the number. For
example, if [inum] = 2, then img{****[inum]} returns the text string
'img0002'. 
d946 1
a946 1
DO [idx] = 1,10
d948 1
a948 1
   [ang] = [idx] * 20  ; Use this as the rotation angle
d950 4
a953 4
   RT
     test001
     rot{***[idx]}     ; This will produce rot001, rot002, ...
     [ang]             ; Rotation angle
d955 1
a955 1
ENDDO
d957 1
a957 1
EN D
d960 3
a962 3
After running this procedure file, you should have files rot001.dat,
rot002.dat,... rot010.dat in the working directory. View this image
series in Web: 
d964 5
a968 5
<p><i>Commands/Montage</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Select rot001.dat (this is the
first image in the series), click 'Ok'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Enter 10 in the LAST FILE
NUMBER box, click 'Accept'</p>
d971 1
a971 1
rotations.</p>
d980 1
a980 1
; bat07.spf
d982 3
a984 3
; UD N counts the number of lines in the doc file, puts result in [n]
UD N [n]   
randoc
d986 1
a986 1
DO [idx] = 1,[n]   ; Loop for each line in the doc file
d995 1
a995 1
ENDDO
d997 1
a997 1
EN D
d1000 1
a1000 1
View the results in Web: 
d1002 1
a1002 2
<p><i>Commands/Clear</i><br>
</p>
d1005 2
a1006 2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; check the SHOW FILE NAMES box,
click 'Accept'</p>
d1010 2
a1011 3
be rot010.dat. Reselect rot001.dat as the first image.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set LAST FILE NUMBER to
20.</p>
d1014 1
a1014 1
orientations.</p>
d1019 2
a1020 2
files. They can have variable arguments that change with every call
to the procedure.</p>
d1022 1
a1022 2
<p>Copy bat07.spf to proc.spf, and make the following changes:<br>
</p>
d1025 2
a1026 1
<li>Add 3 FR operations to the top of the file. These File-Read
d1029 2
a1030 2
   procedure file that calls this procedure. The text inside the ?question
   marks? is used as a prompt in an interactive session; here, they
d1032 1
a1032 1
   expecting.<br>
d1037 1
a1037 1
                            "rot" to "[output]".<br>
d1041 3
a1043 2
procedure file have been executed, control is returned to the
calling procedure file.</li>
d1047 2
a1048 2
FR
  ?angles?[angsdocfile]      ; This sets [angsdocfile] = "randoc"
d1050 2
a1051 2
FR
  ?input file?[img]          ; This sets [img] = "filt001"
d1053 2
a1054 2
FR
  ?output template?[output]  ; Sets [output] = "rot"
d1056 2
a1057 2
UD N  [n]   
  [angsdocfile]              ; *** Change randoc to angsdocfile
d1059 1
a1059 1
DO LB1 [num] = 1,[n]
d1061 1
a1061 1
   UD x11,[ang]
d1069 1
a1069 1
ENDDO
d1077 1
a1077 1
; bat08.spf  : rotate images using a procedure call
d1079 4
a1082 4
@@proc          ; Call to the procedure (named proc)
  randoc       ; Doc file of rotation angles
  test001      ; Input file
  rot          ; Output template (will be expanded to rot001, rot002, ...)
d1084 1
a1084 1
               ; Any SPIDER operations may go here
d1086 1
a1086 1
EN D
d1089 6
a1094 6
The procedure call is simply the name of the procedure file
(without the extension), preceded by the '@@' sign. Subsequent lines
must have text strings which correspond to the FR operations in the
procedure. Any SPIDER operation can come before or after a procedure
call. Note: procedure files must have the same file extension
as the calling procedure file. 
d1097 1
a1097 1
SPIDER runs the procedure file, which in turn, calls the procedure.</p>
d1100 4
a1103 4
that the 3rd line after the procedure is "root", instead of "rot".
When you run the procedure file, it will create a new set of images.
Procedures provide reusable code with variable filenames, that can
be called by procedure files, or even other procedures.</p>
d1111 1
a1111 1
; bat09.spf  : Fourier transform images using a procedure call
d1113 2
a1114 2
[n] = 5        ; Number of images
@@proc-ft([n])  ; Call to the procedure (named proc-ft)
d1116 1
a1116 1
EN D
d1122 1
a1122 1
([numimgs])
d1124 1
a1124 1
DO [img]=1,[numimgs]
d1132 1
a1132 1
ENDDO
d1134 1
a1134 1
RE
d1139 3
a1141 3
SPIDER runs the procedure file: bat09 which in turn, 
calls the procedure: proc-ft with argument <i>[numimgs]</i> set to
the value of: 5.</p>
d1143 1
a1143 1
<p>Examine the Power Spectra in Web.  Adjust the contrast with
d1150 1
a1150 2
<p>
  <font size="2" face="times new roman">
d1152 1
a1152 1
  Authors: Bill Baxter &amp; ArDean Leith </font>
@


1.8
log
@*** empty log message ***
@
text
@d201 1
a201 1
 .EXISTING RAW FILE: esp
d262 1
a262 1
 .INPUT FILE: espnoise
d271 1
a271 1
View the noisy input: espnoise.dat and denoised output: filt002.dat.
d1158 2
a1159 2
  Updated Jul 31, 2009, &nbsp;&nbsp;&nbsp;
  Bill Baxter</font>&nbsp;&nbsp;&nbsp;
@


1.7
log
@*** empty log message ***
@
text
@d519 2
a520 2
<p>View the ribosome volume '<a href="ribosome.dat">ribosome.dat</a>'
 in Web:</p>
d524 2
a525 2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select ribosome.dat, click
'Accept'</p>
d534 1
a534 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select ribosome.dat<br>
d1143 2
a1144 1
<p>Run the procedure file: spider spf/dat @@bat09  
d1148 1
d1154 2
d1157 7
@


1.6
log
@nx
@
text
@d9 2
a10 1
<center> <h1><b>SPIDER/Web LAB</b></h1> </center>
d46 10
a55 8
<a href="tutorial.html">SPIDER Tutorial</a> is a more detailed tour of many
SPIDER operations. The SPIDER 
<a href="operations_doc.html">Manual of operations</a> 
provides information on the specific options and
choices of parameters for each SPIDER operation. The 
<a href="user_doc.html">User's guide</a> covers issues relating to the
syntax and conventions of SPIDER, including a longer section on writing
and using procedures.
a56 1
<br>
d93 1
a93 1
 .OPERATION: mo
d161 1
a161 1
 .OPERATION: pt
d199 1
a199 1
 .OPERATION: cp from raw
d218 1
a218 1
 .OPERATION: mr
d238 1
a238 1
 .OPERATION: fq np
d260 1
a260 1
 .OPERATION: ce med
d284 1
a284 1
 .OPERATION: sh
d305 1
a305 1
 .OPERATION: su
d342 1
a342 1
 .OPERATION: cc
d415 1
a415 1
 .OPERATION:  pk [ix],[iy]
d467 1
a467 1
 .OPERATION: su
d554 1
a554 1
 .OPERATION: sd 1, [ix], [iy], [ixn], [iyn]
d567 1
a567 1
 .OPERATION: vm
d589 1
a589 1
.OPERATION: en
d617 3
a619 3
test001   ; The input image
rot001    ; The output image
60        ; Rotation angle (in degrees)
d622 3
a624 3
rot001    ; Input image
big001    ; Output image
150,150   ; New dimensions
d627 4
a630 4
big001    ; Input image
win001    ; Output image
75,75     ; Size of the window
1,75      ; Top left coordinates
d717 3
a719 3
test001 
_1        ; ***** Replace the output filename with _1
60        
d722 3
a724 3
_1        ; ***** Use the above result
_2        ; ***** Replace the output filename with _2
150,150 
d727 4
a730 4
_2        ; ***** Use the above result
win002    ; ***** Give the final result a different number
75,75 
1,1       ; ***** Window out a different region 
d788 1
a788 1
   randoc                  ;    20 times.
d956 3
a958 3
   test001
   rot{***[idx]}       ; This will produce rot001, rot002, ...
   [ang]               ; Rotation angle
d994 1
a994 1
   randoc
d997 3
a999 3
   filt001
   rot{***[idx]} 
   [rotang]
d1054 1
a1054 1
?angles?[angsdocfile]      ; This sets [angsdocfile] = "randoc"
d1057 1
a1057 1
?input file?[img]          ; This sets [img] = "filt001"
d1060 1
a1060 1
?output template?[output]  ; Sets [output] = "rot"
d1063 1
a1063 1
[angsdocfile]              ; *** Change randoc to angsdocfile
d1068 1
a1068 1
   [angsdocfile]           ; *** Change randoc to angsdocfile
d1071 3
a1073 3
   [img]                   ; *** Change filt001 to [img]
   [output]{***[num]}        ; *** This becomes rot001, rot002, ...
   [ang]
d1077 1
a1077 1
RE                         ; ***** IMPORTANT - CHANGE "EN D" TO "RE"  *****
d1085 4
a1088 4
@@proc        ; Call to the procedure (named proc)
randoc       ; Doc file of rotation angles
test001      ; Input file
rot          ; Output template (will be expanded to rot001, rot002, ...)
d1090 1
a1090 1
             ; Any SPIDER operations may go here
d1132 2
a1133 2
   sam{***[img]}      ; Input image
   four{***[img]}     ; Output Fourier image
d1136 2
a1137 2
   four{***[img]}     ; Input image
   pow{***[img]}      ; Output Power spectrum
@


1.5
log
@added stuff for workshop'
@
text
@d95 1
a95 1
 .ENTER DIMENSIONS (NSAM,NROW): 75,75
d163 1
a163 1
 .ENTER DIMENSIONS (NSAM,NROW): 75,75
d493 1
a493 1
 .ENTER DIMENSIONS (NSAM,NROW,NSLICE): 75,75,75
@


1.4
log
@*** empty log message ***
@
text
@d1 1
a1 1
<!DOCTYPE html PUBLIC "-//w3c//dtd html 3.2//en">
d4 1
a4 1
   <title>SPIDER Quick Start</title>
d9 2
a10 1
<center> <h1><b>A Quick Start Guide to SPIDER and WEB</b></h1> </center>
d16 3
a18 1
<p><a href="#INTRO">Introduction</a><br>
d30 9
a38 2
<a href="quickstart2.html">Part II : SPIDER Procedure files</a></p>

d40 1
d44 10
a53 8
<p>Below is a brief introduction to SPIDER and WEB. The <a href=
"tutorial.html">SPIDER Tutorial</a> is a more detailed tour of many
SPIDER operations. The SPIDER <a href="operations_doc.html">Manual
of operations</a> provides information on the specific options and
choices of parameters for each SPIDER operation. The <a href=
"user_doc.html">User's guide</a> covers issues relating to the
syntax and conventions of SPIDER, including a section on writing
and using procedures.<br>
d55 1
a55 2
<a name="SPIDER"><b>Filename extensions and starting
SPIDER</b></a></p>
d58 1
a58 1
filename extension.</p>
d60 2
a61 2
<p>For this lab, we will use the extension is "ext". In a Unix
window, start SPIDER by typing at the Unix prompt:</p>
d64 1
a64 1
    spider ext
d87 2
a88 2
<p>Create a simple image with the <a href="man/mo.html">MO</a>
operation:</p>
d112 5
a116 3
the user to view the output files. In another Unix window, type
'web' followed by the data extension, and an ampersand (&amp;) to
put it in the background:</p>
d119 1
a119 1
  web ext &amp;
d123 2
a124 2
When Web starts up, you will see a blank background screen, with
menus at the top and a status window at the bottom. 
d133 1
a133 1
to be viewed (circ001.ext). Web displays the image, and prints out
d135 1
a135 1
status window at the bottom.</p>
d137 1
a137 1
<p>The size of the displayed image may be adjusted: select
d141 1
a141 1
<i>Commands/Image</i> again to view circ001.ext. It should appear
d146 2
d150 1
a150 1
forth between SPIDER and Web, performing image processing in
d153 1
a153 2
<p><a name="TEST"><b>Creating another test image in
SPIDER</b></a></p>
d155 2
a156 3
<p>The PT operation allows you to create geometric shapes. Here is
another test image you can make using <a href=
"man/pt.html">PT</a>:</p>
d184 1
a184 1
In Web, view the resulting test file, test001.ext with
d190 37
d229 5
a233 5
<p>SPIDER has a variety if filtering operations. The <a href=
"man/fqnp.html">FQ NP</a> operation provides a set of filters to
choose from. Filter your test image with FQ NP. NOTE: text after a
semicolon (;) is a SPIDER comment. You DO NOT have to type the
comment on the line prompting for FILTER TYPE!</p>
d238 1
a238 1
 .INPUT FILE: test001
d242 1
a242 1
 .FILTER TYPE (1-8): 3      ; selects Gaussian low-pass filter
d248 24
a271 3
blur the image, while high-pass filters emphasize the edges. You
can experiment with a filter by adjusting the filter radius, or
even try different filters. 
a272 2
<p><a name="GEO_OPS"><b>Geometric and Algebraic
operations</b></a></p>
d274 2
d277 2
a278 2
(<a href="man/sh.html">SH</a>), or resizing (<a href=
"man/ip.html">IP</a>) the image. Apply a shift operation to an
d284 1
a284 1
 .INPUT FILE: filt001
d291 1
a291 1
View the result, shift001.ext. For most operations, the origin of
d305 1
a305 1
 .INPUT FILE: test001
d314 1
a314 1
The SU operation allows you to subtract as many images as you want,
d316 1
a316 1
sub001.ext in Web. The two images were subtracted pixel-by-pixel.
d323 1
a323 1
is -1.0 ... 1.0. This means that for images with different ranges,
d344 1
a344 1
 .REFERENCE FILE: filt001
d360 1
a360 1
contrast back to the original values (64,127). 
d364 7
a370 3
<p>SPIDER provides variables to hold temporary values. These
variables are called 'registers' and are named X11, X12, ..., X99
(X01 through X10 are reserved). You can use registers anywhere you
d375 1
a375 1
 .OPERATION: x11 = 25
d377 1
a377 1
 .OPERATION: x12 = x11 + 3.5
d383 1
a383 1
 .OPERATION: x11
d386 1
a386 1
 .OPERATION: x12
d390 11
d407 1
a407 1
operation line. In the following example, registers x11 and x12 are
d413 1
a413 1
 .OPERATION:  PK X11,X12
d423 1
a423 1
 .OPERATION: x11
d426 1
a426 1
 .OPERATION: x12
d432 1
a432 1
way to get more accurate floating point values (see PK in the
d438 1
a438 1
 .OPERATION: x21 = -x11 
d440 1
a440 1
 .OPERATION: x22 = -x12
d458 1
a458 1
 .SHIFT COMPONENTS IN X-Y: x21, x22     ; instead of -17,7 
d467 1
a467 1
 .INPUT FILE: test001
d476 2
a477 2
How does the subtracted image sub002.ext appear? Compare to
sub001.ext. The new difference image is zero (gray) everywhere,
d493 1
a493 3
 .ENTER DIMENSIONS (NSAM,NROW): 75,75

 .ENTER NUMBER OF SLICES (NSLICE): 75
d495 1
a495 1
 .B/C/G/H/HA/NUM/R/S/SP/SPA/SPV/T/W: sp  ;selects sphere from the menu
d503 1
a503 1
 .X,Y,Z: 38,38,38        ; the sphere's center
d505 1
a505 1
 .X,Y,Z: 0,0,0          ; terminates the operation
d510 1
a510 1
sphere.ext. If a volume is selected for display, Web pops up a
d517 2
a518 3
<p>If the ribosome volume '<a href="ribosome.ext">ribosome.ext</a>'
is available (download by right clicking "Save Link As.."), view it
in Web:</p>
d522 1
a522 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select ribosome.ext, click
d526 1
a526 1
intersubunit space in someof the central slices.</p>
d532 3
a534 3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select ribosome.ext<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set Scale to 5.0, PHI to 50,
THETA to 74, click 'Accept'</p>
d537 1
a537 3
subunit on the right. The intersubunit space is visible as a cavity
between the subunits. The stalk base is a protuberance in the
center of this view.</p>
d552 1
a552 1
 .OPERATION: sd 1, x11, x12, x21, x22
d558 5
a562 3
doc001.ext. This file can be viewed in a text editor, or with the
Unix 'cat' operation (it may not be visible until the SPIDER session
has ended). 
d564 7
a570 1
<p>The doc file has several entries:</p>
d573 1
a573 1
 ;ext/ext   01-JUN-2002 AT 20:29:05   doc001.ext
d584 217
a800 1
<p>End the SPIDER session:</p>
d803 1
a803 1
 .OPERATION: en d
d806 346
a1151 4
<p><br>
Go on to <a href="quickstart2.html">Part II : SPIDER Procedure
files</a></p>
</body>
a1152 1

@


1.3
log
@procedures
operations
@
text
@d27 1
a27 1
<a href="quickstart2.html">Part II : SPIDER Batch files</a></p>
@


1.2
log
@xhtml
@
text
@d4 1
a4 2
<meta name="generator" content="HTML Tidy, see www.w3.org">
<title>SPIDER Quick Start</title>
a5 5
<body bgcolor="#ffffff" text="#000000" link="#0000FF" vlink=
"#800080" alink="#ff0000">
<center>
<h1><b>A Quick Start Guide to SPIDER and WEB</b></h1>
</center>
d7 4
d12 2
a13 3
<center>
<h3><b>Part I : An interactive session with SPIDER and WEB</b></h3>
</center>
d37 1
a37 1
choices of parameters for each SPIDER command. The <a href=
d62 1
a62 1
SPIDER commands are entered at the .OPERATION: prompt. These in
d64 1
a64 1
that command, such as 
d76 1
a76 1
command:</p>
d93 1
a93 1
information. Once the command has all the required arguments, it
d133 1
a133 1
<p>As you try out the SPIDER commands below, you will go back and
d140 1
a140 1
<p>The PT command allows you to create geometric shapes. Here is
d179 1
a179 1
"man/fqnp.html">FQ NP</a> command provides a set of filters to
d243 1
a243 1
so you must enter an asterisk (*) to terminate the command. View
d318 1
a318 1
The <a href="man/pk.html">PK</a> command prints its results to the
d320 1
a320 1
command line. In the following example, registers x11 and x12 are
d399 1
a399 1
href="man/mo3.html">MO 3</a> command:</p>
d420 1
a420 1
 .X,Y,Z: 0,0,0          ; terminates the command
d463 1
a463 1
with the <a href="man/sd.html">SD</a> command, which writes one
d465 2
a466 2
command line. The first number (here 1), is the <i>key</i>. This
doc file can be read by other SPIDER commands; the key tells SPIDER
d477 1
a477 1
Unix 'cat' command (it may not be visible until the SPIDER session
d501 1
a501 1
Go on to <a href="quickstart2.html">Part II : SPIDER Batch
@


1.1
log
@Initial revision
@
text
@d1 508
a508 322
<!doctype html public "-//w3c//dtd html 3.2//en">

<html>

<head>
<title>SPIDER Quick Start</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#0000FF" vlink="#800080" alink="#ff0000">
<center>
<h1><b>A Quick Start Guide to SPIDER and WEB</b></h1>
</center>
<p>
<hr>
<p>
<center>
<h3><b>Part I : An interactive session with SPIDER and WEB</b></h3>
</center>

 <p>
<a href="#INTRO">Introduction</a><br>
<a href="#SPIDER">Filename extensions and starting SPIDER</a><br>
<a href="#WEB">WEB</a><br>
<a href="#TEST">Creating another test image in SPIDER</a><br>
<a href="#FILTER">Filtering</a><br>
<a href="#GEO_OPS">Geometric and Algebraic operations</a><br>
<a href="#CORREL">Correlation</a><br>
<a href="#REGISTERS">Registers</a><br>
<a href="#PEAK">Peak Search</a><br>
<a href="#SHIFT">Shift Alignment</a><br>
<a href="#VOLUME">Volumes</a><br>
<a href="#DOCS">Document Files</a><br>
<a href="quickstart2.html">Part II : SPIDER Batch files</a>
<p>

<p>
<a name="INTRO"><b>Introduction</b></a>
 <p>
Below is a brief introduction to SPIDER and WEB. The <a href="tutorial.html">SPIDER Tutorial</a> is a more detailed tour of many SPIDER operations. The SPIDER <a href="operations_doc.html">Manual of operations</a> provides  information on the specific options and choices of parameters for each SPIDER command. The <a href="user_doc.html">User's guide</a> covers issues relating to the syntax and conventions of SPIDER, including a section on writing and using procedures.
<br> 
<br>
<a name="SPIDER"><b>Filename extensions and starting SPIDER</b></a>
 <p>
SPIDER expects all files within a session to have the same filename extension. 
 <p>
For this lab, we will use the extension is "ext". In a Unix window, start SPIDER by typing at the Unix prompt:
 <pre>    spider ext</pre> 
You will see a start banner with the version number, followed by the prompt:
 <pre>    .OPERATION: </pre>
SPIDER commands are entered at the .OPERATION: prompt. These in turn are followed by prompts asking for parameters specialized for that command, such as
<pre>    .INPUT FILE:</pre> 
When in a SPIDER session, type all filenames without their extensions. In the exercises below, enter the provided text and numbers after each prompt. SPIDER prompts always start with a period (.) and end with a colon (:)
<p>
Create a simple image with the <a href="man/mo.html">MO</a> command:
<pre>
 .OPERATION: mo

 .OUTPUT FILE: circ001

 .ENTER DIMENSIONS (NSAM,NROW): 75,75
 
 .B/C/G/R/S/T/W:  c
 
 .RADIUS (FLOATING POINT): 16

 .OPERATION: 
</pre>

You will see SPIDER echo the input, as well as print out additional information. Once the command has all the required arguments, it carries out the processing, and returns to the .OPERATION: prompt. View the image you have created in Web (below).
<p>
<a name="WEB"><b>WEB</b></a>
<p>
Web is often run simultaneously with a SPIDER session, allowing the user to view the output files. In another Unix window, type 'web' followed by the data extension, and an ampersand (&) to put it in the background:
<pre>
  web ext &
</pre>
Adjust the Web and SPIDER windows so that you can see both of them. When Web starts up, you will see a blank background screen, with menus at the top and a status window at the bottom.
<p>
Options listed under the main menu headings will be written as: <i>Menu/Command</i>
<p>
For example, when Web is first started, you may have to clear the screen with the option <i>Commands/Clear</i>
<p>
To view an image, use <i>Commands/Image</i>, and select the file to be viewed (circ001.ext). Web displays the image, and prints out some information (image size and range of the gray levels) in the status window at the bottom.
<p>
The size of the displayed image may be adjusted: select <i>Options/Image</i>, and enter -2 in the SIZE REDUCTION entry box. Positive numbers will decrease the size by the specified factor, while negative numbers will enlarge the displayed image. Use <i>Commands/Image</i> again to view circ001.ext. It should appear larger this time. All subsequently displayed images will also be enlarged, until SIZE REDUCTION is changed again. Remember, Web only displays a picture - it does not actually enlarge the original data file.
<p>
As you try out the SPIDER commands below, you will go back and forth between SPIDER and Web, performing image processing in SPIDER, and using Web to view the results.
<p>
<a name="TEST"><b>Creating another test image in SPIDER</b></a>
<p>
The PT command allows you to create geometric shapes. Here is another test image you can make using <a href="man/pt.html">PT</a>:
<pre>
 .OPERATION: pt

 .OUTPUT FILE: test001

 .ENTER DIMENSIONS (NSAM,NROW): 75,75

 .ENTER CODE (P,L,C,T,R,S): r

 .ENTER COORDINATES OF UPPER LEFT POINT: 18,12

 .ENTER  X & Y OFFSETS: 38,16

 .CONTINUE? (Y/N): y 

 .ENTER CODE (P,L,C,T,R,S): t

 .ENTER COORDINATES OF FIRST  POINT: 18,33

 .ENTER COORDINATES OF SECOND POINT: 56,36

 .ENTER COORDINATES OF THIRD  POINT: 32,66

 .CONTINUE? (Y/N): N
</pre>
In Web, view the resulting test file, test001.ext with <i>Commands/Image</i>. It doesn't show up in the Image file selection dialog? Every time you create a new image file, you need to press the 'Filter' button, so the program will reread the contents of the current directory. 
<p>
<a name="FILTER"><b>Filtering</b></a>
<p>
SPIDER has a variety if filtering operations. The <a href="man/fqnp.html">FQ NP</a> command provides a set of filters to choose from. Filter your test image with FQ NP. NOTE: text after a semicolon (;) is a SPIDER comment. You DO NOT have to type the comment on the line prompting for FILTER TYPE! 
<pre>
 .OPERATION: fq np

 .INPUT FILE: test001

 .OUTPUT FILE: filt001

 .FILTER TYPE (1-8): 3      ; selects Gaussian low-pass filter

 .FILTER RADIUS: 0.1 
</pre>
View the result of the low-pass filter. Low-pass filters tend to blur the image, while high-pass filters emphasize the edges. You can experiment with a filter by adjusting the filter radius, or even try different filters.
<p>
<a name="GEO_OPS"><b>Geometric and Algebraic operations</b></a>
<p>
These include rotating (<a href="man/rt.html">RT</a>), shifting (<a href="man/sh.html">SH</a>), or resizing (<a href="man/ip.html">IP</a>) the image. Apply a shift operation to an image:
<pre>
 .OPERATION: sh

 .INPUT FILE: filt001

 .OUTPUT FILE: shift001

 .SHIFT COMPONENTS IN X-Y: 16.7, -7.2            
</pre>
View the result, shift001.ext. For most operations, the origin of SPIDER coordinates is in the upper left corner, which is pixel 1,1 (not 0,0!). So a positive X shift moves the image to the right, a negative Y shift moves the image up. Note that the image may be shifted by non-integer values.
<p>
Images may be added (<a href="man/ad.html">AD</a>), subtracted (<a href="man/su.html">SU</a>), or multipiled (<a href="man/mu.html">MU</a>) together. Subtract the image you just shifted from the original test image: 
<pre>
 .OPERATION: su

 .INPUT FILE: test001

 .SUBTRACTED FILE: shift001

 .OUTPUT FILE: sub001

 .SUBTRACTED FILE: *
</pre>
The SU operation allows you to subtract as many images as you want, so you must enter an asterisk (*) to terminate the command. View sub001.ext in Web. The two images were subtracted pixel-by-pixel. In the resulting 'difference image', positive areas (where test001 pixels &gt; shift001 pixels) appear light, while negative areas are dark. Pixels where the two images were equal are zero, and appear as gray. Web always stretches the contrast so that the pixels with the smallest (or most negative) value are set to black, and the pixels with highest value are white. Note the range of this image is -1.0 ... 1.0. This means that for images with different ranges, their gray levels in Web are not comparable.
<p>
<a name="CORREL"><b>Correlation</b></a>
<p>
Cross correlation (<a href="man/cc.html">CC</a>) is a way to measure the similarity of 2 images. The 2 images are multiplied together, pixel by pixel, and the sum of these multiplications is stored at a location representing the position of image1 relative to image2. Then the images are shifted by one pixel, and multiplied again, with the resultant value stored at the next pixel. This is carried out by shifting image1 across all positions of image2 (the reference image). Pixels with high values ('peaks') in the cross correlation result show where the best matches were, while the amplitude of the peaks indicates the degree of similarity.
<pre>
 .OPERATION: cc

 .INPUT FILE: shift001

 .REFERENCE FILE: filt001

 .OUTPUT FILE: cc001
</pre>
View the cross correlation result in Web. There should be a bright spot indicating the location of the best match, or highest correlation. Select <i>Options/Contrast</i>. The sliders allow you to change the way the pixel intensities are displayed. Move the left slider rightward until the correlation result appears as nearly a single pixel. Next, set both sliders to the same intermediate value, e.g., 90. What happens to the images? They are binarized - all pixels above the threshold are white, pixels below the threshold are black. These contrast numbers refer the to actual pixels in the onscreen display, not to the floating point pixel intensities in the image files. When you are done, reset the contrast back to the original values (64,127).
<p>
<a name="REGISTERS"><b>Registers</b></a>
<p>
SPIDER provides variables to hold temporary values. These variables are called 'registers' and are named X11, X12, ..., X99 (X01 through X10 are reserved). You can use registers anywhere you would normally enter a number in SPIDER. Registers can be used as a form of pocket calculator. At the prompt, type:
<pre>
 .OPERATION: x11 = 25

 .OPERATION: x12 = x11 + 3.5
</pre>
Typing the register alone at the prompt returns its value:
<pre>
 .OPERATION: x11
   25.000000    

 .OPERATION: x12
   28.500000    
</pre>
<a name="PEAK"><b>Peak search</b></a>
<p>
A peak search is commonly applied after a correlation, to find the location of the best match - a 'peak' in the pixel intensities. The <a href="man/pk.html">PK</a> command prints its results to the screen, but it can also store these values in registers on the command line. In the following example, registers x11 and x12 are set to the X and Y coordinates of the highest peak found. Apply a peak search to the cross correlation result to find the coordinates of the bright spot:
<pre>
 .OPERATION:  PK X11,X12

 .INPUT FILE: cc001

 .ENTER # OF PEAKS, CENTER ORIGIN OVERRIDE (0/1): 1,0
</pre>
Check the values of the registers:
<pre>
 .OPERATION: x11
   17.000000    

 .OPERATION: x12
   -7.0000000
</pre>
These numbers show the position of the highest peak (best match) relative to the image center. These are integers, but there is a way to get more accurate floating point values (see PK in the Operations Manual). To shift back to the center, we have to use the negative of these numbers. Put the negative values in other registers:
<pre>
 .OPERATION: x21 = -x11 

 .OPERATION: x22 = -x12
</pre>

<a name="SHIFT"><b>Shift Alignment</b></a>
<p>
Use the results from the peak search to align the shifted image to the original test image. For the X,Y shift components, use the negative of the numbers obtained from the peak search (i.e., -17 and 7). Since we have these numbers in registers, use registers x21 and x22 in place of the actual numbers. 
<pre>
 .OPERATION: sh

 .INPUT FILE: shift001

 .OUTPUT FILE: align001

 .SHIFT COMPONENTS IN X-Y: x21, x22     ; instead of -17,7 
</pre>

Compare the 'aligned' image with the original test image by subtracting them:
<pre>
 .OPERATION: su

 .INPUT FILE: test001

 .SUBTRACTED FILE: align001

 .OUTPUT FILE: sub002

 .SUBTRACTED FILE: *
</pre>
How does the subtracted image sub002.ext appear? Compare to sub001.ext. The new difference image is zero (gray) everywhere, except around the edges of the shapes. This is because the edges were blurred in the filtered image, and therefore do not match the original sharp edges exactly.
<p>

<a name="VOLUME"><b>Volumes</b></a>
<p>
A volume may be visualized in Web by viewing it slice-by-slice, or by surface rendering. Create a model volume with SPIDER's <a href="man/mo3.html">MO 3</a> command:
<pre>
 .OPERATION: MO 3

 .OUTPUT FILE: sphere

 .ENTER DIMENSIONS (NSAM,NROW): 75,75

 .ENTER NUMBER OF SLICES (NSLICE): 75

 .B/C/G/H/HA/NUM/R/S/SP/SPA/SPV/T/W: sp  ;selects sphere from the menu

 .GET COORDINATES FROM DOCUMENT FILE (Y/N): n

 .ENTER MASS VALUE PER VOXEL (DEFAULT = 2.0): 2
   
 .OUTER AND INNER RADII OF SPHERES: 19,14
   
 .X,Y,Z: 38,38,38        ; the sphere's center
    
 .X,Y,Z: 0,0,0          ; terminates the command
</pre>
View the volume slice by slice in Web. Under <i>Options/Image</i>, set SIZE REDUCTION to 1. Under <i>Commands/Image</i>, select sphere.ext. If a volume is selected for display, Web pops up a dialog box that lets the user select which slices to display. Just click the 'Accept' button to view all slices. You should see a montage of all 75 slices from top to bottom of the sphere. You can see that it is hollow in the center, but some images contain circles as the volume is sliced.
<p>
If the ribosome volume '<a href="ribosome.ext">ribosome.ext</a>' is available (download by right clicking "Save Link As.."), view it in Web:
<p>
<i>Commands/Clear</i><br>
<i>Commands/Image</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select ribosome.ext, click 'Accept'
<p>
You will see slices of the ribosome volume, with a dark intersubunit space in someof the central slices.
<p>
Now create a surface rendering of the volume.
<p>
<i>Commands/Clear</i><br>
<i>Commands/Surface</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    select ribosome.ext<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    set Scale to 5.0, PHI to 50, THETA to 74, click 'Accept'
<p>
In this view, the small subunit is on the left, the large subunit on the right. The intersubunit space is visible as a cavity between the subunits. The stalk base is a protuberance in the center of this view.
<P>
Click the right mouse button to end the surface session.
<p>

<a name="DOCS"><b>Document files</b> </a>
<P>
Information obtained during a SPIDER session can be saved to document files (called doc files). Data is written to a doc file with the <a href="man/sd.html">SD</a> command, which writes one line at a time. The numbers to be stored are placed on the SD command line. The first number (here 1), is the <i>key</i>. This doc file can be read by other SPIDER commands; the key tells SPIDER which line to read.
<pre>
 .OPERATION: sd 1, x11, x12, x21, x22

 .DOCUMENT FILE: doc001
</pre>
This writes the values of those four registers to the file doc001.ext. This file can be viewed in a text editor, or with the Unix 'cat' command (it may not be visible until the SPIDER session has ended).
<p>
The doc file has several entries: 
<pre>
 ;ext/ext   01-JUN-2002 AT 20:29:05   doc001.ext
    1 4  17.000     -7.0000     -17.000      7.0000    
</pre>
The first line, starting with the semicolon, is a comment line with file creation information. The lines following the comment have the following format:
<p>
&lt;key&gt; &lt;number of data items in this line&gt; &lt;data&gt; &lt;data&gt; &lt;data&gt; &lt;data&gt;
<p>

End the SPIDER session:
<pre>
 .OPERATION: en d
</pre>
<p>

<br>
Go on to <a href="quickstart2.html">Part II : SPIDER Batch files</a>
</body>

</html>
@
