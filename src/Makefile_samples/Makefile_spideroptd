# 
# MAKEFILE FOR Debugging GNU/Linux SPIDER using FFTW on Opteron 64 
# 
# USAGE: make -f Makefile_spideroptd
#
# Using: nVidia HPC compiler (formerly Portland Group)
#        Non-native mode byte ordering on:  AMD Opteron GNU/Linux 64 bit OS
#        FFTW must be configured with: --enable-float --enable-type-prefix
#
# Note:  You may ignore any undefined QFFLAGS, QLFLAGS & SUFFIX
#
# nVidia HPC compile/link flags
# -O2             : Invokes level 2 optimization (-O3 causes some run time problems with PGI compiler on SPIDER code)
# -Kieee          : Invokes strict IEEE floating calculations
# -mp             : Invokes multi processor support  (needed to link in PGI 2013)
# -tp znver4      : Targets AMD Zen 4 architecture (Ryzen 4)
# -fast           : Selects appropriate set of flags usually including -O2 -Munroll -Mnoframe
# -mcmodel=medium : Allows use of >2GB data area
# -Bstatic        : Static link
# -g              : Debugger

AFLAGS   = r

SHELL    = /bin/sh

# Location of PGI Fortran (now nVidia HPC) compiler
COMP    = /opt/nvidia/hpc_sdk/Linux_x86_64/25.7/compilers/bin/nvfortran

PGM        = spider

EXE        = spideroptd

LIB        = spideroptd.a

FFLAGS     = -g -Bstatic -tp znver4 -fast    -mcmodel=medium -O0 -Mpreprocess -Kieee -Minfo=accel,lre,mp,par,stdpar -byteswapio -DSP_LIBFFTW3 -c

LF         = -g -Bstatic -tp znver4 -fast    -mcmodel=medium $(QLFLAGS)

FFTWLIBDIR = ../fftw/fftw-3.3.10/lib

LINKLIBS   = -Bstatic -L$(FFTWLIBDIR) -lfftw3f -lfftw3f_threads -lm

.PRECIOUS : ../bin/$(EXE) $(LIB) 

include Makefile.inc

include Makebody.inc

clean:
	rm -f *.mod *.MOD *.a
