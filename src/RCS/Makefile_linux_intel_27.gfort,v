head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2025.09.21.19.00.47;	author dean;	state Exp;
branches;
next	;


desc
@Makefile for creating Makefile_linux_intel_gfort_27
@


1.1
log
@Initial revision
@
text
@# 
# PURPOSE:  MAKEFILE FOR GNU/Linux SPIDER using FFTW3 using multiple processors. Compiled with gfortran
#
# USING:    Gnu Fortran compiler !!
# TARGET:   Same machine as compiled on  
# IMAGES:   Optimal SPIDER image byte order:    native to machine 
# USAGE:    To create executable:  make -f Makefile_linux_intel_27.gfort 
#
# FOR INITIAL USE:  \rm spider_linux_intel_gfort_27.a  *.mod
#                   See note on compilation order in: Makefile.inc
#
# NOTE:     Uses FFTW3 configured with: --enable-float --enable-openmp
# NOTE:     You may ignore any undefined QFFLAGS, QLFLAGS & SUFFIX
#
# NOTE:     SINCE .MOD FILES ARE NOT COMPATIBLE WITH THOSE PREPARED BY
#           OTHER COMPILERS BE SURE AND COMPILE IN A CLEAN DIRECTORY!!!
#
# Some gfortran Compile/link flags
# -fopenmp             : Invokes multi processor support 
# -Ofast               : Selects fast set of flags for this architecture 
# -fwrapv              : Wrapping of underflow/overflow  (needed for correct results in: bpcg.f)
# -fno-strict-aliasing :
# -Wall                      : Warn of possible errors
# -fallow-argument-mismatch' : Needed for conflation of COMPLEX/REAL

SHELL    = /bin/sh

AFLAGS   = r

# Location of Fortran compiler
COMP     = /usr/bin/gfortran-13

PGM      = spider

WHICH    = linux_intel_gfort

SUFFIX   = 27

LIB      = $(PGM)_$(WHICH)_$(SUFFIX).a

EXE      = $(PGM)_$(WHICH)_$(SUFFIX)

LF       = $(QLFLAGS)  

FFLAGS    = -cpp -Ofast -funroll-loops -finline-limit=600  -DSP_LIBFFTW3 -DSP_GFORTRAN  -fno-strict-aliasing -fwrapv  -fallow-argument-mismatch -c   

# Tapu's: FFLAGS = -cpp -Ofast -funroll-loops -finline-limit=600 -DSP_LIBFFTW3 -DSP_GFORTRAN -fno-strict-aliasing -fwrapv -fallow-argument-mismatch -c
#  
# Static link with static FFTW3 libraries 
# Tapu's: FFTWLIBDIR = ../fftw/fftw-3.3.10/lib
#         FFTWLIBDIR = ../../fftw/fftw3-opt64-gfort/lib
#         FFTWLIBDIR = ../../fftw/fftw321-intel/lib
#         FFTWLIBDIR = ../../fftw/fftw3-opt64-gfort/lib
#
#         FFTWLIBDIR = fftw321-opt64/       NO
#         FFTWLIBDIR = fftw321-intel/       BAD ARCH
#         FFTWLIBDIR = fftw337-intel64-icc/ NO INTEL...

#LINKLIBS  = -L$(FFTWLIBDIR) -llibfftw3f.a -llibfftw3f_threads.a -llibfftw3f_omp.a

FFTWLIBDIR = /home/dean/Software/spider-2026/fftw/fftw3310-intel-gfort/lib/

LINKLIBS   = $(FFTWLIBDIR)/libfftw3f.a  $(FFTWLIBDIR)/libfftw3f_threads.a 

.PRECIOUS :  $(EXE) $(LIB) 

include Makefile.inc

$(EXE) : $(LIB)
	@@echo "        "
	@@echo "        Linking now:  $(COMP) $(LF)  $(LIB) $(LINKLIBS) -o $(EXE)"
	$(COMP) $(LF)  $(LIB) $(LINKLIBS) -o $(EXE)
	@@echo "Created: $(EXE)"
	@@echo " "

$(LIB) : $(ELEMENTS)
	@@echo "         "
	@@echo "        Linking $(EXE) now ----"
.f.a:
	@@echo "         "
	@@echo "        Compiling and archiving $(COMP) $(FFLAGS) $< now ----"
	$(COMP) $(FFLAGS) $<
	$(AR) $(AFLAGS) $(LIB) $*.o
	@@\rm $*.o


#SRCS = $(patsubst %.f, %.o, $(filter-out $(EXCLUDE), $(wildcard *.f)))

clean:
	rm -f *.mod *.MOD *.a

@
